import{l as It,o as Ue,T as Gs,R as zr,E as Dh,M as me,U as Na,q as Fr,r as Rn,S as Xs,u as Zs,c as De,B as gt,b as P,V as ke,P as Fs,v as Qs,w as Fn,x as re,C as Lh,W as Mr,y as Et,z as Pt,D as wi,H as Ot,J as Hs,K as tt,Q as Nh,X as _h,Y as _a,Z as Ua,_ as Ba,$ as ka,a0 as Yr,a1 as za,a2 as Uh,a3 as Vr,a4 as As,a5 as Dr,a6 as Bh,a7 as kh,a8 as qs,a9 as Lr,aa as kt,ab as Pu,ac as Zi,j as ra,ad as zh,ae as yi,af as Ou,ag as Mu,ah as Yh,ai as Gr,G as Nr,aj as ls,ak as ht,al as Ze,L as xs,am as Hr,an as dt,O as xn,ao as as,ap as Ya,aq as Va,ar as Ga,as as Du,at as Lu,au as Nu,av as _u,aw as Uu,ax as xr,ay as At,az as Bu,aA as Nl,aB as ku,aC as zu,aD as Yu,aE as Vu,aF as Qi,aG as Gu,aH as Xn,aI as Hu,aJ as ju,aK as oa,aL as bn,aM as Ku,aN as Wu,d as Xu,aO as Zu,aP as Ha,aQ as Qu,aR as Zn,aS as os,aT as qu,aU as Ju,aV as $u,aW as ed,aX as td,aY as _l,aZ as sd,a_ as nd,a$ as id,b0 as Vh,b1 as rd}from"./index-Dhy3Nnp8.js";var od=Object.defineProperty,ad=(c,e,t)=>e in c?od(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,T=(c,e,t)=>(ad(c,typeof e!="symbol"?e+"":e,t),t),ld=Object.defineProperty,hd=(c,e,t)=>e in c?ld(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t,b=(c,e,t)=>(hd(c,typeof e!="symbol"?e+"":e,t),t);const Gh=0,cd=1,ud=2,Ul=2,_o=1.25,Bl=1,Rr=6*4+4+4,jr=65535,dd=Math.pow(2,-24),Uo=Symbol("SKIP_GENERATION");function pd(c){return c.index?c.index.count:c.attributes.position.count}function Pn(c){return pd(c)/3}function fd(c,e=ArrayBuffer){return c>65535?new Uint32Array(new e(4*c)):new Uint16Array(new e(2*c))}function md(c,e){if(!c.index){const t=c.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=fd(t,s);c.setIndex(new gt(n,1));for(let i=0;i<t;i++)n[i]=i}}function Hh(c){const e=Pn(c),t=c.drawRange,s=t.start/3,n=(t.start+t.count)/3,i=Math.max(0,s),r=Math.min(e,n)-i;return[{offset:Math.floor(i),count:Math.floor(r)}]}function jh(c){if(!c.groups||!c.groups.length)return Hh(c);const e=[],t=new Set,s=c.drawRange,n=s.start/3,i=(s.start+s.count)/3;for(const o of c.groups){const l=o.start/3,u=(o.start+o.count)/3;t.add(Math.max(n,l)),t.add(Math.min(i,u))}const r=Array.from(t.values()).sort((o,l)=>o-l);for(let o=0;o<r.length-1;o++){const l=r[o],u=r[o+1];e.push({offset:Math.floor(l),count:Math.floor(u-l)})}return e}function gd(c){if(c.groups.length===0)return!1;const e=Pn(c),t=jh(c).sort((i,r)=>i.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let n=0;return t.forEach(({count:i})=>n+=i),e!==n}function Ge(c,e,t){return t.min.x=e[c],t.min.y=e[c+1],t.min.z=e[c+2],t.max.x=e[c+3],t.max.y=e[c+4],t.max.z=e[c+5],t}function Ed(c){c[0]=c[1]=c[2]=1/0,c[3]=c[4]=c[5]=-1/0}function kl(c){let e=-1,t=-1/0;for(let s=0;s<3;s++){const n=c[s+3]-c[s];n>t&&(t=n,e=s)}return e}function zl(c,e){e.set(c)}function Yl(c,e,t){let s,n;for(let i=0;i<3;i++){const r=i+3;s=c[i],n=e[i],t[i]=s<n?s:n,s=c[r],n=e[r],t[r]=s>n?s:n}}function qi(c,e,t){for(let s=0;s<3;s++){const n=e[c+2*s],i=e[c+2*s+1],r=n-i,o=n+i;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function Qn(c){const e=c[3]-c[0],t=c[4]-c[1],s=c[5]-c[2];return 2*(e*t+t*s+s*e)}function Bo(c,e,t,s,n=null){let i=1/0,r=1/0,o=1/0,l=-1/0,u=-1/0,d=-1/0,f=1/0,m=1/0,E=1/0,w=-1/0,y=-1/0,A=-1/0;const S=n!==null;for(let x=e*6,R=(e+t)*6;x<R;x+=6){const C=c[x+0],M=c[x+1],k=C-M,G=C+M;k<i&&(i=k),G>l&&(l=G),S&&C<f&&(f=C),S&&C>w&&(w=C);const H=c[x+2],W=c[x+3],Z=H-W,J=H+W;Z<r&&(r=Z),J>u&&(u=J),S&&H<m&&(m=H),S&&H>y&&(y=H);const te=c[x+4],se=c[x+5],ue=te-se,we=te+se;ue<o&&(o=ue),we>d&&(d=we),S&&te<E&&(E=te),S&&te>A&&(A=te)}s[0]=i,s[1]=r,s[2]=o,s[3]=l,s[4]=u,s[5]=d,S&&(n[0]=f,n[1]=m,n[2]=E,n[3]=w,n[4]=y,n[5]=A)}function vd(c,e,t,s){let n=1/0,i=1/0,r=1/0,o=-1/0,l=-1/0,u=-1/0;for(let d=e*6,f=(e+t)*6;d<f;d+=6){const m=c[d+0];m<n&&(n=m),m>o&&(o=m);const E=c[d+2];E<i&&(i=E),E>l&&(l=E);const w=c[d+4];w<r&&(r=w),w>u&&(u=w)}s[0]=n,s[1]=i,s[2]=r,s[3]=o,s[4]=l,s[5]=u}function wd(c,e){Ed(e);const t=c.attributes.position,s=c.index?c.index.array:null,n=Pn(c),i=new Float32Array(n*6),r=t.normalized,o=t.array,l=t.offset||0;let u=3;t.isInterleavedBufferAttribute&&(u=t.data.stride);const d=["getX","getY","getZ"];for(let f=0;f<n;f++){const m=f*3,E=f*6;let w=m+0,y=m+1,A=m+2;s&&(w=s[w],y=s[y],A=s[A]),r||(w=w*u+l,y=y*u+l,A=A*u+l);for(let S=0;S<3;S++){let x,R,C;r?(x=t[d[S]](w),R=t[d[S]](y),C=t[d[S]](A)):(x=o[w+S],R=o[y+S],C=o[A+S]);let M=x;R<M&&(M=R),C<M&&(M=C);let k=x;R>k&&(k=R),C>k&&(k=C);const G=(k-M)/2,H=S*2;i[E+H+0]=M+G,i[E+H+1]=G+(Math.abs(M)+G)*dd,M<e[S]&&(e[S]=M),k>e[S+3]&&(e[S+3]=k)}}return i}const is=32,yd=(c,e)=>c.candidate-e.candidate,ws=new Array(is).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ji=new Float32Array(6);function Id(c,e,t,s,n,i){let r=-1,o=0;if(i===Gh)r=kl(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(i===cd)r=kl(c),r!==-1&&(o=Cd(t,s,n,r));else if(i===ud){const l=Qn(c);let u=_o*n;const d=s*6,f=(s+n)*6;for(let m=0;m<3;m++){const E=e[m],w=(e[m+3]-E)/is;if(n<is/4){const y=[...ws];y.length=n;let A=0;for(let x=d;x<f;x+=6,A++){const R=y[A];R.candidate=t[x+2*m],R.count=0;const{bounds:C,leftCacheBounds:M,rightCacheBounds:k}=R;for(let G=0;G<3;G++)k[G]=1/0,k[G+3]=-1/0,M[G]=1/0,M[G+3]=-1/0,C[G]=1/0,C[G+3]=-1/0;qi(x,t,C)}y.sort(yd);let S=n;for(let x=0;x<S;x++){const R=y[x];for(;x+1<S&&y[x+1].candidate===R.candidate;)y.splice(x+1,1),S--}for(let x=d;x<f;x+=6){const R=t[x+2*m];for(let C=0;C<S;C++){const M=y[C];R>=M.candidate?qi(x,t,M.rightCacheBounds):(qi(x,t,M.leftCacheBounds),M.count++)}}for(let x=0;x<S;x++){const R=y[x],C=R.count,M=n-R.count,k=R.leftCacheBounds,G=R.rightCacheBounds;let H=0;C!==0&&(H=Qn(k)/l);let W=0;M!==0&&(W=Qn(G)/l);const Z=Bl+_o*(H*C+W*M);Z<u&&(r=m,u=Z,o=R.candidate)}}else{for(let S=0;S<is;S++){const x=ws[S];x.count=0,x.candidate=E+w+S*w;const R=x.bounds;for(let C=0;C<3;C++)R[C]=1/0,R[C+3]=-1/0}for(let S=d;S<f;S+=6){let x=~~((t[S+2*m]-E)/w);x>=is&&(x=is-1);const R=ws[x];R.count++,qi(S,t,R.bounds)}const y=ws[is-1];zl(y.bounds,y.rightCacheBounds);for(let S=is-2;S>=0;S--){const x=ws[S],R=ws[S+1];Yl(x.bounds,R.rightCacheBounds,x.rightCacheBounds)}let A=0;for(let S=0;S<is-1;S++){const x=ws[S],R=x.count,C=x.bounds,M=ws[S+1].rightCacheBounds;R!==0&&(A===0?zl(C,Ji):Yl(C,Ji,Ji)),A+=R;let k=0,G=0;A!==0&&(k=Qn(Ji)/l);const H=n-A;H!==0&&(G=Qn(M)/l);const W=Bl+_o*(k*A+G*H);W<u&&(r=m,u=W,o=x.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:r,pos:o}}function Cd(c,e,t,s){let n=0;for(let i=e,r=e+t;i<r;i++)n+=c[i*6+s*2];return n/t}class $i{constructor(){}}function Td(c,e,t,s,n,i){let r=s,o=s+n-1;const l=i.pos,u=i.axis*2;for(;;){for(;r<=o&&t[r*6+u]<l;)r++;for(;r<=o&&t[o*6+u]>=l;)o--;if(r<o){for(let d=0;d<3;d++){let f=e[r*3+d];e[r*3+d]=e[o*3+d],e[o*3+d]=f}for(let d=0;d<6;d++){let f=t[r*6+d];t[r*6+d]=t[o*6+d],t[o*6+d]=f}r++,o--}else return r}}function bd(c,e,t,s,n,i){let r=s,o=s+n-1;const l=i.pos,u=i.axis*2;for(;;){for(;r<=o&&t[r*6+u]<l;)r++;for(;r<=o&&t[o*6+u]>=l;)o--;if(r<o){let d=c[r];c[r]=c[o],c[o]=d;for(let f=0;f<6;f++){let m=t[r*6+f];t[r*6+f]=t[o*6+f],t[o*6+f]=m}r++,o--}else return r}}function Ad(c,e){const t=(c.index?c.index.count:c.attributes.position.count)/3,s=t>2**16,n=s?4:2,i=e?new SharedArrayBuffer(t*n):new ArrayBuffer(t*n),r=s?new Uint32Array(i):new Uint16Array(i);for(let o=0,l=r.length;o<l;o++)r[o]=o;return r}function Sd(c,e){const t=c.geometry,s=t.index?t.index.array:null,n=e.maxDepth,i=e.verbose,r=e.maxLeafTris,o=e.strategy,l=e.onProgress,u=Pn(t),d=c._indirectBuffer;let f=!1;const m=new Float32Array(6),E=new Float32Array(6),w=wd(t,m),y=e.indirect?bd:Td,A=[],S=e.indirect?Hh(t):jh(t);if(S.length===1){const C=S[0],M=new $i;M.boundingData=m,vd(w,C.offset,C.count,E),R(M,C.offset,C.count,E),A.push(M)}else for(let C of S){const M=new $i;M.boundingData=new Float32Array(6),Bo(w,C.offset,C.count,M.boundingData,E),R(M,C.offset,C.count,E),A.push(M)}return A;function x(C){l&&l(C/u)}function R(C,M,k,G=null,H=0){if(!f&&H>=n&&(f=!0,i&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),k<=r||H>=n)return x(M+k),C.offset=M,C.count=k,C;const W=Id(C.boundingData,G,w,M,k,o);if(W.axis===-1)return x(M+k),C.offset=M,C.count=k,C;const Z=y(d,s,w,M,k,W);if(Z===M||Z===M+k)x(M+k),C.offset=M,C.count=k;else{C.splitAxis=W.axis;const J=new $i,te=M,se=Z-M;C.left=J,J.boundingData=new Float32Array(6),Bo(w,te,se,J.boundingData,E),R(J,te,se,E,H+1);const ue=new $i,we=Z,ce=k-se;C.right=ue,ue.boundingData=new Float32Array(6),Bo(w,we,ce,ue.boundingData,E),R(ue,we,ce,E,H+1)}return C}}function Fd(c,e){const t=c.geometry;e.indirect&&(c._indirectBuffer=Ad(t,e.useSharedArrayBuffer),gd(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),c._indirectBuffer||md(t,e);const s=Sd(c,e);let n,i,r;const o=[],l=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let f=0;f<s.length;f++){const m=s[f];let E=u(m);const w=new l(Rr*E);n=new Float32Array(w),i=new Uint32Array(w),r=new Uint16Array(w),d(0,m),o.push(w)}c._roots=o;return;function u(f){return f.count?1:1+u(f.left)+u(f.right)}function d(f,m){const E=f/4,w=f/2,y=!!m.count,A=m.boundingData;for(let S=0;S<6;S++)n[E+S]=A[S];if(y){const S=m.offset,x=m.count;return i[E+6]=S,r[w+14]=x,r[w+15]=jr,f+Rr}else{const S=m.left,x=m.right,R=m.splitAxis;let C;if(C=d(f+Rr,S),C/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[E+6]=C/4,C=d(C,x),i[E+7]=R,C}}}class cs{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,n=-1/0;for(let i=0,r=e.length;i<r;i++){const o=e[i][t];s=o<s?o:s,n=o>n?o:n}this.min=s,this.max=n}setFromPoints(e,t){let s=1/0,n=-1/0;for(let i=0,r=t.length;i<r;i++){const o=t[i],l=e.dot(o);s=l<s?l:s,n=l>n?l:n}this.min=s,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}cs.prototype.setFromBox=function(){const c=new P;return function(e,t){const s=t.min,n=t.max;let i=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){c.x=s.x*o+n.x*(1-o),c.y=s.y*l+n.y*(1-l),c.z=s.z*u+n.z*(1-u);const d=e.dot(c);i=Math.min(d,i),r=Math.max(d,r)}this.min=i,this.max=r}}();const xd=function(){const c=new P,e=new P,t=new P;return function(s,n,i){const r=s.start,o=c,l=n.start,u=e;t.subVectors(r,l),c.subVectors(s.end,s.start),e.subVectors(n.end,n.start);const d=t.dot(u),f=u.dot(o),m=u.dot(u),E=t.dot(o),w=o.dot(o)*m-f*f;let y,A;w!==0?y=(d*f-E*m)/w:y=0,A=(d+y*f)/m,i.x=y,i.y=A}}(),ja=function(){const c=new ke,e=new P,t=new P;return function(s,n,i,r){xd(s,n,c);let o=c.x,l=c.y;if(o>=0&&o<=1&&l>=0&&l<=1){s.at(o,i),n.at(l,r);return}else if(o>=0&&o<=1){l<0?n.at(0,r):n.at(1,r),s.closestPointToPoint(r,!0,i);return}else if(l>=0&&l<=1){o<0?s.at(0,i):s.at(1,i),n.closestPointToPoint(i,!0,r);return}else{let u;o<0?u=s.start:u=s.end;let d;l<0?d=n.start:d=n.end;const f=e,m=t;if(s.closestPointToPoint(d,!0,e),n.closestPointToPoint(u,!0,t),f.distanceToSquared(d)<=m.distanceToSquared(u)){i.copy(f),r.copy(d);return}else{i.copy(u),r.copy(m);return}}}}(),Rd=function(){const c=new P,e=new P,t=new Fs,s=new It;return function(n,i){const{radius:r,center:o}=n,{a:l,b:u,c:d}=i;if(s.start=l,s.end=u,s.closestPointToPoint(o,!0,c).distanceTo(o)<=r||(s.start=l,s.end=d,s.closestPointToPoint(o,!0,c).distanceTo(o)<=r)||(s.start=u,s.end=d,s.closestPointToPoint(o,!0,c).distanceTo(o)<=r))return!0;const f=i.getPlane(t);if(Math.abs(f.distanceToPoint(o))<=r){const m=f.projectPoint(o,e);if(i.containsPoint(m))return!0}return!1}}(),Pd=1e-15;function ko(c){return Math.abs(c)<Pd}class Yt extends Gs{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new P),this.satBounds=new Array(4).fill().map(()=>new cs),this.points=[this.a,this.b,this.c],this.sphere=new Xs,this.plane=new Fs,this.needsUpdate=!0}intersectsSphere(e){return Rd(e,this)}update(){const e=this.a,t=this.b,s=this.c,n=this.points,i=this.satAxes,r=this.satBounds,o=i[0],l=r[0];this.getNormal(o),l.setFromPoints(o,n);const u=i[1],d=r[1];u.subVectors(e,t),d.setFromPoints(u,n);const f=i[2],m=r[2];f.subVectors(t,s),m.setFromPoints(f,n);const E=i[3],w=r[3];E.subVectors(s,e),w.setFromPoints(E,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}Yt.prototype.closestPointToSegment=function(){const c=new P,e=new P,t=new It;return function(s,n=null,i=null){const{start:r,end:o}=s,l=this.points;let u,d=1/0;for(let f=0;f<3;f++){const m=(f+1)%3;t.start.copy(l[f]),t.end.copy(l[m]),ja(t,s,c,e),u=c.distanceToSquared(e),u<d&&(d=u,n&&n.copy(c),i&&i.copy(e))}return this.closestPointToPoint(r,c),u=r.distanceToSquared(c),u<d&&(d=u,n&&n.copy(c),i&&i.copy(r)),this.closestPointToPoint(o,c),u=o.distanceToSquared(c),u<d&&(d=u,n&&n.copy(c),i&&i.copy(o)),Math.sqrt(d)}}();Yt.prototype.intersectsTriangle=function(){const c=new Yt,e=new Array(3),t=new Array(3),s=new cs,n=new cs,i=new P,r=new P,o=new P,l=new P,u=new P,d=new It,f=new It,m=new It,E=new P;function w(y,A,S){const x=y.points;let R=0,C=-1;for(let M=0;M<3;M++){const{start:k,end:G}=d;k.copy(x[M]),G.copy(x[(M+1)%3]),d.delta(r);const H=ko(A.distanceToPoint(k));if(ko(A.normal.dot(r))&&H){S.copy(d),R=2;break}const W=A.intersectLine(d,E);if(!W&&H&&E.copy(k),(W||H)&&!ko(E.distanceTo(G))){if(R<=1)(R===1?S.start:S.end).copy(E),H&&(C=R);else if(R>=2){(C===1?S.start:S.end).copy(E),R=2;break}if(R++,R===2&&C===-1)break}}return R}return function(y,A=null,S=!1){this.needsUpdate&&this.update(),y.isExtendedTriangle?y.needsUpdate&&y.update():(c.copy(y),c.update(),y=c);const x=this.plane,R=y.plane;if(Math.abs(x.normal.dot(R.normal))>1-1e-10){const C=this.satBounds,M=this.satAxes;t[0]=y.a,t[1]=y.b,t[2]=y.c;for(let H=0;H<4;H++){const W=C[H],Z=M[H];if(s.setFromPoints(Z,t),W.isSeparated(s))return!1}const k=y.satBounds,G=y.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let H=0;H<4;H++){const W=k[H],Z=G[H];if(s.setFromPoints(Z,e),W.isSeparated(s))return!1}for(let H=0;H<4;H++){const W=M[H];for(let Z=0;Z<4;Z++){const J=G[Z];if(i.crossVectors(W,J),s.setFromPoints(i,e),n.setFromPoints(i,t),s.isSeparated(n))return!1}}return A&&(S||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),A.start.set(0,0,0),A.end.set(0,0,0)),!0}else{const C=w(this,R,f);if(C===1&&y.containsPoint(f.end))return A&&(A.start.copy(f.end),A.end.copy(f.end)),!0;if(C!==2)return!1;const M=w(y,x,m);if(M===1&&this.containsPoint(m.end))return A&&(A.start.copy(m.end),A.end.copy(m.end)),!0;if(M!==2)return!1;if(f.delta(o),m.delta(l),o.dot(l)<0){let te=m.start;m.start=m.end,m.end=te}const k=f.start.dot(o),G=f.end.dot(o),H=m.start.dot(o),W=m.end.dot(o),Z=G<H,J=k<W;return k!==W&&H!==G&&Z===J?!1:(A&&(u.subVectors(f.start,m.start),u.dot(o)>0?A.start.copy(f.start):A.start.copy(m.start),u.subVectors(f.end,m.end),u.dot(o)<0?A.end.copy(f.end):A.end.copy(m.end)),!0)}}}();Yt.prototype.distanceToPoint=function(){const c=new P;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}();Yt.prototype.distanceToTriangle=function(){const c=new P,e=new P,t=["a","b","c"],s=new It,n=new It;return function(i,r=null,o=null){const l=r||o?s:null;if(this.intersectsTriangle(i,l))return(r||o)&&(r&&l.getCenter(r),o&&l.getCenter(o)),0;let u=1/0;for(let d=0;d<3;d++){let f;const m=t[d],E=i[m];this.closestPointToPoint(E,c),f=E.distanceToSquared(c),f<u&&(u=f,r&&r.copy(c),o&&o.copy(E));const w=this[m];i.closestPointToPoint(w,c),f=w.distanceToSquared(c),f<u&&(u=f,r&&r.copy(w),o&&o.copy(c))}for(let d=0;d<3;d++){const f=t[d],m=t[(d+1)%3];s.set(this[f],this[m]);for(let E=0;E<3;E++){const w=t[E],y=t[(E+1)%3];n.set(i[w],i[y]),ja(s,n,c,e);const A=c.distanceToSquared(e);A<u&&(u=A,r&&r.copy(c),o&&o.copy(e))}}return Math.sqrt(u)}}();class pt{constructor(e,t,s){this.isOrientedBox=!0,this.min=new P,this.max=new P,this.matrix=new me,this.invMatrix=new me,this.points=new Array(8).fill().map(()=>new P),this.satAxes=new Array(3).fill().map(()=>new P),this.satBounds=new Array(3).fill().map(()=>new cs),this.alignedSatBounds=new Array(3).fill().map(()=>new cs),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}pt.prototype.update=function(){return function(){const c=this.matrix,e=this.min,t=this.max,s=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let d=0;d<=1;d++){const f=1*l|2*u|4*d,m=s[f];m.x=l?t.x:e.x,m.y=u?t.y:e.y,m.z=d?t.z:e.z,m.applyMatrix4(c)}const n=this.satBounds,i=this.satAxes,r=s[0];for(let l=0;l<3;l++){const u=i[l],d=n[l],f=1<<l,m=s[f];u.subVectors(r,m),d.setFromPoints(u,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();pt.prototype.intersectsBox=function(){const c=new cs;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,n=this.satBounds,i=this.satAxes,r=this.alignedSatBounds;if(c.min=t.x,c.max=s.x,r[0].isSeparated(c)||(c.min=t.y,c.max=s.y,r[1].isSeparated(c))||(c.min=t.z,c.max=s.z,r[2].isSeparated(c)))return!1;for(let o=0;o<3;o++){const l=i[o],u=n[o];if(c.setFromBox(l,e),u.isSeparated(c))return!1}return!0}}();pt.prototype.intersectsTriangle=function(){const c=new Yt,e=new Array(3),t=new cs,s=new cs,n=new P;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(c.copy(i),c.update(),i=c);const r=this.satBounds,o=this.satAxes;e[0]=i.a,e[1]=i.b,e[2]=i.c;for(let f=0;f<3;f++){const m=r[f],E=o[f];if(t.setFromPoints(E,e),m.isSeparated(t))return!1}const l=i.satBounds,u=i.satAxes,d=this.points;for(let f=0;f<3;f++){const m=l[f],E=u[f];if(t.setFromPoints(E,d),m.isSeparated(t))return!1}for(let f=0;f<3;f++){const m=o[f];for(let E=0;E<4;E++){const w=u[E];if(n.crossVectors(m,w),t.setFromPoints(n,e),s.setFromPoints(n,d),t.isSeparated(s))return!1}}return!0}}();pt.prototype.closestPointToPoint=function(){return function(c,e){return this.needsUpdate&&this.update(),e.copy(c).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();pt.prototype.distanceToPoint=function(){const c=new P;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}();pt.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new It),t=new Array(12).fill().map(()=>new It),s=new P,n=new P;return function(i,r=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(o||l)&&(i.getCenter(n),this.closestPointToPoint(n,s),i.closestPointToPoint(s,n),o&&o.copy(s),l&&l.copy(n)),0;const u=r*r,d=i.min,f=i.max,m=this.points;let E=1/0;for(let y=0;y<8;y++){const A=m[y];n.copy(A).clamp(d,f);const S=A.distanceToSquared(n);if(S<E&&(E=S,o&&o.copy(A),l&&l.copy(n),S<u))return Math.sqrt(S)}let w=0;for(let y=0;y<3;y++)for(let A=0;A<=1;A++)for(let S=0;S<=1;S++){const x=(y+1)%3,R=(y+2)%3,C=A<<x|S<<R,M=1<<y|A<<x|S<<R,k=m[C],G=m[M];e[w].set(k,G);const H=c[y],W=c[x],Z=c[R],J=t[w],te=J.start,se=J.end;te[H]=d[H],te[W]=A?d[W]:f[W],te[Z]=S?d[Z]:f[W],se[H]=f[H],se[W]=A?d[W]:f[W],se[Z]=S?d[Z]:f[W],w++}for(let y=0;y<=1;y++)for(let A=0;A<=1;A++)for(let S=0;S<=1;S++){n.x=y?f.x:d.x,n.y=A?f.y:d.y,n.z=S?f.z:d.z,this.closestPointToPoint(n,s);const x=n.distanceToSquared(s);if(x<E&&(E=x,o&&o.copy(s),l&&l.copy(n),x<u))return Math.sqrt(x)}for(let y=0;y<12;y++){const A=e[y];for(let S=0;S<12;S++){const x=t[S];ja(A,x,s,n);const R=s.distanceToSquared(n);if(R<E&&(E=R,o&&o.copy(s),l&&l.copy(n),R<u))return Math.sqrt(R)}}return Math.sqrt(E)}}();class Ka{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Od extends Ka{constructor(){super(()=>new Yt)}}const St=new Od;function wt(c,e){return e[c+15]===65535}function yt(c,e){return e[c+6]}function Ft(c,e){return e[c+14]}function xt(c){return c+8}function Rt(c,e){return e[c+6]}function Kh(c,e){return e[c+7]}class Md{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Be=new Md;let Ts,An;const an=[],er=new Ka(()=>new Ue);function Dd(c,e,t,s,n,i){Ts=er.getPrimitive(),An=er.getPrimitive(),an.push(Ts,An),Be.setBuffer(c._roots[e]);const r=aa(0,c.geometry,t,s,n,i);Be.clearBuffer(),er.releasePrimitive(Ts),er.releasePrimitive(An),an.pop(),an.pop();const o=an.length;return o>0&&(An=an[o-1],Ts=an[o-2]),r}function aa(c,e,t,s,n=null,i=0,r=0){const{float32Array:o,uint16Array:l,uint32Array:u}=Be;let d=c*2;if(wt(d,l)){const f=yt(c,u),m=Ft(d,l);return Ge(c,o,Ts),s(f,m,!1,r,i+c,Ts)}else{let f=function(J){const{uint16Array:te,uint32Array:se}=Be;let ue=J*2;for(;!wt(ue,te);)J=xt(J),ue=J*2;return yt(J,se)},m=function(J){const{uint16Array:te,uint32Array:se}=Be;let ue=J*2;for(;!wt(ue,te);)J=Rt(J,se),ue=J*2;return yt(J,se)+Ft(ue,te)};const E=xt(c),w=Rt(c,u);let y=E,A=w,S,x,R,C;if(n&&(R=Ts,C=An,Ge(y,o,R),Ge(A,o,C),S=n(R),x=n(C),x<S)){y=w,A=E;const J=S;S=x,x=J,R=C}R||(R=Ts,Ge(y,o,R));const M=wt(y*2,l),k=t(R,M,S,r+1,i+y);let G;if(k===Ul){const J=f(y),te=m(y)-J;G=s(J,te,!0,r+1,i+y,R)}else G=k&&aa(y,e,t,s,n,i,r+1);if(G)return!0;C=An,Ge(A,o,C);const H=wt(A*2,l),W=t(C,H,x,r+1,i+A);let Z;if(W===Ul){const J=f(A),te=m(A)-J;Z=s(J,te,!0,r+1,i+A,C)}else Z=W&&aa(A,e,t,s,n,i,r+1);return!!Z}}const qn=new P,zo=new P;function Ld(c,e,t={},s=0,n=1/0){const i=s*s,r=n*n;let o=1/0,l=null;if(c.shapecast({boundsTraverseOrder:d=>(qn.copy(e).clamp(d.min,d.max),qn.distanceToSquared(e)),intersectsBounds:(d,f,m)=>m<o&&m<r,intersectsTriangle:(d,f)=>{d.closestPointToPoint(e,qn);const m=e.distanceToSquared(qn);return m<o&&(zo.copy(qn),o=m,l=f),m<i}}),o===1/0)return null;const u=Math.sqrt(o);return t.point?t.point.copy(zo):t.point=zo.clone(),t.distance=u,t.faceIndex=l,t}const ln=new P,hn=new P,cn=new P,tr=new ke,sr=new ke,nr=new ke,Vl=new P,Gl=new P,Hl=new P,ir=new P;function Nd(c,e,t,s,n,i){let r;return i===rd?r=c.intersectTriangle(s,t,e,!0,n):r=c.intersectTriangle(e,t,s,i!==wi,n),r===null?null:{distance:c.origin.distanceTo(n),point:n.clone()}}function _d(c,e,t,s,n,i,r,o,l){ln.fromBufferAttribute(e,i),hn.fromBufferAttribute(e,r),cn.fromBufferAttribute(e,o);const u=Nd(c,ln,hn,cn,ir,l);if(u){s&&(tr.fromBufferAttribute(s,i),sr.fromBufferAttribute(s,r),nr.fromBufferAttribute(s,o),u.uv=Gs.getInterpolation(ir,ln,hn,cn,tr,sr,nr,new ke)),n&&(tr.fromBufferAttribute(n,i),sr.fromBufferAttribute(n,r),nr.fromBufferAttribute(n,o),u.uv1=Gs.getInterpolation(ir,ln,hn,cn,tr,sr,nr,new ke)),t&&(Vl.fromBufferAttribute(t,i),Gl.fromBufferAttribute(t,r),Hl.fromBufferAttribute(t,o),u.normal=Gs.getInterpolation(ir,ln,hn,cn,Vl,Gl,Hl,new P),u.normal.dot(c.direction)>0&&u.normal.multiplyScalar(-1));const d={a:i,b:r,c:o,normal:new P,materialIndex:0};Gs.getNormal(ln,hn,cn,d.normal),u.face=d,u.faceIndex=i}return u}function Kr(c,e,t,s,n){const i=s*3;let r=i+0,o=i+1,l=i+2;const u=c.index;c.index&&(r=u.getX(r),o=u.getX(o),l=u.getX(l));const{position:d,normal:f,uv:m,uv1:E}=c.attributes,w=_d(t,d,f,m,E,r,o,l,e);return w?(w.faceIndex=s,n&&n.push(w),w):null}function qe(c,e,t,s){const n=c.a,i=c.b,r=c.c;let o=e,l=e+1,u=e+2;t&&(o=t.getX(o),l=t.getX(l),u=t.getX(u)),n.x=s.getX(o),n.y=s.getY(o),n.z=s.getZ(o),i.x=s.getX(l),i.y=s.getY(l),i.z=s.getZ(l),r.x=s.getX(u),r.y=s.getY(u),r.z=s.getZ(u)}function Ud(c,e,t,s,n,i){const{geometry:r,_indirectBuffer:o}=c;for(let l=s,u=s+n;l<u;l++)Kr(r,e,t,l,i)}function Bd(c,e,t,s,n){const{geometry:i,_indirectBuffer:r}=c;let o=1/0,l=null;for(let u=s,d=s+n;u<d;u++){let f;f=Kr(i,e,t,u),f&&f.distance<o&&(l=f,o=f.distance)}return l}function kd(c,e,t,s,n,i,r){const{geometry:o}=t,{index:l}=o,u=o.attributes.position;for(let d=c,f=e+c;d<f;d++){let m;if(m=d,qe(r,m*3,l,u),r.needsUpdate=!0,s(r,m,n,i))return!0}return!1}function zd(c,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=c.geometry,s=t.index?t.index.array:null,n=t.attributes.position;let i,r,o,l,u=0;const d=c._roots;for(let m=0,E=d.length;m<E;m++)i=d[m],r=new Uint32Array(i),o=new Uint16Array(i),l=new Float32Array(i),f(0,u),u+=i.byteLength;function f(m,E,w=!1){const y=m*2;if(o[y+15]===jr){const A=r[m+6],S=o[y+14];let x=1/0,R=1/0,C=1/0,M=-1/0,k=-1/0,G=-1/0;for(let H=3*A,W=3*(A+S);H<W;H++){let Z=s[H];const J=n.getX(Z),te=n.getY(Z),se=n.getZ(Z);J<x&&(x=J),J>M&&(M=J),te<R&&(R=te),te>k&&(k=te),se<C&&(C=se),se>G&&(G=se)}return l[m+0]!==x||l[m+1]!==R||l[m+2]!==C||l[m+3]!==M||l[m+4]!==k||l[m+5]!==G?(l[m+0]=x,l[m+1]=R,l[m+2]=C,l[m+3]=M,l[m+4]=k,l[m+5]=G,!0):!1}else{const A=m+8,S=r[m+6],x=A+E,R=S+E;let C=w,M=!1,k=!1;e?C||(M=e.has(x),k=e.has(R),C=!M&&!k):(M=!0,k=!0);const G=C||M,H=C||k;let W=!1;G&&(W=f(A,E,C));let Z=!1;H&&(Z=f(S,E,C));const J=W||Z;if(J)for(let te=0;te<3;te++){const se=A+te,ue=S+te,we=l[se],ce=l[se+3],ge=l[ue],pe=l[ue+3];l[m+te]=we<ge?we:ge,l[m+te+3]=ce>pe?ce:pe}return J}}}const jl=new Ue;function Ss(c,e,t,s){return Ge(c,e,jl),t.intersectBox(jl,s)}function Yd(c,e,t,s,n,i){const{geometry:r,_indirectBuffer:o}=c;for(let l=s,u=s+n;l<u;l++){let d=o?o[l]:l;Kr(r,e,t,d,i)}}function Vd(c,e,t,s,n){const{geometry:i,_indirectBuffer:r}=c;let o=1/0,l=null;for(let u=s,d=s+n;u<d;u++){let f;f=Kr(i,e,t,r?r[u]:u),f&&f.distance<o&&(l=f,o=f.distance)}return l}function Gd(c,e,t,s,n,i,r){const{geometry:o}=t,{index:l}=o,u=o.attributes.position;for(let d=c,f=e+c;d<f;d++){let m;if(m=t.resolveTriangleIndex(d),qe(r,m*3,l,u),r.needsUpdate=!0,s(r,m,n,i))return!0}return!1}const Kl=new P;function Hd(c,e,t,s,n){Be.setBuffer(c._roots[e]),la(0,c,t,s,n),Be.clearBuffer()}function la(c,e,t,s,n){const{float32Array:i,uint16Array:r,uint32Array:o}=Be,l=c*2;if(wt(l,r)){const u=yt(c,o),d=Ft(l,r);Ud(e,t,s,u,d,n)}else{const u=xt(c);Ss(u,i,s,Kl)&&la(u,e,t,s,n);const d=Rt(c,o);Ss(d,i,s,Kl)&&la(d,e,t,s,n)}}const Wl=new P,jd=["x","y","z"];function Kd(c,e,t,s){Be.setBuffer(c._roots[e]);const n=ha(0,c,t,s);return Be.clearBuffer(),n}function ha(c,e,t,s){const{float32Array:n,uint16Array:i,uint32Array:r}=Be;let o=c*2;if(wt(o,i)){const l=yt(c,r),u=Ft(o,i);return Bd(e,t,s,l,u)}else{const l=Kh(c,r),u=jd[l],d=s.direction[u]>=0;let f,m;d?(f=xt(c),m=Rt(c,r)):(f=Rt(c,r),m=xt(c));const E=Ss(f,n,s,Wl)?ha(f,e,t,s):null;if(E){const y=E.point[u];if(d?y<=n[m+l]:y>=n[m+l+3])return E}const w=Ss(m,n,s,Wl)?ha(m,e,t,s):null;return E&&w?E.distance<=w.distance?E:w:E||w||null}}const rr=new Ue,un=new Yt,dn=new Yt,Jn=new me,Xl=new pt,or=new pt;function Wd(c,e,t,s){Be.setBuffer(c._roots[e]);const n=ca(0,c,t,s);return Be.clearBuffer(),n}function ca(c,e,t,s,n=null){const{float32Array:i,uint16Array:r,uint32Array:o}=Be;let l=c*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),Xl.set(t.boundingBox.min,t.boundingBox.max,s),n=Xl),wt(l,r)){const u=e.geometry,d=u.index,f=u.attributes.position,m=t.index,E=t.attributes.position,w=yt(c,o),y=Ft(l,r);if(Jn.copy(s).invert(),t.boundsTree)return Ge(c,i,or),or.matrix.copy(Jn),or.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:A=>or.intersectsBox(A),intersectsTriangle:A=>{A.a.applyMatrix4(s),A.b.applyMatrix4(s),A.c.applyMatrix4(s),A.needsUpdate=!0;for(let S=w*3,x=(y+w)*3;S<x;S+=3)if(qe(dn,S,d,f),dn.needsUpdate=!0,A.intersectsTriangle(dn))return!0;return!1}});for(let A=w*3,S=(y+w)*3;A<S;A+=3){qe(un,A,d,f),un.a.applyMatrix4(Jn),un.b.applyMatrix4(Jn),un.c.applyMatrix4(Jn),un.needsUpdate=!0;for(let x=0,R=m.count;x<R;x+=3)if(qe(dn,x,m,E),dn.needsUpdate=!0,un.intersectsTriangle(dn))return!0}}else{const u=c+8,d=o[c+6];return Ge(u,i,rr),!!(n.intersectsBox(rr)&&ca(u,e,t,s,n)||(Ge(d,i,rr),n.intersectsBox(rr)&&ca(d,e,t,s,n)))}}const ar=new me,Yo=new pt,$n=new pt,Xd=new P,Zd=new P,Qd=new P,qd=new P;function Jd(c,e,t,s={},n={},i=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Yo.set(e.boundingBox.min,e.boundingBox.max,t),Yo.needsUpdate=!0;const o=c.geometry,l=o.attributes.position,u=o.index,d=e.attributes.position,f=e.index,m=St.getPrimitive(),E=St.getPrimitive();let w=Xd,y=Zd,A=null,S=null;n&&(A=Qd,S=qd);let x=1/0,R=null,C=null;return ar.copy(t).invert(),$n.matrix.copy(ar),c.shapecast({boundsTraverseOrder:M=>Yo.distanceToBox(M),intersectsBounds:(M,k,G)=>G<x&&G<r?(k&&($n.min.copy(M.min),$n.max.copy(M.max),$n.needsUpdate=!0),!0):!1,intersectsRange:(M,k)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:G=>$n.distanceToBox(G),intersectsBounds:(G,H,W)=>W<x&&W<r,intersectsRange:(G,H)=>{for(let W=G,Z=G+H;W<Z;W++){qe(E,3*W,f,d),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let J=M,te=M+k;J<te;J++){qe(m,3*J,u,l),m.needsUpdate=!0;const se=m.distanceToTriangle(E,w,A);if(se<x&&(y.copy(w),S&&S.copy(A),x=se,R=J,C=W),se<i)return!0}}}});{const G=Pn(e);for(let H=0,W=G;H<W;H++){qe(E,3*H,f,d),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let Z=M,J=M+k;Z<J;Z++){qe(m,3*Z,u,l),m.needsUpdate=!0;const te=m.distanceToTriangle(E,w,A);if(te<x&&(y.copy(w),S&&S.copy(A),x=te,R=Z,C=H),te<i)return!0}}}}}),St.releasePrimitive(m),St.releasePrimitive(E),x===1/0?null:(s.point?s.point.copy(y):s.point=y.clone(),s.distance=x,s.faceIndex=R,n&&(n.point?n.point.copy(S):n.point=S.clone(),n.point.applyMatrix4(ar),y.applyMatrix4(ar),n.distance=y.sub(n.point).length(),n.faceIndex=C),s)}function $d(c,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=c.geometry,s=t.index?t.index.array:null,n=t.attributes.position;let i,r,o,l,u=0;const d=c._roots;for(let m=0,E=d.length;m<E;m++)i=d[m],r=new Uint32Array(i),o=new Uint16Array(i),l=new Float32Array(i),f(0,u),u+=i.byteLength;function f(m,E,w=!1){const y=m*2;if(o[y+15]===jr){const A=r[m+6],S=o[y+14];let x=1/0,R=1/0,C=1/0,M=-1/0,k=-1/0,G=-1/0;for(let H=A,W=A+S;H<W;H++){const Z=3*c.resolveTriangleIndex(H);for(let J=0;J<3;J++){let te=Z+J;te=s?s[te]:te;const se=n.getX(te),ue=n.getY(te),we=n.getZ(te);se<x&&(x=se),se>M&&(M=se),ue<R&&(R=ue),ue>k&&(k=ue),we<C&&(C=we),we>G&&(G=we)}}return l[m+0]!==x||l[m+1]!==R||l[m+2]!==C||l[m+3]!==M||l[m+4]!==k||l[m+5]!==G?(l[m+0]=x,l[m+1]=R,l[m+2]=C,l[m+3]=M,l[m+4]=k,l[m+5]=G,!0):!1}else{const A=m+8,S=r[m+6],x=A+E,R=S+E;let C=w,M=!1,k=!1;e?C||(M=e.has(x),k=e.has(R),C=!M&&!k):(M=!0,k=!0);const G=C||M,H=C||k;let W=!1;G&&(W=f(A,E,C));let Z=!1;H&&(Z=f(S,E,C));const J=W||Z;if(J)for(let te=0;te<3;te++){const se=A+te,ue=S+te,we=l[se],ce=l[se+3],ge=l[ue],pe=l[ue+3];l[m+te]=we<ge?we:ge,l[m+te+3]=ce>pe?ce:pe}return J}}}const Zl=new P;function ep(c,e,t,s,n){Be.setBuffer(c._roots[e]),ua(0,c,t,s,n),Be.clearBuffer()}function ua(c,e,t,s,n){const{float32Array:i,uint16Array:r,uint32Array:o}=Be,l=c*2;if(wt(l,r)){const u=yt(c,o),d=Ft(l,r);Yd(e,t,s,u,d,n)}else{const u=xt(c);Ss(u,i,s,Zl)&&ua(u,e,t,s,n);const d=Rt(c,o);Ss(d,i,s,Zl)&&ua(d,e,t,s,n)}}const Ql=new P,tp=["x","y","z"];function sp(c,e,t,s){Be.setBuffer(c._roots[e]);const n=da(0,c,t,s);return Be.clearBuffer(),n}function da(c,e,t,s){const{float32Array:n,uint16Array:i,uint32Array:r}=Be;let o=c*2;if(wt(o,i)){const l=yt(c,r),u=Ft(o,i);return Vd(e,t,s,l,u)}else{const l=Kh(c,r),u=tp[l],d=s.direction[u]>=0;let f,m;d?(f=xt(c),m=Rt(c,r)):(f=Rt(c,r),m=xt(c));const E=Ss(f,n,s,Ql)?da(f,e,t,s):null;if(E){const y=E.point[u];if(d?y<=n[m+l]:y>=n[m+l+3])return E}const w=Ss(m,n,s,Ql)?da(m,e,t,s):null;return E&&w?E.distance<=w.distance?E:w:E||w||null}}const lr=new Ue,pn=new Yt,fn=new Yt,ei=new me,ql=new pt,hr=new pt;function np(c,e,t,s){Be.setBuffer(c._roots[e]);const n=pa(0,c,t,s);return Be.clearBuffer(),n}function pa(c,e,t,s,n=null){const{float32Array:i,uint16Array:r,uint32Array:o}=Be;let l=c*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),ql.set(t.boundingBox.min,t.boundingBox.max,s),n=ql),wt(l,r)){const u=e.geometry,d=u.index,f=u.attributes.position,m=t.index,E=t.attributes.position,w=yt(c,o),y=Ft(l,r);if(ei.copy(s).invert(),t.boundsTree)return Ge(c,i,hr),hr.matrix.copy(ei),hr.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:A=>hr.intersectsBox(A),intersectsTriangle:A=>{A.a.applyMatrix4(s),A.b.applyMatrix4(s),A.c.applyMatrix4(s),A.needsUpdate=!0;for(let S=w,x=y+w;S<x;S++)if(qe(fn,3*e.resolveTriangleIndex(S),d,f),fn.needsUpdate=!0,A.intersectsTriangle(fn))return!0;return!1}});for(let A=w,S=y+w;A<S;A++){const x=e.resolveTriangleIndex(A);qe(pn,3*x,d,f),pn.a.applyMatrix4(ei),pn.b.applyMatrix4(ei),pn.c.applyMatrix4(ei),pn.needsUpdate=!0;for(let R=0,C=m.count;R<C;R+=3)if(qe(fn,R,m,E),fn.needsUpdate=!0,pn.intersectsTriangle(fn))return!0}}else{const u=c+8,d=o[c+6];return Ge(u,i,lr),!!(n.intersectsBox(lr)&&pa(u,e,t,s,n)||(Ge(d,i,lr),n.intersectsBox(lr)&&pa(d,e,t,s,n)))}}const cr=new me,Vo=new pt,ti=new pt,ip=new P,rp=new P,op=new P,ap=new P;function lp(c,e,t,s={},n={},i=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Vo.set(e.boundingBox.min,e.boundingBox.max,t),Vo.needsUpdate=!0;const o=c.geometry,l=o.attributes.position,u=o.index,d=e.attributes.position,f=e.index,m=St.getPrimitive(),E=St.getPrimitive();let w=ip,y=rp,A=null,S=null;n&&(A=op,S=ap);let x=1/0,R=null,C=null;return cr.copy(t).invert(),ti.matrix.copy(cr),c.shapecast({boundsTraverseOrder:M=>Vo.distanceToBox(M),intersectsBounds:(M,k,G)=>G<x&&G<r?(k&&(ti.min.copy(M.min),ti.max.copy(M.max),ti.needsUpdate=!0),!0):!1,intersectsRange:(M,k)=>{if(e.boundsTree){const G=e.boundsTree;return G.shapecast({boundsTraverseOrder:H=>ti.distanceToBox(H),intersectsBounds:(H,W,Z)=>Z<x&&Z<r,intersectsRange:(H,W)=>{for(let Z=H,J=H+W;Z<J;Z++){const te=G.resolveTriangleIndex(Z);qe(E,3*te,f,d),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let se=M,ue=M+k;se<ue;se++){const we=c.resolveTriangleIndex(se);qe(m,3*we,u,l),m.needsUpdate=!0;const ce=m.distanceToTriangle(E,w,A);if(ce<x&&(y.copy(w),S&&S.copy(A),x=ce,R=se,C=Z),ce<i)return!0}}}})}else{const G=Pn(e);for(let H=0,W=G;H<W;H++){qe(E,3*H,f,d),E.a.applyMatrix4(t),E.b.applyMatrix4(t),E.c.applyMatrix4(t),E.needsUpdate=!0;for(let Z=M,J=M+k;Z<J;Z++){const te=c.resolveTriangleIndex(Z);qe(m,3*te,u,l),m.needsUpdate=!0;const se=m.distanceToTriangle(E,w,A);if(se<x&&(y.copy(w),S&&S.copy(A),x=se,R=Z,C=H),se<i)return!0}}}}}),St.releasePrimitive(m),St.releasePrimitive(E),x===1/0?null:(s.point?s.point.copy(y):s.point=y.clone(),s.distance=x,s.faceIndex=R,n&&(n.point?n.point.copy(S):n.point=S.clone(),n.point.applyMatrix4(cr),y.applyMatrix4(cr),n.distance=y.sub(n.point).length(),n.faceIndex=C),s)}function hp(){return typeof SharedArrayBuffer<"u"}const di=new Be.constructor,_r=new Be.constructor,Cs=new Ka(()=>new Ue),mn=new Ue,gn=new Ue,Go=new Ue,Ho=new Ue;let jo=!1;function cp(c,e,t,s){if(jo)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");jo=!0;const n=c._roots,i=e._roots;let r,o=0,l=0;const u=new me().copy(t).invert();for(let d=0,f=n.length;d<f;d++){di.setBuffer(n[d]),l=0;const m=Cs.getPrimitive();Ge(0,di.float32Array,m),m.applyMatrix4(u);for(let E=0,w=i.length;E<w&&(_r.setBuffer(i[d]),r=_t(0,0,t,u,s,o,l,0,0,m),_r.clearBuffer(),l+=i[E].length,!r);E++);if(Cs.releasePrimitive(m),di.clearBuffer(),o+=n[d].length,r)break}return jo=!1,r}function _t(c,e,t,s,n,i=0,r=0,o=0,l=0,u=null,d=!1){let f,m;d?(f=_r,m=di):(f=di,m=_r);const E=f.float32Array,w=f.uint32Array,y=f.uint16Array,A=m.float32Array,S=m.uint32Array,x=m.uint16Array,R=c*2,C=e*2,M=wt(R,y),k=wt(C,x);let G=!1;if(k&&M)d?G=n(yt(e,S),Ft(e*2,x),yt(c,w),Ft(c*2,y),l,r+e,o,i+c):G=n(yt(c,w),Ft(c*2,y),yt(e,S),Ft(e*2,x),o,i+c,l,r+e);else if(k){const H=Cs.getPrimitive();Ge(e,A,H),H.applyMatrix4(t);const W=xt(c),Z=Rt(c,w);Ge(W,E,mn),Ge(Z,E,gn);const J=H.intersectsBox(mn),te=H.intersectsBox(gn);G=J&&_t(e,W,s,t,n,r,i,l,o+1,H,!d)||te&&_t(e,Z,s,t,n,r,i,l,o+1,H,!d),Cs.releasePrimitive(H)}else{const H=xt(e),W=Rt(e,S);Ge(H,A,Go),Ge(W,A,Ho);const Z=u.intersectsBox(Go),J=u.intersectsBox(Ho);if(Z&&J)G=_t(c,H,t,s,n,i,r,o,l+1,u,d)||_t(c,W,t,s,n,i,r,o,l+1,u,d);else if(Z)if(M)G=_t(c,H,t,s,n,i,r,o,l+1,u,d);else{const te=Cs.getPrimitive();te.copy(Go).applyMatrix4(t);const se=xt(c),ue=Rt(c,w);Ge(se,E,mn),Ge(ue,E,gn);const we=te.intersectsBox(mn),ce=te.intersectsBox(gn);G=we&&_t(H,se,s,t,n,r,i,l,o+1,te,!d)||ce&&_t(H,ue,s,t,n,r,i,l,o+1,te,!d),Cs.releasePrimitive(te)}else if(J)if(M)G=_t(c,W,t,s,n,i,r,o,l+1,u,d);else{const te=Cs.getPrimitive();te.copy(Ho).applyMatrix4(t);const se=xt(c),ue=Rt(c,w);Ge(se,E,mn),Ge(ue,E,gn);const we=te.intersectsBox(mn),ce=te.intersectsBox(gn);G=we&&_t(W,se,s,t,n,r,i,l,o+1,te,!d)||ce&&_t(W,ue,s,t,n,r,i,l,o+1,te,!d),Cs.releasePrimitive(te)}}return G}const ur=new pt,Jl=new Ue;class Wa{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,n=e._roots,i=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:n.map(l=>l.slice()),index:r.array.slice(),indirectBuffer:i?i.slice():null}:o={roots:n,index:r.array,indirectBuffer:i},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:n,roots:i,indirectBuffer:r}=e,o=new Wa(t,{...s,[Uo]:!0});if(o._roots=i,o._indirectBuffer=r||null,s.setIndex){const l=t.getIndex();if(l===null){const u=new gt(e.index,1,!1);t.setIndex(u)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Gh,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Uo]:!1},t),t.useSharedArrayBuffer&&!hp())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Uo]||(Fd(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ue)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?n=>s[n]:n=>n}refit(e=null){return(this.indirect?$d:zd)(this,e)}traverse(e,t=0){const s=this._roots[t],n=new Uint32Array(s),i=new Uint16Array(s);r(0);function r(o,l=0){const u=o*2,d=i[u+15]===jr;if(d){const f=n[o+6],m=i[u+14];e(l,d,new Float32Array(s,o*4,6),f,m)}else{const f=o+Rr/4,m=n[o+6],E=n[o+7];e(l,d,new Float32Array(s,o*4,6),E)||(r(f,l+1),r(m,l+1))}}}raycast(e,t=Nl){const s=this._roots,n=this.geometry,i=[],r=t.isMaterial,o=Array.isArray(t),l=n.groups,u=r?t.side:t,d=this.indirect?ep:Hd;for(let f=0,m=s.length;f<m;f++){const E=o?t[l[f].materialIndex].side:u,w=i.length;if(d(this,f,E,e,i),o){const y=l[f].materialIndex;for(let A=w,S=i.length;A<S;A++)i[A].face.materialIndex=y}}return i}raycastFirst(e,t=Nl){const s=this._roots,n=this.geometry,i=t.isMaterial,r=Array.isArray(t);let o=null;const l=n.groups,u=i?t.side:t,d=this.indirect?sp:Kd;for(let f=0,m=s.length;f<m;f++){const E=r?t[l[f].materialIndex].side:u,w=d(this,f,E,e);w!=null&&(o==null||w.distance<o.distance)&&(o=w,r&&(w.face.materialIndex=l[f].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const n=this._roots,i=this.indirect?np:Wd;for(let r=0,o=n.length;r<o&&(s=i(this,r,e,t),!s);r++);return s}shapecast(e){const t=St.getPrimitive(),s=this.indirect?Gd:kd;let{boundsTraverseOrder:n,intersectsBounds:i,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const f=r;r=(m,E,w,y,A)=>f(m,E,w,y,A)?!0:s(m,E,this,o,w,y,t)}else r||(o?r=(f,m,E,w)=>s(f,m,this,o,E,w,t):r=(f,m,E)=>E);let l=!1,u=0;const d=this._roots;for(let f=0,m=d.length;f<m;f++){const E=d[f];if(l=Dd(this,f,i,r,n,u),l)break;u+=E.byteLength}return St.releasePrimitive(t),l}bvhcast(e,t,s){let{intersectsRanges:n,intersectsTriangles:i}=s;const r=St.getPrimitive(),o=this.geometry.index,l=this.geometry.attributes.position,u=this.indirect?w=>{const y=this.resolveTriangleIndex(w);qe(r,y*3,o,l)}:w=>{qe(r,w*3,o,l)},d=St.getPrimitive(),f=e.geometry.index,m=e.geometry.attributes.position,E=e.indirect?w=>{const y=e.resolveTriangleIndex(w);qe(d,y*3,f,m)}:w=>{qe(d,w*3,f,m)};if(i){const w=(y,A,S,x,R,C,M,k)=>{for(let G=S,H=S+x;G<H;G++){E(G),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let W=y,Z=y+A;W<Z;W++)if(u(W),r.needsUpdate=!0,i(r,d,W,G,R,C,M,k))return!0}return!1};if(n){const y=n;n=function(A,S,x,R,C,M,k,G){return y(A,S,x,R,C,M,k,G)?!0:w(A,S,x,R,C,M,k,G)}}else n=w}return cp(this,e,t,n)}intersectsBox(e,t){return ur.set(e.min,e.max,t),ur.needsUpdate=!0,this.shapecast({intersectsBounds:s=>ur.intersectsBox(s),intersectsTriangle:s=>ur.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},n={},i=0,r=1/0){return(this.indirect?lp:Jd)(this,e,t,s,n,i,r)}closestPointToPoint(e,t={},s=0,n=1/0){return Ld(this,e,t,s,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Ge(0,new Float32Array(t),Jl),e.union(Jl)}),e}}function $l(c,e,t){return c===null||(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(t.ray.origin),c.object=e,c.distance<t.near||c.distance>t.far)?null:c}const Ko=new ku,eh=new me,up=re.prototype.raycast;function dp(c,e){if(this.geometry.boundsTree){if(this.material===void 0)return;eh.copy(this.matrixWorld).invert(),Ko.copy(c.ray).applyMatrix4(eh);const t=this.geometry.boundsTree;if(c.firstHitOnly===!0){const s=$l(t.raycastFirst(Ko,this.material),this,c);s&&e.push(s)}else{const s=t.raycast(Ko,this.material);for(let n=0,i=s.length;n<i;n++){const r=$l(s[n],this,c);r&&e.push(r)}}}else up.call(this,c,e)}function pp(c){return this.boundsTree=new Wa(this,c),this.boundsTree}function fp(){this.boundsTree=null}class ${constructor(){b(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)}),b(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class bs{constructor(){b(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)}),b(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class Xa{constructor(e){b(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),b(this,"isResizeable",()=>"resize"in this&&"getSize"in this),b(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),b(this,"isHideable",()=>"visible"in this),b(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}class Fe extends Xa{}class Wh extends Xa{constructor(e){super(e),b(this,"worlds",new Map),b(this,"onWorldChanged",new $),b(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}}class mp extends Wh{constructor(){super(...arguments),b(this,"hasCameraControls",()=>"controls"in this)}}class gp extends Wh{constructor(){super(...arguments),b(this,"onAfterUpdate",new $),b(this,"onBeforeUpdate",new $),b(this,"onDisposed",new $),b(this,"onResize",new $),b(this,"onClippingPlanesUpdated",new $),b(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,s){t.isLocal=s;const n=this.clippingPlanes.indexOf(t);e&&n===-1?this.clippingPlanes.push(t):!e&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(i=>!i.isLocal)}}const Xh=class fa extends Fe{constructor(e){super(e),b(this,"_disposedComponents",new Set),b(this,"enabled",!0),e.add(fa.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const n=e;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(e,t),s&&n.children&&n.children.length&&this.disposeChildren(n),e.children.length=0}disposeGeometry(e){const t=e;t.boundsTree&&t.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&fa.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};b(Xh,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let us=Xh;const Pr=0,Ep=1,vp=new P,th=new It,Wo=new Fs,sh=new P,dr=new Gs;class wp{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new nh,this.unassigned=new nh,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new yp(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const n=s.geometry;if(n!==void 0){const i=n.attributes.position;if(i!==void 0)for(let r=0,o=i.count;r<o;r++){const l=new P;l.fromBufferAttribute(i,r).applyMatrix4(s.matrixWorld),t.push(l)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,n=t.length;s<n;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let n=-1/0,i=1/0;for(let r=0,o=s.length;r<o;r++){const l=s[r],u=l.distanceToPoint(e.origin),d=l.normal.dot(e.direction);if(u>0&&d>=0)return null;const f=d!==0?-u/d:0;if(!(f<=0)&&(d>0?i=Math.min(f,i):n=Math.max(f,n),n>i))return null}return n!==-1/0?e.at(n,t):e.at(i,t),t}intersectsRay(e){return this.intersectRay(e,vp)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let n=s;do{const i=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=i}while(n!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let n=this.tolerance,i=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===Pr){const l=o.distanceToPoint(t.point);if(l>n&&(n=l,i=o),n>1e3*this.tolerance)break}}i!==null&&this.addVertexToFace(t,i),t=s}while(t!==null)}return this}computeExtremes(){const e=new P,t=new P,s=[],n=[];for(let i=0;i<3;i++)s[i]=n[i]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let i=0,r=this.vertices.length;i<r;i++){const o=this.vertices[i],l=o.point;for(let u=0;u<3;u++)l.getComponent(u)<e.getComponent(u)&&(e.setComponent(u,l.getComponent(u)),s[u]=o);for(let u=0;u<3;u++)l.getComponent(u)>t.getComponent(u)&&(t.setComponent(u,l.getComponent(u)),n[u]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:n}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,n=t.max;let i=0,r=0;for(let m=0;m<3;m++){const E=n[m].point.getComponent(m)-s[m].point.getComponent(m);E>i&&(i=E,r=m)}const o=s[r],l=n[r];let u,d;i=0,th.set(o.point,l.point);for(let m=0,E=this.vertices.length;m<E;m++){const w=e[m];if(w!==o&&w!==l){th.closestPointToPoint(w.point,!0,sh);const y=sh.distanceToSquared(w.point);y>i&&(i=y,u=w)}}i=-1,Wo.setFromCoplanarPoints(o.point,l.point,u.point);for(let m=0,E=this.vertices.length;m<E;m++){const w=e[m];if(w!==o&&w!==l&&w!==u){const y=Math.abs(Wo.distanceToPoint(w.point));y>i&&(i=y,d=w)}}const f=[];if(Wo.distanceToPoint(d.point)<0){f.push(Bt.create(o,l,u),Bt.create(d,l,o),Bt.create(d,u,l),Bt.create(d,o,u));for(let m=0;m<3;m++){const E=(m+1)%3;f[m+1].getEdge(2).setTwin(f[0].getEdge(E)),f[m+1].getEdge(1).setTwin(f[E+1].getEdge(0))}}else{f.push(Bt.create(o,u,l),Bt.create(d,o,l),Bt.create(d,l,u),Bt.create(d,u,o));for(let m=0;m<3;m++){const E=(m+1)%3;f[m+1].getEdge(2).setTwin(f[0].getEdge((3-m)%3)),f[m+1].getEdge(0).setTwin(f[E+1].getEdge(1))}}for(let m=0;m<4;m++)this.faces.push(f[m]);for(let m=0,E=e.length;m<E;m++){const w=e[m];if(w!==o&&w!==l&&w!==u&&w!==d){i=this.tolerance;let y=null;for(let A=0;A<4;A++){const S=this.faces[A].distanceToPoint(w.point);S>i&&(i=S,y=this.faces[A])}y!==null&&this.addVertexToFace(w,y)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===Pr&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let n=s.outside;do{const i=s.distanceToPoint(n.point);i>t&&(t=i,e=n),n=n.next}while(n!==null&&n.face===s);return e}}computeHorizon(e,t,s,n){this.deleteFaceVertices(s),s.mark=Ep;let i;t===null?i=t=s.getEdge(0):i=t.next;do{const r=i.twin,o=r.face;o.mark===Pr&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,n):n.push(i)),i=i.next}while(i!==t);return this}addAdjoiningFace(e,t){const s=Bt.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,n=null;for(let i=0;i<t.length;i++){const r=t[i],o=this.addAdjoiningFace(e,r);s===null?s=o:o.next.setTwin(n),this.newFaces.push(o.face),n=o}return s.next.setTwin(n),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class Bt{constructor(){this.normal=new P,this.midpoint=new P,this.area=0,this.constant=0,this.outside=null,this.mark=Pr,this.edge=null}static create(e,t,s){const n=new Bt,i=new Xo(e,n),r=new Xo(t,n),o=new Xo(s,n);return i.next=o.prev=r,r.next=i.prev=o,o.next=r.prev=i,n.edge=i,n.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return dr.set(e.point,t.point,s.point),dr.getNormal(this.normal),dr.getMidpoint(this.midpoint),this.area=dr.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class Xo{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class yp{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class nh{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}const ma=[2,2,1],ga=[1,0,0];function qt(c,e){return c*3+e}function Ip(c){const e=c.elements;let t=0;for(let s=0;s<9;s++)t+=e[s]*e[s];return Math.sqrt(t)}function Cp(c){const e=c.elements;let t=0;for(let s=0;s<3;s++){const n=e[qt(ma[s],ga[s])];t+=2*n*n}return Math.sqrt(t)}function Tp(c,e){let t=0,s=1;const n=c.elements;for(let u=0;u<3;u++){const d=Math.abs(n[qt(ma[u],ga[u])]);d>t&&(t=d,s=u)}let i=1,r=0;const o=ga[s],l=ma[s];if(Math.abs(n[qt(l,o)])>Number.EPSILON){const u=n[qt(l,l)],d=n[qt(o,o)],f=n[qt(l,o)],m=(u-d)/2/f;let E;m<0?E=-1/(-m+Math.sqrt(1+m*m)):E=1/(m+Math.sqrt(1+m*m)),i=1/Math.sqrt(1+E*E),r=E*i}return e.identity(),e.elements[qt(o,o)]=i,e.elements[qt(l,l)]=i,e.elements[qt(l,o)]=r,e.elements[qt(o,l)]=-r,e}function bp(c,e){let t=0,s=0;const n=10;e.unitary.identity(),e.diagonal.copy(c);const i=e.unitary,r=e.diagonal,o=new Hs,l=new Hs,u=Number.EPSILON*Ip(r);for(;s<n&&Cp(r)>u;)Tp(r,o),l.copy(o).transpose(),r.multiply(o),r.premultiply(l),i.multiply(o),++t>2&&(s++,t=0);return e}function Ap(c){const e=[];for(let Ke=0;Ke<c.length-2;Ke+=3){const de=c[Ke],Ve=c[Ke+1],Dt=c[Ke+2];e.push(new P(de,Ve,Dt))}const t=new wp;t.setFromPoints(e);const s={unitary:new Hs,diagonal:new Hs},n=t.faces,i=[],r=[];for(let Ke=0,de=n.length;Ke<de;Ke++){const Ve=n[Ke];let Dt=Ve.edge;i.length=0;do i.push(Dt),Dt=Dt.next;while(Dt!==Ve.edge);const Oe=i.length-2;for(let Vt=1,Qr=Oe;Vt<=Qr;Vt++){const Lt=i[0].vertex,Dn=i[Vt+0].vertex,Ln=i[Vt+1].vertex;r.push(Lt.point.x,Lt.point.y,Lt.point.z),r.push(Dn.point.x,Dn.point.y,Dn.point.z),r.push(Ln.point.x,Ln.point.y,Ln.point.z)}}const o=new P,l=new P,u=new P,d=new P,f=new P,m=new P,E=new P,w=new P;let y=0,A=0,S=0,x=0,R=0,C=0,M=0;for(let Ke=0,de=r.length;Ke<de;Ke+=9){o.fromArray(r,Ke),l.fromArray(r,Ke+3),u.fromArray(r,Ke+6),E.set(0,0,0),E.add(o).add(l).add(u).divideScalar(3),d.subVectors(l,o),f.subVectors(u,o);const Ve=m.crossVectors(d,f).length()/2;w.add(m.copy(E).multiplyScalar(Ve)),y+=Ve,A+=(9*E.x*E.x+o.x*o.x+l.x*l.x+u.x*u.x)*(Ve/12),S+=(9*E.x*E.y+o.x*o.y+l.x*l.y+u.x*u.y)*(Ve/12),x+=(9*E.x*E.z+o.x*o.z+l.x*l.z+u.x*u.z)*(Ve/12),R+=(9*E.y*E.y+o.y*o.y+l.y*l.y+u.y*u.y)*(Ve/12),C+=(9*E.y*E.z+o.y*o.z+l.y*l.z+u.y*u.z)*(Ve/12),M+=(9*E.z*E.z+o.z*o.z+l.z*l.z+u.z*u.z)*(Ve/12)}w.divideScalar(y),A/=y,S/=y,x/=y,R/=y,C/=y,M/=y,A-=w.x*w.x,S-=w.x*w.y,x-=w.x*w.z,R-=w.y*w.y,C-=w.y*w.z,M-=w.z*w.z;const k=new Hs;k.elements[0]=A,k.elements[1]=S,k.elements[2]=x,k.elements[3]=S,k.elements[4]=R,k.elements[5]=C,k.elements[6]=x,k.elements[7]=C,k.elements[8]=M,bp(k,s);const G=s.unitary,H=new P,W=new P,Z=new P;G.extractBasis(H,W,Z);let J=-1/0,te=-1/0,se=-1/0,ue=1/0,we=1/0,ce=1/0;for(let Ke=0,de=e.length;Ke<de;Ke++){const Ve=e[Ke];J=Math.max(H.dot(Ve),J),te=Math.max(W.dot(Ve),te),se=Math.max(Z.dot(Ve),se),ue=Math.min(H.dot(Ve),ue),we=Math.min(W.dot(Ve),we),ce=Math.min(Z.dot(Ve),ce)}H.multiplyScalar(.5*(ue+J)),W.multiplyScalar(.5*(we+te)),Z.multiplyScalar(.5*(ce+se));const ge=new P,pe=new P,Ie=new Hs;ge.add(H).add(W).add(Z),pe.x=J-ue,pe.y=te-we,pe.z=se-ce,pe.multiplyScalar(.5),Ie.copy(G);const{x:je,y:Mt,z:Js}=pe,Ct=new me;Ct.makeScale(je*2,Mt*2,Js*2);const Mn=new me;Mn.makeTranslation(-je,-Mt,-Js);const Rs=new me;Rs.makeTranslation(ge.x,ge.y,ge.z);const $t=new me;$t.setFromMatrix3(Ie);const es=new me;return es.multiply(Rs),es.multiply($t),es.multiply(Mn),es.multiply(Ct),{center:ge,halfSizes:pe,rotation:Ie,transformation:es}}function Sp(c,e,t){const s=[c[0]-e[0],c[1]-e[1],c[2]-e[2]];return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]>0}class ih{static isTransparent(e){return e.transparent&&e.opacity<1}}const Ea=class et{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${et._lut[e&255]+et._lut[e>>8&255]+et._lut[e>>16&255]+et._lut[e>>24&255]}-${et._lut[t&255]}${et._lut[t>>8&255]}-${et._lut[t>>16&15|64]}${et._lut[t>>24&255]}-${et._lut[s&63|128]}${et._lut[s>>8&255]}-${et._lut[s>>16&255]}${et._lut[s>>24&255]}${et._lut[n&255]}${et._lut[n>>8&255]}${et._lut[n>>16&255]}${et._lut[n>>24&255]}`.toLowerCase()}static validate(e){if(!et._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};b(Ea,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),b(Ea,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Za=Ea;class Fp extends Fe{constructor(e,t){super(e),b(this,"onVertexFound",new $),b(this,"onVertexLost",new $),b(this,"components"),b(this,"_pickedPoint",null),b(this,"_config"),b(this,"_enabled",!1),b(this,"_workingPlane",null),this.components=e,this.config={snapDistance:.25,showOnlyVertex:!1,...t},this.enabled=!1}set enabled(e){this._enabled=e,e||(this._pickedPoint=null)}get enabled(){return this._enabled}set workingPlane(e){this._workingPlane=e}get workingPlane(){return this._workingPlane}set config(e){this._config={...this._config,...e}}get config(){return this._config}dispose(){this.onVertexFound.reset(),this.onVertexLost.reset(),this.components=null}get(e){if(!this.enabled)return this._pickedPoint;const t=this.components.get(zt).get(e).castRay();if(!t)return this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint;const s=this.getClosestVertex(t);return s?!this.workingPlane||Math.abs(this.workingPlane.distanceToPoint(s))<.001?((this._pickedPoint===null||!this._pickedPoint.equals(s))&&(this._pickedPoint=s.clone(),this.onVertexFound.trigger(this._pickedPoint)),this._pickedPoint):(this._pickedPoint=null,this._pickedPoint):(this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint)}getClosestVertex(e){let t=new P,s=!1,n=Number.MAX_SAFE_INTEGER;const i=this.getVertices(e);return i==null||i.forEach(r=>{if(!r)return;const o=e.point.distanceTo(r);o>n||o>this._config.snapDistance||(s=!0,t=r,n=e.point.distanceTo(r))}),s?t:this.config.showOnlyVertex?null:e.point}getVertices(e){const t=e.object;if(!e.face||!t)return null;const s=t.geometry;return[this.getVertex(e.face.a,s),this.getVertex(e.face.b,s),this.getVertex(e.face.c,s)].map(n=>n==null?void 0:n.applyMatrix4(t.matrixWorld))}getVertex(e,t){if(e===void 0)return null;const s=t.attributes.position;return new P(s.getX(e),s.getY(e),s.getZ(e))}}const Zh=class Qh{constructor(){b(this,"onDisposed",new $),b(this,"list",new Map),b(this,"enabled",!1),b(this,"_clock"),b(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new Lh,Qh.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components intance. Use Components.get() instead.");Za.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){De.prototype.computeBoundsTree=pp,De.prototype.disposeBoundsTree=fp,re.prototype.raycast=dp}};b(Zh,"release","1.4.21");let xp=Zh;class Rp{constructor(e){b(this,"_event"),b(this,"_position",new ke),b(this,"onDisposed",new $),b(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("mousemove",this.updateMouseInfo):this.dom.removeEventListener("mousemove",this.updateMouseInfo)}}class Pp{constructor(e,t){b(this,"enabled",!0),b(this,"components"),b(this,"onDisposed",new $),b(this,"mouse"),b(this,"three",new zr),b(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new Rp(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||(s==null?void 0:s.length)<=0?e:e.filter(n=>s.every(i=>i.distanceToPoint(n.point)>0))}}const qh=class Jh extends Fe{constructor(e){super(e),b(this,"enabled",!0),b(this,"list",new Map),b(this,"onDisposed",new $),e.add(Jh.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Pp(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};b(qh,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let zt=qh;class Op extends Xa{constructor(e){super(e),b(this,"meshes",new Set),b(this,"onAfterUpdate",new $),b(this,"onBeforeUpdate",new $),b(this,"enabled",!0),b(this,"uuid",Za.create()),b(this,"onDisposed",new $),b(this,"_scene"),b(this,"_camera"),b(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(us);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class Mp extends gp{constructor(e,t,s){super(e),b(this,"enabled",!0),b(this,"container"),b(this,"three"),b(this,"_canvas"),b(this,"_parameters"),b(this,"_resizeObserver",null),b(this,"onContainerUpdated",new $),b(this,"resize",r=>{this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,l=r?r.y:this.container.clientHeight;this.three.setSize(o,l),this.onResize.trigger(new ke(o,l))}),b(this,"resizeEvent",()=>{this.resize()}),b(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),b(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Mr({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=s,this.three=new Mr({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:i}=n;i.addEventListener("webglcontextlost",this.onContextLost,!1),i.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new ke(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),this._resizeObserver.observe(document.body),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const ye={LEFT:1,RIGHT:2,MIDDLE:4},q=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),En={NONE:0,IN:1,OUT:-1};function Bs(c){return c.isPerspectiveCamera}function Is(c){return c.isOrthographicCamera}const vn=Math.PI*2,rh=Math.PI/2,$h=1e-5,si=Math.PI/180;function Ut(c,e,t){return Math.max(e,Math.min(t,c))}function Ne(c,e=$h){return Math.abs(c)<e}function Me(c,e,t=$h){return Ne(c-e,t)}function oh(c,e){return Math.round(c/e)*e}function ni(c){return isFinite(c)?c:c<0?-Number.MAX_VALUE:Number.MAX_VALUE}function ii(c){return Math.abs(c)<Number.MAX_VALUE?c:c*(1/0)}function pr(c,e,t,s,n=1/0,i){s=Math.max(1e-4,s);const r=2/s,o=r*i,l=1/(1+o+.48*o*o+.235*o*o*o);let u=c-e;const d=e,f=n*s;u=Ut(u,-f,f),e=c-u;const m=(t.value+r*u)*i;t.value=(t.value-r*m)*l;let E=e+(u+m)*l;return d-c>0==E>d&&(E=d,t.value=(E-d)/i),E}function ah(c,e,t,s,n=1/0,i,r){s=Math.max(1e-4,s);const o=2/s,l=o*i,u=1/(1+l+.48*l*l+.235*l*l*l);let d=e.x,f=e.y,m=e.z,E=c.x-d,w=c.y-f,y=c.z-m;const A=d,S=f,x=m,R=n*s,C=R*R,M=E*E+w*w+y*y;if(M>C){const we=Math.sqrt(M);E=E/we*R,w=w/we*R,y=y/we*R}d=c.x-E,f=c.y-w,m=c.z-y;const k=(t.x+o*E)*i,G=(t.y+o*w)*i,H=(t.z+o*y)*i;t.x=(t.x-o*k)*u,t.y=(t.y-o*G)*u,t.z=(t.z-o*H)*u,r.x=d+(E+k)*u,r.y=f+(w+G)*u,r.z=m+(y+H)*u;const W=A-c.x,Z=S-c.y,J=x-c.z,te=r.x-A,se=r.y-S,ue=r.z-x;return W*te+Z*se+J*ue>0&&(r.x=A,r.y=S,r.z=x,t.x=(r.x-A)/i,t.y=(r.y-S)/i,t.z=(r.z-x)/i),r}function Zo(c,e){e.set(0,0),c.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=c.length,e.y/=c.length}function Qo(c,e){return Is(c)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Dp{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const n=s.indexOf(t);n!==-1&&s.splice(n,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let n=0,i=s.length;n<i;n++)s[n].call(this,e)}}}const Lp="2.7.3",fr=1/8,ec=typeof window<"u",Np=ec&&/Mac/.test(navigator.platform),_p=!(ec&&"PointerEvent"in window);let Ee,lh,mr,qo,ft,Ce,Re,wn,ri,Kt,Wt,ks,hh,ch,bt,oi,yn,uh,Jo,dh,$o,ea,gr;class ct extends Dp{static install(e){Ee=e.THREE,lh=Object.freeze(new Ee.Vector3(0,0,0)),mr=Object.freeze(new Ee.Vector3(0,1,0)),qo=Object.freeze(new Ee.Vector3(0,0,1)),ft=new Ee.Vector2,Ce=new Ee.Vector3,Re=new Ee.Vector3,wn=new Ee.Vector3,ri=new Ee.Vector3,Kt=new Ee.Vector3,Wt=new Ee.Vector3,ks=new Ee.Vector3,hh=new Ee.Vector3,ch=new Ee.Vector3,bt=new Ee.Spherical,oi=new Ee.Spherical,yn=new Ee.Box3,uh=new Ee.Box3,Jo=new Ee.Sphere,dh=new Ee.Quaternion,$o=new Ee.Quaternion,ea=new Ee.Matrix4,gr=new Ee.Raycaster}static get ACTION(){return q}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=q.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=En.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Ee.Vector3,this._focalOffsetVelocity=new Ee.Vector3,this._zoomVelocity={value:0},this._truckInternal=(C,M,k)=>{let G,H;if(Bs(this._camera)){const W=Ce.copy(this._camera.position).sub(this._target),Z=this._camera.getEffectiveFOV()*si,J=W.length()*Math.tan(Z*.5);G=this.truckSpeed*C*J/this._elementRect.height,H=this.truckSpeed*M*J/this._elementRect.height}else if(Is(this._camera)){const W=this._camera;G=C*(W.right-W.left)/W.zoom/this._elementRect.width,H=M*(W.top-W.bottom)/W.zoom/this._elementRect.height}else return;this.verticalDragToForward?(k?this.setFocalOffset(this._focalOffsetEnd.x+G,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(G,0,!0),this.forward(-H,!0)):k?this.setFocalOffset(this._focalOffsetEnd.x+G,this._focalOffsetEnd.y+H,this._focalOffsetEnd.z,!0):this.truck(G,H,!0)},this._rotateInternal=(C,M)=>{const k=vn*this.azimuthRotateSpeed*C/this._elementRect.height,G=vn*this.polarRotateSpeed*M/this._elementRect.height;this.rotate(k,G,!0)},this._dollyInternal=(C,M,k)=>{const G=Math.pow(.95,-C*this.dollySpeed),H=this._sphericalEnd.radius,W=this._sphericalEnd.radius*G,Z=Ut(W,this.minDistance,this.maxDistance),J=Z-W;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(W,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(J,!0),this._dollyToNoClamp(Z,!0)):this._dollyToNoClamp(Z,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?W:Z)-H,this._dollyControlCoord.set(M,k)),this._lastDollyDirection=Math.sign(-C)},this._zoomInternal=(C,M,k)=>{const G=Math.pow(.95,C*this.dollySpeed),H=this._zoom,W=this._zoom*G;this.zoomTo(W,!0),this.dollyToCursor&&(this._changedZoom+=W-H,this._dollyControlCoord.set(M,k))},typeof Ee>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Ee.Quaternion().setFromUnitVectors(this._camera.up,mr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=q.NONE,this._target=new Ee.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Ee.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Ee.Spherical().setFromVector3(Ce.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Ee.Vector3,new Ee.Vector3,new Ee.Vector3,new Ee.Vector3],this._updateNearPlaneCorners(),this._boundary=new Ee.Box3(new Ee.Vector3(-1/0,-1/0,-1/0),new Ee.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Ee.Vector2,this.mouseButtons={left:q.ROTATE,middle:q.DOLLY,right:q.TRUCK,wheel:Bs(this._camera)?q.DOLLY:Is(this._camera)?q.ZOOM:q.NONE},this.touches={one:q.TOUCH_ROTATE,two:Bs(this._camera)?q.TOUCH_DOLLY_TRUCK:Is(this._camera)?q.TOUCH_ZOOM_TRUCK:q.NONE,three:q.TOUCH_TRUCK};const s=new Ee.Vector2,n=new Ee.Vector2,i=new Ee.Vector2,r=C=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const G=this._domElement.getBoundingClientRect(),H=C.clientX/G.width,W=C.clientY/G.height;if(H<this._interactiveArea.left||H>this._interactiveArea.right||W<this._interactiveArea.top||W>this._interactiveArea.bottom)return}const M=C.pointerType!=="mouse"?null:(C.buttons&ye.LEFT)===ye.LEFT?ye.LEFT:(C.buttons&ye.MIDDLE)===ye.MIDDLE?ye.MIDDLE:(C.buttons&ye.RIGHT)===ye.RIGHT?ye.RIGHT:null;if(M!==null){const G=this._findPointerByMouseButton(M);G&&this._disposePointer(G)}if((C.buttons&ye.LEFT)===ye.LEFT&&this._lockedPointer)return;const k={pointerId:C.pointerId,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:M};this._activePointers.push(k),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",d),this._isDragging=!0,y(C)},o=C=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const G=this._domElement.getBoundingClientRect(),H=C.clientX/G.width,W=C.clientY/G.height;if(H<this._interactiveArea.left||H>this._interactiveArea.right||W<this._interactiveArea.top||W>this._interactiveArea.bottom)return}const M=(C.buttons&ye.LEFT)===ye.LEFT?ye.LEFT:(C.buttons&ye.MIDDLE)===ye.MIDDLE?ye.MIDDLE:(C.buttons&ye.RIGHT)===ye.RIGHT?ye.RIGHT:null;if(M!==null){const G=this._findPointerByMouseButton(M);G&&this._disposePointer(G)}const k={pointerId:1,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:(C.buttons&ye.LEFT)===ye.LEFT?ye.LEFT:(C.buttons&ye.MIDDLE)===ye.LEFT?ye.MIDDLE:(C.buttons&ye.RIGHT)===ye.LEFT?ye.RIGHT:null};this._activePointers.push(k),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("mouseup",f),this._domElement.ownerDocument.addEventListener("mousemove",u),this._domElement.ownerDocument.addEventListener("mouseup",f),this._isDragging=!0,y(C)},l=C=>{C.cancelable&&C.preventDefault();const M=C.pointerId,k=this._lockedPointer||this._findPointerById(M);if(k){if(k.clientX=C.clientX,k.clientY=C.clientY,k.deltaX=C.movementX,k.deltaY=C.movementY,this._state=0,C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(C.buttons&ye.LEFT)===ye.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(C.buttons&ye.MIDDLE)===ye.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(C.buttons&ye.RIGHT)===ye.RIGHT&&(this._state=this._state|this.mouseButtons.right);A()}},u=C=>{const M=this._lockedPointer||this._findPointerById(1);M&&(M.clientX=C.clientX,M.clientY=C.clientY,M.deltaX=C.movementX,M.deltaY=C.movementY,this._state=0,(this._lockedPointer||(C.buttons&ye.LEFT)===ye.LEFT)&&(this._state=this._state|this.mouseButtons.left),(C.buttons&ye.MIDDLE)===ye.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&ye.RIGHT)===ye.RIGHT&&(this._state=this._state|this.mouseButtons.right),A())},d=C=>{const M=this._findPointerById(C.pointerId);if(!(M&&M===this._lockedPointer)){if(M&&this._disposePointer(M),C.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=q.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=q.NONE;S()}},f=()=>{const C=this._findPointerById(1);C&&C===this._lockedPointer||(C&&this._disposePointer(C),this._state=q.NONE,S())};let m=-1;const E=C=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===q.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const W=this._domElement.getBoundingClientRect(),Z=C.clientX/W.width,J=C.clientY/W.height;if(Z<this._interactiveArea.left||Z>this._interactiveArea.right||J<this._interactiveArea.top||J>this._interactiveArea.bottom)return}if(C.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===q.ROTATE||this.mouseButtons.wheel===q.TRUCK){const W=performance.now();m-W<1e3&&this._getClientRect(this._elementRect),m=W}const M=Np?-1:-3,k=C.deltaMode===1?C.deltaY/M:C.deltaY/(M*10),G=this.dollyToCursor?(C.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,H=this.dollyToCursor?(C.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case q.ROTATE:{this._rotateInternal(C.deltaX,C.deltaY),this._isUserControllingRotate=!0;break}case q.TRUCK:{this._truckInternal(C.deltaX,C.deltaY,!1),this._isUserControllingTruck=!0;break}case q.OFFSET:{this._truckInternal(C.deltaX,C.deltaY,!0),this._isUserControllingOffset=!0;break}case q.DOLLY:{this._dollyInternal(-k,G,H),this._isUserControllingDolly=!0;break}case q.ZOOM:{this._zoomInternal(-k,G,H),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},w=C=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ct.ACTION.NONE){const M=C instanceof PointerEvent?C.pointerId:0,k=this._findPointerById(M);k&&this._disposePointer(k),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("mouseup",f);return}C.preventDefault()}},y=C=>{if(this._enabled){if(Zo(this._activePointers,ft),this._getClientRect(this._elementRect),s.copy(ft),n.copy(ft),this._activePointers.length>=2){const M=ft.x-this._activePointers[1].clientX,k=ft.y-this._activePointers[1].clientY,G=Math.sqrt(M*M+k*k);i.set(0,G);const H=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,W=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(H,W)}if(this._state=0,!C)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in C&&C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(C.buttons&ye.LEFT)===ye.LEFT&&(this._state=this._state|this.mouseButtons.left),(C.buttons&ye.MIDDLE)===ye.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&ye.RIGHT)===ye.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&q.ROTATE)===q.ROTATE||(this._state&q.TOUCH_ROTATE)===q.TOUCH_ROTATE||(this._state&q.TOUCH_DOLLY_ROTATE)===q.TOUCH_DOLLY_ROTATE||(this._state&q.TOUCH_ZOOM_ROTATE)===q.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&q.TRUCK)===q.TRUCK||(this._state&q.TOUCH_TRUCK)===q.TOUCH_TRUCK||(this._state&q.TOUCH_DOLLY_TRUCK)===q.TOUCH_DOLLY_TRUCK||(this._state&q.TOUCH_ZOOM_TRUCK)===q.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&q.DOLLY)===q.DOLLY||(this._state&q.TOUCH_DOLLY)===q.TOUCH_DOLLY||(this._state&q.TOUCH_DOLLY_TRUCK)===q.TOUCH_DOLLY_TRUCK||(this._state&q.TOUCH_DOLLY_OFFSET)===q.TOUCH_DOLLY_OFFSET||(this._state&q.TOUCH_DOLLY_ROTATE)===q.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&q.ZOOM)===q.ZOOM||(this._state&q.TOUCH_ZOOM)===q.TOUCH_ZOOM||(this._state&q.TOUCH_ZOOM_TRUCK)===q.TOUCH_ZOOM_TRUCK||(this._state&q.TOUCH_ZOOM_OFFSET)===q.TOUCH_ZOOM_OFFSET||(this._state&q.TOUCH_ZOOM_ROTATE)===q.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&q.OFFSET)===q.OFFSET||(this._state&q.TOUCH_OFFSET)===q.TOUCH_OFFSET||(this._state&q.TOUCH_DOLLY_OFFSET)===q.TOUCH_DOLLY_OFFSET||(this._state&q.TOUCH_ZOOM_OFFSET)===q.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},A=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Zo(this._activePointers,ft);const C=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,M=C?-C.deltaX:n.x-ft.x,k=C?-C.deltaY:n.y-ft.y;if(n.copy(ft),((this._state&q.ROTATE)===q.ROTATE||(this._state&q.TOUCH_ROTATE)===q.TOUCH_ROTATE||(this._state&q.TOUCH_DOLLY_ROTATE)===q.TOUCH_DOLLY_ROTATE||(this._state&q.TOUCH_ZOOM_ROTATE)===q.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(M,k),this._isUserControllingRotate=!0),(this._state&q.DOLLY)===q.DOLLY||(this._state&q.ZOOM)===q.ZOOM){const G=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,H=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,W=this.dollyDragInverted?-1:1;(this._state&q.DOLLY)===q.DOLLY?(this._dollyInternal(W*k*fr,G,H),this._isUserControllingDolly=!0):(this._zoomInternal(W*k*fr,G,H),this._isUserControllingZoom=!0)}if((this._state&q.TOUCH_DOLLY)===q.TOUCH_DOLLY||(this._state&q.TOUCH_ZOOM)===q.TOUCH_ZOOM||(this._state&q.TOUCH_DOLLY_TRUCK)===q.TOUCH_DOLLY_TRUCK||(this._state&q.TOUCH_ZOOM_TRUCK)===q.TOUCH_ZOOM_TRUCK||(this._state&q.TOUCH_DOLLY_OFFSET)===q.TOUCH_DOLLY_OFFSET||(this._state&q.TOUCH_ZOOM_OFFSET)===q.TOUCH_ZOOM_OFFSET||(this._state&q.TOUCH_DOLLY_ROTATE)===q.TOUCH_DOLLY_ROTATE||(this._state&q.TOUCH_ZOOM_ROTATE)===q.TOUCH_ZOOM_ROTATE){const G=ft.x-this._activePointers[1].clientX,H=ft.y-this._activePointers[1].clientY,W=Math.sqrt(G*G+H*H),Z=i.y-W;i.set(0,W);const J=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,te=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&q.TOUCH_DOLLY)===q.TOUCH_DOLLY||(this._state&q.TOUCH_DOLLY_ROTATE)===q.TOUCH_DOLLY_ROTATE||(this._state&q.TOUCH_DOLLY_TRUCK)===q.TOUCH_DOLLY_TRUCK||(this._state&q.TOUCH_DOLLY_OFFSET)===q.TOUCH_DOLLY_OFFSET?(this._dollyInternal(Z*fr,J,te),this._isUserControllingDolly=!0):(this._zoomInternal(Z*fr,J,te),this._isUserControllingZoom=!0)}((this._state&q.TRUCK)===q.TRUCK||(this._state&q.TOUCH_TRUCK)===q.TOUCH_TRUCK||(this._state&q.TOUCH_DOLLY_TRUCK)===q.TOUCH_DOLLY_TRUCK||(this._state&q.TOUCH_ZOOM_TRUCK)===q.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(M,k,!1),this._isUserControllingTruck=!0),((this._state&q.OFFSET)===q.OFFSET||(this._state&q.TOUCH_OFFSET)===q.TOUCH_OFFSET||(this._state&q.TOUCH_DOLLY_OFFSET)===q.TOUCH_DOLLY_OFFSET||(this._state&q.TOUCH_ZOOM_OFFSET)===q.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(M,k,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},S=()=>{Zo(this._activePointers,ft),n.copy(ft),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mouseup",f),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",x),this._domElement.ownerDocument.addEventListener("pointerlockerror",R),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",d),y())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",x),this._domElement.ownerDocument.removeEventListener("pointerlockerror",R))};const x=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},R=()=>{this.unlockPointer()};this._addAllEventListeners=C=>{this._domElement=C,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),_p&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",d),this._domElement.addEventListener("wheel",E,{passive:!1}),this._domElement.addEventListener("contextmenu",w)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",d),this._domElement.removeEventListener("wheel",E,{passive:!1}),this._domElement.removeEventListener("contextmenu",w),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mouseup",f),this._domElement.ownerDocument.removeEventListener("pointerlockchange",x),this._domElement.ownerDocument.removeEventListener("pointerlockerror",R))},this.cancel=()=>{this._state!==q.NONE&&(this._state=q.NONE,this._activePointers.length=0,S())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Ut(e.width,0,1),this._interactiveArea.height=Ut(e.height,0,1),this._interactiveArea.x=Ut(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ut(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const n=Ut(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=Ut(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||Me(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Me(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=En.NONE,this._changedDolly=0,this._dollyToNoClamp(Ut(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const i=this._collisionTest(),r=Me(i,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,i)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const n=!t||Me(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(ri).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||Me(this._target.x,this._targetEnd.x,this.restThreshold)&&Me(this._target.y,this._targetEnd.y,this.restThreshold)&&Me(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ut(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||Me(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Kt.setFromMatrixColumn(this._camera.matrix,0),Wt.setFromMatrixColumn(this._camera.matrix,1),Kt.multiplyScalar(e),Wt.multiplyScalar(-t);const n=Ce.copy(Kt).add(Wt),i=Re.copy(this._targetEnd).add(n);return this.moveTo(i.x,i.y,i.z,s)}forward(e,t=!1){Ce.setFromMatrixColumn(this._camera.matrix,0),Ce.crossVectors(this._camera.up,Ce),Ce.multiplyScalar(e);const s=Re.copy(this._targetEnd).add(Ce);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return Ce.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+Ce.x,this._targetEnd.y+Ce.y,this._targetEnd.z+Ce.z,t)}moveTo(e,t,s,n=!1){this._isUserControllingTruck=!1;const i=Ce.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const r=!n||Me(this._target.x,this._targetEnd.x,this.restThreshold)&&Me(this._target.y,this._targetEnd.y,this.restThreshold)&&Me(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,n=!1){const i=Ce.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(i.x,i.y,i.z,n)}fitToBox(e,t,{cover:s=!1,paddingLeft:n=0,paddingRight:i=0,paddingBottom:r=0,paddingTop:o=0}={}){const l=[],u=e.isBox3?yn.copy(e):yn.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const d=oh(this._sphericalEnd.theta,rh),f=oh(this._sphericalEnd.phi,rh);l.push(this.rotateTo(d,f,t));const m=Ce.setFromSpherical(this._sphericalEnd).normalize(),E=dh.setFromUnitVectors(m,qo),w=Me(Math.abs(m.y),1);w&&E.multiply($o.setFromAxisAngle(mr,d)),E.multiply(this._yAxisUpSpaceInverse);const y=uh.makeEmpty();Re.copy(u.min).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.min).setX(u.max.x).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.min).setY(u.max.y).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.max).setZ(u.min.z).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.min).setZ(u.max.z).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.max).setY(u.min.y).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.max).setX(u.min.x).applyQuaternion(E),y.expandByPoint(Re),Re.copy(u.max).applyQuaternion(E),y.expandByPoint(Re),y.min.x-=n,y.min.y-=r,y.max.x+=i,y.max.y+=o,E.setFromUnitVectors(qo,m),w&&E.premultiply($o.invert()),E.premultiply(this._yAxisUpSpace);const A=y.getSize(Ce),S=y.getCenter(Re).applyQuaternion(E);if(Bs(this._camera)){const x=this.getDistanceToFitBox(A.x,A.y,A.z,s);l.push(this.moveTo(S.x,S.y,S.z,t)),l.push(this.dollyTo(x,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Is(this._camera)){const x=this._camera,R=x.right-x.left,C=x.top-x.bottom,M=s?Math.max(R/A.x,C/A.y):Math.min(R/A.x,C/A.y);l.push(this.moveTo(S.x,S.y,S.z,t)),l.push(this.zoomTo(M,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const s=[],n=e instanceof Ee.Sphere?Jo.copy(e):ct.createBoundingSphere(e,Jo);if(s.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),Bs(this._camera)){const i=this.getDistanceToFitSphere(n.radius);s.push(this.dollyTo(i,t))}else if(Is(this._camera)){const i=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*n.radius,l=Math.min(i/o,r/o);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,n,i,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=En.NONE,this._changedDolly=0;const l=Re.set(n,i,r),u=Ce.set(e,t,s);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(u.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const d=!o||Me(this._target.x,this._targetEnd.x,this.restThreshold)&&Me(this._target.y,this._targetEnd.y,this.restThreshold)&&Me(this._target.z,this._targetEnd.z,this.restThreshold)&&Me(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Me(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Me(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(d)}lerpLookAt(e,t,s,n,i,r,o,l,u,d,f,m,E,w=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=En.NONE,this._changedDolly=0;const y=Ce.set(n,i,r),A=Re.set(e,t,s);bt.setFromVector3(A.sub(y).applyQuaternion(this._yAxisUpSpace));const S=wn.set(d,f,m),x=Re.set(o,l,u);oi.setFromVector3(x.sub(S).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(y.lerp(S,E));const R=oi.theta-bt.theta,C=oi.phi-bt.phi,M=oi.radius-bt.radius;this._sphericalEnd.set(bt.radius+M*E,bt.phi+C*E,bt.theta+R*E),this.normalizeRotations(),this._needsUpdate=!0,w||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const k=!w||Me(this._target.x,this._targetEnd.x,this.restThreshold)&&Me(this._target.y,this._targetEnd.y,this.restThreshold)&&Me(this._target.z,this._targetEnd.z,this.restThreshold)&&Me(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Me(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Me(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(k)}setPosition(e,t,s,n=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,s,n=!1){const i=this.getPosition(Ce),r=this.setLookAt(i.x,i.y,i.z,e,t,s,n);return this._sphericalEnd.phi=Ut(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const i=!n||Me(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Me(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Me(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Kt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Wt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ks.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=Ce.set(e,t,s),i=n.distanceTo(this._camera.position),r=n.sub(this._camera.position);Kt.multiplyScalar(r.x),Wt.multiplyScalar(r.y),ks.multiplyScalar(r.z),Ce.copy(Kt).add(Wt).add(ks),Ce.z=Ce.z+i,this.dollyTo(i,!1),this.setFocalOffset(-Ce.x,Ce.y,-Ce.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,n){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Ee.Vector4,typeof e=="number"?this._viewport.set(e,t,s,n):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,n=!1){if(Qo(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const i=e/t,r=this._camera.getEffectiveFOV()*si,o=this._camera.aspect;return((n?i>o:i<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(Qo(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*si,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?t:s;return e/Math.sin(n*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Ee.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Ee.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof Ee.Spherical?e:new Ee.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Ee.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%vn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=vn),this._spherical.theta+=vn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/vn)}reset(e=!1){if(!Me(this._camera.up.x,this._cameraUp0.x)||!Me(this._camera.up.y,this._cameraUp0.y)||!Me(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(Ce);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,mr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=Ce.subVectors(this._target,this._camera.position).normalize(),t=Re.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(Ce);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,i=hh.subVectors(this._targetEnd,this._target),r=ch.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(Ne(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=pr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,d,1/0,e),this._needsUpdate=!0}if(Ne(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=pr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,d,1/0,e),this._needsUpdate=!0}if(Ne(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const d=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=pr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,d,this.maxSpeed,e),this._needsUpdate=!0}if(Ne(i.x)&&Ne(i.y)&&Ne(i.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const d=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ah(this._target,this._targetEnd,this._targetVelocity,d,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Ne(r.x)&&Ne(r.y)&&Ne(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const d=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ah(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,d,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Ne(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const d=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=pr(this._zoom,this._zoomEnd,this._zoomVelocity,d,1/0,e)}if(this.dollyToCursor){if(Bs(this._camera)&&this._changedDolly!==0){const d=this._spherical.radius-this._lastDistance,f=this._camera,m=this._getCameraDirection(ri),E=Ce.copy(m).cross(f.up).normalize();E.lengthSq()===0&&(E.x=1);const w=Re.crossVectors(E,m),y=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*si*.5),A=(this._sphericalEnd.radius-d-this._sphericalEnd.radius)/this._sphericalEnd.radius,S=wn.copy(this._targetEnd).add(E.multiplyScalar(this._dollyControlCoord.x*y*f.aspect)).add(w.multiplyScalar(this._dollyControlCoord.y*y)),x=Ce.copy(this._targetEnd).lerp(S,A),R=this._lastDollyDirection===En.IN&&this._spherical.radius<=this.minDistance,C=this._lastDollyDirection===En.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(R||C)){this._sphericalEnd.radius-=d,this._spherical.radius-=d;const k=Re.copy(m).multiplyScalar(-d);x.add(k)}this._boundary.clampPoint(x,x);const M=Re.subVectors(x,this._targetEnd);this._targetEnd.copy(x),this._target.add(M),this._changedDolly-=d,Ne(this._changedDolly)&&(this._changedDolly=0)}else if(Is(this._camera)&&this._changedZoom!==0){const d=this._zoom-this._lastZoom,f=this._camera,m=Ce.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),E=Re.set(0,0,-1).applyQuaternion(f.quaternion),w=wn.copy(m).add(E.multiplyScalar(-m.dot(f.up))),y=-(this._zoom-d-this._zoom)/this._zoom,A=this._getCameraDirection(ri),S=this._targetEnd.dot(A),x=Ce.copy(this._targetEnd).lerp(w,y),R=x.dot(A),C=A.multiplyScalar(R-S);x.sub(C),this._boundary.clampPoint(x,x);const M=Re.subVectors(x,this._targetEnd);this._targetEnd.copy(x),this._target.add(M),this._changedZoom-=d,Ne(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ne(this._focalOffset.x)||!Ne(this._focalOffset.y)||!Ne(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Kt.setFromMatrixColumn(this._camera.matrix,0),Wt.setFromMatrixColumn(this._camera.matrix,1),ks.setFromMatrixColumn(this._camera.matrix,2),Kt.multiplyScalar(this._focalOffset.x),Wt.multiplyScalar(-this._focalOffset.y),ks.multiplyScalar(this._focalOffset.z),Ce.copy(Kt).add(Wt).add(ks),this._camera.position.add(Ce)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Ce.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),Ne(t,this.restThreshold)&&Ne(s,this.restThreshold)&&Ne(n,this.restThreshold)&&Ne(i.x,this.restThreshold)&&Ne(i.y,this.restThreshold)&&Ne(i.z,this.restThreshold)&&Ne(r.x,this.restThreshold)&&Ne(r.y,this.restThreshold)&&Ne(r.z,this.restThreshold)&&Ne(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:ni(this.maxDistance),minZoom:this.minZoom,maxZoom:ni(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:ni(this.maxPolarAngle),minAzimuthAngle:ni(this.minAzimuthAngle),maxAzimuthAngle:ni(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:Ce.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=ii(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=ii(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=ii(s.maxPolarAngle),this.minAzimuthAngle=ii(s.minAzimuthAngle),this.maxAzimuthAngle=ii(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),bt.setFromVector3(Ce.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(bt.theta,bt.phi,t),this.dollyTo(bt.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Lp),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const n=t.lengthSq();if(n===0)return e;const i=Re.copy(t).add(e),r=this._boundary.clampPoint(i,wn).sub(i),o=r.lengthSq();if(o===0)return e.add(t);if(o===n)return e;if(s===0)return e.add(t).add(r);{const l=1+s*o/t.dot(r);return e.add(Re.copy(t).multiplyScalar(l)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Bs(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*si,n=Math.tan(s*.5)*t,i=n*e.aspect;this._nearPlaneCorners[0].set(-i,-n,0),this._nearPlaneCorners[1].set(i,-n,0),this._nearPlaneCorners[2].set(i,n,0),this._nearPlaneCorners[3].set(-i,n,0)}else if(Is(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,n=e.right*t,i=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,i,0),this._nearPlaneCorners[1].set(n,i,0),this._nearPlaneCorners[2].set(n,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Qo(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(ri);ea.lookAt(lh,t,this._camera.up);for(let s=0;s<4;s++){const n=Re.copy(this._nearPlaneCorners[s]);n.applyMatrix4(ea);const i=wn.addVectors(this._target,n);gr.set(i,t),gr.far=this._spherical.radius+1;const r=gr.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Ee.Sphere){const s=t,n=s.center;yn.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&yn.expandByObject(r)}),yn.getCenter(n);let i=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,l=o.geometry.clone();l.applyMatrix4(o.matrixWorld);const u=l.attributes.position;for(let d=0,f=u.count;d<f;d++)Ce.fromBufferAttribute(u,d),i=Math.max(i,n.distanceToSquared(Ce))}),s.radius=Math.sqrt(i),s}}class fi extends mp{constructor(e){super(e),b(this,"onBeforeUpdate",new $),b(this,"onAfterUpdate",new $),b(this,"onAspectUpdated",new $),b(this,"onDisposed",new $),b(this,"three"),b(this,"_allControls",new Map),b(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof Zs){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:s})=>{if(t==="added"){const n=this.newCameraControls();this._allControls.set(s.uuid,n)}if(t==="removed"){const n=this._allControls.get(s.uuid);n&&(n.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.controls.enabled=e}dispose(){this.setupEvents(!1),this.enabled=!1,this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new zu(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new P(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");ct.install({THREE:fi.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new ct(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Yu,Vector2:ke,Vector3:P,Vector4:Rn,Quaternion:At,Matrix4:me,Spherical:Vu,Box3:Ue,Sphere:Xs,Raycaster:zr,MathUtils:yi}}}const tc=class sc extends Fe{constructor(e){super(e),b(this,"onAfterUpdate",new $),b(this,"onBeforeUpdate",new $),b(this,"onDisposed",new $),b(this,"list",new Map),b(this,"enabled",!0),e.add(sc.uuid,this)}create(){const e=new Op(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),e}delete(e){this.list.delete(e.uuid),e.dispose()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};b(tc,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Up=tc;class Bp{constructor(e,t,s){b(this,"onDisposed",new $),b(this,"world"),b(this,"components"),b(this,"three"),b(this,"_fade",3),b(this,"updateZoom",()=>{this.world.camera instanceof fi&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:n,size1:i,size2:r,distance:o}=s;this.components=e;const l=new Gr(2,2,1,1),u=new ht({side:wi,uniforms:{uSize1:{value:i},uSize2:{value:r},uColor:{value:n},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new re(l,u),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}[Symbol.dispose](){throw new Error("Method not implemented.")}dispose(){this.setupEvents(!1),this.components.get(us).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(!(this.world.camera instanceof fi))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}class kp extends Fe{constructor(){super(...arguments),b(this,"list",new Map),b(this,"onDisposed",new $),b(this,"config",{color:new Et(12303291),size1:1,size2:10,distance:500}),b(this,"enabled",!0)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new Bp(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}}b(kp,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const zs=new zr,lt=new P,ys=new P,Ye=new At,ph={X:new P(1,0,0),Y:new P(0,1,0),Z:new P(0,0,1)},ta={type:"change"},fh={type:"mouseDown"},mh={type:"mouseUp",mode:null},gh={type:"objectChange"};class zp extends xn{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new Kp;this._gizmo=s,this.add(s);const n=new Wp;this._plane=n,this.add(n);const i=this;function r(x,R){let C=R;Object.defineProperty(i,x,{get:function(){return C!==void 0?C:R},set:function(M){C!==M&&(C=M,n[x]=M,s[x]=M,i.dispatchEvent({type:x+"-changed",value:M}),i.dispatchEvent(ta))}}),i[x]=R,n[x]=R,s[x]=R}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new P,l=new P,u=new At,d=new At,f=new P,m=new At,E=new P,w=new P,y=new P,A=0,S=new P;r("worldPosition",o),r("worldPositionStart",l),r("worldQuaternion",u),r("worldQuaternionStart",d),r("cameraPosition",f),r("cameraQuaternion",m),r("pointStart",E),r("pointEnd",w),r("rotationAxis",y),r("rotationAngle",A),r("eye",S),this._offset=new P,this._startNorm=new P,this._endNorm=new P,this._cameraScale=new P,this._parentPosition=new P,this._parentQuaternion=new At,this._parentQuaternionInv=new At,this._parentScale=new P,this._worldScaleStart=new P,this._worldQuaternionInv=new At,this._worldScale=new P,this._positionStart=new P,this._quaternionStart=new At,this._scaleStart=new P,this._getPointer=Yp.bind(this),this._onPointerDown=Gp.bind(this),this._onPointerHover=Vp.bind(this),this._onPointerMove=Hp.bind(this),this._onPointerUp=jp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;zs.setFromCamera(e,this.camera);const t=sa(this._gizmo.picker[this.mode],zs);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){zs.setFromCamera(e,this.camera);const t=sa(this._plane,zs,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,fh.mode=this.mode,this.dispatchEvent(fh)}}pointerMove(e){const t=this.axis,s=this.mode,n=this.object;let i=this.space;if(s==="scale"?i="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(i="world"),n===void 0||t===null||this.dragging===!1||e.button!==-1)return;zs.setFromCamera(e,this.camera);const r=sa(this._plane,zs,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),i==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),i==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(i==="local"&&(n.position.applyQuaternion(Ye.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),i==="world"&&(n.parent&&n.position.add(lt.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(lt.setFromMatrixPosition(n.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),ys.set(o,o,o)}else lt.copy(this.pointStart),ys.copy(this.pointEnd),lt.applyQuaternion(this._worldQuaternionInv),ys.applyQuaternion(this._worldQuaternionInv),ys.divide(lt),t.search("X")===-1&&(ys.x=1),t.search("Y")===-1&&(ys.y=1),t.search("Z")===-1&&(ys.z=1);n.scale.copy(this._scaleStart).multiply(ys),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(lt.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(lt.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(ph[t]),lt.copy(ph[t]),i==="local"&&lt.applyQuaternion(this.worldQuaternion),lt.cross(this.eye),lt.length()===0?l=!0:this.rotationAngle=this._offset.dot(lt.normalize())*o),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),i==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(Ye.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(Ye.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ta),this.dispatchEvent(gh)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(mh.mode=this.mode,this.dispatchEvent(mh)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ta),this.dispatchEvent(gh),this.pointStart.copy(this.pointEnd))}getRaycaster(){return zs}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Yp(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function Vp(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c));break}}function Gp(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function Hp(c){this.enabled&&this.pointerMove(this._getPointer(c))}function jp(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function sa(c,e,t){const s=e.intersectObject(c,!0);for(let n=0;n<s.length;n++)if(s[n].object.visible||t)return s[n];return!1}const Er=new Dh,Le=new P(0,1,0),Eh=new P(0,0,0),vh=new me,vr=new At,Or=new At,Xt=new P,wh=new me,ci=new P(1,0,0),Vs=new P(0,1,0),ui=new P(0,0,1),wr=new P,ai=new P,li=new P;class Kp extends xn{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Pt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new xs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const n=t.clone();n.opacity=.5;const i=e.clone();i.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const d=e.clone();d.color.setHex(255),d.opacity=.5;const f=e.clone();f.opacity=.25;const m=e.clone();m.color.setHex(16776960),m.opacity=.25,e.clone().color.setHex(16776960);const E=e.clone();E.color.setHex(7895160);const w=new dt(0,.04,.1,12);w.translate(0,.05,0);const y=new tt(.08,.08,.08);y.translate(0,.04,0);const A=new De;A.setAttribute("position",new Fn([0,0,0,1,0,0],3));const S=new dt(.0075,.0075,.5,3);S.translate(0,.25,0);function x(ue,we){const ce=new Xn(ue,.0075,3,64,we*Math.PI*2);return ce.rotateY(Math.PI/2),ce.rotateX(Math.PI/2),ce}function R(){const ue=new De;return ue.setAttribute("position",new Fn([0,0,0,1,1,1],3)),ue}const C={X:[[new re(w,i),[.5,0,0],[0,0,-Math.PI/2]],[new re(w,i),[-.5,0,0],[0,0,Math.PI/2]],[new re(S,i),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new re(w,r),[0,.5,0]],[new re(w,r),[0,-.5,0],[Math.PI,0,0]],[new re(S,r)]],Z:[[new re(w,o),[0,0,.5],[Math.PI/2,0,0]],[new re(w,o),[0,0,-.5],[-Math.PI/2,0,0]],[new re(S,o),null,[Math.PI/2,0,0]]],XYZ:[[new re(new Qi(.1,0),f.clone()),[0,0,0]]],XY:[[new re(new tt(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new re(new tt(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new tt(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},M={X:[[new re(new dt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new re(new dt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new re(new dt(.2,0,.6,4),s),[0,.3,0]],[new re(new dt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new re(new dt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new re(new dt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new re(new Qi(.2,0),s)]],XY:[[new re(new tt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new re(new tt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new tt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},k={START:[[new re(new Qi(.01,2),n),null,null,null,"helper"]],END:[[new re(new Qi(.01,2),n),null,null,null,"helper"]],DELTA:[[new Ze(R(),n),null,null,null,"helper"]],X:[[new Ze(A,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(A,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(A,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},G={XYZE:[[new re(x(.5,1),E),null,[0,Math.PI/2,0]]],X:[[new re(x(.5,.5),i)]],Y:[[new re(x(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new re(x(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new re(x(.75,1),m),null,[0,Math.PI/2,0]]]},H={AXIS:[[new Ze(A,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},W={XYZE:[[new re(new Gu(.25,10,8),s)]],X:[[new re(new Xn(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new re(new Xn(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new re(new Xn(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new re(new Xn(.75,.1,2,24),s)]]},Z={X:[[new re(y,i),[.5,0,0],[0,0,-Math.PI/2]],[new re(S,i),[0,0,0],[0,0,-Math.PI/2]],[new re(y,i),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new re(y,r),[0,.5,0]],[new re(S,r)],[new re(y,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new re(y,o),[0,0,.5],[Math.PI/2,0,0]],[new re(S,o),[0,0,0],[Math.PI/2,0,0]],[new re(y,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new re(new tt(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new re(new tt(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new tt(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new re(new tt(.1,.1,.1),f.clone())]]},J={X:[[new re(new dt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new re(new dt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new re(new dt(.2,0,.6,4),s),[0,.3,0]],[new re(new dt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new re(new dt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new re(new dt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new re(new tt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new re(new tt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new tt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new re(new tt(.2,.2,.2),s),[0,0,0]]]},te={X:[[new Ze(A,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(A,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(A,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function se(ue){const we=new xn;for(const ce in ue)for(let ge=ue[ce].length;ge--;){const pe=ue[ce][ge][0].clone(),Ie=ue[ce][ge][1],je=ue[ce][ge][2],Mt=ue[ce][ge][3],Js=ue[ce][ge][4];pe.name=ce,pe.tag=Js,Ie&&pe.position.set(Ie[0],Ie[1],Ie[2]),je&&pe.rotation.set(je[0],je[1],je[2]),Mt&&pe.scale.set(Mt[0],Mt[1],Mt[2]),pe.updateMatrix();const Ct=pe.geometry.clone();Ct.applyMatrix4(pe.matrix),pe.geometry=Ct,pe.renderOrder=1/0,pe.position.set(0,0,0),pe.rotation.set(0,0,0),pe.scale.set(1,1,1),we.add(pe)}return we}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=se(C)),this.add(this.gizmo.rotate=se(G)),this.add(this.gizmo.scale=se(Z)),this.add(this.picker.translate=se(M)),this.add(this.picker.rotate=se(W)),this.add(this.picker.scale=se(J)),this.add(this.helper.translate=se(k)),this.add(this.helper.rotate=se(H)),this.add(this.helper.scale=se(te)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Or;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let n=0;n<s.length;n++){const i=s[n];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(r*this.size/4),i.tag==="helper"){i.visible=!1,i.name==="AXIS"?(i.visible=!!this.axis,this.axis==="X"&&(Ye.setFromEuler(Er.set(0,0,0)),i.quaternion.copy(t).multiply(Ye),Math.abs(Le.copy(ci).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Y"&&(Ye.setFromEuler(Er.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(Ye),Math.abs(Le.copy(Vs).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Z"&&(Ye.setFromEuler(Er.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(Ye),Math.abs(Le.copy(ui).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="XYZE"&&(Ye.setFromEuler(Er.set(0,Math.PI/2,0)),Le.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(vh.lookAt(Eh,Le,Vs)),i.quaternion.multiply(Ye),i.visible=this.dragging),this.axis==="E"&&(i.visible=!1)):i.name==="START"?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):i.name==="END"?(i.position.copy(this.worldPosition),i.visible=this.dragging):i.name==="DELTA"?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),lt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),lt.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(lt),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=this.axis.search(i.name)!==-1));continue}i.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(i.name==="X"&&Math.abs(Le.copy(ci).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Y"&&Math.abs(Le.copy(Vs).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Z"&&Math.abs(Le.copy(ui).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XY"&&Math.abs(Le.copy(ui).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="YZ"&&Math.abs(Le.copy(ci).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XZ"&&Math.abs(Le.copy(Vs).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1)):this.mode==="rotate"&&(vr.copy(t),Le.copy(this.eye).applyQuaternion(Ye.copy(t).invert()),i.name.search("E")!==-1&&i.quaternion.setFromRotationMatrix(vh.lookAt(this.eye,Eh,Vs)),i.name==="X"&&(Ye.setFromAxisAngle(ci,Math.atan2(-Le.y,Le.z)),Ye.multiplyQuaternions(vr,Ye),i.quaternion.copy(Ye)),i.name==="Y"&&(Ye.setFromAxisAngle(Vs,Math.atan2(Le.x,Le.z)),Ye.multiplyQuaternions(vr,Ye),i.quaternion.copy(Ye)),i.name==="Z"&&(Ye.setFromAxisAngle(ui,Math.atan2(Le.y,Le.x)),Ye.multiplyQuaternions(vr,Ye),i.quaternion.copy(Ye))),i.visible=i.visible&&(i.name.indexOf("X")===-1||this.showX),i.visible=i.visible&&(i.name.indexOf("Y")===-1||this.showY),i.visible=i.visible&&(i.name.indexOf("Z")===-1||this.showZ),i.visible=i.visible&&(i.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),i.material._color=i.material._color||i.material.color.clone(),i.material._opacity=i.material._opacity||i.material.opacity,i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled&&this.axis&&(i.name===this.axis||this.axis.split("").some(function(o){return i.name===o}))&&(i.material.color.setHex(16776960),i.material.opacity=1)}super.updateMatrixWorld(e)}}class Wp extends re{constructor(){super(new Gr(1e5,1e5,2,2),new Pt({visible:!1,wireframe:!0,side:wi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),wr.copy(ci).applyQuaternion(t==="local"?this.worldQuaternion:Or),ai.copy(Vs).applyQuaternion(t==="local"?this.worldQuaternion:Or),li.copy(ui).applyQuaternion(t==="local"?this.worldQuaternion:Or),Le.copy(ai),this.mode){case"translate":case"scale":switch(this.axis){case"X":Le.copy(this.eye).cross(wr),Xt.copy(wr).cross(Le);break;case"Y":Le.copy(this.eye).cross(ai),Xt.copy(ai).cross(Le);break;case"Z":Le.copy(this.eye).cross(li),Xt.copy(li).cross(Le);break;case"XY":Xt.copy(li);break;case"YZ":Xt.copy(wr);break;case"XZ":Le.copy(li),Xt.copy(ai);break;case"XYZ":case"E":Xt.set(0,0,0);break}break;case"rotate":default:Xt.set(0,0,0)}Xt.length()===0?this.quaternion.copy(this.cameraQuaternion):(wh.lookAt(lt.set(0,0,0),Xt,Le),this.quaternion.setFromRotationMatrix(wh)),super.updateMatrixWorld(e)}}class Wr{constructor(e,t,s,n,i,r=5,o=!0){if(b(this,"onDraggingStarted",new $),b(this,"onDraggingEnded",new $),b(this,"onDisposed",new $),b(this,"normal"),b(this,"origin"),b(this,"three",new Fs),b(this,"_helper"),b(this,"_visible",!0),b(this,"_enabled",!0),b(this,"components"),b(this,"world"),b(this,"_controlsActive",!1),b(this,"_arrowBoundBox",new re),b(this,"_planeMesh"),b(this,"_controls"),b(this,"_hiddenMaterial",new Pt({visible:!1})),b(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),b(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=Wr.newPlaneMesh(r,i),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new P(1,0,0),t=new P;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new zp(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new dt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new xn;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new Gr(1),n=new re(s,t);return n.scale.set(e,e,e),n}}const nc=class va extends Fe{constructor(e){super(e),b(this,"onAfterCreate",new $),b(this,"onAfterDelete",new $),b(this,"onBeforeDrag",new $),b(this,"onAfterDrag",new $),b(this,"onBeforeCreate",new $),b(this,"onBeforeCancel",new $),b(this,"onAfterCancel",new $),b(this,"onBeforeDelete",new $),b(this,"onDisposed",new $),b(this,"orthogonalY",!1),b(this,"toleranceOrthogonalY",.7),b(this,"Type",Wr),b(this,"list",[]),b(this,"_material",new Pt({color:12255487,side:wi,transparent:!0,opacity:.2})),b(this,"_size",5),b(this,"_enabled",!1),b(this,"_visible",!0),b(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),b(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(va.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1;for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(va.uuid),this.onDisposed.reset()}create(e){if(!this.enabled)return;const t=this.components.get(zt).get(e).castRay();t&&this.createPlaneFromIntersection(e,t)}createFromNormalAndCoplanarPoint(e,t,s){const n=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),n}delete(e,t){this.enabled&&(t||(t=this.pickPlane(e)),t&&this.deletePlane(t))}deleteAll(){for(;this.list.length>0;){const e=this.list[0];this.delete(e.world,e)}}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get(zt).get(e),s=this.getAllPlaneMeshes(),n=t.castRay(s);if(n){const i=n.object;return this.list.find(r=>r.meshes.includes(i))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const n=t.point.distanceTo(new P(0,0,0)),i=(s=t.face)==null?void 0:s.normal;if(!n||!i)return;const r=this.getWorldNormal(t,i),o=this.newPlane(e,t.point,r.negate());o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes()}getWorldNormal(e,t){const s=e.object;let n=e.object.matrixWorld.clone();if(s instanceof Ot&&e.instanceId!==void 0){const o=new me;s.getMatrixAt(e.instanceId,o),n=o.multiply(n)}const i=new Hs().getNormalMatrix(n),r=t.clone().applyMatrix3(i).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const n=new this.Type(this.components,e,t,s,this._material);return n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging),this.list.push(n),this.onAfterCreate.trigger(n),n}updateMaterialsAndPlanes(){const e=this.components.get(Up);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:n}=s.renderer;for(const i of s.meshes)if(Array.isArray(i.material))for(const r of i.material)r.clippingPlanes=n;else i.material.clippingPlanes=n}}};b(nc,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let Ur=nc;function Xp(c,e,t,s){return new Promise((n,i)=>{function r(){const o=c.clientWaitSync(e,t,0);if(o===c.WAIT_FAILED){i();return}if(o===c.TIMEOUT_EXPIRED){setTimeout(r,s);return}n()}r()})}async function Zp(c,e,t,s,n,i,r){const o=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),await Xp(c,o,0,10),c.deleteSync(o),c.bindBuffer(e,t),c.getBufferSubData(e,s,n,i,r),c.bindBuffer(e,null)}async function Qp(c,e,t,s,n,i,r,o){const l=c.createBuffer();return c.bindBuffer(c.PIXEL_PACK_BUFFER,l),c.bufferData(c.PIXEL_PACK_BUFFER,o.byteLength,c.STREAM_READ),c.readPixels(e,t,s,n,i,r,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await Zp(c,c.PIXEL_PACK_BUFFER,l,0,o),c.deleteBuffer(l),o}class ic{constructor(e,t,s){if(b(this,"onDisposed",new $),b(this,"onViewUpdated",new bs),b(this,"enabled",!0),b(this,"needsUpdate",!1),b(this,"renderDebugFrame",!1),b(this,"components"),b(this,"world"),b(this,"renderer"),b(this,"autoUpdate",!0),b(this,"updateInterval",1e3),b(this,"worker"),b(this,"scene",new Qs),b(this,"_width",512),b(this,"_height",512),b(this,"_availableColor",1),b(this,"renderTarget"),b(this,"bufferSize"),b(this,"_buffer"),b(this,"_isWorkerBusy",!1),b(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const l=this.renderer.getContext();await Qp(l,0,0,this._width,this._height,l.RGBA,l.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(s),this.world=t,this.renderer=new Mr,this.renderTarget=new ls(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const n=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,i=new Blob([n],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(i))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,n,i]=t,r=`${s}-${n}-${i}`;return{r:s,g:n,b:i,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}}class qp extends ic{constructor(e,t,s){super(e,t,s),b(this,"threshold",100),b(this,"onViewUpdated",new $),b(this,"colorMeshes",new Map),b(this,"isProcessing",!1),b(this,"_colorCodeMeshMap",new Map),b(this,"_meshIDColorCodeMap",new Map),b(this,"_currentVisibleMeshes",new Set),b(this,"_recentlyHiddenMeshes",new Set),b(this,"_intervalID",null),b(this,"_transparentMat",new Pt({transparent:!0,opacity:0})),b(this,"handleWorkerMessage",async n=>{if(this.isProcessing)return;const i=n.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of i){if(o<this.threshold)continue;const l=this._colorCodeMeshMap.get(r);l&&(this._currentVisibleMeshes.add(l),this._recentlyHiddenMeshes.delete(l))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval),this.onViewUpdated.add(({seen:n,unseen:i})=>{for(const r of n)r.visible=!0;for(const r of i)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(us);for(const t in this.colorMeshes){const s=this.colorMeshes.get(t);s&&e.destroy(s,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=e instanceof Ot,{geometry:s,material:n}=e,{colorMaterial:i,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(n)){let d=!0;const f=[];for(const m of n)ih.isTransparent(m)?f.push(this._transparentMat):(d=!1,f.push(i));if(d){i.dispose(),this.isProcessing=!1;return}o=f}else if(ih.isTransparent(n)){i.dispose(),this.isProcessing=!1;return}else o=i;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const l=t?e.count:1,u=new Ot(s,o,l);t?u.instanceMatrix=e.instanceMatrix:u.setMatrixAt(0,new me),e.visible=!1,u.applyMatrix4(e.matrix),u.updateMatrix(),this.scene.add(u),this.colorMeshes.set(e.uuid,u),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=this.components.get(us);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const s=this.colorMeshes.get(e.uuid),n=this._meshIDColorCodeMap.get(e.uuid);if(!s||!n){this.isProcessing=!1,console.log(e.visible);return}this._colorCodeMeshMap.delete(n),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),s.geometry=void 0,s.material=[],t.destroy(s,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}getAvailableMaterial(){const{r:e,g:t,b:s,code:n}=this.getAvailableColor(),i=as.enabled;as.enabled=!1;const r=new Et(`rgb(${e}, ${t}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,l=new Pt({color:r,clippingPlanes:o,side:wi});return as.enabled=i,{colorMaterial:l,code:n}}}const rc=class wa extends Fe{constructor(e){super(e),b(this,"_enabled",!0),b(this,"list",new Map),b(this,"onDisposed",new $),e.add(wa.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,s]of this.list)s.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);const s=new qp(this.components,e,t);return this.list.set(e.uuid,s),s}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(wa.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}};b(rc,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let Jp=rc;class $p{constructor(e){if(b(this,"onDisposed",new $),b(this,"onAfterUpdate",new $),b(this,"onBeforeUpdate",new $),b(this,"onResize",new $),b(this,"frontOffset",0),b(this,"overrideMaterial",new Yh),b(this,"backgroundColor",new Et(395274)),b(this,"renderer"),b(this,"enabled",!0),b(this,"world"),b(this,"_lockRotation",!0),b(this,"_camera"),b(this,"_plane"),b(this,"_size",new ke(320,160)),b(this,"_tempVector1",new P),b(this,"_tempVector2",new P),b(this,"_tempTarget",new P),b(this,"down",new P(0,-1,0)),b(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const n=[],i=this.world.renderer.three;for(const r of i.clippingPlanes)n.push(r);n.push(this._plane),this.renderer.clippingPlanes=n}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new Mr,this.renderer.setSize(this._size.x,this._size.y);const t=1,s=this._size.x/this._size.y;this._camera=new Zs(t*s/-2,t*s/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new Fs(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof Qs))throw new Error("The given world must have a THREE.Scene as a root!");const s=t.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const i=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=i+Math.PI}this._plane.set(this.down,this._tempVector1.y);const n=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=n,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e){if(e){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,s=1;this._camera.left=s*t/-2,this._camera.right=s*t/2,this._camera.top=s/2,this._camera.bottom=-s/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}}}const ef=class oc extends Fe{constructor(e){super(e),b(this,"onAfterUpdate",new $),b(this,"onBeforeUpdate",new $),b(this,"onDisposed",new $),b(this,"enabled",!0),b(this,"list",new Map),this.components.add(oc.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new $p(e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};b(ef,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");class tf{constructor(e){b(this,"enabled",!1),b(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new P;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=ct.ACTION.DOLLY,e.touches.two=ct.ACTION.TOUCH_ZOOM_TRUCK}}class sf{constructor(e){b(this,"enabled",!0),b(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new P;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:n}=this.camera.three,i=new P(0,0,-1).applyEuler(n),r=t.addScaledVector(i,s);e.moveTo(r.x,r.y,r.z)}}class nf{constructor(e){b(this,"enabled",!1),b(this,"id","Plan"),b(this,"mouseAction1"),b(this,"mouseAction2"),b(this,"mouseInitialized",!1),b(this,"defaultAzimuthSpeed"),b(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=ct.ACTION.TRUCK,t.touches.one=ct.ACTION.TOUCH_TRUCK,t.touches.two=ct.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=ct.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}}class rf{constructor(e){b(this,"onChanged",new $),b(this,"current","Perspective"),b(this,"camera"),b(this,"_component"),b(this,"_previousDistance",-1),b(this,"matchOrthoDistanceEnabled",!1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new P;this._component.threePersp.getWorldDirection(t);const s=new P;this._component.controls.getTarget(s);const n=s.clone().sub(this._component.threePersp.position).dot(t),i=e.renderer.getSize(),r=i.x/i.y,o=this._component.threePersp,l=n*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:l*r,height:l}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=ct.ACTION.ZOOM,this._component.controls.mouseButtons.middle=ct.ACTION.ZOOM;const s=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=t/-2,n.right=t/2,n.top=e/2,n.bottom=e/-2,n.updateProjectionMatrix(),n.position.copy(s.position),n.quaternion.copy(s.quaternion),this._component.controls.camera=n}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=ct.ACTION.DOLLY,this._component.controls.mouseButtons.middle=ct.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=ct.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}}class of extends fi{constructor(e){super(e),b(this,"_mode",null),b(this,"projection"),b(this,"threeOrtho"),b(this,"threePersp"),b(this,"_userInputButtons",{}),b(this,"_frustumSize",50),b(this,"_navigationModes",new Map),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new rf(this),this.onAspectUpdated.add(()=>{this.setOrthoCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t}),this.onWorldChanged.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new sf(this)),this._navigationModes.set("FirstPerson",new tf(this)),this._navigationModes.set("Plan",new nf(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0})})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,n=Number.MIN_VALUE,i=new P(s,s,s),r=new P(n,n,n);for(const m of e){const E=new Ue().setFromObject(m);E.min.x<i.x&&(i.x=E.min.x),E.min.y<i.y&&(i.y=E.min.y),E.min.z<i.z&&(i.z=E.min.z),E.max.x>r.x&&(r.x=E.max.x),E.max.y>r.y&&(r.y=E.max.y),E.max.z>r.z&&(r.z=E.max.z)}const o=new Ue(i,r),l=new P;o.getSize(l);const u=new P;o.getCenter(u);const d=Math.max(l.x,l.y,l.z)*t,f=new Xs(u,d);await this.controls.fitToSphere(f,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new Zs(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer)return;const e=new P;this.threePersp.getWorldDirection(e);const t=new P;this.controls.getTarget(t);const s=t.clone().sub(this.threePersp.position).dot(e),n=this.currentWorld.renderer.getSize(),i=n.x/n.y,r=this.threePersp,o=s*2*Math.atan(r.fov*(Math.PI/180)/2),l=o*i;this.threeOrtho.zoom=1,this.threeOrtho.left=l/-2,this.threeOrtho.right=l/2,this.threeOrtho.top=o/2,this.threeOrtho.bottom=o/-2,this.threeOrtho.updateProjectionMatrix()}}const ac=class rs extends Fe{constructor(e){super(e),b(this,"enabled",!0),b(this,"onDisposed",new $),b(this,"_absoluteMin"),b(this,"_absoluteMax"),b(this,"_meshes",[]),this.components.add(rs.uuid,this),this._absoluteMin=rs.newBound(!0),this._absoluteMax=rs.newBound(!1)}static getDimensions(e){const{min:t,max:s}=e,n=Math.abs(s.x-t.x),i=Math.abs(s.y-t.y),r=Math.abs(s.z-t.z),o=new P;return o.subVectors(s,t).divideScalar(2).add(t),{width:n,height:i,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new P(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,s){const n=s||this.newBound(!1),i=t||this.newBound(!0);for(const r of e)r.x<i.x&&(i.x=r.x),r.y<i.y&&(i.y=r.y),r.z<i.z&&(i.z=r.z),r.x>n.x&&(n.x=r.x),r.y>n.y&&(n.y=r.y),r.z>n.z&&(n.z=r.z);return new Ue(t,s)}dispose(){const e=this.components.get(us);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(rs.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Ue(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),s=Math.abs((t.x-e.x)/2),n=Math.abs((t.y-e.y)/2),i=Math.abs((t.z-e.z)/2),r=new P(e.x+s,e.y+n,e.z+i),o=r.distanceTo(e);return new Xs(r,o)}getMesh(){const e=new Ue(this._absoluteMin,this._absoluteMax),t=rs.getDimensions(e),{width:s,height:n,depth:i,center:r}=t,o=new tt(s,n,i),l=new re(o);return this._meshes.push(l),l.position.copy(r),l}reset(){this._absoluteMin=rs.newBound(!0),this._absoluteMax=rs.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const s=rs.getFragmentBounds(e);e.updateMatrixWorld();const n=e.matrixWorld,i=new me,r=e instanceof Ot,o=new Set;if(t&&e instanceof Nh)for(const l of t){const u=e.fragment.getInstancesIDs(l);if(u)for(const d of u)o.add(d)}else o.add(0);for(const l of o){const u=s.min.clone(),d=s.max.clone();r&&(e.getMatrixAt(l,i),u.applyMatrix4(i),d.applyMatrix4(i)),u.applyMatrix4(n),d.applyMatrix4(n),u.x<this._absoluteMin.x&&(this._absoluteMin.x=u.x),u.y<this._absoluteMin.y&&(this._absoluteMin.y=u.y),u.z<this._absoluteMin.z&&(this._absoluteMin.z=u.z),u.x>this._absoluteMax.x&&(this._absoluteMax.x=u.x),u.y>this._absoluteMax.y&&(this._absoluteMax.y=u.y),u.z>this._absoluteMax.z&&(this._absoluteMax.z=u.z),d.x>this._absoluteMax.x&&(this._absoluteMax.x=d.x),d.y>this._absoluteMax.y&&(this._absoluteMax.y=d.y),d.z>this._absoluteMax.z&&(this._absoluteMax.z=d.z),d.x<this._absoluteMin.x&&(this._absoluteMin.x=d.x),d.y<this._absoluteMin.y&&(this._absoluteMin.y=d.y),d.z<this._absoluteMin.z&&(this._absoluteMin.z=d.z)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,s=Number.MAX_VALUE,n=-s,i=new P(s,s,s),r=new P(n,n,n);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let l=0;l<o.length;l++){if(l%3===0&&o[l]===0&&o[l+1]===0&&o[l+2]===0){l+=2;continue}const u=o[l],d=t.getX(u),f=t.getY(u),m=t.getZ(u);d<i.x&&(i.x=d),f<i.y&&(i.y=f),m<i.z&&(i.z=m),d>r.x&&(r.x=d),f>r.y&&(r.y=f),m>r.z&&(r.z=m)}return new Ue(i,r)}};b(ac,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let Qa=ac;const qa=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,3940055652,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),lc=class hc extends Fe{constructor(e){super(e),b(this,"enabled",!0),e.add(hc.uuid,this)}async export(e,t,s=!1,n=!0){const i={},r=new Set(e.GetIfcEntityList(t)),o=new Set([Ya,Va,Ga,Hr,qs]);for(const l of o)r.add(l);for(const l of r){if(qa.has(l))continue;const u=o.has(l)&&n,d=e.GetLineIDsWithType(t,l);for(const f of d){const m=e.GetLine(0,f,u,s);i[m.expressID]=m}}return i}};b(lc,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let af=lc;const cc=class uc extends Fe{constructor(e){super(e),b(this,"onDisposed",new $),b(this,"onFragmentsLoaded",new $),b(this,"onFragmentsDisposed",new $),b(this,"list",new Map),b(this,"groups",new Map),b(this,"enabled",!0),b(this,"baseCoordinationModel",""),b(this,"_loader",new _h),this.components.add(uc.uuid,this)}get meshes(){const e=[];for(const[t,s]of this.list)e.push(s.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,s=[];for(const n of e.items)s.push(n.id),this.list.delete(n.id);e.dispose(!0),this.groups.delete(e.uuid),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:s})}load(e,t){const s={coordinate:!0,...t},{coordinate:n,properties:i,relationsMap:r}=s,o=this._loader.import(e);for(const l of o.items)l.group=o,this.list.set(l.id,l);return n&&this.coordinate([o]),this.groups.set(o.uuid,o),i&&o.setLocalProperties(i),r&&this.components.get(Ja).setRelationMap(o,r),this.onFragmentsLoaded.trigger(o),o}export(e){return this._loader.export(e)}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const s=e.pop();if(!s)return;this.baseCoordinationModel=s.uuid}if(!e.length)return;const t=this.groups.get(this.baseCoordinationModel);if(!t){console.log("No base model found for coordination!");return}for(const s of e)s!==t&&(s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),s.updateMatrix(),s.applyMatrix4(s.coordinationMatrix.clone().invert()),s.applyMatrix4(t.coordinationMatrix))}};b(cc,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Qe=cc;const dc={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class hs{static async getUnits(e){var t;const{IFCUNITASSIGNMENT:s}=kt,n=await e.getAllPropertiesOfType(s);if(!n)return 1;const i=Object.keys(n),r=n[parseInt(i[0],10)];for(const o of r.Units){if(o.value===void 0||o.value===null)continue;const l=await e.getProperties(o.value);if(!l||!l.UnitType||!l.UnitType.value||l.UnitType.value!=="LENGTHUNIT")continue;let u=1,d=1;return l.Name.value==="METRE"&&(d=1),l.Name.value==="FOOT"&&(d=.3048),((t=l.Prefix)==null?void 0:t.value)==="MILLI"&&(u=.001),d*u}return 1}static async findItemByGuid(e,t){var s;const n=e.getAllPropertiesIDs();for(const i of n){const r=await e.getProperties(i);if(r&&((s=r.GlobalId)==null?void 0:s.value)===t)return r}return null}static async getRelationMap(e,t,s){var n;const i=s??(()=>{}),r={},o=e.getAllPropertiesIDs();for(const l of o){const u=await e.getProperties(l);if(!u)continue;const d=u.type===t,f=Object.keys(u).find(A=>A.startsWith("Relating")),m=Object.keys(u).find(A=>A.startsWith("Related"));if(!(d&&f&&m))continue;const E=await e.getProperties((n=u[f])==null?void 0:n.value),w=u[m];if(!E||!w||!(w&&Array.isArray(w)))continue;const y=w.map(A=>A.value);i(E.expressID,y),r[E.expressID]=y}return r}static async getQsetQuantities(e,t,s){const n=s??(()=>{}),i=await e.getProperties(t);return!i||i.type!==Du?null:(i.Quantities??[{}]).map(r=>(r.value&&n(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,s){const n=s??(()=>{}),i=await e.getProperties(t);return!i||i.type!==ra?null:(i.HasProperties??[{}]).map(r=>(r.value&&n(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var s;if(!await e.getProperties(t))return null;const n=await e.getAllPropertiesOfType(Yr);if(!n)return null;const i=Object.values(n);let r=null;for(const o of i)((s=o.RelatingPropertyDefinition)==null?void 0:s.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return hs.getPsetRel(e,t)}static async getEntityName(e,t){var s;const n=await e.getProperties(t);if(!n)return{key:null,name:null};const i=Object.keys(n).find(o=>o.endsWith("Name"))??null,r=i?(s=n[i])==null?void 0:s.value:null;return{key:i,name:r}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const n=Object.keys(s).find(r=>r.endsWith("Value"))??null;let i;return n===null||s[n]===void 0||s[n]===null?i=null:i=s[n].value,{key:n,value:i}}static isRel(e){return dc[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const n=await e.getProperties(t);return n?Object.keys(n).includes(s):!1}static async groupEntitiesByType(e,t){var s;const n=new Map;for(const i of t){const r=await e.getProperties(i);if(!r)continue;const o=r.type;n.get(o)||n.set(o,new Set),(s=n.get(o))==null||s.add(i)}return n}}const lf=new Map([[_a,{forRelating:"IsDecomposedBy",forRelated:"Decomposes"}],[Ua,{forRelating:"AssociatedTo",forRelated:"HasAssociations"}],[Ba,{forRelating:"ClassificationForObjects",forRelated:"HasAssociations"}],[ka,{forRelating:"IsGroupedBy",forRelated:"HasAssignments"}],[Yr,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[za,{forRelated:"IsTypedBy",forRelating:"Types"}],[Uh,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Vr,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}]]),pc=class ya extends Fe{constructor(e){super(e),b(this,"onDisposed",new $),b(this,"enabled",!0),b(this,"onRelationsIndexed",new $),b(this,"_relToAttributesMap",lf),b(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements"]),b(this,"_ifcRels",[_a,Ua,Ba,ka,Yr,za,Uh,Vr]),b(this,"relationMaps",{}),b(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),this.components.add(ya.uuid,this),e.get(Qe).onFragmentsDisposed.add(this.onFragmentsDisposed)}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(const s of this._ifcRels)await hs.getRelationMap(e,s,async(n,i)=>{const r=this._relToAttributesMap.get(s);if(!r)return;const{forRelated:o,forRelating:l}=r,u=t.get(n)??new Map,d=this._inverseAttributes.indexOf(l);u.set(d,i),t.set(n,u);for(const f of i){const m=t.get(f)??new Map,E=this._inverseAttributes.indexOf(o),w=m.get(E)??[];w.push(n),m.set(E,w),t.set(f,m)}});return this.setRelationMap(e,t),t}async processFromWebIfc(e,t){const s=new Map;for(const n of this._ifcRels){const i=this._relToAttributesMap.get(n);if(!i)continue;const{forRelated:r,forRelating:o}=i,l=e.GetLineIDsWithType(t,n);for(let u=0;u<l.size();u++){const d=await e.properties.getItemProperties(t,l.get(u)),f=Object.keys(d).find(S=>S.startsWith("Relating")),m=Object.keys(d).find(S=>S.startsWith("Related"));if(!(f&&m))continue;const E=d[f].value,w=d[m].map(S=>S.value),y=s.get(E)??new Map,A=this._inverseAttributes.indexOf(o);y.set(A,w),s.set(E,y);for(const S of w){const x=s.get(S)??new Map,R=this._inverseAttributes.indexOf(r),C=x.get(R)??[];C.push(E),x.set(R,C),s.set(S,x)}}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:s}),s}getEntityRelations(e,t,s){const n=this.relationMaps[e.uuid];if(!n)return null;const i=n.get(t),r=this._inverseAttributes.indexOf(s);return!i||r===-1?null:i.get(r)||null}serializeRelations(e){const t={};for(const[s,n]of e.entries()){t[s]||(t[s]={});for(const[i,r]of n.entries())t[s][i]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const s=this.relationMaps[t],n={};for(const[i,r]of s.entries()){n[i]||(n[i]={});for(const[o,l]of r.entries())n[i][o]=l}e[t]=n}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),s=new Map;for(const n in t){const i=t[n],r=new Map;for(const o in i)r.set(Number(o),i[o]);s.set(Number(n),r)}return s}dispose(){this.relationMaps={},this.components.get(Qe).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(ya.uuid),this.onDisposed.reset()}};b(pc,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Ja=pc;class hf{constructor(){b(this,"factor",1),b(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t;this.factor=1;const s=this.getLengthUnits(e);if(!s)return;const n=s==null,i=s.Name===void 0||s.Name===null;n||i||(s.Name.value==="FOOT"?this.factor=.3048:((t=s.Prefix)==null?void 0:t.value)==="MILLI"&&(this.complement=.001))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,Hu).get(0),s=e.GetLine(0,t);for(const n of s.Units){if(!n||n.value===null||n.value===void 0)continue;const i=e.GetLine(0,n.value);if(i.UnitType&&i.UnitType.value==="LENGTHUNIT")return i}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new me().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}class fc{constructor(){b(this,"itemsByFloor",{}),b(this,"_units",new hf)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,Vr),s=new Set,n=e.GetLineIDsWithType(0,qs);for(let u=0;u<n.size();u++)s.add(n.get(u));const i=e.GetLineIDsWithType(0,_a),r=i.size();for(let u=0;u<r;u++){const d=i.get(u),f=e.GetLine(0,d);if(!f||!f.RelatingObject||!f.RelatedObjects)continue;const m=f.RelatingObject.value,E=f.RelatedObjects;for(const w of E){const y=w.value;s.has(y)&&(this.itemsByFloor[y]=m)}}const o={},l=t.size();for(let u=0;u<l;u++){const d=t.get(u),f=e.GetLine(0,d);if(!f||!f.RelatingStructure||!f.RelatedElements)continue;const m=f.RelatingStructure.value,E=f.RelatedElements;if(s.has(m))for(const w of E){o[m]||(o[m]=[]);const y=w.value;o[m].push(y)}else for(const w of E){const y=w.value;this.itemsByFloor[y]=m}}for(const u in o){const d=this.itemsByFloor[u];if(d!==void 0){const f=o[u];for(const m of f)this.itemsByFloor[m]=d}}for(let u=0;u<r;u++){const d=i.get(u),f=e.GetLine(0,d);if(!f||!f.RelatingObject||!f.RelatedObjects)continue;const m=f.RelatingObject.value,E=f.RelatedObjects;for(const w of E){const y=w.value,A=this.itemsByFloor[m];A!==void 0&&(this.itemsByFloor[y]=A)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class $a{constructor(){b(this,"includeProperties",!0),b(this,"optionalCategories",[qs]),b(this,"coordinate",!0),b(this,"wasm",{path:"",absolute:!1,logLevel:Lu.LOG_LEVEL_OFF}),b(this,"excludedCategories",new Set),b(this,"saveLocations",!1),b(this,"webIfc",{COORDINATE_TO_ORIGIN:!0,OPTIMIZE_PROFILES:!0}),b(this,"autoSetWasm",!0),b(this,"customLocateFileHandler",null)}}class mc{constructor(){b(this,"defLineMat",new xs({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),n=e.GetAllCrossSections3D(0),i={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:n};return this.get(i)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const n=new Nu;n.absolute=this.getCurves(s.curve3D,n),n.horizontal=this.getCurves(s.horizontal,n),n.vertical=this.getCurves(s.vertical,n),t.set(t.size,n)}return{alignments:t,coordinationMatrix:new me}}}getCurves(e,t){const s=[];let n=0;for(const i of e){const r={};if(i.data)for(const m of i.data){const[E,w]=m.split(": "),y=parseFloat(w);r[E]=y||w}const{points:o}=i,l=new Float32Array(o.length*3);for(let m=0;m<o.length;m++){const{x:E,y:w,z:y}=o[m];l[m*3]=E,l[m*3+1]=w,l[m*3+2]=y||0}const u=new gt(l,3),d=new _u;d.setAttribute("position",u);const f=new Uu(n,r,t,d,this.defLineMat);s.push(f.curve),n++}return s}}class gc{get(e,t){let s="";const n=e.GetHeaderLine(0,t)||"";if(!n)return s;for(const i of n.arguments)if(i!=null)if(Array.isArray(i))for(const r of i)s+=`${r.value}|`;else s+=`${i.value}|`;return s}}const Ec=class Ia extends Fe{constructor(e){super(e),b(this,"onIfcStartedLoading",new $),b(this,"onSetup",new $),b(this,"onDisposed",new $),b(this,"settings",new $a),b(this,"enabled",!0),b(this,"webIfc",new As),b(this,"_material",new Dr),b(this,"_spatialTree",new fc),b(this,"_metaData",new gc),b(this,"_fragmentInstances",new Map),b(this,"_civil",new mc),b(this,"_visitedFragments",new Map),b(this,"_materialT",new Dr({transparent:!0,opacity:.5})),this.components.add(Ia.uuid,this),this.settings.excludedCategories.add(Bh)}dispose(){this.webIfc=null,this.onDisposed.trigger(Ia.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const n=await this.getAllGeometries(),i=await this.components.get(af).export(this.webIfc,0);n.setLocalProperties(i),this.cleanUp();const r=this.components.get(Qe);r.groups.set(n.uuid,n);for(const o of n.items)r.list.set(o.id,o),o.mesh.uuid=o.id,o.group=n;return r.onFragmentsLoaded.trigger(n),t&&r.coordinate([n]),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),n}async readIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new kh,{FILE_NAME:s,FILE_DESCRIPTION:n}=kt;t.ifcMetadata={name:this._metaData.get(this.webIfc,s),description:this._metaData.get(this.webIfc,n),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const i=[];for(const o of e){if(!this.webIfc.IsIfcElement(o)&&o!==qs||this.settings.excludedCategories.has(o))continue;const l=this.webIfc.GetLineIDsWithType(0,o),u=l.size();for(let d=0;d<u;d++){const f=l.get(d);i.push(f);const m=this._spatialTree.itemsByFloor[f]||0;t.data.set(f,[[],[m,o]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,i,o=>{this.getMesh(o,t)});for(const o of this._visitedFragments){const{index:l,fragment:u}=o[1];t.keyFragments.set(l,u.id)}for(const o of t.items){const l=this._fragmentInstances.get(o.id);if(!l)throw new Error("Fragment not found!");const u=[];for(const[d,f]of l)u.push(f);o.add(u)}const r=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(r),t.civilData=this._civil.read(this.webIfc),t}cleanUp(){this.webIfc=null,this.webIfc=new As,this._visitedFragments.clear(),this._fragmentInstances.clear()}getMesh(e,t){const s=e.geometries.size(),n=e.expressID;for(let i=0;i<s;i++){const r=e.geometries.get(i),{x:o,y:l,z:u,w:d}=r.color,f=d!==1,{geometryExpressID:m}=r,E=`${m}-${f}`;if(!this._visitedFragments.has(E)){const C=this.getGeometry(this.webIfc,m),M=f?this._materialT:this._material,k=new Lr(C,M,1);t.add(k.mesh),t.items.push(k);const G=this._visitedFragments.size;this._visitedFragments.set(E,{index:G,fragment:k})}const w=new Et().setRGB(o,l,u,"srgb"),y=new me;y.fromArray(r.flatTransformation);const A=this._visitedFragments.get(E);if(A===void 0)throw new Error("Error getting geometry data for streaming!");const S=t.data.get(n);if(!S)throw new Error("Data not found!");S[0].push(A.index);const{fragment:x}=A;this._fragmentInstances.has(x.id)||this._fragmentInstances.set(x.id,new Map);const R=this._fragmentInstances.get(x.id);if(!R)throw new Error("Instances not found!");if(R.has(n)){const C=R.get(n);if(!C)throw new Error("Instance not found!");C.transforms.push(y),C.colors&&C.colors.push(w)}else R.set(n,{id:n,transforms:[y],colors:[w]})}}getGeometry(e,t){const s=e.GetGeometry(0,t),n=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),i=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(i.length/2),o=new Float32Array(i.length/2);for(let f=0;f<i.length;f+=6)r[f/2]=i[f],r[f/2+1]=i[f+1],r[f/2+2]=i[f+2],o[f/2]=i[f+3],o[f/2+1]=i[f+4],o[f/2+2]=i[f+5];const l=new De,u=new gt(r,3),d=new gt(o,3);return l.setAttribute("position",u),l.setAttribute("normal",d),l.setIndex(Array.from(n)),s.delete(),l}async autoSetWasm(){const e=await fetch(`https://unpkg.com/openbim-components@${xp.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};b(Ec,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let cf=Ec;const uf=class Cn extends Fe{constructor(e){super(e),b(this,"onDisposed",new $),b(this,"onRequestFile",new $),b(this,"ifcToExport",null),b(this,"onElementToPset",new $),b(this,"onPropToPset",new $),b(this,"onPsetRemoved",new $),b(this,"onDataChanged",new $),b(this,"wasm",{path:"/",absolute:!1}),b(this,"enabled",!0),b(this,"attributeListeners",{}),b(this,"selectedModel"),b(this,"changeMap",{}),this.components.add(Cn.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Cn.uuid),this.onDisposed.reset()}increaseMaxID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t}newGUID(e){const t=Cn.getIFCSchema(e);return new kt[t].IfcGloballyUniqueId(Za.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(Pu);if(!t)throw new Error("No OwnerHistory was found.");const s=Object.keys(t).map(r=>parseInt(r,10)),n=t[s[0]],i=new Zi(n.expressID);return{ownerHistory:n,ownerHistoryHandle:i}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const s of t)this.changeMap[e.uuid].add(s),this.onDataChanged.trigger({model:e,expressID:s})}async setData(e,...t){for(const s of t){const n=s.expressID;n&&(await e.setProperties(n,s),this.registerChange(e,n))}}async newPset(e,t,s){const n=Cn.getIFCSchema(e),{ownerHistoryHandle:i}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new kt[n].IfcLabel(t),l=s?new kt[n].IfcText(s):null,u=new kt[n].IfcPropertySet(r,i,o,l,[]);u.expressID=this.increaseMaxID(e);const d=this.newGUID(e),f=new kt[n].IfcRelDefinesByProperties(d,i,null,null,[],new Zi(u.expressID));return f.expressID=this.increaseMaxID(e),await this.setData(e,u,f),{pset:u,rel:f}}async removePset(e,...t){for(const s of t){const n=await e.getProperties(s);if((n==null?void 0:n.type)!==ra)continue;const i=await hs.getPsetRel(e,s);if(i&&(await e.setProperties(i,null),this.registerChange(e,i)),n){for(const r of n.HasProperties)await e.setProperties(r.value,null);await e.setProperties(s,null),this.onPsetRemoved.trigger({model:e,psetID:s}),this.registerChange(e,s)}}}async newSingleProperty(e,t,s,n){const i=Cn.getIFCSchema(e),r=new kt[i].IfcIdentifier(s),o=new kt[i][t](n),l=new kt[i].IfcPropertySingleValue(r,null,o,null);return l.expressID=this.increaseMaxID(e),await this.setData(e,l),l}newSingleStringProperty(e,t,s,n){return this.newSingleProperty(e,t,s,n)}newSingleNumericProperty(e,t,s,n){return this.newSingleProperty(e,t,s,n)}newSingleBooleanProperty(e,t,s,n){return this.newSingleProperty(e,t,s,n)}async removePsetProp(e,t,s){const n=await e.getProperties(t),i=await e.getProperties(s);!n||!i||n.type===ra&&i&&(n.HasProperties=n.HasProperties.filter(r=>r.value!==s),await e.setProperties(s,null),this.registerChange(e,t,s))}async addElementToPset(e,t,...s){const n=await hs.getPsetRel(e,t);if(!n)return;const i=await e.getProperties(n);if(i){for(const r of s){const o=new Zi(r);i.RelatedObjects.push(o),this.onElementToPset.trigger({model:e,psetID:t,elementID:r})}this.registerChange(e,t)}}async addPropToPset(e,t,...s){const n=await e.getProperties(t);if(n){for(const i of s){if(n.HasProperties.includes(i))continue;const r=new Zi(i);n.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:i})}this.registerChange(e,t)}}async saveToIfc(e,t){const s=this.components.get(cf),n=s.webIfc,i=await s.readIfcFile(t),r=this.changeMap[e.uuid]??[];for(const l of r){const u=await e.getProperties(l);if(u)try{n.WriteLine(i,u)}catch{}else try{n.DeleteLine(i,l)}catch{}}const o=n.SaveModel(i);return s.webIfc.CloseModel(i),s.cleanUp(),o}async setAttributeListener(e,t,s){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const n=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][s]:null;if(n)return n;const i=await e.getProperties(t);if(!i)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=i[s];if(Array.isArray(r)||!r)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const l=new $;return Object.defineProperty(i[s],"value",{get(){return this._value},async set(u){this._value=u,l.trigger(u)}}),i[s].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][s]=l,l}};b(uf,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");const vc=class wc extends Fe{constructor(e){super(e),b(this,"enabled",!0),b(this,"list",{}),b(this,"onDisposed",new $),b(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:n}=t;for(const i in this.list){const r=this.list[i],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[i];else for(const l of o){const u=r[l];for(const d of n)delete u[d];Object.values(u).length===0&&delete r[l]}}}),e.add(wc.uuid,this),e.get(Qe).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(Qe).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const s=this.list[t];for(const n in s){const i=s[n];delete i[e]}}}find(e){const t=this.components.get(Qe);if(!e){const r={};for(const[o,l]of t.list)r[o]=new Set(l.ids);return r}const s=Object.keys(e).length,n={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const l of o){const u=this.list[r][l];if(u)for(const d in u){n[d]||(n[d]=new Map);for(const f of u[d]){const m=n[d].get(f);m===void 0?n[d].set(f,1):n[d].set(f,m+1)}}}}const i={};for(const r in n){const o=n[r];for(const[l,u]of o){if(u===void 0)throw new Error("Malformed fragments map!");u===s&&(i[r]||(i[r]=new Set),i[r].add(l))}}return i}byModel(e,t){this.list.models||(this.list.models={});const s=this.list.models;s[e]||(s[e]={});const n=s[e];for(const[i,r]of t.data){const o=r[0];for(const l of o){const u=t.keyFragments.get(l);u&&(n[u]||(n[u]=new Set),n[u].add(i))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,n=e.getAllPropertiesIDs();for(const i of n){const r=await e.getProperties(i);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();s[o]||(s[o]={});const l=s[o];for(const[u,d]of e.data){const f=d[0];for(const m of f){const E=e.keyFragments.get(m);if(!E)throw new Error("Fragment ID not found!");l[E]||(l[E]=new Set),l[E].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,s]of e.data){const n=s[1][1],i=dc[n];this.saveItem(e,"entities",i,t)}}byStorey(e){for(const[t,s]of e.data){const n=s[1][0].toString();this.saveItem(e,"storeys",n,t)}}async byIfcRel(e,t,s){hs.isRel(t)&&await hs.getRelationMap(e,t,async(n,i)=>{const{name:r}=await hs.getEntityName(e,n);for(const o of i)this.saveItem(e,s,r??"NO REL NAME",o)})}setColor(e,t,s=!1){const n=this.components.get(Qe);for(const i in e){const r=n.list.get(i);if(!r)continue;const o=e[i];r.setColor(t,o,s)}}resetColor(e){const t=this.components.get(Qe);for(const s in e){const n=t.list.get(s);if(!n)continue;const i=e[s];n.resetColor(i)}}saveItem(e,t,s,n){this.list[t]||(this.list[t]={});const i=e.data.get(n);if(i)for(const r of i[0]){const o=e.keyFragments.get(r);if(o){const l=this.list[t];l[s]||(l[s]={}),l[s][o]||(l[s][o]=new Set),l[s][o].add(n)}}}};b(vc,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let df=vc;const pf=class yc extends Fe{constructor(e){super(e),b(this,"enabled",!0),b(this,"height",10),b(this,"groupName","storeys"),b(this,"onDisposed",new $),b(this,"list",new Set),e.add(yc.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get(df),s=this.components.get(Qe),n=e?1:-1;let i=0;const r=t.list[this.groupName],o=new me;for(const l in r){o.elements[13]=i*n*this.height;for(const u in r[l]){const d=s.list.get(u),f=l+u,m=this.list.has(f);if(!d||e&&m||!e&&!m)continue;e?this.list.add(f):this.list.delete(f);const E=r[l][u];d.applyTransform(E,o)}i++}}};b(pf,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");const ff=class Ic extends Fe{constructor(e){super(e),b(this,"enabled",!0),this.components.add(Ic.uuid,this)}set(e,t){const s=this.components.get(Qe);if(!t){for(const n in s.list){const i=s.list.get(n);i&&(i.setVisibility(e),this.updateCulledVisibility(i))}return}for(const n in t){const i=t[n],r=s.list.get(n);r&&(r.setVisibility(e,i),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(Jp);for(const[s,n]of t.list){const i=n.colorMeshes.get(e.id);i&&(i.count=e.mesh.count)}}};b(ff,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");class mf extends $a{constructor(){super(...arguments),b(this,"minGeometrySize",10),b(this,"minAssetsSize",1e3)}}class Cc extends $a{constructor(){super(...arguments),b(this,"propertiesSize",100)}}class gf extends Fe{constructor(){super(...arguments),b(this,"onPropertiesStreamed",new bs),b(this,"onProgress",new bs),b(this,"onIndicesStreamed",new bs),b(this,"onDisposed",new $),b(this,"enabled",!0),b(this,"settings",new Cc),b(this,"webIfc",new As)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){const t=performance.now();await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-t} ms!`)}async streamFromCallBack(e){const t=performance.now();await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-t} ms!`)}async readIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=[Yr,za,Ua,Vr,Ba,ka],n=new Map,i=new Set([Ya,Va,Ga,Hr,qs]);for(const u of i)t.add(u);let r=.01,o=0;for(const u of t){if(o++,qa.has(u))continue;const d=i.has(u),f=this.webIfc.GetLineIDsWithType(0,u),m=f.size();let E=0;for(let y=0;y<m-e;y+=e){const A={};for(let S=0;S<e;S++){E++;const x=f.get(y+S);try{const R=this.webIfc.GetLine(0,x,d);s.includes(u)&&this.getIndices(R,x,n),A[R.expressID]=R}catch{console.log(`Could not get property: ${x}`)}}await this.onPropertiesStreamed.trigger({type:u,data:A})}if(E!==m){const y={};for(let A=E;A<m;A++){const S=f.get(A);try{const x=this.webIfc.GetLine(0,S,d);s.includes(u)&&this.getIndices(x,S,n),y[x.expressID]=x}catch{console.log(`Could not get property: ${S}`)}}await this.onPropertiesStreamed.trigger({type:u,data:y})}const w=o/t.size;w>r&&(r+=.01,r=Math.max(r,w),await this.onProgress.trigger(Math.round(r*100)/100))}const l=[];for(const[u,d]of n)l.push([u,...d]);await this.onIndicesStreamed.trigger(l)}getIndices(e,t,s){const n=e.RelatedObjects||e.RelatedElements;if(!n){console.log(`Related objects not found: ${t}`);return}const i=e.RelatingType||e.RelatingMaterial||e.RelatingStructure||e.RelatingPropertyDefinition||e.RelatingGroup||e.RelatingClassification;if(!i){console.log(`Relating object not found: ${t}`);return}if(!Array.isArray(n)||i.value===void 0)return;const r=i.value;for(const o of n){if(o.value===void 0||o.value===null)continue;const l=o.value;s.has(l)||s.set(l,new Set),s.get(l).add(r)}}cleanUp(){this.webIfc=null,this.webIfc=new As}}b(gf,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const Ef=class Tc extends Fe{constructor(e){super(e),b(this,"onGeometryStreamed",new $),b(this,"onAssetStreamed",new $),b(this,"onProgress",new $),b(this,"onIfcLoaded",new $),b(this,"onDisposed",new $),b(this,"settings",new mf),b(this,"enabled",!0),b(this,"webIfc",new As),b(this,"_spatialTree",new fc),b(this,"_metaData",new gc),b(this,"_visitedGeometries",new Map),b(this,"_streamSerializer",new zh),b(this,"_geometries",new Map),b(this,"_geometryCount",0),b(this,"_civil",new mc),b(this,"_groupSerializer",new _h),b(this,"_assets",[]),b(this,"_meshesWithHoles",new Set),this.components.add(Tc.uuid,this),this.settings.excludedCategories.add(Bh)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){const t=performance.now();await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-t} ms!`)}async streamFromCallBack(e){const t=performance.now();await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-t} ms!`)}async readIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),n=[[]],i=new kh,{FILE_NAME:r,FILE_DESCRIPTION:o}=kt;i.ifcMetadata={name:this._metaData.get(this.webIfc,r),description:this._metaData.get(this.webIfc,o),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let l=0,u=0;for(const S of s){if(!this.webIfc.IsIfcElement(S)&&S!==qs||this.settings.excludedCategories.has(S))continue;const x=this.webIfc.GetLineIDsWithType(0,S),R=x.size();console.log(R);for(let C=0;C<R;C++){l>e&&(l=0,u++,n.push([]));const M=x.get(C);n[u].push(M);const k=this._spatialTree.itemsByFloor[M]||0;i.data.set(M,[[],[k,S]]),l++}}this._spatialTree.cleanUp();let d=.01,f=0;for(const S of n){f++,this.webIfc.StreamMeshes(0,S,R=>{this.getMesh(this.webIfc,R,i)}),this._geometryCount>e&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const x=f/n.length;x>d&&(d+=.01,d=Math.max(d,x),this.onProgress.trigger(Math.round(d*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:m,transparent:E}=i.geometryIDs;for(const[S,{index:x,uuid:R}]of this._visitedGeometries)i.keyFragments.set(x,R),(S>1?m:E).set(S,x);const w=i.data.keys();for(const S of w){const[x]=i.data.get(S);x.length||i.data.delete(S)}const y=this.webIfc.GetCoordinationMatrix(0);i.coordinationMatrix.fromArray(y),i.civilData=this._civil.read(this.webIfc);const A=this._groupSerializer.export(i);this.onIfcLoaded.trigger(A),i.dispose(!0)}cleanUp(){this.webIfc=null,this.webIfc=new As,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,s){const n=t.geometries.size(),i=t.expressID,r={id:i,geometries:[]};for(let o=0;o<n;o++){const l=t.geometries.get(o),u=l.geometryExpressID,d=l.color.w===1?1:-1,f=u*d;if(!this._visitedGeometries.has(f)){this._visitedGeometries.has(u)||this.getGeometry(e,u);const C=this._visitedGeometries.size,M=yi.generateUUID();this._visitedGeometries.set(f,{uuid:M,index:C})}const m=this._visitedGeometries.get(f);if(m===void 0)throw new Error("Error getting geometry data for streaming!");const E=s.data.get(i);if(!E)throw new Error("Data not found!");E[0].push(m.index);const{x:w,y,z:A,w:S}=l.color,x=[w,y,A,S],R=l.flatTransformation;r.geometries.push({color:x,geometryID:u,transformation:R})}this._assets.push(r)}getGeometry(e,t){const s=e.GetGeometry(0,t),n=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),i=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(i.length/2),o=new Float32Array(i.length/2);for(let m=0;m<i.length;m+=6)r[m/2]=i[m],r[m/2+1]=i[m+1],r[m/2+2]=i[m+2],o[m/2]=i[m+3],o[m/2+1]=i[m+4],o[m/2+2]=i[m+5];const l=Ap(r),u=new Float32Array(l.transformation.elements),d=[l.center.x,l.center.y,l.center.z];let f=!1;for(let m=0;m<r.length-2;m+=3){const E=r[m],w=r[m+1],y=r[m+2],A=o[m],S=o[m+1],x=o[m+2];if(Sp(d,[E,w,y],[A,S,x])){f=!0;break}}this._geometries.set(t,{position:r,normal:o,index:n,boundingBox:u,hasHoles:f}),s.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[s,{boundingBox:n,hasHoles:i}]of this._geometries)t[s]={boundingBox:n,hasHoles:i};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}};b(Ef,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class vf extends Fe{constructor(){super(...arguments),b(this,"onPropertiesStreamed",new bs),b(this,"onProgress",new bs),b(this,"onIndicesStreamed",new bs),b(this,"onDisposed",new $),b(this,"enabled",!0),b(this,"settings",new Cc),b(this,"webIfc",new As)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){const t=performance.now();await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-t} ms!`)}async streamFromCallBack(e){const t=performance.now();await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-t} ms!`)}async readIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([Ya,Va,Ga,Hr,qs]);for(const o of s)t.add(o);let n=.01,i=0;for(const o of t){if(i++,qa.has(o))continue;const l=s.has(o),u=this.webIfc.GetLineIDsWithType(0,o),d=u.size();let f=0;for(let E=0;E<d-e;E+=e){const w={};for(let y=0;y<e;y++){f++;const A=u.get(E+y);try{const S=this.webIfc.GetLine(0,A,l);w[S.expressID]=S}catch{console.log(`Could not get property: ${A}`)}}await this.onPropertiesStreamed.trigger({type:o,data:w})}if(f!==d){const E={};for(let w=f;w<d;w++){const y=u.get(w);try{const A=this.webIfc.GetLine(0,y,l);E[A.expressID]=A}catch{console.log(`Could not get property: ${y}`)}}await this.onPropertiesStreamed.trigger({type:o,data:E})}const m=i/t.size;m>n&&(n+=.01,n=Math.max(n,m),await this.onProgress.trigger(Math.round(n*100)/100))}const r=await this.components.get(Ja).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc=null,this.webIfc=new As}}b(vf,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const bc=class Ac extends Fe{constructor(e){super(e),b(this,"enabled",!0),e.add(Ac.uuid,this)}getFace(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const n=new Map,i=e.geometry.index.array,{plane:r}=this.getFaceData(t,s,e),o=[];for(let f=0;f<i.length/3;f++){const{plane:m,edges:E}=this.getFaceData(f,s,e);if(m.equals(r)){o.push({index:f,edges:E});for(const{id:w,points:y,distance:A}of E)n.set(w,{points:y,distance:A})}}let l=0;const u=new Map,d=new Map;for(const{index:f,edges:m}of o){const E=new Map;for(const{id:C}of m)if(u.has(C)){const M=u.get(C);E.set(C,M)}const w=m.map(C=>C.id);if(!E.size){const C=l++;for(const{id:M}of m)u.set(M,C);d.set(C,{edges:new Set(w),indices:new Set([f])});continue}let y=null;const A=new Set,S=new Set(w);for(const[C,M]of E){y===null?y=M:M!==y&&A.add(M),u.delete(C);const{edges:k}=d.get(M);k.delete(C),S.delete(C)}if(y===null)throw new Error("Error computing face!");const x=d.get(y),{indices:R}=x;R.add(f);for(const C of S){u.set(C,y);const{edges:M}=x;M.add(C)}for(const C of A){const M=d.get(C),{edges:k,indices:G}=M,H=d.get(y),{edges:W,indices:Z}=H;for(const J of k)W.add(J),u.set(J,y);for(const J of G)Z.add(J);d.delete(C)}}for(const[f,{indices:m,edges:E}]of d)if(m.has(t)){const w=[];for(const y of E){const A=n.get(y);w.push(A)}return{edges:w,indices:m}}return null}static distanceFromPointToLine(e,t,s,n=!1){const i=new It,r=new P;return i.set(t,s),i.closestPointToPoint(e,n,r),r.distanceTo(e)}getFaceData(e,t,s){const n=this.getVerticesAndNormal(s,e,t),{p1:i,p2:r,p3:o,faceNormal:l}=n;this.round(i),this.round(r),this.round(o),this.round(l);const u=[{id:`${i.x}|${i.y}|${i.z}`,value:i},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];u.sort((x,R)=>x.id<R.id?-1:x.id>R.id?1:0);const[{id:d,value:f},{id:m,value:E},{id:w,value:y}]=u,A=[{id:`${d}|${m}`,distance:f.distanceTo(E),points:[f,E]},{id:`${m}|${w}`,distance:E.distanceTo(y),points:[E,y]},{id:`${d}|${w}`,distance:f.distanceTo(y),points:[f,y]}],S=new Fs;return S.setFromNormalAndCoplanarPoint(l,i),S.constant=Math.round(S.constant*10)/10,{plane:S,edges:A}}getVerticesAndNormal(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const n=e.geometry.index.array,i=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=n[t*3]*3,l=n[t*3+1]*3,u=n[t*3+2]*3,d=new P(i[o],i[o+1],i[o+2]),f=new P(i[l],i[l+1],i[l+2]),m=new P(i[u],i[u+1],i[u+2]),E=new P(r[o],r[o+1],r[o+2]),w=new P(r[l],r[l+1],r[l+2]),y=new P(r[u],r[u+1],r[u+2]),A=(E.x+w.x+y.x)/3,S=(E.y+w.y+y.y)/3,x=(E.z+w.z+y.z)/3,R=new P(A,S,x);if(!R.x&&!R.y&&!R.z&&console.log("hey"),s!==void 0&&e instanceof Ot){const C=new me;e.getMatrixAt(s,C);const M=new me;M.extractRotation(C),R.applyMatrix4(M),d.applyMatrix4(C),f.applyMatrix4(C),m.applyMatrix4(C)}return{p1:d,p2:f,p3:m,faceNormal:R}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}};b(bc,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let Br=bc;const yh=new Ue,yr=new P;class Sc extends ju{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new Fn(e,3)),this.setAttribute("uv",new Fn(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,s=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),s.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new oa(t,6,1);return this.setAttribute("instanceStart",new bn(s,3,0)),this.setAttribute("instanceEnd",new bn(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new oa(t,6,1);return this.setAttribute("instanceColorStart",new bn(s,3,0)),this.setAttribute("instanceColorEnd",new bn(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Ku(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ue);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),yh.setFromBufferAttribute(t),this.boundingBox.union(yh))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xs),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let n=0;for(let i=0,r=e.count;i<r;i++)yr.fromBufferAttribute(e,i),n=Math.max(n,s.distanceToSquared(yr)),yr.fromBufferAttribute(t,i),n=Math.max(n,s.distanceToSquared(yr));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}Fr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ke(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};xr.line={uniforms:Na.merge([Fr.common,Fr.fog,Fr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Ii extends ht{constructor(e){super({type:"LineMaterial",uniforms:Na.clone(xr.line.uniforms),vertexShader:xr.line.vertexShader,fragmentShader:xr.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const Ih=new P,Ch=new P,st=new Rn,nt=new Rn,Zt=new Rn,na=new P,ia=new me,it=new It,Th=new P,Ir=new Ue,Cr=new Xs,Qt=new Rn;let Jt,js;function bh(c,e,t){return Qt.set(0,0,-e,1).applyMatrix4(c.projectionMatrix),Qt.multiplyScalar(1/Qt.w),Qt.x=js/t.width,Qt.y=js/t.height,Qt.applyMatrix4(c.projectionMatrixInverse),Qt.multiplyScalar(1/Qt.w),Math.abs(Math.max(Qt.x,Qt.y))}function wf(c,e){const t=c.matrixWorld,s=c.geometry,n=s.attributes.instanceStart,i=s.attributes.instanceEnd,r=Math.min(s.instanceCount,n.count);for(let o=0,l=r;o<l;o++){it.start.fromBufferAttribute(n,o),it.end.fromBufferAttribute(i,o),it.applyMatrix4(t);const u=new P,d=new P;Jt.distanceSqToSegment(it.start,it.end,d,u),d.distanceTo(u)<js*.5&&e.push({point:d,pointOnLine:u,distance:Jt.origin.distanceTo(d),object:c,face:null,faceIndex:o,uv:null,uv1:null})}}function yf(c,e,t){const s=e.projectionMatrix,n=c.material.resolution,i=c.matrixWorld,r=c.geometry,o=r.attributes.instanceStart,l=r.attributes.instanceEnd,u=Math.min(r.instanceCount,o.count),d=-e.near;Jt.at(1,Zt),Zt.w=1,Zt.applyMatrix4(e.matrixWorldInverse),Zt.applyMatrix4(s),Zt.multiplyScalar(1/Zt.w),Zt.x*=n.x/2,Zt.y*=n.y/2,Zt.z=0,na.copy(Zt),ia.multiplyMatrices(e.matrixWorldInverse,i);for(let f=0,m=u;f<m;f++){if(st.fromBufferAttribute(o,f),nt.fromBufferAttribute(l,f),st.w=1,nt.w=1,st.applyMatrix4(ia),nt.applyMatrix4(ia),st.z>d&&nt.z>d)continue;if(st.z>d){const S=st.z-nt.z,x=(st.z-d)/S;st.lerp(nt,x)}else if(nt.z>d){const S=nt.z-st.z,x=(nt.z-d)/S;nt.lerp(st,x)}st.applyMatrix4(s),nt.applyMatrix4(s),st.multiplyScalar(1/st.w),nt.multiplyScalar(1/nt.w),st.x*=n.x/2,st.y*=n.y/2,nt.x*=n.x/2,nt.y*=n.y/2,it.start.copy(st),it.start.z=0,it.end.copy(nt),it.end.z=0;const E=it.closestPointToPointParameter(na,!0);it.at(E,Th);const w=yi.lerp(st.z,nt.z,E),y=w>=-1&&w<=1,A=na.distanceTo(Th)<js*.5;if(y&&A){it.start.fromBufferAttribute(o,f),it.end.fromBufferAttribute(l,f),it.start.applyMatrix4(i),it.end.applyMatrix4(i);const S=new P,x=new P;Jt.distanceSqToSegment(it.start,it.end,x,S),t.push({point:x,pointOnLine:S,distance:Jt.origin.distanceTo(x),object:c,face:null,faceIndex:f,uv:null,uv1:null})}}}class If extends re{constructor(e=new Sc,t=new Ii({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,s=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let r=0,o=0,l=t.count;r<l;r++,o+=2)Ih.fromBufferAttribute(t,r),Ch.fromBufferAttribute(s,r),n[o]=o===0?0:n[o-1],n[o+1]=n[o]+Ih.distanceTo(Ch);const i=new oa(n,2,1);return e.setAttribute("instanceDistanceStart",new bn(i,1,0)),e.setAttribute("instanceDistanceEnd",new bn(i,1,1)),this}raycast(e,t){const s=this.material.worldUnits,n=e.camera;n===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const i=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Jt=e.ray;const r=this.matrixWorld,o=this.geometry,l=this.material;js=l.linewidth+i,o.boundingSphere===null&&o.computeBoundingSphere(),Cr.copy(o.boundingSphere).applyMatrix4(r);let u;if(s)u=js*.5;else{const f=Math.max(n.near,Cr.distanceToPoint(Jt.origin));u=bh(n,f,l.resolution)}if(Cr.radius+=u,Jt.intersectsSphere(Cr)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),Ir.copy(o.boundingBox).applyMatrix4(r);let d;if(s)d=js*.5;else{const f=Math.max(n.near,Ir.distanceToPoint(Jt.origin));d=bh(n,f,l.resolution)}Ir.expandByScalar(d),Jt.intersectsBox(Ir)!==!1&&(s?wf(this,t):yf(this,n,t))}}class kr extends Sc{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,s=new Float32Array(2*t);for(let n=0;n<t;n+=3)s[2*n]=e[n],s[2*n+1]=e[n+1],s[2*n+2]=e[n+2],s[2*n+3]=e[n+3],s[2*n+4]=e[n+4],s[2*n+5]=e[n+5];return super.setPositions(s),this}setColors(e){const t=e.length-3,s=new Float32Array(2*t);for(let n=0;n<t;n+=3)s[2*n]=e[n],s[2*n+1]=e[n+1],s[2*n+2]=e[n+2],s[2*n+3]=e[n+3],s[2*n+4]=e[n+4],s[2*n+5]=e[n+5];return super.setColors(s),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Fc extends If{constructor(e=new kr,t=new Ii({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const xc=class Rc{constructor(e,t){T(this,"scene"),T(this,"onSelect",new $),T(this,"type"),T(this,"selectCurve"),T(this,"selectPoints"),T(this,"hoverCurve"),T(this,"hoverPoints"),T(this,"caster",new zr),this.scene=e,this.type=t,this.hoverCurve=this.newCurve(.003,4473924,!1),this.hoverPoints=this.newPoints(5,4473924),this.selectCurve=this.newCurve(.005,16777215,!0),this.selectPoints=this.newPoints(7,16777215)}dispose(){this.selectCurve&&this.scene.remove(this.selectCurve),this.selectCurve.material.dispose(),this.selectCurve.geometry.dispose(),this.selectCurve=null,this.hoverCurve.material.dispose(),this.hoverCurve.geometry.dispose(),this.hoverCurve=null,this.hoverPoints.material.dispose(),this.hoverPoints.geometry.dispose(),this.selectPoints.material.dispose(),this.selectPoints.geometry.dispose(),this.scene=null}castRay(e,t,s,n){const i=new ke,r=s.getBoundingClientRect();i.x=(e.clientX-r.left)/r.width*2-1,i.y=-((e.clientY-r.top)/r.height)*2+1,this.caster.setFromCamera(i,t);const o=this.caster.intersectObjects(n);return o.length?o[0]:null}select(e){this.highlight(e,this.selectCurve,this.selectPoints,!0),this.onSelect.trigger(e)}unSelect(){this.selectCurve.removeFromParent(),this.selectPoints.removeFromParent()}hover(e){this.highlight(e,this.hoverCurve,this.hoverPoints,!1)}unHover(){this.hoverCurve.removeFromParent(),this.hoverPoints.removeFromParent()}highlight(e,t,s,n){const{alignment:i}=e.curve;this.scene.add(t),this.scene.add(s);const r=[],o=[],l=[];for(const m of i[this.type]){const E=m.mesh.geometry.attributes.position;for(const S of E.array)r.push(S);if(n){let S;if(this.type==="absolute"){const{horizontal:R}=m.alignment;S=R[m.index].data.TYPE}else S=m.data.TYPE;const x=Rc.settings.colors[S]||[1,1,1];for(let R=0;R<E.count;R++)o.push(...x)}const[w,y,A]=E.array;l.push(new P(w,y,A))}const u=r[r.length-3],d=r[r.length-2],f=r[r.length-1];l.push(new P(u,d,f)),r.length/3>t.geometry.attributes.position.count&&(t.geometry.dispose(),t.geometry=new kr),t.geometry.setPositions(r),n&&t.geometry.setColors(o),s.geometry.setFromPoints(l)}newCurve(e,t,s){const n=new kr,i=new Ii({color:t,linewidth:e,vertexColors:s,worldUnits:!1,depthTest:!1}),r=new Fc(n,i);return this.scene.add(r),r}newPoints(e,t){const s=new De,n=new gt(new Float32Array,3);s.setAttribute("position",n);const i=new Ou({size:e,color:t,sizeAttenuation:!1,depthTest:!1}),r=new Mu(s,i);return r.frustumCulled=!1,this.scene.add(r),r}};T(xc,"settings",{colors:{LINE:[213/255,0/255,255/255],CIRCULARARC:[0/255,46,255/255],CLOTHOID:[0/255,255/255,0/255],PARABOLICARC:[0/255,255/255,72/255],CONSTANTGRADIENT:[213/255,0/255,255/255]}});let Pc=xc;class Cf extends xn{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new ke(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const In=new P,Ah=new me,Sh=new me,Fh=new P,xh=new P;class Tf{constructor(e={}){const t=this;let s,n,i,r;const o={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:s,height:n}},this.render=function(E,w){E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),w.parent===null&&w.matrixWorldAutoUpdate===!0&&w.updateMatrixWorld(),Ah.copy(w.matrixWorldInverse),Sh.multiplyMatrices(w.projectionMatrix,Ah),u(E,E,w),m(E)},this.setSize=function(E,w){s=E,n=w,i=s/2,r=n/2,l.style.width=E+"px",l.style.height=w+"px"};function u(E,w,y){if(E.isCSS2DObject){In.setFromMatrixPosition(E.matrixWorld),In.applyMatrix4(Sh);const A=E.visible===!0&&In.z>=-1&&In.z<=1&&E.layers.test(y.layers)===!0;if(E.element.style.display=A===!0?"":"none",A===!0){E.onBeforeRender(t,w,y);const x=E.element;x.style.transform="translate("+-100*E.center.x+"%,"+-100*E.center.y+"%)translate("+(In.x*i+i)+"px,"+(-In.y*r+r)+"px)",x.parentNode!==l&&l.appendChild(x),E.onAfterRender(t,w,y)}const S={distanceToCameraSquared:d(y,E)};o.objects.set(E,S)}for(let A=0,S=E.children.length;A<S;A++)u(E.children[A],w,y)}function d(E,w){return Fh.setFromMatrixPosition(E.matrixWorld),xh.setFromMatrixPosition(w.matrixWorld),Fh.distanceToSquared(xh)}function f(E){const w=[];return E.traverse(function(y){y.isCSS2DObject&&w.push(y)}),w}function m(E){const w=f(E).sort(function(A,S){if(A.renderOrder!==S.renderOrder)return S.renderOrder-A.renderOrder;const x=o.objects.get(A).distanceToCameraSquared,R=o.objects.get(S).distanceToCameraSquared;return x-R}),y=w.length;for(let A=0,S=w.length;A<S;A++)w[A].element.style.zIndex=y-A}}}class mt{constructor(e,t,s){T(this,"three"),T(this,"world"),T(this,"onDisposed",new $),this.world=e;let n;t?n=t:(n=document.createElement("div"),n.style.width="15px",n.style.height="15px",n.style.border="5px solid red"),this.three=new Cf(n),(s||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}class bf extends Mp{constructor(e,t,s){super(e,t,s),T(this,"three2D",new Tf),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const n=this.currentWorld.scene.three,i=this.currentWorld.camera.three;n instanceof Qs&&this.three2D.render(n,i)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:n,y:i})=>{this.three2D.setSize(n,i)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}const Oc=class Mc extends Fe{constructor(e){super(e),T(this,"enabled",!0),T(this,"threshold",50),T(this,"autoCluster",!0),T(this,"list",new Map),T(this,"clusterLabels",new Set),T(this,"currentKeys",new Set),T(this,"_color","white"),T(this,"_markerKey",0),T(this,"_clusterKey",0),T(this,"isNavigating",!1),T(this,"_setupWorlds",new Set),e.add(Mc.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[t,s]of this.list)s.label.three.element.style.color=e}create(e,t,s,n=!1){this.setupEvents(e,!0);const i=document.createElement("span");i.innerHTML=t,i.style.color=this._color;const r=new mt(e,i);r.three.position.copy(s);const o=this._markerKey.toString();return this.list.set(o,{key:o,label:r,merged:!1,static:n}),this._markerKey++,o}delete(e){const t=this.list.get(e);t&&t.label.dispose(),this.list.delete(e)}clear(e){const t=[...this.list.keys()];for(const s of t){const n=this.list.get(s);e&&n.type!==e||(n.label.dispose(),this.list.delete(s))}this.list.clear(),this._markerKey=0}dispose(){for(const[e,t]of this.list)t.label.dispose();this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}setupEvents(e,t){t&&this._setupWorlds.has(e.uuid)||e.camera.hasCameraControls()&&(t?(e.camera.controls.addEventListener("sleep",()=>{this.manageCluster()}),e.camera.controls.addEventListener("rest",()=>{this.isNavigating&&(this.manageCluster(),this.isNavigating=!1)})):(e.camera.controls.removeEventListener("sleep",()=>{this.manageCluster()}),e.camera.controls.removeEventListener("rest",()=>{this.isNavigating&&(this.manageCluster(),this.isNavigating=!1)})))}resetMarkers(){for(const[e,t]of this.list)t.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(){for(const[e,t]of this.list)t.merged?t.label.dispose():t.label.world.scene.three.add(t.label.three);for(const e of this.clusterLabels)if(e.markerKeys.length===1){const t=this.list.get(e.markerKeys[0]);t&&(t.label.world.scene.three.add(t.label.three),t.merged=!1),e.label.dispose(),this.clusterLabels.delete(e)}}manageCluster(){if(this.autoCluster){this.resetMarkers();for(const[e,t]of this.list)if(!t.merged&&!t.static){this.currentKeys.clear();for(const[s,n]of this.list)n.static||t.key!==n.key&&!n.merged&&this.distance(t.label,n.label)<this.threshold&&(this.currentKeys.add(n.key),n.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(t.key),t.merged=!0;const s=Array.from(this.currentKeys),n=this.getAveragePositionFromLabels(s),i=new mt(t.label.world,this.createClusterElement(this._clusterKey.toString())),{element:r}=i.three;r.textContent=s.length.toString(),i.three.position.copy(n),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:s,label:i}),this._clusterKey++}}this.removeMergeMarkers()}}getAveragePositionFromLabels(e){const t=e.map(s=>{const n=this.list.get(s);return n?n.label.three.position:new P});return t.reduce((s,n)=>s.add(n),new P).divideScalar(t.length)}createClusterElement(e){const t=document.createElement("div");return t.textContent=e,t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.pointerEvents="auto",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.style.cursor="pointer",t.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),t.addEventListener("pointerover",()=>{t.style.background="#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background="#FFFFFF"}),t}getScreenPosition(e){const t=new P;if(!e.world.renderer)throw new Error("Renderer not found!");const s=e.three.position.clone();s.project(e.world.camera.three);const n=e.world.renderer.getSize();return t.x=s.x*n.x/2+n.x/2,t.y=-(s.y*n.y/2)+n.y/2,t}distance(e,t){const s=this.getScreenPosition(e),n=this.getScreenPosition(t),i=s.x-n.x,r=s.y-n.y,o=Math.sqrt(i*i+r*r)*.5;return o===0?this.threshold+1:o}navigateToCluster(e){const t=[],s=Array.from(this.clusterLabels).find(u=>u.key===e);if(!s)return;const n=s.label.world.camera;if(!n.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const u of s.markerKeys){const d=this.list.get(u);if(d){const{x:f,y:m,z:E}=d.label.three.position;t.push(f,m,E)}}s.label.dispose(),this.clusterLabels.delete(s);const i=new De,r=new Float32Array(t),o=new gt(r,3);i.setAttribute("position",o);const l=new re(i);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&n.controls.fitToSphere(l,!0),this.isNavigating=!0,i.dispose(),l.clear(),t.length=0}};T(Oc,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");let Ys=Oc;var Rh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dc(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var el={exports:{}};el.exports=Xr;el.exports.default=Xr;function Xr(c,e,t){t=t||2;var s=e&&e.length,n=s?e[0]*t:c.length,i=Lc(c,0,n,t,!0),r=[];if(!i||i.next===i.prev)return r;var o,l,u,d,f,m,E;if(s&&(i=Rf(c,e,i,t)),c.length>80*t){o=u=c[0],l=d=c[1];for(var w=t;w<n;w+=t)f=c[w],m=c[w+1],f<o&&(o=f),m<l&&(l=m),f>u&&(u=f),m>d&&(d=m);E=Math.max(u-o,d-l),E=E!==0?32767/E:0}return mi(i,r,t,o,l,E,0),r}function Lc(c,e,t,s,n){var i,r;if(n===ba(c,e,t,s)>0)for(i=e;i<t;i+=s)r=Ph(i,c[i],c[i+1],r);else for(i=t-s;i>=e;i-=s)r=Ph(i,c[i],c[i+1],r);return r&&Zr(r,r.next)&&(Ei(r),r=r.next),r}function Ks(c,e){if(!c)return c;e||(e=c);var t=c,s;do if(s=!1,!t.steiner&&(Zr(t,t.next)||He(t.prev,t,t.next)===0)){if(Ei(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function mi(c,e,t,s,n,i,r){if(c){!r&&i&&Lf(c,s,n,i);for(var o=c,l,u;c.prev!==c.next;){if(l=c.prev,u=c.next,i?Sf(c,s,n,i):Af(c)){e.push(l.i/t|0),e.push(c.i/t|0),e.push(u.i/t|0),Ei(c),c=u.next,o=u.next;continue}if(c=u,c===o){r?r===1?(c=Ff(Ks(c),e,t),mi(c,e,t,s,n,i,2)):r===2&&xf(c,e,t,s,n,i):mi(Ks(c),e,t,s,n,i,1);break}}}}function Af(c){var e=c.prev,t=c,s=c.next;if(He(e,t,s)>=0)return!1;for(var n=e.x,i=t.x,r=s.x,o=e.y,l=t.y,u=s.y,d=n<i?n<r?n:r:i<r?i:r,f=o<l?o<u?o:u:l<u?l:u,m=n>i?n>r?n:r:i>r?i:r,E=o>l?o>u?o:u:l>u?l:u,w=s.next;w!==e;){if(w.x>=d&&w.x<=m&&w.y>=f&&w.y<=E&&Sn(n,o,i,l,r,u,w.x,w.y)&&He(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function Sf(c,e,t,s){var n=c.prev,i=c,r=c.next;if(He(n,i,r)>=0)return!1;for(var o=n.x,l=i.x,u=r.x,d=n.y,f=i.y,m=r.y,E=o<l?o<u?o:u:l<u?l:u,w=d<f?d<m?d:m:f<m?f:m,y=o>l?o>u?o:u:l>u?l:u,A=d>f?d>m?d:m:f>m?f:m,S=Ca(E,w,e,t,s),x=Ca(y,A,e,t,s),R=c.prevZ,C=c.nextZ;R&&R.z>=S&&C&&C.z<=x;){if(R.x>=E&&R.x<=y&&R.y>=w&&R.y<=A&&R!==n&&R!==r&&Sn(o,d,l,f,u,m,R.x,R.y)&&He(R.prev,R,R.next)>=0||(R=R.prevZ,C.x>=E&&C.x<=y&&C.y>=w&&C.y<=A&&C!==n&&C!==r&&Sn(o,d,l,f,u,m,C.x,C.y)&&He(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;R&&R.z>=S;){if(R.x>=E&&R.x<=y&&R.y>=w&&R.y<=A&&R!==n&&R!==r&&Sn(o,d,l,f,u,m,R.x,R.y)&&He(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;C&&C.z<=x;){if(C.x>=E&&C.x<=y&&C.y>=w&&C.y<=A&&C!==n&&C!==r&&Sn(o,d,l,f,u,m,C.x,C.y)&&He(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function Ff(c,e,t){var s=c;do{var n=s.prev,i=s.next.next;!Zr(n,i)&&Nc(n,s,s.next,i)&&gi(n,i)&&gi(i,n)&&(e.push(n.i/t|0),e.push(s.i/t|0),e.push(i.i/t|0),Ei(s),Ei(s.next),s=c=i),s=s.next}while(s!==c);return Ks(s)}function xf(c,e,t,s,n,i){var r=c;do{for(var o=r.next.next;o!==r.prev;){if(r.i!==o.i&&Uf(r,o)){var l=_c(r,o);r=Ks(r,r.next),l=Ks(l,l.next),mi(r,e,t,s,n,i,0),mi(l,e,t,s,n,i,0);return}o=o.next}r=r.next}while(r!==c)}function Rf(c,e,t,s){var n=[],i,r,o,l,u;for(i=0,r=e.length;i<r;i++)o=e[i]*s,l=i<r-1?e[i+1]*s:c.length,u=Lc(c,o,l,s,!1),u===u.next&&(u.steiner=!0),n.push(_f(u));for(n.sort(Pf),i=0;i<n.length;i++)t=Of(n[i],t);return t}function Pf(c,e){return c.x-e.x}function Of(c,e){var t=Mf(c,e);if(!t)return e;var s=_c(t,c);return Ks(s,s.next),Ks(t,t.next)}function Mf(c,e){var t=e,s=c.x,n=c.y,i=-1/0,r;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var o=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=s&&o>i&&(i=o,r=t.x<t.next.x?t:t.next,o===s))return r}t=t.next}while(t!==e);if(!r)return null;var l=r,u=r.x,d=r.y,f=1/0,m;t=r;do s>=t.x&&t.x>=u&&s!==t.x&&Sn(n<d?s:i,n,u,d,n<d?i:s,n,t.x,t.y)&&(m=Math.abs(n-t.y)/(s-t.x),gi(t,c)&&(m<f||m===f&&(t.x>r.x||t.x===r.x&&Df(r,t)))&&(r=t,f=m)),t=t.next;while(t!==l);return r}function Df(c,e){return He(c.prev,c,e.prev)<0&&He(e.next,c,c.next)<0}function Lf(c,e,t,s){var n=c;do n.z===0&&(n.z=Ca(n.x,n.y,e,t,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==c);n.prevZ.nextZ=null,n.prevZ=null,Nf(n)}function Nf(c){var e,t,s,n,i,r,o,l,u=1;do{for(t=c,c=null,i=null,r=0;t;){for(r++,s=t,o=0,e=0;e<u&&(o++,s=s.nextZ,!!s);e++);for(l=u;o>0||l>0&&s;)o!==0&&(l===0||!s||t.z<=s.z)?(n=t,t=t.nextZ,o--):(n=s,s=s.nextZ,l--),i?i.nextZ=n:c=n,n.prevZ=i,i=n;t=s}i.nextZ=null,u*=2}while(r>1);return c}function Ca(c,e,t,s,n){return c=(c-t)*n|0,e=(e-s)*n|0,c=(c|c<<8)&16711935,c=(c|c<<4)&252645135,c=(c|c<<2)&858993459,c=(c|c<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,c|e<<1}function _f(c){var e=c,t=c;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==c);return t}function Sn(c,e,t,s,n,i,r,o){return(n-r)*(e-o)>=(c-r)*(i-o)&&(c-r)*(s-o)>=(t-r)*(e-o)&&(t-r)*(i-o)>=(n-r)*(s-o)}function Uf(c,e){return c.next.i!==e.i&&c.prev.i!==e.i&&!Bf(c,e)&&(gi(c,e)&&gi(e,c)&&kf(c,e)&&(He(c.prev,c,e.prev)||He(c,e.prev,e))||Zr(c,e)&&He(c.prev,c,c.next)>0&&He(e.prev,e,e.next)>0)}function He(c,e,t){return(e.y-c.y)*(t.x-e.x)-(e.x-c.x)*(t.y-e.y)}function Zr(c,e){return c.x===e.x&&c.y===e.y}function Nc(c,e,t,s){var n=br(He(c,e,t)),i=br(He(c,e,s)),r=br(He(t,s,c)),o=br(He(t,s,e));return!!(n!==i&&r!==o||n===0&&Tr(c,t,e)||i===0&&Tr(c,s,e)||r===0&&Tr(t,c,s)||o===0&&Tr(t,e,s))}function Tr(c,e,t){return e.x<=Math.max(c.x,t.x)&&e.x>=Math.min(c.x,t.x)&&e.y<=Math.max(c.y,t.y)&&e.y>=Math.min(c.y,t.y)}function br(c){return c>0?1:c<0?-1:0}function Bf(c,e){var t=c;do{if(t.i!==c.i&&t.next.i!==c.i&&t.i!==e.i&&t.next.i!==e.i&&Nc(t,t.next,c,e))return!0;t=t.next}while(t!==c);return!1}function gi(c,e){return He(c.prev,c,c.next)<0?He(c,e,c.next)>=0&&He(c,c.prev,e)>=0:He(c,e,c.prev)<0||He(c,c.next,e)<0}function kf(c,e){var t=c,s=!1,n=(c.x+e.x)/2,i=(c.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&n<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==c);return s}function _c(c,e){var t=new Ta(c.i,c.x,c.y),s=new Ta(e.i,e.x,e.y),n=c.next,i=e.prev;return c.next=e,e.prev=c,t.next=n,n.prev=t,s.next=t,t.prev=s,i.next=s,s.prev=i,s}function Ph(c,e,t,s){var n=new Ta(c,e,t);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function Ei(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Ta(c,e,t){this.i=c,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Xr.deviation=function(c,e,t,s){var n=e&&e.length,i=n?e[0]*t:c.length,r=Math.abs(ba(c,0,i,t));if(n)for(var o=0,l=e.length;o<l;o++){var u=e[o]*t,d=o<l-1?e[o+1]*t:c.length;r-=Math.abs(ba(c,u,d,t))}var f=0;for(o=0;o<s.length;o+=3){var m=s[o]*t,E=s[o+1]*t,w=s[o+2]*t;f+=Math.abs((c[m]-c[w])*(c[E+1]-c[m+1])-(c[m]-c[E])*(c[w+1]-c[m+1]))}return r===0&&f===0?0:Math.abs((f-r)/r)};function ba(c,e,t,s){for(var n=0,i=e,r=t-s;i<t;i+=s)n+=(c[r]-c[i])*(c[i+1]+c[r+1]),r=i;return n}Xr.flatten=function(c){for(var e=c[0][0].length,t={vertices:[],holes:[],dimensions:e},s=0,n=0;n<c.length;n++){for(var i=0;i<c[n].length;i++)for(var r=0;r<e;r++)t.vertices.push(c[n][i][r]);n>0&&(s+=c[n-1].length,t.holes.push(s))}return t};var zf=el.exports;const Yf=Dc(zf),Vf={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class On{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Gf=new Zs(-1,1,1,-1,0,1);class Hf extends De{constructor(){super(),this.setAttribute("position",new Fn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Fn([0,2,0,0,2,0],2))}}const jf=new Hf;class Uc{constructor(e){this._mesh=new re(jf,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Gf)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Bc extends On{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof ht?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Na.clone(e.uniforms),this.material=new ht({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Uc(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Oh extends On{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const n=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let r,o;this.inverse?(r=0,o=1):(r=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),i.buffers.stencil.setFunc(n.ALWAYS,r,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(n.EQUAL,1,4294967295),i.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),i.buffers.stencil.setLocked(!0)}}class Kf extends On{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Wf{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const s=e.getSize(new ke);this._width=s.width,this._height=s.height,t=new ls(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ha}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Bc(Vf),this.copyPass.material.blending=Qu,this.clock=new Lh}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let n=0,i=this.passes.length;n<i;n++){const r=this.passes[n];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),r.needsSwap){if(s){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}Oh!==void 0&&(r instanceof Oh?s=!0:r instanceof Kf&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ke);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(s,n),this.renderTarget2.setSize(s,n);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(s,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Xf extends On{constructor(e,t,s=null,n=null,i=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=n,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Et}render(e,t,s){const n=e.autoClear;e.autoClear=!1;let i,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(i),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=n}}const Ci=new De;Ci.setAttribute("position",new gt(new Float32Array([-1,-1,3,-1,-1,3]),2));Ci.setAttribute("uv",new gt(new Float32Array([0,0,2,0,0,2]),2));Ci.boundingSphere=new Xs;Ci.computeBoundingSphere=function(){};const Zf=new Zs;class Ar{constructor(e){this._mesh=new re(Ci,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,Zf)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const Qf={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new me},viewMat:{value:new me},projViewMat:{value:new me},projectionMatrixInv:{value:new me},viewMatrixInv:{value:new me},cameraPos:{value:new P},resolution:{value:new ke},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projViewMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},qf={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new me},viewMat:{value:new me},projectionMatrixInv:{value:new me},viewMatrixInv:{value:new me},cameraPos:{value:new P},resolution:{value:new ke},color:{value:new P(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform float radius;
    uniform float distanceFalloff;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);

        #ifdef HALFRES 
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

     
        float finalAo = pow(texel.a, intensity);
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},Jf={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new me},viewMat:{value:new me},projectionMatrixInv:{value:new me},viewMatrixInv:{value:new me},cameraPos:{value:new P},resolution:{value:new ke},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        occlusion /= count;
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},$f={uniforms:{sceneDepth:{value:null},resolution:{value:new ke},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new me},projectionMatrixInv:{value:new me},logDepth:{value:!1}},vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`};var kc="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";Uint8Array.from(atob(kc),c=>c.charCodeAt(0));const em=Uint8Array.from(atob(kc),c=>c.charCodeAt(0));function zc(c,e,t){if(e.getQueryParameter(c,e.QUERY_RESULT_AVAILABLE)){const s=e.getQueryParameter(c,e.QUERY_RESULT)/1e6;t.lastTime=s}else setTimeout(()=>{zc(c,e,t)},1)}class tm extends On{constructor(e,t,s=512,n=512){super(),this.width=s,this.height=n,this.clear=!0,this.camera=t,this.scene=e,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new Et(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0},{set:(i,r,o)=>{const l=i[r];return i[r]=o,r==="aoSamples"&&l!==o&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),r==="denoiseSamples"&&l!==o&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),r==="halfRes"&&l!==o&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),r==="depthAwareUpsampling"&&l!==o&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.beautyRenderTarget=new ls(this.width,this.height,{minFilter:Zn,magFilter:os}),this.beautyRenderTarget.depthTexture=new qu(this.width,this.height,Ju),this.beautyRenderTarget.depthTexture.format=$u,this.writeTargetInternal=new ls(this.width,this.height,{minFilter:Zn,magFilter:Zn,depthBuffer:!1}),this.readTargetInternal=new ls(this.width,this.height,{minFilter:Zn,magFilter:Zn,depthBuffer:!1}),this.bluenoise=new ed(em,128,128),this.bluenoise.colorSpace=td,this.bluenoise.wrapS=_l,this.bluenoise.wrapT=_l,this.bluenoise.minFilter=os,this.bluenoise.magFilter=os,this.bluenoise.needsUpdate=!0,this.lastTime=0,this._r=new ke,this._c=new Et}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new sd(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=nd,this.depthDownsampleTarget.texture[0].type=id,this.depthDownsampleTarget.texture[0].minFilter=os,this.depthDownsampleTarget.texture[0].magFilter=os,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=Vh,this.depthDownsampleTarget.texture[1].type=Ha,this.depthDownsampleTarget.texture[1].minFilter=os,this.depthDownsampleTarget.texture[1].magFilter=os,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new Ar(new ht($f))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);const t={...Qf};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new ht(t)):this.effectShaderQuad=new Ar(new ht(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...Jf};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new ht(t)):this.poissonBlurQuad=new Ar(new ht(t))}configureEffectCompositer(e=!1){const t={...qf};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new ht(t)):this.effectCompositerQuad=new Ar(new ht(t))}generateHemisphereSamples(e){const t=[];for(let s=0;s<e;s++){const n=2.399963*s,i=Math.sqrt(s+.5)/Math.sqrt(e),r=i*Math.cos(n),o=i*Math.sin(n),l=Math.sqrt(1-(r*r+o*o));t.push(new P(r,o,l))}return t}generateHemisphereSamplesR(e){let t=[];for(let s=0;s<e;s++)t.push((s+1)/e);return t}generateDenoiseSamples(e,t){const s=2*Math.PI*t/e,n=1/e,i=n,r=[];let o=n,l=0;for(let u=0;u<e;u++)r.push(new ke(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(o,.75))),o+=i,l+=s;return r}setSize(e,t){this.width=e,this.height=t;const s=this.configuration.halfRes?.5:1;this.beautyRenderTarget.setSize(e,t),this.writeTargetInternal.setSize(e*s,t*s),this.readTargetInternal.setSize(e*s,t*s),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*s,t*s)}render(e,t,s,n,i){e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer));let r,o,l;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera),this.debugMode&&(l=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,l));const u=e.xr.enabled;e.xr.enabled=!1,this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let d=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(d*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.position,this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=d,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let f=0;f<this.configuration.denoiseIterations;f++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.position,this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=d,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=f,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=d,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),e.setRenderTarget(this.renderToScreen?null:t),this.effectCompositerQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),zc(l,r,this)),e.xr.enabled=u}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}const sm={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`};function nm(){return new ht({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
    
       vec4 absPosition = vec4(position, 1.0);
       vec3 trueNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          trueNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       trueNormal = (normalize(modelMatrix * vec4(trueNormal, 0.))).xyz;
       
       vec3 planePosition = absPosition.xyz / 40.;
       float d = abs(dot(trueNormal, planePosition));
       vColor = vec4(abs(trueNormal), d);
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      gl_FragColor = vColor;
    }
    `})}function im(){return new ht({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
       
       vec4 absPosition = vec4(position, 1.0);
       vNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          vNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       vNormal = (normalize(modelMatrix * vec4(vNormal, 0.))).xyz;
       
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       vCameraPosition = cameraPosition;
       vPosition = absPosition.xyz;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      vec3 cameraPixelVec = normalize(vCameraPosition - vPosition);
      float difference = abs(dot(vNormal, cameraPixelVec));
      
      // This achieves a double gloss effect: when the surface is perpendicular and when it's parallel
      difference = abs((difference * 2.) - 1.);
      
      gl_FragColor = vec4(difference, difference, difference, 1.);
    }
    `})}class rm extends On{constructor(e,t,s,n,i){if(super(),T(this,"components"),T(this,"resolution"),T(this,"renderScene"),T(this,"renderCamera"),T(this,"fsQuad"),T(this,"normalOverrideMaterial"),T(this,"glossOverrideMaterial"),T(this,"planeBuffer"),T(this,"glossBuffer"),T(this,"outlineBuffer"),T(this,"excludedMeshes",[]),T(this,"outlinedMeshes",{}),T(this,"_outlineScene",new Qs),T(this,"_outlineEnabled",!1),T(this,"_lineColor",10066329),T(this,"_opacity",.4),T(this,"_tolerance",3),T(this,"_glossEnabled",!0),T(this,"_glossExponent",1.9),T(this,"_minGloss",-.1),T(this,"_maxGloss",.1),T(this,"_outlinesNeedsUpdate",!1),!s.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.renderScene=n,this.renderCamera=i,this.resolution=new ke(e.x,e.y),this.fsQuad=new Uc,this.fsQuad.material=this.createOutlinePostProcessMaterial(),this.planeBuffer=this.newRenderTarget(),this.glossBuffer=this.newRenderTarget(),this.outlineBuffer=this.newRenderTarget();const r=nm();r.clippingPlanes=s.renderer.clippingPlanes,this.normalOverrideMaterial=r;const o=im();o.clippingPlanes=s.renderer.clippingPlanes,this.glossOverrideMaterial=o}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this.fsQuad.material.uniforms.lineColor.value.set(e)}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e;const t=this.fsQuad.material;t.uniforms.tolerance.value=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;const t=this.fsQuad.material;t.uniforms.opacity.value=e}get glossEnabled(){return this._glossEnabled}set glossEnabled(e){if(e===this._glossEnabled)return;this._glossEnabled=e;const t=this.fsQuad.material;t.uniforms.glossEnabled.value=e?1:0}get glossExponent(){return this._glossExponent}set glossExponent(e){this._glossExponent=e;const t=this.fsQuad.material;t.uniforms.glossExponent.value=e}get minGloss(){return this._minGloss}set minGloss(e){this._minGloss=e;const t=this.fsQuad.material;t.uniforms.minGloss.value=e}get maxGloss(){return new Pt().color.convertLinearToSRGB(),this._maxGloss}set maxGloss(e){this._maxGloss=e;const t=this.fsQuad.material;t.uniforms.maxGloss.value=e}get outlineEnabled(){return this._outlineEnabled}set outlineEnabled(e){if(e===this._outlineEnabled)return;this._outlineEnabled=e;const t=this.fsQuad.material;t.uniforms.outlineEnabled.value=e?1:0}async dispose(){this.planeBuffer.dispose(),this.glossBuffer.dispose(),this.outlineBuffer.dispose(),this.normalOverrideMaterial.dispose(),this.glossOverrideMaterial.dispose(),this.fsQuad.dispose(),this.excludedMeshes=[],this._outlineScene.children=[];const e=this.components.get(us);for(const t in this.outlinedMeshes){const s=this.outlinedMeshes[t];for(const n of s.meshes)e.destroy(n,!0,!0);s.material.dispose()}}setSize(e,t){this.planeBuffer.setSize(e,t),this.glossBuffer.setSize(e,t),this.outlineBuffer.setSize(e,t),this.resolution.set(e,t),this.fsQuad.material.uniforms.screenSize.value.set(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}render(e,t,s){const n=t.depthBuffer;t.depthBuffer=!1;const i=this.renderScene.overrideMaterial,r=this.renderScene.background;this.renderScene.background=null;for(const l of this.excludedMeshes)l.visible=!1;if(e.setRenderTarget(this.planeBuffer),this.renderScene.overrideMaterial=this.normalOverrideMaterial,e.render(this.renderScene,this.renderCamera),this._glossEnabled&&(e.setRenderTarget(this.glossBuffer),this.renderScene.overrideMaterial=this.glossOverrideMaterial,e.render(this.renderScene,this.renderCamera)),this.renderScene.overrideMaterial=i,this._outlineEnabled){let l=!1;for(const u in this.outlinedMeshes){const d=this.outlinedMeshes[u];for(const f of d.meshes)l=!0,f.userData.materialPreOutline=f.material,f.material=d.material,f.userData.groupsPreOutline=f.geometry.groups,f.geometry.groups=[],f instanceof Ot&&(f.userData.colorPreOutline=f.instanceColor,f.instanceColor=null),f.userData.parentPreOutline=f.parent,this._outlineScene.add(f)}(l||this._outlinesNeedsUpdate)&&(e.setRenderTarget(this.outlineBuffer),e.render(this._outlineScene,this.renderCamera),this._outlinesNeedsUpdate=l);for(const u in this.outlinedMeshes){const d=this.outlinedMeshes[u];for(const f of d.meshes)f.material=f.userData.materialPreOutline,f.geometry.groups=f.userData.groupsPreOutline,f instanceof Ot&&(f.instanceColor=f.userData.colorPreOutline),f.userData.parentPreOutline&&f.userData.parentPreOutline.add(f),f.userData.materialPreOutline=void 0,f.userData.groupsPreOutline=void 0,f.userData.colorPreOutline=void 0,f.userData.parentPreOutline=void 0}}for(const l of this.excludedMeshes)l.visible=!0;this.renderScene.background=r;const o=this.fsQuad.material;o.uniforms.planeBuffer.value=this.planeBuffer.texture,o.uniforms.glossBuffer.value=this.glossBuffer.texture,o.uniforms.outlineBuffer.value=this.outlineBuffer.texture,o.uniforms.sceneColorBuffer.value=s.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.fsQuad.render(e)),t.depthBuffer=n}get vertexShader(){return`
	  varying vec2 vUv;
	  void main() {
	  	vUv = uv;
	  	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	  }
	`}get fragmentShader(){return`
	  uniform sampler2D sceneColorBuffer;
	  uniform sampler2D planeBuffer;
	  uniform sampler2D glossBuffer;
	  uniform sampler2D outlineBuffer;
	  uniform vec4 screenSize;
	  uniform vec3 lineColor;
	  
	  uniform float outlineEnabled;
	  
      uniform int width;
	  uniform float opacity;
      uniform float tolerance;
      uniform float glossExponent;
      uniform float minGloss;
      uniform float maxGloss;
      uniform float glossEnabled;

	  varying vec2 vUv;

	  vec4 getValue(sampler2D buffer, int x, int y) {
	  	return texture2D(buffer, vUv + screenSize.zw * vec2(x, y));
	  }

      float normalDiff(vec3 normal1, vec3 normal2) {
        return ((dot(normal1, normal2) - 1.) * -1.) / 2.;
      }

      // Returns 0 if it's background, 1 if it's not
      float getIsBackground(vec3 normal) {
        float background = 1.0;
        background *= step(normal.x, 0.);
        background *= step(normal.y, 0.);
        background *= step(normal.z, 0.);
        background = (background - 1.) * -1.;
        return background;
      }

	  void main() {
	  
	    vec4 sceneColor = getValue(sceneColorBuffer, 0, 0);
	    vec3 normSceneColor = normalize(sceneColor.rgb);
  
        vec4 plane = getValue(planeBuffer, 0, 0);
	    vec3 normal = plane.xyz;
        float distance = plane.w;
  
        vec3 normalTop = getValue(planeBuffer, 0, width).rgb;
        vec3 normalBottom = getValue(planeBuffer, 0, -width).rgb;
        vec3 normalRight = getValue(planeBuffer, width, 0).rgb;
        vec3 normalLeft = getValue(planeBuffer, -width, 0).rgb;
        vec3 normalTopRight = getValue(planeBuffer, width, width).rgb;
        vec3 normalTopLeft = getValue(planeBuffer, -width, width).rgb;
        vec3 normalBottomRight = getValue(planeBuffer, width, -width).rgb;
        vec3 normalBottomLeft = getValue(planeBuffer, -width, -width).rgb;
  
        float distanceTop = getValue(planeBuffer, 0, width).a;
        float distanceBottom = getValue(planeBuffer, 0, -width).a;
        float distanceRight = getValue(planeBuffer, width, 0).a;
        float distanceLeft = getValue(planeBuffer, -width, 0).a;
        float distanceTopRight = getValue(planeBuffer, width, width).a;
        float distanceTopLeft = getValue(planeBuffer, -width, width).a;
        float distanceBottomRight = getValue(planeBuffer, width, -width).a;
        float distanceBottomLeft = getValue(planeBuffer, -width, -width).a;
        
        vec3 sceneColorTop = normalize(getValue(sceneColorBuffer, 1, 0).rgb);
        vec3 sceneColorBottom = normalize(getValue(sceneColorBuffer, -1, 0).rgb);
        vec3 sceneColorLeft = normalize(getValue(sceneColorBuffer, 0, -1).rgb);
        vec3 sceneColorRight = normalize(getValue(sceneColorBuffer, 0, 1).rgb);
        vec3 sceneColorTopRight = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomRight = normalize(getValue(sceneColorBuffer, -1, 1).rgb);
        vec3 sceneColorTopLeft = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomLeft = normalize(getValue(sceneColorBuffer, -1, 1).rgb);

        // Checks if the planes of this texel and the neighbour texels are different

        float planeDiff = 0.0;

        planeDiff += step(0.001, normalDiff(normal, normalTop));
        planeDiff += step(0.001, normalDiff(normal, normalBottom));
        planeDiff += step(0.001, normalDiff(normal, normalLeft));
        planeDiff += step(0.001, normalDiff(normal, normalRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopLeft));
        planeDiff += step(0.001, normalDiff(normal, normalBottomRight));
        planeDiff += step(0.001, normalDiff(normal, normalBottomLeft));
        
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTop));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottom));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorRight));
       	planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomLeft));

        planeDiff += step(0.001, abs(distance - distanceTop));
        planeDiff += step(0.001, abs(distance - distanceBottom));
        planeDiff += step(0.001, abs(distance - distanceLeft));
        planeDiff += step(0.001, abs(distance - distanceRight));
        planeDiff += step(0.001, abs(distance - distanceTopRight));
        planeDiff += step(0.001, abs(distance - distanceTopLeft));
        planeDiff += step(0.001, abs(distance - distanceBottomRight));
        planeDiff += step(0.001, abs(distance - distanceBottomLeft));

        // Add extra background outline

        int width2 = width + 1;
        vec3 normalTop2 = getValue(planeBuffer, 0, width2).rgb;
        vec3 normalBottom2 = getValue(planeBuffer, 0, -width2).rgb;
        vec3 normalRight2 = getValue(planeBuffer, width2, 0).rgb;
        vec3 normalLeft2 = getValue(planeBuffer, -width2, 0).rgb;
        vec3 normalTopRight2 = getValue(planeBuffer, width2, width2).rgb;
        vec3 normalTopLeft2 = getValue(planeBuffer, -width2, width2).rgb;
        vec3 normalBottomRight2 = getValue(planeBuffer, width2, -width2).rgb;
        vec3 normalBottomLeft2 = getValue(planeBuffer, -width2, -width2).rgb;

        planeDiff += -(getIsBackground(normalTop2) - 1.);
        planeDiff += -(getIsBackground(normalBottom2) - 1.);
        planeDiff += -(getIsBackground(normalRight2) - 1.);
        planeDiff += -(getIsBackground(normalLeft2) - 1.);
        planeDiff += -(getIsBackground(normalTopRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomLeft2) - 1.);

        // Tolerance sets the minimum amount of differences to consider
        // this texel an edge

        float line = step(tolerance, planeDiff);

        // Exclude background and apply opacity

        float background = getIsBackground(normal);
        line *= background;
        line *= opacity;
        
        // Add gloss
        
        vec3 gloss = getValue(glossBuffer, 0, 0).xyz;
        float diffGloss = abs(maxGloss - minGloss);
        vec3 glossExpVector = vec3(glossExponent,glossExponent,glossExponent);
        gloss = min(pow(gloss, glossExpVector), vec3(1.,1.,1.));
        gloss *= diffGloss;
        gloss += minGloss;
        vec4 glossedColor = sceneColor + vec4(gloss, 1.) * glossEnabled;
        
        vec4 corrected = mix(sceneColor, glossedColor, background);
        
        // Draw lines
        
        corrected = mix(corrected, vec4(lineColor, 1.), line);
        
        // Add outline
        
        vec4 outlinePreview =getValue(outlineBuffer, 0, 0);
        float outlineColorCorrection = 1. / max(0.2, outlinePreview.a);
        vec3 outlineColor = outlinePreview.rgb * outlineColorCorrection;
        
        // thickness between 10 and 2, opacity between 1 and 0.2
	    int outlineThickness = int(outlinePreview.a * 10.);
	    
	    float outlineDiff = 0.;
        
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, -outlineThickness).a);
        
        float outLine = step(4., outlineDiff) * step(outlineDiff, 12.) * outlineEnabled;
        corrected = mix(corrected, vec4(outlineColor, 1.), outLine);
        
        gl_FragColor = corrected;
	}
			`}createOutlinePostProcessMaterial(){return new ht({uniforms:{opacity:{value:this._opacity},debugVisualize:{value:0},sceneColorBuffer:{value:null},tolerance:{value:this._tolerance},planeBuffer:{value:null},glossBuffer:{value:null},outlineBuffer:{value:null},glossEnabled:{value:1},minGloss:{value:this._minGloss},maxGloss:{value:this._maxGloss},outlineEnabled:{value:0},glossExponent:{value:this._glossExponent},width:{value:1},lineColor:{value:new Et(this._lineColor)},screenSize:{value:new Rn(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}newRenderTarget(){const e=new ls(this.resolution.x,this.resolution.y);return e.texture.colorSpace="srgb-linear",e.texture.format=Vh,e.texture.type=Ha,e.texture.minFilter=os,e.texture.magFilter=os,e.texture.generateMipmaps=!1,e.stencilBuffer=!1,e}}class om{constructor(e,t,s){if(T(this,"overrideClippingPlanes",!1),T(this,"composer"),T(this,"_enabled",!1),T(this,"_initialized",!1),T(this,"_n8ao"),T(this,"_customEffects"),T(this,"_basePass"),T(this,"_gammaPass"),T(this,"_depthTexture"),T(this,"_settings",{gamma:!0,custom:!0,ao:!1}),T(this,"_renderer"),T(this,"_components"),T(this,"_world"),T(this,"_renderTarget"),!s.renderer)throw new Error("The given world must have a renderer!");this._components=e,this._renderer=t,this._world=s,this._renderTarget=new ls(window.innerWidth,window.innerHeight),this._renderTarget.texture.colorSpace="srgb-linear",this.composer=new Wf(t,this._renderTarget),this.composer.setSize(window.innerWidth,window.innerHeight)}get basePass(){if(!this._basePass)throw new Error("Custom effects not initialized!");return this._basePass}get gammaPass(){if(!this._gammaPass)throw new Error("Custom effects not initialized!");return this._gammaPass}get customEffects(){if(!this._customEffects)throw new Error("Custom effects not initialized!");return this._customEffects}get n8ao(){if(!this._n8ao)throw new Error("Custom effects not initialized!");return this._n8ao}get enabled(){return this._enabled}set enabled(e){this._initialized||this.initialize(),this._enabled=e}get settings(){return{...this._settings}}dispose(){var e,t,s,n;this._renderTarget.dispose(),(e=this._depthTexture)==null||e.dispose(),(t=this._customEffects)==null||t.dispose(),(s=this._gammaPass)==null||s.dispose(),(n=this._n8ao)==null||n.dispose()}setPasses(e){let t=!1;for(const s in e){const n=s;if(this.settings[n]!==e[n]){t=!0;break}}if(t){for(const s in e){const n=s;this._settings[n]!==void 0&&(this._settings[n]=e[n])}this.updatePasses()}}setSize(e,t){this._initialized&&(this.composer.setSize(e,t),this.basePass.setSize(e,t),this.n8ao.setSize(e,t),this.customEffects.setSize(e,t),this.gammaPass.setSize(e,t))}update(){this._enabled&&this.composer.render()}updateCamera(){const e=this._world.camera.three;this._n8ao&&(this._n8ao.camera=e),this._customEffects&&(this._customEffects.renderCamera=e),this._basePass&&(this._basePass.camera=e)}initialize(){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const e=this._world.scene.three,t=this._world.camera.three;if(!(e instanceof Qs))throw new Error("The given scene must have a THREE.Scene as core!");this._world.camera instanceof of&&this._world.camera.projection.onChanged.add(()=>{this.updateCamera()});const s=this._world.renderer;this.overrideClippingPlanes||(this._renderer.clippingPlanes=s.clippingPlanes),this._renderer.outputColorSpace="srgb",this._renderer.toneMapping=Zu,this.newBasePass(e,t),this.newSaoPass(e,t),this.newGammaPass(),this.newCustomPass(e,t),this._initialized=!0,this.updatePasses()}updateProjection(e){this.composer.passes.forEach(t=>{t.camera=e}),this.update()}updatePasses(){for(const e of this.composer.passes)this.composer.removePass(e);this._basePass&&this.composer.addPass(this.basePass),this._settings.gamma&&this.composer.addPass(this.gammaPass),this._settings.ao&&this.composer.addPass(this.n8ao),this._settings.custom&&this.composer.addPass(this.customEffects)}newCustomPass(e,t){this._customEffects=new rm(new ke(window.innerWidth,window.innerHeight),this._components,this._world,e,t)}newGammaPass(){this._gammaPass=new Bc(sm)}newSaoPass(e,t){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const{width:s,height:n}=this._world.renderer.getSize();this._n8ao=new tm(e,t,s,n);const{configuration:i}=this._n8ao;i.aoSamples=16,i.denoiseSamples=1,i.denoiseRadius=13,i.aoRadius=1,i.distanceFalloff=4,i.aoRadius=1,i.intensity=4,i.halfRes=!0,i.color=new Et().setHex(13421772,"srgb-linear")}newBasePass(e,t){this._basePass=new Xf(e,t)}}class Aa extends bf{constructor(e,t,s){super(e,t,s),T(this,"_postproduction"),this.onResize.add(n=>this.resizePostproduction(n)),this.onWorldChanged.add(()=>{this.currentWorld&&(this._postproduction&&this._postproduction.dispose(),this._postproduction=new om(e,this.three,this.currentWorld),this.setPostproductionSize())})}get postproduction(){if(!this._postproduction)throw new Error("Renderer not initialized yet with a world!");return this._postproduction}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger();const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.postproduction.enabled?this.postproduction.composer.render():this.three.render(e,t),e instanceof Qs&&this.three2D.render(e,t),this.onAfterUpdate.trigger()}dispose(){super.dispose(),this.postproduction.dispose()}resizePostproduction(e){this.postproduction&&this.setPostproductionSize(e)}setPostproductionSize(e){if(!this.container)return;const t=e?e.x:this.container.clientWidth,s=e?e.y:this.container.clientHeight;this.postproduction.setSize(t,s)}}class am{constructor(e,t,s,n){T(this,"mesh",new re(new De)),T(this,"world"),T(this,"styleName"),T(this,"_precission",1e4),T(this,"_tempVector",new P),T(this,"_plane"),T(this,"_geometry"),T(this,"_plane2DCoordinateSystem",new me),T(this,"_planeAxis"),this.world=e,this.mesh.material=n,this.mesh.frustumCulled=!1,this._plane=t;const{x:i,y:r,z:o}=t.normal;Math.abs(i)===1?this._planeAxis="x":Math.abs(r)===1?this._planeAxis="y":Math.abs(o)===1&&(this._planeAxis="z"),this._geometry=s,this.mesh.geometry.attributes.position=s.attributes.position;const l=t.normal.clone().multiplyScalar(.01);this.mesh.position.copy(l),this.visible=!0}get visible(){return this.mesh.parent!==null}set visible(e){const t=this.getStyle();e?(this.world.scene.three.add(this.mesh),t&&t.meshes.add(this.mesh)):(this.mesh.removeFromParent(),t&&t.meshes.delete(this.mesh))}set geometry(e){this._geometry=e,this.mesh.geometry.attributes.position=e.attributes.position}dispose(){const e=this.getStyle();e&&e.meshes.delete(this.mesh),this.mesh.geometry.dispose(),this.mesh.removeFromParent(),this.mesh.geometry=null,this.mesh=null,this._plane=null,this._geometry=null}update(e){const t=this._geometry.attributes.position.array;if(!t)return;this.updatePlane2DCoordinateSystem();const s=[];let n=0;for(let i=0;i<e.length;i++){const r=e[i],o=[];for(let u=n;u<r;u+=2)o.push(u*3);const l=this.computeFill(o,t);for(const u of l)s.push(u);n=r}this.mesh.geometry.setIndex(s)}computeFill(e,t){const s=new Map,n={},i=new Map;let r=0;const o=new Map,l=new Map,u=new Set,d=this._precission;for(let m=0;m<e.length;m++){const E=e[m];let w=0,y=0,A=0,S=0;const x=t[E],R=t[E+1],C=t[E+2],M=t[E+3],k=t[E+4],G=t[E+5];if(this._tempVector.set(x,R,C),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),w=Math.trunc(this._tempVector.x*d)/d,y=Math.trunc(this._tempVector.y*d)/d,this._tempVector.set(M,k,G),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),A=Math.trunc(this._tempVector.x*d)/d,S=Math.trunc(this._tempVector.y*d)/d,w===A&&y===S)continue;const H=`${w}|${y}`,W=`${A}|${S}`;s.has(H)||s.set(H,E/3),s.has(W)||s.set(W,E/3+1);const Z=s.get(H),J=s.get(W);n[Z]=[w,y],n[J]=[A,S];const te=l.has(Z),se=o.has(Z),ue=l.has(J),we=o.has(J);if(!te&&!se&&!ue&&!we)l.set(Z,r),o.set(J,r),u.add(r),i.set(r,[Z,J]),r++;else if(te&&we){const ce=l.get(Z),ge=o.get(J);if(ce!==ge){const pe=i.get(ge),Ie=i.get(ce);if(!pe||!Ie)continue;i.delete(ce),u.delete(ce),o.set(Ie[Ie.length-1],ge),o.delete(pe[pe.length-1]);for(const je of Ie)pe.push(je)}else u.delete(ge);l.delete(Z),o.delete(J)}else if(se&&ue){const ce=l.get(J),ge=o.get(Z);if(ce!==ge){const pe=i.get(ge),Ie=i.get(ce);if(!pe||!Ie)continue;i.delete(ce),u.delete(ce),o.set(Ie[Ie.length-1],ge),o.delete(pe[pe.length-1]);for(const je of Ie)pe.push(je)}else u.delete(ge);l.delete(J),o.delete(Z)}else if(te&&ue){const ce=l.get(J),ge=l.get(Z),pe=i.get(ge),Ie=i.get(ce);if(!pe||!Ie)continue;i.delete(ce),u.delete(ce),l.delete(pe[0]),l.delete(Ie[0]),o.delete(Ie[Ie.length-1]),l.set(Ie[Ie.length-1],ge),Ie.reverse(),pe.splice(0,0,...Ie)}else if(se&&we){const ce=o.get(J),ge=o.get(Z),pe=i.get(ge),Ie=i.get(ce);if(!pe||!Ie)continue;i.delete(ce),u.delete(ce),o.delete(pe[pe.length-1]),o.delete(Ie[Ie.length-1]),l.delete(Ie[0]),o.set(Ie[0],ge),Ie.reverse(),pe.push(...Ie)}else if(te){const ce=l.get(Z),ge=i.get(ce);if(!ge)continue;ge.unshift(J),l.delete(Z),l.set(J,ce)}else if(se){const ce=o.get(Z),ge=i.get(ce);if(!ge)continue;ge.push(J),o.delete(Z),o.set(J,ce)}else if(ue){const ce=l.get(J),ge=i.get(ce);if(!ge)continue;ge.unshift(Z),l.delete(J),l.set(Z,ce)}else if(we){const ce=o.get(J),ge=i.get(ce);if(!ge)continue;ge.push(Z),o.delete(J),o.set(Z,ce)}}const f=[];for(const[m,E]of i){if(u.has(m))continue;const w=[],y=new Map;let A=0;for(const x of E){const R=n[x];w.push(R[0],R[1]),y.set(A++,x)}const S=Yf(w);for(const x of S){const R=y.get(x);if(R===void 0)throw new Error("Map error!");f.push(R)}}return f}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new me;const e=new P(1,0,0),t=new P(0,1,0),s=this._plane.normal,n=new P;this._plane.coplanarPoint(n),this._planeAxis==="x"?e.crossVectors(t,s):this._planeAxis==="y"?t.crossVectors(s,e):this._planeAxis==="z"||(e.crossVectors(t,s).normalize(),t.crossVectors(s,e)),this._plane2DCoordinateSystem.fromArray([e.x,e.y,e.z,0,t.x,t.y,t.z,0,s.x,s.y,s.z,0,n.x,n.y,n.z,1]),this._plane2DCoordinateSystem.invert()}getStyle(){if(!this.world.renderer)return null;const e=this.world.renderer instanceof Aa;return this.styleName&&e?this.world.renderer.postproduction.customEffects.outlinedMeshes[this.styleName]:null}}class lm{constructor(e,t,s){T(this,"onDisposed",new $),T(this,"onAfterUpdate",new $),T(this,"onBeforeUpdate",new $),T(this,"enabled",!0),T(this,"fillNeedsUpdate",!1),T(this,"components"),T(this,"world"),T(this,"_edges",{}),T(this,"_visible",!0),T(this,"_inverseMatrix",new me),T(this,"_localPlane",new Fs),T(this,"_tempLine",new It),T(this,"_tempVector",new P),T(this,"_plane"),this.components=e,this.world=t,this._plane=s}get visible(){return this._visible}set visible(e){for(const t in this._edges){const s=this._edges[t];e?this.world.scene.three.add(s.mesh):s.mesh.removeFromParent(),s.fill&&(s.fill.visible=e)}}update(){const e=this.components.get(Sr).styles.list;this.updateDeletedEdges(e);for(const t in e)this.drawEdges(t);this.fillNeedsUpdate=!1}get(){return this._edges}dispose(){const e=Object.keys(this._edges);for(const t of e)this.disposeEdge(t);this.onDisposed.trigger(),this.onDisposed.reset()}newEdgesMesh(e){const t=this.components.get(Sr).styles.list[e].lineMaterial,s=new De,n=new Float32Array(3e5),i=new gt(n,3,!1);i.setUsage(Wu),s.setAttribute("position",i);const r=new Xu(s,t);return r.frustumCulled=!1,r}newFillMesh(e,t){const s=this.components.get(Sr).styles.list[e],n=s.fillMaterial;if(n){const i=new am(this.world,this._plane,t,n);return this.newFillOutline(e,i,s),i}}newFillOutline(e,t,s){if(!s.outlineMaterial||!this.world.renderer)return;const n=this.world.renderer;if(n instanceof Aa){const i=n.postproduction.customEffects.outlinedMeshes;i[e]||(i[e]={meshes:new Set,material:s.outlineMaterial}),t.styleName=e}}drawEdges(e){const t=this.components.get(Sr).styles.list[e];this._edges[e]||this.initializeStyle(e);const s=this._edges[e];let n=0;const i=s.mesh.geometry.attributes.position;i.array.fill(0);const r=[];let o=0;for(const u of t.meshes)if(u.geometry){if(!u.geometry.boundsTree)throw new Error("Bounds tree not found for clipping edges subset.");if(u instanceof Ot){if(u.count===0)continue;const d=u;for(let f=0;f<d.count;f++){const m=d instanceof Nh,E=d,w=t.fragments[E.fragment.id];if(m&&w){const S=E.fragment.getItemID(f);if(S===null||!w.has(S))continue}const y=new re(u.geometry);y.matrix.copy(u.matrix);const A=new me;d.getMatrixAt(f,A),y.applyMatrix4(A),y.applyMatrix4(u.matrix),y.updateMatrix(),y.updateMatrixWorld(),this._inverseMatrix.copy(y.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),n=this.shapecast(y,i,n),n!==o&&(r.push(n),o=n)}}else this._inverseMatrix.copy(u.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),n=this.shapecast(u,i,n),n!==o&&(r.push(n),o=n)}s.mesh.geometry.setDrawRange(0,n),s.mesh.position.copy(this._plane.normal).multiplyScalar(1e-4),i.needsUpdate=!0;const l=s.mesh.geometry.attributes.position;Number.isNaN(l.array[0])||(s.mesh.parent||this.world.scene.three.add(s.mesh),this.fillNeedsUpdate&&s.fill&&(s.fill.geometry=s.mesh.geometry,s.fill.update(r)))}initializeStyle(e){const t=this.newEdgesMesh(e),s=t.geometry,n=this.newFillMesh(e,s);this._edges[e]={mesh:t,name:e,fill:n}}shapecast(e,t,s){return e.geometry.boundsTree.shapecast({intersectsBounds:n=>this._localPlane.intersectsBox(n),intersectsTriangle:n=>{let i=0;if(this._tempLine.start.copy(n.a),this._tempLine.end.copy(n.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),i++,s++}if(this._tempLine.start.copy(n.b),this._tempLine.end.copy(n.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),i++,s++}if(this._tempLine.start.copy(n.c),this._tempLine.end.copy(n.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),i++,s++}i!==2&&(s-=i)}}),s}updateDeletedEdges(e){const t=Object.keys(this._edges);for(const s of t)e[s]===void 0&&(this.disposeEdge(s),this.disposeOutline(s))}disposeOutline(e){if(!this.world.renderer)return;const t=this.world.renderer;if(t instanceof Aa){const s=t.postproduction.customEffects.outlinedMeshes;delete s[e]}}disposeEdge(e){const t=this.components.get(us),s=this._edges[e];s.fill&&s.fill.dispose(),t.destroy(s.mesh,!1),delete this._edges[e]}}class vi extends Wr{constructor(e,t,s,n,i,r=5,o=!0){super(e,t,s,n,i,r,o),T(this,"edges"),T(this,"edgesMaxUpdateRate",50),T(this,"_visible",!0),T(this,"_edgesVisible",!0),T(this,"updateFill",()=>{this.edges.fillNeedsUpdate=!0,this.edges.update(),this.edges.visible=this._visible}),this.edges=new lm(e,t,this.three),this.toggleControls(!0),this.edges.visible=!0,this.onDraggingEnded.add(()=>{this.updateFill()}),this.onDraggingStarted.add(()=>this.edges.visible=!1)}get visible(){return this._visible}set visible(e){super.visible=e,this.toggleControls(e)}set enabled(e){this._enabled=e,this.world.renderer&&this.world.renderer.setPlane(e,this.three)}get enabled(){return super.enabled}dispose(){super.dispose(),this.edges.dispose()}}class hm{constructor(){T(this,"onDisposed",new $),T(this,"enabled",!0),T(this,"list",{}),T(this,"_defaultLineMaterial",new xs({color:0,linewidth:.001})),T(this,"onAfterUpdate",new $),T(this,"onBeforeUpdate",new $)}update(e){this.onBeforeUpdate.trigger(this.list),this.onAfterUpdate.trigger(this.list)}create(e,t,s,n,i,r){if(!s.renderer)throw new Error("The given world doesn't have a renderer!");n||(n=this._defaultLineMaterial);for(const u of t)u.geometry.boundsTree||u.geometry.computeBoundsTree();const o=s.renderer;n.clippingPlanes=o.clippingPlanes;const l={name:e,lineMaterial:n,meshes:t,fillMaterial:i,outlineMaterial:r,fragments:{}};return this.list[e]=l,l}dispose(){const e=Object.keys(this.list);for(const t of e)this.deleteStyle(t);this.list={},this.onDisposed.trigger(),this.onDisposed.reset()}deleteStyle(e,t=!0){var s,n;const i=this.list[e];i&&(i.meshes.clear(),t&&(i.lineMaterial.dispose(),(s=i.fillMaterial)==null||s.dispose(),(n=i.outlineMaterial)==null||n.dispose())),delete this.list[e]}}const Yc=class Vc extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"enabled",!0),T(this,"styles"),T(this,"fillsNeedUpdate",!1),T(this,"_visible",!0),this.components.list.set(Vc.uuid,this),this.styles=new hm}get visible(){return this._visible}set visible(e){this._visible=e;const t=this.components.get(Ur);for(const s of t.list)s instanceof vi&&(s.edges.visible=e)}dispose(){this.styles.dispose(),this.onDisposed.trigger()}async update(e=!1){if(!this.enabled)return;const t=this.components.get(Ur);for(const s of t.list)s instanceof vi&&(e||this.fillsNeedUpdate?s.updateFill():s.update());this.fillsNeedUpdate=!1}};T(Yc,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let Sr=Yc;const cm={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},um={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},dm=class Tn extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"enabled",!0),T(this,"cameraHeight",10),T(this,"darkness",1.2),T(this,"opacity",1),T(this,"resolution",512),T(this,"amount",3.5),T(this,"planeColor",16777215),T(this,"shadowOffset",0),T(this,"shadowExtraScaleFactor",1.5),T(this,"list",{}),T(this,"tempMaterial",new Pt({visible:!1})),T(this,"depthMaterial",new Yh),this.components.add(Tn.uuid,this),this.initializeDepthMaterial()}dispose(){for(const e in this.list)this.deleteShadow(e);this.tempMaterial.dispose(),this.depthMaterial.dispose(),this.components=null,this.onDisposed.trigger(Tn.uuid),this.onDisposed.reset()}create(e,t,s){if(this.list[t])throw new Error(`There is already a shadow with ID ${t}`);const{size:n,center:i,min:r}=this.getSizeCenterMin(e),o=this.createShadow(t,n,s);return this.initializeShadow(o,i,r),this.createPlanes(o,n),this.bakeShadow(e,o),o.root}deleteShadow(e){const t=this.components.get(us),s=this.list[e];if(delete this.list[e],!s)throw new Error(`No shadow with ID ${e} was found.`);t.destroy(s.root),t.destroy(s.blurPlane),s.rt.dispose(),s.rtBlur.dispose()}createPlanes(e,t){const s=new Gr(t.x,t.z).rotateX(Math.PI/2);this.createBasePlane(e,s),Tn.createBlurPlane(e,s)}initializeShadow(e,t,s){this.initializeRoot(e,t,s),Tn.initializeRenderTargets(e),Tn.initializeCamera(e)}bakeShadow(e,t){const s=t.world.scene.three;if(!(s instanceof Qs))throw new Error("The core of the scene of the world must be a scene!");if(!t.world.renderer)throw new Error("The given world must have a renderer!");const n=t.world.renderer.three,i=e.map(u=>!!u.parent);for(let u=0;u<e.length;u++)i[u]||s.add(e[u]);const r=s.children.filter(u=>!e.includes(u)&&u!==t.root);for(let u=r.length-1;u>=0;u--)s.remove(r[u]);const o=s.background;s.background=null,s.overrideMaterial=this.depthMaterial;const l=[];for(const u of e)l.push(u.visible),u.visible=!0;n.setRenderTarget(t.rt),n.render(s,t.camera),s.overrideMaterial=null,this.blurShadow(t,this.amount),this.blurShadow(t,this.amount*.4),n.setRenderTarget(null),s.background=o;for(let u=0;u<e.length;u++)e[u].visible=l[u];for(let u=r.length-1;u>=0;u--)s.add(r[u]);for(let u=0;u<e.length;u++)i[u]||s.remove(e[u])}static initializeCamera(e){e.camera.rotation.x=Math.PI/2,e.root.add(e.camera)}static initializeRenderTargets(e){e.rt.texture.generateMipmaps=!1,e.rtBlur.texture.generateMipmaps=!1}initializeRoot(e,t,s){const n=e.world.scene.three;e.root.position.set(t.x,s.y-this.shadowOffset,t.z),n.add(e.root)}createBasePlane(e,t){const s=this.createPlaneMaterial(e),n=new re(t,s);n.renderOrder=2,e.root.add(n),n.scale.y=-1}static createBlurPlane(e,t){e.blurPlane.geometry=t,e.blurPlane.visible=!1,e.root.add(e.blurPlane)}createPlaneMaterial(e){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const t=e.world.renderer.three;return new Pt({map:e.rt.texture,opacity:this.opacity,transparent:!0,depthWrite:!1,clippingPlanes:t.clippingPlanes})}initializeDepthMaterial(){this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1;const e="gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );",t="gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );";this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.onBeforeCompile=s=>{s.uniforms.darkness=this.depthMaterial.userData.darkness,s.fragmentShader=`
						uniform float darkness;
						${s.fragmentShader.replace(e,t)}
					`}}createShadow(e,t,s){return this.list[e]={root:new Nr,world:s,rt:new ls(this.resolution,this.resolution),rtBlur:new ls(this.resolution,this.resolution),blurPlane:new re,camera:this.createCamera(t)},this.list[e]}createCamera(e){return new Zs(-e.x/2,e.x/2,e.z/2,-e.z/2,0,this.cameraHeight)}getSizeCenterMin(e){const t=e[0].parent,s=new Nr;s.children=e;const n=new Ue().setFromObject(s);t==null||t.add(...e);const i=new P;n.getSize(i),i.x*=this.shadowExtraScaleFactor,i.z*=this.shadowExtraScaleFactor;const r=new P;n.getCenter(r);const o=n.min;return{size:i,center:r,min:o}}blurShadow(e,t){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const s=new ht(cm);s.depthTest=!1;const n=new ht(um);n.depthTest=!1,e.blurPlane.visible=!0,e.blurPlane.material=s,e.blurPlane.material.uniforms.tDiffuse.value=e.rt.texture,s.uniforms.h.value=t*1/256;const i=e.world.renderer.three;i.setRenderTarget(e.rtBlur),i.render(e.blurPlane,e.camera),e.blurPlane.material=n,e.blurPlane.material.uniforms.tDiffuse.value=e.rtBlur.texture,n.uniforms.v.value=t*1/256,i.setRenderTarget(e.rt),i.render(e.blurPlane,e.camera),e.blurPlane.visible=!1}};T(dm,"uuid","f833a09a-a3ab-4c58-b03e-da5298c7a1b6");const pm=["Station","Radius","Length","InitialKP","FinalKP","KP","Slope","Height","InitialKPV","FinalKPV"],Gc=class Hc extends Fe{constructor(e){super(e),T(this,"enabled",!0),T(this,"world",null),T(this,"list",new Map),T(this,"_markerKey",0),T(this,"type","horizontal"),T(this,"divisionLength",100),e.add(Hc.uuid,this)}addKPStation(e,t,s){const n=this.components.get(Ys),i=document.createElement("div"),r=document.createElement("div");i.appendChild(r),r.innerHTML=t,r.style.color=n.color,r.style.borderBottom="1px dotted white",r.style.width="160px",r.style.textAlign="left";const o=new mt(e,i),l=new P;l.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),l.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),l.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);const u=new P;u.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-2),u.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-2),u.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-2);const d=new P;d.x=(l.x+u.x)/2,d.y=(l.y+u.y)/2,d.z=(l.z+u.z)/2,o.three.position.copy(d);const f=new P;f.subVectors(l,u).normalize();const m=new At;m.setFromUnitVectors(new P(0,1,0),f);const E=new Dh().setFromQuaternion(m).z,w=yi.radToDeg(E);r.style.transform=`rotate(${-w-90}deg) translate(-35%, -50%)`;const y=this._markerKey.toString();n.list.set(y,{label:o,key:y,merged:!1,static:!1}),this._markerKey++,this.save(y,"KP")}addVerticalMarker(e,t,s,n,i){const r=this.components.get(Ys),o=document.createElement("span");o.innerHTML=t,o.style.color=r.color;const l=new mt(e,o,i);if(n==="Height"){const d=document.createElement("span");d.innerHTML=t,d.style.color=r.color;const{position:f}=s.geometry.attributes,m=(f.array.length/3-1)*3,E=f.array.slice(m,m+3);l.three.position.set(E[0],E[1]+10,E[2])}else if(n==="InitialKPV"){const{position:d}=s.geometry.attributes,f=d.getX(0),m=d.getY(0),E=d.getZ(0);l.three.position.set(f-20,m,E)}else if(n==="FinalKPV"){const{position:d}=s.geometry.attributes,f=d.getX(s.geometry.attributes.position.count-1),m=d.getY(s.geometry.attributes.position.count-1),E=d.getZ(s.geometry.attributes.position.count-1);l.three.position.set(f+20,m,E)}else if(n==="Slope"){o.style.color="grey";const{position:d}=s.geometry.attributes,f=new P;f.x=d.getX(0),f.y=d.getY(0),f.z=d.getZ(0);const m=new P;m.x=d.getX(d.count-1),m.y=d.getY(d.count-1),m.z=d.getZ(d.count-1);const E=new P;E.addVectors(f,m).multiplyScalar(.5),l.three.position.set(E.x,E.y-10,E.z)}const u=this._markerKey.toString();return r.list.set(u,{label:l,key:u,type:n,merged:!1,static:!1}),this._markerKey++,this.save(u,n),l}addCivilMarker(e,t,s,n){const i=this.components.get(Ys),r=document.createElement("span");r.innerHTML=t,r.style.color=i.color;const o=new mt(e,r);if(n==="InitialKP"){const u=s.geometry.attributes.position.getX(0),d=s.geometry.attributes.position.getY(0),f=s.geometry.attributes.position.getZ(0);o.three.position.set(u+2,d+2,f)}else if(n==="FinalKP"){const u=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),d=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),f=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);o.three.position.set(u+2,d-2,f)}else if(n==="Length"){const u=new P;u.x=s.geometry.attributes.position.getX(0),u.y=s.geometry.attributes.position.getY(0),u.z=s.geometry.attributes.position.getZ(0);const d=new P;d.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),d.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),d.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);const f=u.distanceTo(d);o.three.element.innerText=f.toFixed(2);const m=d.clone().add(u).divideScalar(2);o.three.position.copy(m)}const l=this._markerKey.toString();return i.list.set(l,{label:o,key:l,type:n,merged:!1,static:!1}),this._markerKey++,this.save(l,n),o}showKPStations(e){if(!this.world)throw new Error("A world is needed for this component to work!");if(this.type==="horizontal"){const t=this.generateStartAndEndKP(e);for(const[,n]of t)this.addKPStation(this.world,n.value,n.normal);const s=this.generateConstantKP(e);for(const[,n]of s)this.addKPStation(this.world,n.value,n.normal)}}showCurveLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(Ys),n=e.length,i=`${t.toFixed(2)} m`,r=Math.round(n/2),o=e[r],l=s.create(this.world,i,o,!0);this.save(l,"Length")}showLineLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(Ys),n=new P;n.x=e.geometry.getAttribute("position").getX(0),n.y=e.geometry.getAttribute("position").getY(0),n.z=e.geometry.getAttribute("position").getZ(0);const i=new P;i.x=e.geometry.getAttribute("position").getX(1),i.y=e.geometry.getAttribute("position").getY(1),i.z=e.geometry.getAttribute("position").getZ(1);const r=`${t.toFixed(2)} m`,o=new P;o.addVectors(n,i).multiplyScalar(.5);const l=s.create(this.world,r,o,!0);this.save(l,"Length")}showCurveRadius(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(Ys),n=new P;n.x=e.geometry.getAttribute("position").getX(0),n.y=e.geometry.getAttribute("position").getY(0),n.z=e.geometry.getAttribute("position").getZ(0);const i=new P;i.x=e.geometry.getAttribute("position").getX(1),i.y=e.geometry.getAttribute("position").getY(1),i.z=e.geometry.getAttribute("position").getZ(1);const r=`R = ${t.toFixed(2)} m`,o=new P;o.addVectors(n,i).multiplyScalar(.5);const l=s.create(this.world,r,o,!0);this.save(l,"Radius")}deleteByType(e=pm){const t=this.components.get(Ys);for(const s of e){const n=this.list.get(s);if(n){for(const i of n)t.delete(i);this.list.delete(s)}}}generateStartAndEndKP(e){const{alignment:t}=e.curve,s=new Map;for(const n of t.horizontal){const i=n.getLength();if(s.size>0){const r=n.index-1,o=s.get(r).distance+i,l=n.mesh.geometry.getAttribute("position"),u=l.count-1,d=new P;d.x=l.getX(u),d.y=l.getY(u),d.z=l.getZ(u);const f=this.createNormalLine(n.mesh);s.set(n.index,{value:this.getShortendKPValue(o),distance:o,point:d,normal:f})}else{const r=n.mesh.geometry.getAttribute("position"),o=r.count-1,l=new P;l.x=r.getX(o),l.y=r.getY(o),l.z=r.getZ(o);const u=this.createNormalLine(n.mesh);s.set(n.index,{value:this.getShortendKPValue(i),distance:i,point:l,normal:u})}}return s}createNormalLine(e){const t=e.geometry.attributes.position.count-1,s=t-1,n=new P;n.x=e.geometry.attributes.position.getX(t),n.y=e.geometry.attributes.position.getY(t),n.z=e.geometry.attributes.position.getZ(t);const i=new P;i.x=e.geometry.attributes.position.getX(s),i.y=e.geometry.attributes.position.getY(s),i.z=e.geometry.attributes.position.getZ(s);const r=new P().subVectors(n,i).clone().applyAxisAngle(new P(0,0,1),Math.PI*.5).normalize(),o=new De().setFromPoints([r.clone().setLength(10).add(n),r.clone().setLength(-10).add(n)]);return new Ze(o)}generateConstantKP(e){const{alignment:t}=e.curve,s=new Map,n=t.getLength("horizontal"),i=Math.floor(n/this.divisionLength);for(let r=0;r<i;r++){const o=r/i,l=t.getPointAt(o,"horizontal"),u=n*o,d=this.getNormal(t,l);s.set(r,{value:this.getShortendKPValue(u),distance:u,point:l,normal:d})}return s}getNormal(e,t){const s=[],n={start:new P,end:new P};for(let o=0;o<e.horizontal.length;o++){const l=e.horizontal[o].mesh.geometry.attributes.position,u=l.count;for(let d=0;d<u;d++){const f=l.getX(d),m=l.getY(d),E=l.getZ(d);s.push(new P(f,m,E))}}for(let o=0;o<s.length-1;o++){const l=s[o],u=s[o+1],d=l.distanceTo(t),f=u.distanceTo(t),m=l.distanceTo(u);Math.abs(d+f-m)<1e-5&&(n.start=l,n.end=u)}const i=new P().subVectors(n.end,n.start).clone().applyAxisAngle(new P(0,0,1),Math.PI*.5).normalize(),r=new De().setFromPoints([i.clone().setLength(10).add(t),i.clone().setLength(-10).add(t)]);return new Ze(r,new xs({color:16711680}))}getShortendKPValue(e){const t=e.toFixed(2),[s,n]=t.toString().split("."),i=n||"00";if(parseInt(s,10)>1e3&&parseInt(s,10)<1e4){const[r,...o]=s;return`${r}+${o.join("")}.${i}`}if(parseInt(s,10)>1e4){const[r,o,...l]=s;return`${r}${o}+${l.join("")}.${i}`}return`0+${s.padStart(3,"0")}.${i}`}save(e,t){this.list.has(t)||this.list.set(t,new Set),this.list.get(t).add(e)}};T(Gc,"uuid","0af12c32-81ee-4100-a030-e9ae546f6170");let pi=Gc;class jc extends Fe{constructor(e){super(e),T(this,"enabled",!0),T(this,"highlighter"),T(this,"onHighlight",new $),T(this,"onMarkerChange",new $),T(this,"mouseMarkers"),T(this,"onMarkerHidden",new $),T(this,"_curves",[]),T(this,"_previousAlignment",null),T(this,"_world",null),T(this,"onMouseMove",t=>{var s,n,i;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const r=this._world.renderer.three.domElement.parentElement,o=this._world.camera.three,l=(s=this.highlighter)==null?void 0:s.castRay(t,o,r,this._curves);if(l){const{object:u}=l;(n=this.highlighter)==null||n.hover(u),this.updateMarker(l,"hover");return}this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),(i=this.highlighter)==null||i.unHover(),this.onMarkerHidden.trigger({type:"hover"})}),T(this,"onClick",t=>{var s,n;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const i=this._world.renderer.three.domElement.parentElement,r=this._world.camera.three,o=(s=this.highlighter)==null?void 0:s.castRay(t,r,i,this._curves);if(o){const l=o,u=l.object;if((n=this.highlighter)==null||n.select(u),this.updateMarker(l,"select"),this.onHighlight.trigger({mesh:u,point:l.point}),this._previousAlignment!==u.curve.alignment){const d=this.components.get(pi);d.deleteByType(["KP"]),d.showKPStations(u),this._previousAlignment=u.curve.alignment}}}),T(this,"onControlsUpdated",()=>{if(!this._world)throw new Error("No world was given for this navigator!");if(!(this._world.camera.three instanceof Zs)||!this.highlighter)return;const{zoom:t,left:s,right:n,top:i,bottom:r}=this._world.camera.three,o=s-n,l=i-r,u=Math.max(o,l)/t,d=40,{caster:f}=this.highlighter;f.params.Line.threshold=u/d})}get world(){return this._world}set world(e){var t,s,n;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this.highlighter)==null||t.dispose(),(s=this.mouseMarkers)==null||s.hover.dispose(),(n=this.mouseMarkers)==null||n.select.dispose(),!e))return;const i=e.scene.three;this.highlighter=new Pc(i,"absolute"),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}async draw(e,t){if(!e.civilData)throw new Error("The provided model doesn't have civil data!");if(!this._world)throw new Error("No world was given for this navigator!");const{alignments:s}=e.civilData,n=t||s.values(),i=this._world.scene.three,r=new Ue;r.makeEmpty(),r.min.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.max.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const d of n){if(!d)throw new Error("Alignment not found!");for(const f of d[this.view])if(i.add(f.mesh),this._curves.push(f.mesh),!r.isEmpty())r.expandByObject(f.mesh);else{f.mesh.geometry.computeBoundingBox();const m=f.mesh.geometry.boundingBox;m instanceof Ue&&r.copy(m).applyMatrix4(f.mesh.matrixWorld)}}const o=new Ue,l=new P,u=new P;r.getCenter(u),r.getSize(l),l.multiplyScalar(1.2),o.setFromCenterAndSize(u,l),this._world.camera.hasCameraControls()&&await this._world.camera.controls.fitToBox(o,!1)}async dispose(){var e;(e=this.highlighter)==null||e.dispose(),this.clear(),this.onHighlight.reset(),this._curves=[]}clear(){var e,t;(e=this.highlighter)==null||e.unSelect(),(t=this.highlighter)==null||t.unHover();for(const s of this._curves)s.removeFromParent();this._curves=[]}setMarker(e,t,s){if(!this._curves.length)return;const n=e.getCurveAt(t,this.view),i=e.getPointAt(t,this.view),{index:r}=n.curve.getSegmentAt(n.percentage);this.setMouseMarker(i,n.curve.mesh,r,s)}setDefSegments(e){const t=[],s=[],n=(i,r)=>{const o=r[1]-i[1],l=r[0]-i[0];return o/l};for(let i=0;i<e.length;i++){const r=e[i];let o,l,u,d;for(let m=0;m<Object.keys(r).length/3;m++)if(r[m*3]!==void 0&&r[m*3+1]!==void 0){o=r[m*3],l=r[m*3+1];break}for(let m=Object.keys(r).length/3-1;m>=0;m--)if(r[m*3]!==void 0&&r[m*3+1]!==void 0){u=r[m*3],d=r[m*3+1];break}const f=(n([o,l],[u,d])*100).toFixed(2);s.push({slope:f})}for(const i of e)for(let r=0;r<i.length-3;r+=3){const o=i[r],l=i[r+1],u=i[r+2],d=i[r+3],f=i[r+4],m=i[r+5];t.push({start:new P(o,l,u),end:new P(d,f,m)})}return{defSegments:t,slope:s}}hideMarker(e){this.mouseMarkers&&(this.mouseMarkers[e].visible=!1)}setupEvents(e){if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const t=this._world.renderer.three.domElement.parentElement;e?(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("click",this.onClick),this._world.camera.hasCameraControls()&&this._world.camera.controls.addEventListener("update",this.onControlsUpdated)):(t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("click",this.onClick),this._world.camera.hasCameraControls()&&this._world.camera.controls.removeEventListener("update",this.onControlsUpdated))}newMouseMarker(e,t){if(!this._world)throw new Error("No world was given for this navigator!");const s=t.scene.three,n=document.createElement("div"),i=document.createElement("div");n.appendChild(i),i.style.backgroundColor=e,i.style.width="3rem",i.style.height="3px";const r=new mt(this._world,n,s);return r.visible=!1,r}setMouseMarker(e,t,s,n){if(s===void 0||!this.mouseMarkers)return;this.mouseMarkers[n].visible=!0;const i=this.mouseMarkers[n].three;i.position.copy(e);const r=t,{startPoint:o,endPoint:l}=r.curve.getSegment(s),u=Math.atan2(l.y-o.y,l.x-o.x),d=i.element.children[0],f=90-u/Math.PI*180;d.style.transform=`rotate(${f}deg)`}updateMarker(e,t){const{point:s,index:n,object:i}=e,r=i,o=r.curve,l=r.curve.alignment,u=l.getPercentageAt(s,this.view),d=s.clone();this.setMouseMarker(d,r,n,t),u!==null&&this.onMarkerChange.trigger({alignment:l,percentage:u,type:t,curve:o})}}class fm{constructor(e,t){T(this,"components"),T(this,"_scene"),T(this,"offset",10),T(this,"markupLines",[]),T(this,"currentCurveMesh"),T(this,"markupMaterial",new xs({color:6842472})),this.components=e,this._scene=t}showCurveInfo(e){switch(this.disposeMarkups(),this.currentCurveMesh=e,e.curve.data.TYPE){case"LINE":this.showLineInfo(e,this.offset);break;case"CIRCULARARC":this.showCircularArcInfo(e,this.offset);break;case"CLOTHOID":this.showClothoidInfo(e,this.offset);break;default:console.log("Unknown curve type:",e.curve.data.TYPE);break}}updateOffset(e,t,s){const n=Math.max(e.height,e.width)/(t*150);n!==this.offset&&(this.offset=n,s&&this.currentCurveMesh&&this.showCurveInfo(this.currentCurveMesh))}dispose(){for(const e of this.markupLines)e.removeFromParent();this.disposeMarkups(),this.markupMaterial.dispose()}disposeMarkups(){for(const e of this.markupLines)e.geometry.dispose(),e.removeFromParent();this.markupLines=[]}unSelect(){this.disposeMarkups()}calculateTangent(e,t){const s=t*3,n=Math.max(0,s-3),i=Math.min(e.length-3,s+3),r=new P().fromArray(e,n);return new P().fromArray(e,i).clone().sub(r).normalize()}calculateParallelCurve(e,t,s){const n=[];for(let i=0;i<t;i++){const r=this.calculateTangent(e,i).clone().applyAxisAngle(new P(0,0,1),Math.PI/2);r.normalize();const o=r.clone().multiplyScalar(s),l=i*3,u=new P().fromArray(e,l).add(o);n.push(u)}return n}calculateDimensionLines(e,t){const s=[],n=e.geometry.attributes.position.array,i=t.geometry.attributes.position.array;if(n.length<6&&i.length<6)throw new Error("Line must have at least two vertices");const r=new P(n[0],n[1],n[2]),o=new P(i[0],i[1],i[2]),l=[],u=n.length-3,d=new P(n[u],n[u+1],n[u+2]),f=i.length-3,m=new P(i[f],i[f+1],i[f+2]);return s.push(r,o),l.push(d,m),{startDimensionPoints:s,endDimensionPoints:l}}offsetDimensionLine(e,t){const s=new P().copy(e[e.length-1]).sub(e[0]).normalize().clone().multiplyScalar(t);return e.map(n=>n.clone().add(s))}showLineInfo(e,t){const s=this.components.get(pi);s.deleteByType(["Length","Radius"]);const n=e.geometry.attributes.position.array,i=this.calculateParallelCurve(n,n.length/3,t),r=new De().setFromPoints(i),o=new Ze(r,this.markupMaterial);s.showLineLength(o,e.curve.getLength()),this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:l,endDimensionPoints:u}=this.calculateDimensionLines(e,o),d=this.offsetDimensionLine(l,t*.1),f=this.offsetDimensionLine(u,t*.1),m=new De().setFromPoints(d),E=new De().setFromPoints(f),w=new Ze(m,this.markupMaterial);this._scene.add(w),this.markupLines.push(w);const y=new Ze(E,this.markupMaterial);this._scene.add(y),this.markupLines.push(y)}showClothoidInfo(e,t){const s=this.components.get(pi);s.deleteByType(["Length","Radius"]);const n=e.geometry.attributes.position.array,i=this.calculateParallelCurve(n,n.length/3,t),r=new De().setFromPoints(i);s.showCurveLength(i,e.curve.getLength());const o=new Ze(r,this.markupMaterial);this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:l,endDimensionPoints:u}=this.calculateDimensionLines(e,o),d=this.offsetDimensionLine(l,t*.1),f=this.offsetDimensionLine(u,t*.1),m=new De().setFromPoints(d),E=new De().setFromPoints(f),w=new Ze(m,this.markupMaterial);this._scene.add(w),this.markupLines.push(w);const y=new Ze(E,this.markupMaterial);this._scene.add(y),this.markupLines.push(y)}showCircularArcInfo(e,t){const s=this.components.get(pi);s.deleteByType(["Length","Radius"]);const n=e.curve.data.RADIUS,i=e.geometry.attributes.position.array,r=e.geometry.attributes.position.count,o=[],l=new P(i[0],i[1],i[2]),u=(r-1)*3,d=new P(i[u],i[u+1],i[u+2]),f=r/2*3,m=new P(i[f],i[f+1],i[f+2]),E=d.clone().sub(l).normalize(),w=new P(-E.y,E.x,0);w.multiplyScalar(n);const y=m.clone().add(w);o.push(m),o.push(y);const A=new De().setFromPoints(o),S=new Ze(A,this.markupMaterial);s.showCurveRadius(S,Math.abs(n)),this._scene.add(S),this.markupLines.push(S);const x=[];for(let se=0;se<r;se++){const ue=this.calculateTangent(i,se),we=e.curve.data.RADIUS,ce=new P(ue.y,-ue.x,0);ce.normalize(),we<0&&ce.negate();const ge=ce.clone().multiplyScalar(t),pe=se*3,Ie=new P(i[pe]+ge.x,i[pe+1]+ge.y,i[pe+2]+ge.z);x.push(Ie)}const R=new De().setFromPoints(x);s.showCurveLength(x,e.curve.getLength());const C=new Ze(R,this.markupMaterial);this._scene.add(C),this.markupLines.push(C);const{startDimensionPoints:M,endDimensionPoints:k}=this.calculateDimensionLines(e,C),G=this.offsetDimensionLine(M,t*.1),H=this.offsetDimensionLine(k,t*.1),W=new De().setFromPoints(G),Z=new De().setFromPoints(H),J=new Ze(W,this.markupMaterial);this._scene.add(J),this.markupLines.push(J);const te=new Ze(Z,this.markupMaterial);this._scene.add(te),this.markupLines.push(te)}}const mm=class Kc extends jc{constructor(e){super(e),T(this,"view","horizontal"),T(this,"planHighlighter"),this.components.add(Kc.uuid,this),this.onHighlight.add(({mesh:t})=>{!this.highlighter||!this.planHighlighter||(this.planHighlighter.showCurveInfo(t),this.fitCameraToAlignment(t))})}set world(e){var t;super.world=e,e&&((t=this.planHighlighter)==null||t.dispose(),this.planHighlighter=new fm(this.components,e.scene.three))}async fitCameraToAlignment(e){const t=this.components.get(Qa),s=e.curve.alignment;for(const d of s.horizontal)t.addMesh(d.mesh);const n=t.get(),i=new P,{min:r,max:o}=n,l=1.2,u=new P((o.x-r.x)*l,(o.y-r.y)*l,(o.z-r.z)*l);n.getCenter(i),n.setFromCenterAndSize(i,u),t.reset(),this.world&&this.world.camera.hasCameraControls()&&await this.world.camera.controls.fitToBox(n,!0)}};T(mm,"uuid","3096dea0-5bc2-41c7-abce-9089b6c9431b");const gm=class Wc extends jc{constructor(e){super(e),T(this,"view","vertical"),T(this,"enabled",!0),this.components.add(Wc.uuid,this)}set world(e){this.world!==e&&(super.world=e,this.highlighter&&this.highlighter.onSelect.add(t=>{if(!this.world)throw new Error("A world is needed to work with this component!");const s=this.components.get(pi);s.deleteByType(["Slope","Height","InitialKPV","FinalKPV"]);const{alignment:n}=t.curve,i=[];for(const u of n.vertical){const d=u.mesh.geometry.attributes.position.array;i.push(d)}const{defSegments:r,slope:o}=this.setDefSegments(i),l=this.world.scene.three;for(let u=0;u<n.vertical.length;u++){const d=n.vertical[u];s.addVerticalMarker(this.world,`S: ${o[u].slope}%`,d.mesh,"Slope",l),s.addVerticalMarker(this.world,`H: ${r[u].end.y.toFixed(2)}`,d.mesh,"Height",l)}s.addVerticalMarker(this.world,"KP: 0",n.vertical[0].mesh,"InitialKPV",l),s.addVerticalMarker(this.world,`KP: ${n.vertical.length}`,n.vertical[n.vertical.length-1].mesh,"FinalKPV",l)}))}};T(gm,"uuid","097eea29-2d5a-431a-a247-204d44670621");const Em=class Xc extends Fe{constructor(e){super(e),T(this,"onHighlight",new $),T(this,"enabled",!0),T(this,"_highlighter"),T(this,"mouseMarkers"),T(this,"onMarkerChange",new $),T(this,"onMarkerHidden",new $),T(this,"_curves",[]),T(this,"_world",null),T(this,"onClick",t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const s=this.world.renderer.three.domElement,n=this.world.camera.three,i=this._highlighter.castRay(t,n,s,this._curves);if(i){const r=i.object;this._highlighter.select(r),this.updateMarker(i,"select");const{point:o,index:l}=i;l!==void 0&&this.onHighlight.trigger({curve:r,point:o,index:l});return}this._highlighter.unSelect(),this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),this.onMarkerHidden.trigger({type:"hover"})}),T(this,"onMouseMove",async t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const s=this.world.renderer.three.domElement,n=this.world.camera.three,i=this._highlighter.castRay(t,n,s,this._curves);if(i){this._highlighter.hover(i.object),this.updateMarker(i,"hover");return}this._highlighter.unHover()}),this.components.add(Xc.uuid,this)}get world(){return this._world}set world(e){var t,s,n;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(s=this.mouseMarkers)==null||s.hover.dispose(),(n=this.mouseMarkers)==null||n.select.dispose(),!e))return;const i=e.scene.three;this._highlighter=new Pc(i,"absolute"),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}get highlighter(){if(!this._highlighter)throw new Error("Navigator not initialized!");return this._highlighter}draw(e){if(!e.civilData)throw new Error("Model must have civil data!");if(!this.world)throw new Error("A world must be given before drawing an alignment!");const t=this.world.scene.three;for(const[s,n]of e.civilData.alignments)for(const{mesh:i}of n.absolute)t.add(i),this._curves.push(i)}newMouseMarker(e,t){const s=t.scene.three,n=document.createElement("div");n.style.backgroundColor=e,n.style.width="1rem",n.style.height="1rem",n.style.borderRadius="1rem";const i=new mt(t,n,s);return i.visible=!1,i}setMarker(e,t,s){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const n=e.getPointAt(t,"absolute");this.mouseMarkers[s].visible=!0,this.mouseMarkers[s].three.position.copy(n)}hideMarker(e){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const t=this.mouseMarkers[e].three;t.visible=!1}setupEvents(e){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const t=this.world.renderer.three.domElement;e?(t.addEventListener("click",this.onClick),t.addEventListener("mousemove",this.onMouseMove)):(t.removeEventListener("click",this.onClick),t.removeEventListener("mousemove",this.onMouseMove))}updateMarker(e,t){if(!this.mouseMarkers)return;const{point:s,object:n}=e,i=n,r=i.curve,o=i.curve.alignment,l=o.getPercentageAt(s,"absolute");this.mouseMarkers[t].visible=!0,this.mouseMarkers[t].three.position.copy(s),l!==null&&this.onMarkerChange.trigger({alignment:o,percentage:l,type:t,curve:r})}};T(Em,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const vm=class Zc extends Fe{constructor(e){super(e),T(this,"_world",null),T(this,"enabled",!0),T(this,"plane"),this.components.add(Zc.uuid,this)}get world(){return this._world}set world(e){var t;if(this._world=e,(t=this.plane)==null||t.dispose(),!e)return;const s=this.components.get(Ur),n=s.Type;s.Type=vi,this.plane=s.createFromNormalAndCoplanarPoint(e,new P(1,0,0),new P),s.Type=n,this.plane.visible=!1,this.plane.enabled=!1}async set(e,t){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;const s=e.curve.getPercentageAt(t);if(s===null)return;const{startPoint:n,endPoint:i}=e.curve.getSegmentAt(s);if(e.geometry.index===null)throw new Error("Geometry must be indexed!");const r=new P;r.subVectors(i,n),r.normalize(),await this.plane.setFromNormalAndCoplanarPoint(r,t);const o=this.plane.helper.matrix.clone();o.invert();const l=this.world.scene.three,u=this.plane.edges.get();for(const d in u){const{mesh:f}=u[d];f.position.set(0,0,0),f.rotation.set(0,0,0),f.updateMatrix(),f.applyMatrix4(o),f.parent!==l&&l.add(f)}this.plane.enabled=!1}};T(vm,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");function Ws(){const c=document.createElement("div");return c.style.backgroundColor="black",c.style.color="white",c.style.padding="8px",c.style.borderRadius="8px",c.style.fontFamily="sans-serif",c}const Sa=class Fa{constructor(e,t,s){T(this,"label"),T(this,"boundingBox",new re),T(this,"world"),T(this,"components"),T(this,"_length"),T(this,"_visible",!0),T(this,"_start"),T(this,"_end"),T(this,"_root",new Nr),T(this,"_endpoints",[]),T(this,"_line"),this.components=e,this.world=t,this._start=s.start,this._end=s.end,this._length=this.getLength(),this._line=this.createLine(s),this.newEndpointElement(s.endpointElement),this.newEndpointElement(s.endpointElement.cloneNode(!0)),this.label=this.newText(),this._root.renderOrder=2,this.world.scene.three.add(this._root)}get visible(){return this._visible}set visible(e){this._visible=e,this.label.visible=e,this._endpoints[0].visible=e,this._endpoints[1].visible=e;const[t,s]=this._endpoints,n=t.three,i=s.three,r=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(r,n,i)):(r.removeFromParent(),n.removeFromParent(),i.removeFromParent(),this._root.removeFromParent())}get endPoint(){return this._end}set endPoint(e){this._end=e;const t=this._line.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[1].three.position.copy(e),this.updateLabel()}get startPoint(){return this._start}set startPoint(e){this._start=e;const t=this._line.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[0].three.position.copy(e),this.updateLabel()}get _center(){let e=this._end.clone().sub(this._start);const t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this._start.clone().add(e)}dispose(){const e=this.components.get(us);this.visible=!1,e.destroy(this._root),e.destroy(this._line);for(const t of this._endpoints)t.dispose();this._endpoints.length=0,this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.components=null}createBoundingBox(){this.boundingBox.geometry=new tt(1,1,this._length),this.boundingBox.position.copy(this._center),this.boundingBox.lookAt(this._end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}toggleLabel(){this.label.toggleVisibility()}newEndpointElement(e){const t=this._endpoints.length===0?this._start:this._end,s=new mt(this.world,e);s.three.position.copy(t),this._endpoints.push(s),this._root.add(s.three)}updateLabel(){this._length=this.getLength(),this.label.three.element.textContent=this.getTextContent(),this.label.three.position.copy(this._center),this._line.computeLineDistances()}createLine(e){const t=new De;t.setFromPoints([e.start,e.end]);const s=new Ze(t,e.lineMaterial);return this._root.add(s),s}newText(){const e=Ws();e.textContent=this.getTextContent();const t=new mt(this.world,e);return t.three.position.copy(this._center),this._root.add(t.three),t}getTextContent(){return`${this._length/Fa.scale} ${Fa.units}`}getLength(){return parseFloat(this._start.distanceTo(this._end).toFixed(2))}};T(Sa,"scale",1),T(Sa,"units","m");let tl=Sa;class wm{constructor(e,t,s){T(this,"enabled",!0),T(this,"visible",!0),T(this,"points",[]),T(this,"workingPlane",null),T(this,"labelMarker"),T(this,"world"),T(this,"components"),T(this,"onDisposed",new $),T(this,"_rotationMatrix",null),T(this,"_dimensionLines",[]),T(this,"_defaultLineMaterial",new xs({color:"red"})),T(this,"onAreaComputed",new $),T(this,"onWorkingPlaneComputed",new $),T(this,"onPointAdded",new $),T(this,"onPointRemoved",new $),this.world=t,this.components=e;const n=Ws();this.labelMarker=new mt(t,n),this.labelMarker.visible=!1,this.onPointAdded.add(i=>{this.points.length===3&&!this._dimensionLines[2]&&(this.addDimensionLine(i,this.points[0]),this.labelMarker.visible=!0)}),s==null||s.forEach(i=>this.setPoint(i))}setPoint(e,t){let s;if(t?s=t:s=this.points.length===0?0:this.points.length,s===0){this.points[0]=e;return}if(s<0||s>this.points.length)return;const n=this.points.length>s;this.points[s]=e,this.onPointAdded.trigger(e),n||this.addDimensionLine(this.points[s-1],e);const{previousLine:i,nextLine:r}=this.getLinesBetweenIndex(s);i&&(i.endPoint=e),r&&(r.startPoint=e)}removePoint(e){if(this.points.length===3)return;this.points.splice(e,1);const{previousLine:t,nextLine:s}=this.getLinesBetweenIndex(e);s&&(t.endPoint=s.endPoint),s==null||s.dispose(),this._dimensionLines.splice(e,1),this.onPointRemoved.trigger()}toggleLabel(){this.labelMarker.toggleVisibility()}addDimensionLine(e,t){const s=document.createElement("div");s.className="w-2 h-2 bg-red-600 rounded-full";const n=new tl(this.components,this.world,{start:e,end:t,lineMaterial:this._defaultLineMaterial,endpointElement:s});return n.toggleLabel(),this._dimensionLines.length>1?this._dimensionLines.splice(this._dimensionLines.length-1,0,n):this._dimensionLines.push(n),n}getLinesBetweenIndex(e){const t=e===0?this._dimensionLines.length-1:e-1,s=this._dimensionLines[t],n=this._dimensionLines[e];return{previousLine:s,nextLine:n}}computeWorkingPlane(){this.workingPlane=new Fs().setFromCoplanarPoints(this.points[0],this.points[1],this.points[2]);const e=new P(0,1,0),t=this.workingPlane.normal.angleTo(e),s=new P().crossVectors(this.workingPlane.normal,e).normalize();this._rotationMatrix=new me().makeRotationAxis(s,t),this.onWorkingPlaneComputed.trigger(this.workingPlane)}computeArea(){if(!(this._rotationMatrix&&this.workingPlane))return this.onAreaComputed.trigger(0),0;let e=0,t=0;const s=this._rotationMatrix,n=this.points.map(r=>{const o=r.clone().applyMatrix4(s),l=new ke(o.x,o.z);return e+=l.x,t+=l.y,l}),i=Math.abs(Bu.area(n));return this.labelMarker.three.element.textContent=`${i.toFixed(2)} m²`,this.labelMarker.three.position.set(e/n.length,-this.workingPlane.constant,t/n.length).applyMatrix4(s.clone().invert()),this.onAreaComputed.trigger(i),i}dispose(){this.onAreaComputed.reset(),this.onWorkingPlaneComputed.reset(),this.onPointAdded.reset(),this.onPointRemoved.reset();for(const e of this._dimensionLines)e.dispose();this.labelMarker.dispose(),this._dimensionLines=[],this.points=[],this._rotationMatrix=null,this.workingPlane=null,this._defaultLineMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return{points:this.points,workingPlane:this.workingPlane,area:this.computeArea()}}}class sl extends Fp{constructor(){super(...arguments),T(this,"onDisposed",new $),T(this,"marker",null)}dispose(){this.marker&&this.marker.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(e){const t=super.get(e);return t?(this.marker||(this.marker=new mt(e)),this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(t)):this.marker&&(this.marker.visible=!1),t}}const ym=class xa extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"list",[]),T(this,"world"),T(this,"_enabled",!1),T(this,"_vertexPicker"),T(this,"_currentAreaElement",null),T(this,"_clickCount",0),T(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World not defined for the area measurement!");const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAreaElement){const s=new wm(this.components,this.world);s.onPointAdded.add(()=>{this._clickCount===3&&!s.workingPlane&&(s.computeWorkingPlane(),this._vertexPicker.workingPlane=s.workingPlane)}),s.onPointRemoved.add(()=>this._clickCount--),this._currentAreaElement=s}this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea(),this._clickCount++}}),T(this,"onMouseMove",()=>{if(!this.world){console.log("No world given for the area measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAreaElement&&(this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea())}),T(this,"onKeydown",t=>{this.enabled&&(t.key==="z"&&t.ctrlKey&&this._currentAreaElement&&this._currentAreaElement.removePoint(this._clickCount-1),t.key==="Enter"&&this._currentAreaElement&&this.endCreation(),t.key==="Escape"&&(this._clickCount===0&&!this._currentAreaElement?this.enabled=!1:this.cancelCreation()))}),this.components.add(xa.uuid,this),this._vertexPicker=new sl(e)}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}set workingPlane(e){this._vertexPicker.workingPlane=e}get workingPlane(){return this._vertexPicker.workingPlane}dispose(){this.setupEvents(!1),this._vertexPicker.dispose(),this._currentAreaElement&&this._currentAreaElement.dispose();for(const e of this.list)e.dispose();this.components=null,this.onDisposed.trigger(xa.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAreaElement&&(this.list.push(this._currentAreaElement),this._currentAreaElement.removePoint(this._clickCount),this._currentAreaElement.computeWorkingPlane(),this._currentAreaElement.computeArea(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0}cancelCreation(){this._currentAreaElement&&(this._currentAreaElement.dispose(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("The area measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the area measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}};T(ym,"uuid","c453a99e-f054-4781-9060-33df617db4a5");class Im{constructor(e,t){T(this,"enabled",!0),T(this,"visible",!0),T(this,"points",[]),T(this,"world"),T(this,"onDisposed",new $),T(this,"_lineMaterial",new Ii({color:6629591,linewidth:2})),T(this,"_lineGeometry",new kr),T(this,"_line",new Fc(this._lineGeometry,this._lineMaterial)),T(this,"_labelMarker"),T(this,"onAngleComputed",new $),T(this,"onPointAdded",new $),this.world=e;const s=Ws();this._labelMarker=new mt(e,s),this.labelMarker.visible=!0,this.onPointAdded.add(()=>{this.points.length===1&&e.scene.three.add(this._line),this.points.length===3&&(this.labelMarker.visible=!0)}),this.onAngleComputed.add(n=>{this.labelMarker.three.element.textContent=`${n.toFixed(2)}°`,this.labelMarker.three.position.copy(this.points[1]??new P)}),t==null||t.forEach(n=>this.setPoint(n))}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._line.material=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get lineMaterial(){return this._lineMaterial}set labelMarker(e){this._labelMarker.dispose(),this._labelMarker=e}get labelMarker(){return this._labelMarker}get angle(){return{points:this.points,angle:this.computeAngle()}}setPoint(e,t){let s;if(t?s=t:s=this.points.length===0?0:this.points.length,![0,1,2].includes(s))return;this.points[s]=e,this.onPointAdded.trigger(e);const n=this.points.map(i=>[i.x,i.y,i.z]);this._lineGeometry.setPositions(n.flat())}toggleLabel(){this.labelMarker.toggleVisibility()}computeAngle(){const e=this.points[0],t=this.points[1],s=this.points[2];if(!(e&&t&&s))return 0;const n=new P().subVectors(t,e),i=new P().subVectors(t,s),r=yi.radToDeg(n.angleTo(i));return this.onAngleComputed.trigger(r),r}dispose(){this.points=[],this.labelMarker.dispose(),this.onAngleComputed.reset(),this.onPointAdded.reset(),this.labelMarker.dispose(),this._line.removeFromParent(),this._lineMaterial.dispose(),this._lineGeometry.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}}const Cm=class Ra extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"world"),T(this,"list",[]),T(this,"_lineMaterial"),T(this,"_enabled",!1),T(this,"_vertexPicker"),T(this,"_currentAngleElement",null),T(this,"_clickCount",0),T(this,"create",()=>{if(!this.enabled)return;if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAngleElement){const s=new Im(this.world);s.lineMaterial=this.lineMaterial,this._currentAngleElement=s}this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.setPoint(t,this._clickCount+1),this._currentAngleElement.setPoint(t,this._clickCount+2),this._currentAngleElement.computeAngle(),this._clickCount++,this._clickCount===3&&this.endCreation()}}),T(this,"onMouseMove",()=>{if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAngleElement&&(this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.computeAngle())}),T(this,"onKeyDown",t=>{this.enabled&&(t.key==="z"&&t.ctrlKey&&this._currentAngleElement,t.key==="Escape"&&(this._clickCount===0&&!this._currentAngleElement?this.enabled=!1:this.cancelCreation()))}),this.components.add(Ra.uuid,this),this._vertexPicker=new sl(e),this._lineMaterial=new Ii({color:6629591,linewidth:2})}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get lineMaterial(){return this._lineMaterial}set enabled(e){this._enabled=e,this.setupEvents(e),this._vertexPicker.enabled=e,e||this.cancelCreation()}get enabled(){return this._enabled}set workingPlane(e){this._vertexPicker.workingPlane=e}get workingPlane(){return this._vertexPicker.workingPlane}dispose(){this.setupEvents(!1),this._lineMaterial.dispose(),this._vertexPicker.dispose();for(const e of this.list)e.dispose();this._currentAngleElement&&this._currentAngleElement.dispose(),this.components=null,this.onDisposed.trigger(Ra.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAngleElement&&(this.list.push(this._currentAngleElement),this._currentAngleElement.computeAngle(),this._currentAngleElement=null),this._clickCount=0}cancelCreation(){this._currentAngleElement&&(this._currentAngleElement.dispose(),this._currentAngleElement=null),this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("No world selected for angle measurement!");if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeyDown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeyDown))}};T(Cm,"uuid","622fb2c9-528c-4b0a-8a0e-6a1375f0a3aa");const Qc=class Pa extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"onBeforeUpdate",new $),T(this,"onAfterUpdate",new $),T(this,"snapDistance",.25),T(this,"_vertexPicker"),T(this,"_lineMaterial",new xs({color:"#DC2626",linewidth:2,depthTest:!1})),T(this,"list",[]),T(this,"world"),T(this,"_visible",!0),T(this,"_enabled",!1),T(this,"_temp",{isDragging:!1,start:new P,end:new P,dimension:void 0}),T(this,"create",t=>{const s=t instanceof xn?t:void 0;if(this._enabled){if(!this._temp.isDragging){this.drawStart(s);return}this.endCreation()}}),T(this,"onMouseMove",()=>{this.world&&this._vertexPicker.get(this.world)}),this.components.add(Pa.uuid,this),this._vertexPicker=new sl(e,{previewElement:Ws(),snapDistance:this.snapDistance})}get enabled(){return this._enabled}set enabled(e){e||this.cancelCreation(),this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e)}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get color(){return this._lineMaterial.color}set color(e){this._lineMaterial.color=e}dispose(){this.setupEvents(!1),this.enabled=!1;for(const e of this.list)e.dispose();this._lineMaterial.dispose(),this.list=[],this._vertexPicker.dispose(),this.onDisposed.trigger(Pa.uuid),this.onDisposed.reset()}async update(e){this._enabled&&this._temp.isDragging&&this.drawInProcess()}createOnPoints(e,t){const s=this.drawDimension();s.startPoint=e,s.endPoint=t,s.createBoundingBox(),this.list.push(s)}delete(){if(!this.world)throw new Error("World is needed for Length Measurement!");if(!this._enabled||this.list.length===0)return;const e=this.getBoundingBoxes(),t=this.components.get(zt).get(this.world).castRay(e);if(!t)return;const s=this.list.find(n=>n.boundingBox===t.object);if(s){const n=this.list.indexOf(s);this.list.splice(n,1),s.dispose()}}async deleteMeasurement(e){if(e){const t=this.list.indexOf(e);this.list.splice(t,1),e.dispose()}}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}cancelCreation(){var e;this._temp.dimension&&(this._temp.isDragging=!1,(e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0)}drawStart(e){if(!this.world)throw new Error("The length measurement needs a world to work!");const t=e?[e]:void 0,s=this.components.get(zt).get(this.world).castRay(t),n=this._vertexPicker.get(this.world);s&&n&&(this._temp.isDragging=!0,this._temp.start=e?s.point:n)}drawInProcess(){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.components.get(zt).get(this.world).castRay())return;const e=this._vertexPicker.get(this.world);e&&(this._temp.end=e,this._temp.dimension||(this._temp.dimension=this.drawDimension()),this._temp.dimension.endPoint=this._temp.end)}endCreation(){this._temp.dimension&&(this._temp.dimension.createBoundingBox(),this.list.push(this._temp.dimension),this._temp.dimension=void 0,this._temp.isDragging=!1)}drawDimension(){if(!this.world)throw new Error("The length measurement needs a world to work!");return new tl(this.components,this.world,{start:this._temp.start,end:this._temp.end,lineMaterial:this._lineMaterial,endpointElement:Ws()})}getBoundingBoxes(){return this.list.map(e=>e.boundingBox).filter(e=>e!==void 0)}setupEvents(e){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the length measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("click",this.create),e&&t.addEventListener("mousemove",this.onMouseMove))}};T(Qc,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");let hi=Qc;const Tm=class qc extends Fe{constructor(e){super(e),T(this,"label",null),T(this,"world"),T(this,"onVolumeFound",new $),T(this,"_enabled",!1),T(this,"onDisposed",new $),T(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World is needed for Volume Measurement!");const t=this.components.get(zt).get(this.world).castRay();if(!t||!t.object)return;const{object:s}=t;if(s instanceof re){const n=this.getVolumeOfMesh(s);this.onVolumeFound.trigger(n)}}),T(this,"onMouseMove",()=>{}),T(this,"onKeydown",t=>{}),this.components.add(qc.uuid,this)}set enabled(e){this._enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}async dispose(){var e;this.setupEvents(!1),(e=this.label)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){}async deleteAll(){}endCreation(){}cancelCreation(){}get(){}getVolumeFromFragments(e){const t=this.components.get(Qe),s=new me,n=[];for(const i in e){const r=t.list.get(i);if(!r)continue;const o=e[i];let l=0;for(const f of o){const m=r.getInstancesIDs(f);m&&(l+=m.size)}const u=new Ot(r.mesh.geometry,void 0,l);let d=0;for(const f of o){const m=r.getInstancesIDs(f);if(m)for(const E of m)r.mesh.getMatrixAt(E,s),u.setMatrixAt(d++,s)}n.push(u)}return this.getVolumeFromMeshes(n)}getVolumeFromMeshes(e){if(!this.world)throw new Error("World is needed for Volume Measurement!");this.label||(this.label=this.newLabel(),this.label.three.removeFromParent());let t=0;for(const l of e)t+=this.getVolumeOfMesh(l);const s=this.world.scene.three,n=this.label.three;s.add(n);const i=this.components.get(Qa);for(const l of e)l.geometry.computeBoundingSphere(),i.addMesh(l);const r=i.getSphere();i.reset(),n.position.copy(r.center);const o=Math.trunc(t*100)/100;return n.element.textContent=o.toString(),t}newLabel(){if(!this.world)throw new Error("World is needed for Volume Measurement!");const e=Ws();return new mt(this.world,e)}setupEvents(e){if(!this.world)throw new Error("The volume measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the volume measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}getVolumeOfMesh(e){let t=0;const s=new P,n=new P,i=new P,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const l=[];if(e instanceof Ot)for(let d=0;d<e.count;d++){const f=new me;e.getMatrixAt(d,f),l.push(f)}else l.push(new me().identity());const{matrixWorld:u}=e;for(let d=0;d<r.array.length-2;d+=3)for(const f of l){const m=f.multiply(u),E=r.array[d]*3,w=r.array[d+1]*3,y=r.array[d+2]*3;s.set(o[E],o[E+1],o[E+2]).applyMatrix4(m),n.set(o[w],o[w+1],o[w+2]).applyMatrix4(m),i.set(o[y],o[y+1],o[y+2]).applyMatrix4(m),t+=this.getSignedVolumeOfTriangle(s,n,i)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,s){const n=s.x*t.y*e.z,i=t.x*s.y*e.z,r=s.x*e.y*t.z,o=e.x*s.y*t.z,l=t.x*e.y*s.z,u=e.x*t.y*s.z;return 1/6*(-n+i+r-o-l+u)}};T(Tm,"uuid","811da532-7af3-4635-b592-1c06ae494af5");const bm=class Jc extends Fe{constructor(e){super(e),T(this,"selection",[]),T(this,"preview",new re(new De,new Pt({side:2,depthTest:!1,transparent:!0,opacity:.25,color:"#BCF124"}))),T(this,"selectionMaterial",new Pt({side:2,depthTest:!1,transparent:!0,color:"#BCF124",opacity:.75})),T(this,"world"),T(this,"onDisposed",new $),T(this,"_enabled",!1),T(this,"_currentSelelection",null),T(this,"create",()=>{if(!this.world)throw new Error("No world given to the face measurement!");if(!this.enabled||!this._currentSelelection)return;const t=this.world.scene.three,s=new De,n=new re(s,this.selectionMaterial);s.setAttribute("position",this.preview.geometry.attributes.position),t.add(n),s.computeBoundingSphere();const{area:i,perimeter:r}=this._currentSelelection,o=this.newLabel(s,i);n.add(o.three),this.selection.push({area:i,perimeter:r,mesh:n,label:o})}),T(this,"onMouseMove",()=>{if(!this.world)throw new Error("The face measurement needs a world to work!");if(!this.enabled){this.unselect();return}const t=this.components.get(zt).get(this.world).castRay();if(!t||!t.object||t.faceIndex===void 0){this.unselect();return}const{object:s,faceIndex:n}=t;s instanceof re||s instanceof Ot?this.updateSelection(s,n,t.instanceId):this.unselect()}),T(this,"onKeydown",t=>{}),this.components.add(Jc.uuid,this),this.preview.frustumCulled=!1}set enabled(e){if(!this.world)throw new Error("No world given for the Face measurement!");this._enabled=e,this.setupEvents(e),e?this.world.scene.three.add(this.preview):(this.preview.removeFromParent(),this.cancelCreation()),this.setVisibility(e)}get enabled(){return this._enabled}dispose(){this.setupEvents(!1),this.deleteAll(),this.preview.removeFromParent(),this.preview.material.dispose(),this.preview.geometry.dispose(),this.selectionMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.world)throw new Error("No world given to the face measurement!");const e=this.selection.map(i=>i.mesh),t=this.components.get(zt).get(this.world).castRay(e);if(!t||!t.object)return;const s=this.selection.find(i=>i.mesh===t.object);if(!s)return;s.mesh.removeFromParent(),s.mesh.geometry.dispose(),s.label.dispose();const n=this.selection.indexOf(s);this.selection.splice(n,1)}deleteAll(){for(const e of this.selection)e.mesh.removeFromParent(),e.mesh.geometry.dispose(),e.label.dispose();this.selection=[]}endCreation(){}cancelCreation(){}get(){const e=[];for(const t of this.selection){const s=t.mesh.geometry,{area:n,perimeter:i}=t,r=s.attributes.position.array;e.push({position:r,area:n,perimeter:i})}return e}set(e){if(!this.world)throw new Error("No world given to the face measurement!");const t=this.world.scene.three;for(const s of e){const n=new De,i=new re(n,this.selectionMaterial);t.add(i);const r=new gt(s.position,3);n.setAttribute("position",r),n.computeBoundingSphere();const{area:o,perimeter:l}=s,u=this.newLabel(n,o);i.add(u.three),this.selection.push({area:o,perimeter:l,mesh:i,label:u})}}setupEvents(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the face measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown))}setVisibility(e){if(!this.world)throw new Error("The face measurement needs a world to work!");const t=this.world.scene.three;for(const s of this.selection){const n=s.label.three;e?(t.add(s.mesh),s.mesh.add(n)):(s.mesh.removeFromParent(),n.removeFromParent())}}unselect(){this.preview.removeFromParent(),this._currentSelelection=null}updateSelection(e,t,s){if(!this.world)throw new Error("The face measurement needs a world to work!");this.world.scene.three.add(this.preview);const n=this.components.get(Br).getFace(e,t,s);if(n===null){console.log("Hey!");return}const i=this.regenerateHighlight(e,n.indices,s);let r=0;for(const{distance:o}of n.edges)r+=o;this._currentSelelection={perimeter:r,area:i}}newLabel(e,t){if(!e.boundingSphere)throw new Error("Error computing area geometry");if(!this.world)throw new Error("The face measurement needs a world to work!");const{center:s}=e.boundingSphere,n=Ws(),i=Math.trunc(t*100)/100;n.textContent=i.toString();const r=new mt(this.world,n);return r.three.position.copy(s),r}regenerateHighlight(e,t,s){const n=[],i=[];let r=0,o=0;const l=new Gs,u=this.components.get(Br);for(const m of t){const{p1:E,p2:w,p3:y}=u.getVerticesAndNormal(e,m,s);n.push(E.x,E.y,E.z),n.push(w.x,w.y,w.z),n.push(y.x,y.y,y.z),l.set(E,w,y),o+=l.getArea(),i.push(r,r+1,r+2),r+=3}const d=new Float32Array(n),f=new gt(d,3);return this.preview.geometry.setAttribute("position",f),this.preview.geometry.setIndex(i),o}};T(bm,"uuid","30279548-1309-44f6-aa97-ce26eed73522");const Am=class $c extends Fe{constructor(e){super(e),T(this,"preview"),T(this,"tolerance",.3),T(this,"world"),T(this,"onDisposed",new $),T(this,"_enabled",!1),T(this,"_lineMaterial",new xs({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0})),T(this,"create",async()=>{if(!this.preview||!this.enabled||!this.preview.visible)return;const t=this.components.get(hi);t.world=this.world;const s=this.preview.startPoint.clone(),n=this.preview.endPoint.clone();t.createOnPoints(s,n)}),T(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}const t=this.components.get(zt).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}const{object:s,faceIndex:n,point:i}=t;if(n===void 0){this.preview.visible=!1;return}s instanceof re||s instanceof Ot?this.updateSelection(s,i,n,t.instanceId):this.preview.visible=!1}),T(this,"onKeydown",t=>{}),this.components.add($c.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){const t=document.createElement("div");t.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new tl(this.components,this.world,{start:new P,end:new P,lineMaterial:this._lineMaterial,endpointElement:t}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;const e=this.components.get(hi),t=e.enabled;e.enabled=!0,e.delete(),e.enabled=t}deleteAll(){this.components.get(hi).deleteAll()}endCreation(){}cancelCreation(){}get(){const e=this.components.get(hi).list,t=[];for(const s of e){const n=s.startPoint,i=s.endPoint,r=[n.x,n.y,n.z,i.x,i.y,i.z];t.push(r)}return t}set(e){const t=this.components.get(hi);t.world=this.world;for(const s of e){const[n,i,r,o,l,u]=s,d=new P(n,i,r),f=new P(o,l,u);t.createOnPoints(d,f)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,t,s,n){if(!this.preview||!e.geometry.index)return;const i=this.components.get(Br).getFace(e,s,n);if(!i)return;const{edges:r}=i;let o=Number.MAX_VALUE,l=[];for(const f of r){const[m,E]=f.points,w=Br.distanceFromPointToLine(t,m,E,!0);w<this.tolerance&&w<o&&(o=w,l=f.points)}if(!l.length){this.preview.visible=!1;return}const[u,d]=l;this.preview.startPoint=u,this.preview.endPoint=d,this.preview.visible=!0}};T(Am,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");class Sm extends ic{constructor(e,t,s){super(e,t,s),T(this,"threshold",50),T(this,"bboxThreshold",200),T(this,"maxLostTime",3e4),T(this,"maxHiddenTime",5e3),T(this,"boxes",new Map),T(this,"_geometry"),T(this,"_material",new Pt({transparent:!0,side:2,opacity:1})),T(this,"onViewUpdated",new bs),T(this,"_modelIDIndex",new Map),T(this,"_indexModelID",new Map),T(this,"_nextModelID",0),T(this,"_geometries",new Map),T(this,"_geometriesGroups",new Map),T(this,"_foundGeometries",new Set),T(this,"_intervalID",null),T(this,"codes",new Map),T(this,"handleWorkerMessage",async i=>{const r=i.data.colors,o={},l={},u={},d={},f=performance.now();let m=!1;const E=new Set(this._foundGeometries);for(const[w,y]of r){const A=this._geometries.get(w);if(!A)continue;const S=y>this.threshold,{exists:x}=A;if(!S&&!x)continue;const R=this._indexModelID.get(A.modelIndex);E.delete(w),S&&x?(A.time=f,d[R]||(d[R]=new Set),d[R].add(A.geometryID),this._foundGeometries.add(w),m=!0):S&&!x?(o[R]||(o[R]=new Map),A.time=f,A.exists=!0,o[R].has(y)||o[R].set(y,new Set),o[R].get(y).add(A.geometryID),this._foundGeometries.add(w),m=!0):!S&&x&&(this.handleLostGeometries(f,w,A,l,u),m=!0)}m&&await this.onViewUpdated.trigger({toLoad:o,toRemove:l,toHide:u,toShow:d}),this._isWorkerBusy=!1}),this.updateInterval=500,this._geometry=new tt(1,1,1),this._geometry.groups=[],this._geometry.deleteAttribute("uv");const n=this._geometry.attributes.position.array;for(let i=0;i<n.length;i++)n[i]+=.5;this._geometry.attributes.position.needsUpdate=!0,this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._intervalID=window.setInterval(this.updateVisibility,this.updateInterval))}dispose(){super.dispose(),this.onViewUpdated.reset(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null);for(const[e,t]of this._geometriesGroups){t.removeFromParent();const s=[...t.children];for(const n of s)n.removeFromParent()}this._geometriesGroups.clear();for(const[e,t]of this.boxes)t.dispose(!0);this.boxes.clear();for(const[e,t]of this._geometries)t.fragment&&(t.fragment.dispose(!0),t.fragment=void 0);this._geometries.clear(),this._geometry.dispose(),this._material.dispose(),this._modelIDIndex.clear(),this._indexModelID.clear(),this.codes.clear()}add(e,t,s){const n=this.createModelIndex(e),i=as.enabled;as.enabled=!1;const r=new Map,o=new me,l=new Lr(this._geometry,this._material,10);this.boxes.set(n,l),this.scene.add(l.mesh);const u=new Nr;this.scene.add(u),this._geometriesGroups.set(n,u);const d=new Map;for(const m of t)for(const E of m.geometries){const{geometryID:w,transformation:y,color:A}=E,S=new Et;S.setRGB(A[0],A[1],A[2],"srgb");const x=this.getInstanceID(m.id,w),R=s[w];if(!R){console.log(`Geometry not found: ${w}`);continue}const{boundingBox:C}=R;let M;r.has(w)?M=r.get(w):(M=this.getAvailableColor(),this.increaseColor(),r.set(w,M));const{r:k,g:G,b:H,code:W}=M,Z=new Et;Z.setRGB(k/255,G/255,H/255,"srgb"),this.codes.has(n)||this.codes.set(n,new Map),this.codes.get(n).set(w,W);const J=new me,te=Object.values(C);if(J.fromArray(y),o.fromArray(te),J.multiply(o),d.has(x)){const se=d.get(x);if(se===void 0||!se.colors)throw new Error("Malformed item!");se.colors.push(Z),se.geometryColors.push(S),se.transforms.push(J)}else d.set(x,{id:x,colors:[Z],geometryColors:[S],transforms:[J]});if(this._geometries.has(W))this._geometries.get(W).assetIDs.add(m.id);else{const se=new Set([m.id]);this._geometries.set(W,{modelIndex:n,geometryID:w,assetIDs:se,exists:!1,hidden:!1,time:0})}}const f=Array.from(d.values());l.add(f),as.enabled=i}remove(e){const t=this._modelIDIndex.get(e);if(t===void 0)throw new Error("Model doesn't exist!");const s=this._geometriesGroups.get(t);s.removeFromParent();const n=[...s.children];for(const r of n)r.removeFromParent();this._geometriesGroups.delete(t),this.boxes.get(t).dispose(!1),this.boxes.delete(t);const i=this.codes.get(t);this.codes.delete(t);for(const[r,o]of i){const l=this._geometries.get(o);l&&l.fragment&&(l.fragment.dispose(!1),l.fragment=void 0),this._geometries.delete(o)}this._modelIDIndex.delete(e),this._indexModelID.delete(t),this._foundGeometries.clear()}addFragment(e,t,s){const n=as.enabled;as.enabled=!1;const i=this._modelIDIndex.get(e),r=this.codes.get(i).get(t),o=this._geometries.get(r);if(this.setGeometryVisibility(o,!1,!1),!o.fragment){o.fragment=new Lr(s.mesh.geometry,this._material,s.capacity);const m=this._geometriesGroups.get(i);if(!m)throw new Error("Group not found!");m.add(o.fragment.mesh)}const[l,u,d]=r.split("-").map(m=>parseInt(m,10)),f=[];for(const m of s.ids){const E=s.get(m);if(!E.colors)throw new Error("Malformed fragments!");for(const w of E.colors)w.setRGB(l/255,u/255,d/255,"srgb");f.push(E)}o.fragment.add(f),as.enabled=n,this.needsUpdate=!0}removeFragment(e,t){const s=this._modelIDIndex.get(e),n=this.codes.get(s).get(t),i=this._geometries.get(n);if(i.hidden||this.setGeometryVisibility(i,!0,!1),i.fragment){const{fragment:r}=i;r.dispose(!1),i.fragment=void 0}}setModelTransformation(e,t){const s=this._modelIDIndex.get(e);if(s===void 0)throw new Error("Model not found!");const n=this.boxes.get(s);n&&(n.mesh.position.set(0,0,0),n.mesh.rotation.set(0,0,0),n.mesh.scale.set(1,1,1),n.mesh.applyMatrix4(t));const i=this._geometriesGroups.get(s);i&&(i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),i.applyMatrix4(t))}setVisibility(e,t,s){const n=this._modelIDIndex.get(t);if(n!==void 0)for(const[i,r]of s){const o=this.codes.get(n);if(o===void 0)throw new Error("Map not found!");const l=o.get(i),u=this._geometries.get(l);if(u===void 0)throw new Error("Geometry not found!");u.hidden=!e,this.setGeometryVisibility(u,e,!0,r)}}setGeometryVisibility(e,t,s,n){const{modelIndex:i,geometryID:r,assetIDs:o}=e,l=this.boxes.get(i);if(l===void 0)throw new Error("Model not found!");const u=n||o;if(s&&e.fragment)e.fragment.setVisibility(t,u);else{const d=new Set;for(const f of u){const m=this.getInstanceID(f,r);d.add(m)}l.setVisibility(t,d)}}handleLostGeometries(e,t,s,n,i){const r=this._indexModelID.get(s.modelIndex),o=e-s.time;o>this.maxLostTime?(n[r]||(n[r]=new Set),s.exists=!1,n[r].add(s.geometryID),this._foundGeometries.delete(t)):o>this.maxHiddenTime&&(i[r]||(i[r]=new Set),i[r].add(s.geometryID))}createModelIndex(e){if(this._modelIDIndex.has(e))throw new Error("Can't load the same model twice!");const t=this._nextModelID;return this._nextModelID++,this._modelIDIndex.set(e,t),this._indexModelID.set(t,e),t}getInstanceID(e,t){const s=10**(Math.log(t)*Math.LOG10E+1|0);return e+t/s}}var eu={exports:{}};(function(c,e){(function(t,s){c.exports=s()})(Rh,function(){var t=function(a,h){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,g){p.__proto__=g}||function(p,g){for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(p[v]=g[v])})(a,h)},s=function(){return(s=Object.assign||function(a){for(var h,p=1,g=arguments.length;p<g;p++)for(var v in h=arguments[p])Object.prototype.hasOwnProperty.call(h,v)&&(a[v]=h[v]);return a}).apply(this,arguments)};function n(a,h,p){for(var g,v=0,I=h.length;v<I;v++)!g&&v in h||((g=g||Array.prototype.slice.call(h,0,v))[v]=h[v]);return a.concat(g||Array.prototype.slice.call(h))}var i=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Rh,r=Object.keys,o=Array.isArray;function l(a,h){return typeof h!="object"||r(h).forEach(function(p){a[p]=h[p]}),a}typeof Promise>"u"||i.Promise||(i.Promise=Promise);var u=Object.getPrototypeOf,d={}.hasOwnProperty;function f(a,h){return d.call(a,h)}function m(a,h){typeof h=="function"&&(h=h(u(a))),(typeof Reflect>"u"?r:Reflect.ownKeys)(h).forEach(function(p){w(a,p,h[p])})}var E=Object.defineProperty;function w(a,h,p,g){E(a,h,l(p&&f(p,"get")&&typeof p.get=="function"?{get:p.get,set:p.set,configurable:!0}:{value:p,configurable:!0,writable:!0},g))}function y(a){return{from:function(h){return a.prototype=Object.create(h.prototype),w(a.prototype,"constructor",a),{extend:m.bind(null,a.prototype)}}}}var A=Object.getOwnPropertyDescriptor,S=[].slice;function x(a,h,p){return S.call(a,h,p)}function R(a,h){return h(a)}function C(a){if(!a)throw new Error("Assertion Failed")}function M(a){i.setImmediate?setImmediate(a):setTimeout(a,0)}function k(a,h){if(typeof h=="string"&&f(a,h))return a[h];if(!h)return a;if(typeof h!="string"){for(var p=[],g=0,v=h.length;g<v;++g){var I=k(a,h[g]);p.push(I)}return p}var F=h.indexOf(".");if(F!==-1){var O=a[h.substr(0,F)];return O==null?void 0:k(O,h.substr(F+1))}}function G(a,h,p){if(a&&h!==void 0&&!("isFrozen"in Object&&Object.isFrozen(a)))if(typeof h!="string"&&"length"in h){C(typeof p!="string"&&"length"in p);for(var g=0,v=h.length;g<v;++g)G(a,h[g],p[g])}else{var I,F,O=h.indexOf(".");O!==-1?(I=h.substr(0,O),(F=h.substr(O+1))===""?p===void 0?o(a)&&!isNaN(parseInt(I))?a.splice(I,1):delete a[I]:a[I]=p:G(O=!(O=a[I])||!f(a,I)?a[I]={}:O,F,p)):p===void 0?o(a)&&!isNaN(parseInt(h))?a.splice(h,1):delete a[h]:a[h]=p}}function H(a){var h,p={};for(h in a)f(a,h)&&(p[h]=a[h]);return p}var W=[].concat;function Z(a){return W.apply([],a)}var ss="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Z([8,16,32,64].map(function(a){return["Int","Uint","Float"].map(function(h){return h+a+"Array"})}))).filter(function(a){return i[a]}),J=new Set(ss.map(function(a){return i[a]})),te=null;function se(a){return te=new WeakMap,a=function h(p){if(!p||typeof p!="object")return p;var g=te.get(p);if(g)return g;if(o(p)){g=[],te.set(p,g);for(var v=0,I=p.length;v<I;++v)g.push(h(p[v]))}else if(J.has(p.constructor))g=p;else{var F,O=u(p);for(F in g=O===Object.prototype?{}:Object.create(O),te.set(p,g),p)f(p,F)&&(g[F]=h(p[F]))}return g}(a),te=null,a}var ue={}.toString;function we(a){return ue.call(a).slice(8,-1)}var ce=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ge=typeof ce=="symbol"?function(a){var h;return a!=null&&(h=a[ce])&&h.apply(a)}:function(){return null};function pe(a,h){return h=a.indexOf(h),0<=h&&a.splice(h,1),0<=h}var Ie={};function je(a){var h,p,g,v;if(arguments.length===1){if(o(a))return a.slice();if(this===Ie&&typeof a=="string")return[a];if(v=ge(a)){for(p=[];!(g=v.next()).done;)p.push(g.value);return p}if(a==null)return[a];if(typeof(h=a.length)!="number")return[a];for(p=new Array(h);h--;)p[h]=a[h];return p}for(h=arguments.length,p=new Array(h);h--;)p[h]=arguments[h];return p}var Mt=typeof Symbol<"u"?function(a){return a[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},_n=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Tt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(_n),Js={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ct(a,h){this.name=a,this.message=h}function Mn(a,h){return a+". Errors: "+Object.keys(h).map(function(p){return h[p].toString()}).filter(function(p,g,v){return v.indexOf(p)===g}).join(`
`)}function Rs(a,h,p,g){this.failures=h,this.failedKeys=g,this.successCount=p,this.message=Mn(a,h)}function $t(a,h){this.name="BulkError",this.failures=Object.keys(h).map(function(p){return h[p]}),this.failuresByPos=h,this.message=Mn(a,this.failures)}y(Ct).from(Error).extend({toString:function(){return this.name+": "+this.message}}),y(Rs).from(Ct),y($t).from(Ct);var es=Tt.reduce(function(a,h){return a[h]=h+"Error",a},{}),Ke=Ct,de=Tt.reduce(function(a,h){var p=h+"Error";function g(v,I){this.name=p,v?typeof v=="string"?(this.message="".concat(v).concat(I?`
 `+I:""),this.inner=I||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=Js[h]||p,this.inner=null)}return y(g).from(Ke),a[h]=g,a},{});de.Syntax=SyntaxError,de.Type=TypeError,de.Range=RangeError;var Ve=_n.reduce(function(a,h){return a[h+"Error"]=de[h],a},{}),Dt=Tt.reduce(function(a,h){return["Syntax","Type","Range"].indexOf(h)===-1&&(a[h+"Error"]=de[h]),a},{});function Oe(){}function Vt(a){return a}function Qr(a,h){return a==null||a===Vt?h:function(p){return h(a(p))}}function Lt(a,h){return function(){a.apply(this,arguments),h.apply(this,arguments)}}function Dn(a,h){return a===Oe?h:function(){var p=a.apply(this,arguments);p!==void 0&&(arguments[0]=p);var g=this.onsuccess,v=this.onerror;this.onsuccess=null,this.onerror=null;var I=h.apply(this,arguments);return g&&(this.onsuccess=this.onsuccess?Lt(g,this.onsuccess):g),v&&(this.onerror=this.onerror?Lt(v,this.onerror):v),I!==void 0?I:p}}function Ln(a,h){return a===Oe?h:function(){a.apply(this,arguments);var p=this.onsuccess,g=this.onerror;this.onsuccess=this.onerror=null,h.apply(this,arguments),p&&(this.onsuccess=this.onsuccess?Lt(p,this.onsuccess):p),g&&(this.onerror=this.onerror?Lt(g,this.onerror):g)}}function nu(a,h){return a===Oe?h:function(p){var g=a.apply(this,arguments);l(p,g);var v=this.onsuccess,I=this.onerror;return this.onsuccess=null,this.onerror=null,p=h.apply(this,arguments),v&&(this.onsuccess=this.onsuccess?Lt(v,this.onsuccess):v),I&&(this.onerror=this.onerror?Lt(I,this.onerror):I),g===void 0?p===void 0?void 0:p:l(g,p)}}function iu(a,h){return a===Oe?h:function(){return h.apply(this,arguments)!==!1&&a.apply(this,arguments)}}function qr(a,h){return a===Oe?h:function(){var p=a.apply(this,arguments);if(p&&typeof p.then=="function"){for(var g=this,v=arguments.length,I=new Array(v);v--;)I[v]=arguments[v];return p.then(function(){return h.apply(g,I)})}return h.apply(this,arguments)}}Dt.ModifyError=Rs,Dt.DexieError=Ct,Dt.BulkError=$t;var Gt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function nl(a){Gt=a}var Nn={},il=100,ss=typeof Promise>"u"?[]:function(){var a=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[a,u(a),a];var h=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[h,u(h),a]}(),_n=ss[0],Tt=ss[1],ss=ss[2],Tt=Tt&&Tt.then,Un=_n&&_n.constructor,Jr=!!ss,Bn=function(a,h){kn.push([a,h]),Ti&&(queueMicrotask(ou),Ti=!1)},$r=!0,Ti=!0,Ps=[],bi=[],eo=Vt,ds={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Oe,pgp:!1,env:{},finalize:Oe},fe=ds,kn=[],Os=0,Ai=[];function he(a){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var h=this._PSD=fe;if(typeof a!="function"){if(a!==Nn)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&so(this,this._value))}this._state=null,this._value=null,++h.ref,function p(g,v){try{v(function(I){if(g._state===null){if(I===g)throw new TypeError("A promise cannot be resolved with itself.");var F=g._lib&&$s();I&&typeof I.then=="function"?p(g,function(O,_){I instanceof he?I._then(O,_):I.then(O,_)}):(g._state=!0,g._value=I,ol(g)),F&&en()}},so.bind(null,g))}catch(I){so(g,I)}}(this,a)}var to={get:function(){var a=fe,h=Ri;function p(g,v){var I=this,F=!a.global&&(a!==fe||h!==Ri),O=F&&!fs(),_=new he(function(L,z){no(I,new rl(ll(g,a,F,O),ll(v,a,F,O),L,z,a))});return this._consoleTask&&(_._consoleTask=this._consoleTask),_}return p.prototype=Nn,p},set:function(a){w(this,"then",a&&a.prototype===Nn?to:{get:function(){return a},set:to.set})}};function rl(a,h,p,g,v){this.onFulfilled=typeof a=="function"?a:null,this.onRejected=typeof h=="function"?h:null,this.resolve=p,this.reject=g,this.psd=v}function so(a,h){var p,g;bi.push(h),a._state===null&&(p=a._lib&&$s(),h=eo(h),a._state=!1,a._value=h,g=a,Ps.some(function(v){return v._value===g._value})||Ps.push(g),ol(a),p&&en())}function ol(a){var h=a._listeners;a._listeners=[];for(var p=0,g=h.length;p<g;++p)no(a,h[p]);var v=a._PSD;--v.ref||v.finalize(),Os===0&&(++Os,Bn(function(){--Os==0&&io()},[]))}function no(a,h){if(a._state!==null){var p=a._state?h.onFulfilled:h.onRejected;if(p===null)return(a._state?h.resolve:h.reject)(a._value);++h.psd.ref,++Os,Bn(ru,[p,a,h])}else a._listeners.push(h)}function ru(a,h,p){try{var g,v=h._value;!h._state&&bi.length&&(bi=[]),g=Gt&&h._consoleTask?h._consoleTask.run(function(){return a(v)}):a(v),h._state||bi.indexOf(v)!==-1||function(I){for(var F=Ps.length;F;)if(Ps[--F]._value===I._value)return Ps.splice(F,1)}(h),p.resolve(g)}catch(I){p.reject(I)}finally{--Os==0&&io(),--p.psd.ref||p.psd.finalize()}}function ou(){Ms(ds,function(){$s()&&en()})}function $s(){var a=$r;return Ti=$r=!1,a}function en(){var a,h,p;do for(;0<kn.length;)for(a=kn,kn=[],p=a.length,h=0;h<p;++h){var g=a[h];g[0].apply(null,g[1])}while(0<kn.length);Ti=$r=!0}function io(){var a=Ps;Ps=[],a.forEach(function(g){g._PSD.onunhandled.call(null,g._value,g)});for(var h=Ai.slice(0),p=h.length;p;)h[--p]()}function Si(a){return new he(Nn,!1,a)}function ze(a,h){var p=fe;return function(){var g=$s(),v=fe;try{return ms(p,!0),a.apply(this,arguments)}catch(I){h&&h(I)}finally{ms(v,!1),g&&en()}}}m(he.prototype,{then:to,_then:function(a,h){no(this,new rl(null,null,a,h,fe))},catch:function(a){if(arguments.length===1)return this.then(null,a);var h=a,p=arguments[1];return typeof h=="function"?this.then(null,function(g){return(g instanceof h?p:Si)(g)}):this.then(null,function(g){return(g&&g.name===h?p:Si)(g)})},finally:function(a){return this.then(function(h){return he.resolve(a()).then(function(){return h})},function(h){return he.resolve(a()).then(function(){return Si(h)})})},timeout:function(a,h){var p=this;return a<1/0?new he(function(g,v){var I=setTimeout(function(){return v(new de.Timeout(h))},a);p.then(g,v).finally(clearTimeout.bind(null,I))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&w(he.prototype,Symbol.toStringTag,"Dexie.Promise"),ds.env=al(),m(he,{all:function(){var a=je.apply(null,arguments).map(Pi);return new he(function(h,p){a.length===0&&h([]);var g=a.length;a.forEach(function(v,I){return he.resolve(v).then(function(F){a[I]=F,--g||h(a)},p)})})},resolve:function(a){return a instanceof he?a:a&&typeof a.then=="function"?new he(function(h,p){a.then(h,p)}):new he(Nn,!0,a)},reject:Si,race:function(){var a=je.apply(null,arguments).map(Pi);return new he(function(h,p){a.map(function(g){return he.resolve(g).then(h,p)})})},PSD:{get:function(){return fe},set:function(a){return fe=a}},totalEchoes:{get:function(){return Ri}},newPSD:ps,usePSD:Ms,scheduler:{get:function(){return Bn},set:function(a){Bn=a}},rejectionMapper:{get:function(){return eo},set:function(a){eo=a}},follow:function(a,h){return new he(function(p,g){return ps(function(v,I){var F=fe;F.unhandleds=[],F.onunhandled=I,F.finalize=Lt(function(){var O,_=this;O=function(){_.unhandleds.length===0?v():I(_.unhandleds[0])},Ai.push(function L(){O(),Ai.splice(Ai.indexOf(L),1)}),++Os,Bn(function(){--Os==0&&io()},[])},F.finalize),a()},h,p,g)})}}),Un&&(Un.allSettled&&w(he,"allSettled",function(){var a=je.apply(null,arguments).map(Pi);return new he(function(h){a.length===0&&h([]);var p=a.length,g=new Array(p);a.forEach(function(v,I){return he.resolve(v).then(function(F){return g[I]={status:"fulfilled",value:F}},function(F){return g[I]={status:"rejected",reason:F}}).then(function(){return--p||h(g)})})})}),Un.any&&typeof AggregateError<"u"&&w(he,"any",function(){var a=je.apply(null,arguments).map(Pi);return new he(function(h,p){a.length===0&&p(new AggregateError([]));var g=a.length,v=new Array(g);a.forEach(function(I,F){return he.resolve(I).then(function(O){return h(O)},function(O){v[F]=O,--g||p(new AggregateError(v))})})})}));var Je={awaits:0,echoes:0,id:0},au=0,Fi=[],xi=0,Ri=0,lu=0;function ps(a,h,p,g){var v=fe,I=Object.create(v);return I.parent=v,I.ref=0,I.global=!1,I.id=++lu,ds.env,I.env=Jr?{Promise:he,PromiseProp:{value:he,configurable:!0,writable:!0},all:he.all,race:he.race,allSettled:he.allSettled,any:he.any,resolve:he.resolve,reject:he.reject}:{},h&&l(I,h),++v.ref,I.finalize=function(){--this.parent.ref||this.parent.finalize()},g=Ms(I,a,p,g),I.ref===0&&I.finalize(),g}function tn(){return Je.id||(Je.id=++au),++Je.awaits,Je.echoes+=il,Je.id}function fs(){return!!Je.awaits&&(--Je.awaits==0&&(Je.id=0),Je.echoes=Je.awaits*il,!0)}function Pi(a){return Je.echoes&&a&&a.constructor===Un?(tn(),a.then(function(h){return fs(),h},function(h){return fs(),We(h)})):a}function hu(){var a=Fi[Fi.length-1];Fi.pop(),ms(a,!1)}function ms(a,h){var p,g=fe;(h?!Je.echoes||xi++&&a===fe:!xi||--xi&&a===fe)||queueMicrotask(h?(function(v){++Ri,Je.echoes&&--Je.echoes!=0||(Je.echoes=Je.awaits=Je.id=0),Fi.push(fe),ms(v,!0)}).bind(null,a):hu),a!==fe&&(fe=a,g===ds&&(ds.env=al()),Jr&&(p=ds.env.Promise,h=a.env,(g.global||a.global)&&(Object.defineProperty(i,"Promise",h.PromiseProp),p.all=h.all,p.race=h.race,p.resolve=h.resolve,p.reject=h.reject,h.allSettled&&(p.allSettled=h.allSettled),h.any&&(p.any=h.any))))}function al(){var a=i.Promise;return Jr?{Promise:a,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:a.all,race:a.race,allSettled:a.allSettled,any:a.any,resolve:a.resolve,reject:a.reject}:{}}function Ms(a,h,p,g,v){var I=fe;try{return ms(a,!0),h(p,g,v)}finally{ms(I,!1)}}function ll(a,h,p,g){return typeof a!="function"?a:function(){var v=fe;p&&tn(),ms(h,!0);try{return a.apply(this,arguments)}finally{ms(v,!1),g&&queueMicrotask(fs)}}}function ro(a){Promise===Un&&Je.echoes===0?xi===0?a():enqueueNativeMicroTask(a):setTimeout(a,0)}(""+Tt).indexOf("[native code]")===-1&&(tn=fs=Oe);var We=he.reject,Ds="￿",ts="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",hl="String expected.",sn=[],Oi="__dbnames",oo="readonly",ao="readwrite";function Ls(a,h){return a?h?function(){return a.apply(this,arguments)&&h.apply(this,arguments)}:a:h}var cl={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Mi(a){return typeof a!="string"||/\./.test(a)?function(h){return h}:function(h){return h[a]===void 0&&a in h&&delete(h=se(h))[a],h}}function ul(){throw de.Type()}function Pe(a,h){try{var p=dl(a),g=dl(h);if(p!==g)return p==="Array"?1:g==="Array"?-1:p==="binary"?1:g==="binary"?-1:p==="string"?1:g==="string"?-1:p==="Date"?1:g!=="Date"?NaN:-1;switch(p){case"number":case"Date":case"string":return h<a?1:a<h?-1:0;case"binary":return function(v,I){for(var F=v.length,O=I.length,_=F<O?F:O,L=0;L<_;++L)if(v[L]!==I[L])return v[L]<I[L]?-1:1;return F===O?0:F<O?-1:1}(pl(a),pl(h));case"Array":return function(v,I){for(var F=v.length,O=I.length,_=F<O?F:O,L=0;L<_;++L){var z=Pe(v[L],I[L]);if(z!==0)return z}return F===O?0:F<O?-1:1}(a,h)}}catch{}return NaN}function dl(a){var h=typeof a;return h!="object"?h:ArrayBuffer.isView(a)?"binary":(a=we(a),a==="ArrayBuffer"?"binary":a)}function pl(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a)}var fl=(_e.prototype._trans=function(a,h,p){var g=this._tx||fe.trans,v=this.name,I=Gt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(a==="readonly"?"read":"write"," ").concat(this.name));function F(L,z,D){if(!D.schema[v])throw new de.NotFound("Table "+v+" not part of transaction");return h(D.idbtrans,D)}var O=$s();try{var _=g&&g.db._novip===this.db._novip?g===fe.trans?g._promise(a,F,p):ps(function(){return g._promise(a,F,p)},{trans:g,transless:fe.transless||fe}):function L(z,D,Y,N){if(z.idbdb&&(z._state.openComplete||fe.letThrough||z._vip)){var U=z._createTransaction(D,Y,z._dbSchema);try{U.create(),z._state.PR1398_maxLoop=3}catch(V){return V.name===es.InvalidState&&z.isOpen()&&0<--z._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),z.close({disableAutoOpen:!1}),z.open().then(function(){return L(z,D,Y,N)})):We(V)}return U._promise(D,function(V,B){return ps(function(){return fe.trans=U,N(V,B,U)})}).then(function(V){if(D==="readwrite")try{U.idbtrans.commit()}catch{}return D==="readonly"?V:U._completion.then(function(){return V})})}if(z._state.openComplete)return We(new de.DatabaseClosed(z._state.dbOpenError));if(!z._state.isBeingOpened){if(!z._state.autoOpen)return We(new de.DatabaseClosed);z.open().catch(Oe)}return z._state.dbReadyPromise.then(function(){return L(z,D,Y,N)})}(this.db,a,[this.name],F);return I&&(_._consoleTask=I,_=_.catch(function(L){return console.trace(L),We(L)})),_}finally{O&&en()}},_e.prototype.get=function(a,h){var p=this;return a&&a.constructor===Object?this.where(a).first(h):a==null?We(new de.Type("Invalid argument to Table.get()")):this._trans("readonly",function(g){return p.core.get({trans:g,key:a}).then(function(v){return p.hook.reading.fire(v)})}).then(h)},_e.prototype.where=function(a){if(typeof a=="string")return new this.db.WhereClause(this,a);if(o(a))return new this.db.WhereClause(this,"[".concat(a.join("+"),"]"));var h=r(a);if(h.length===1)return this.where(h[0]).equals(a[h[0]]);var p=this.schema.indexes.concat(this.schema.primKey).filter(function(_){if(_.compound&&h.every(function(z){return 0<=_.keyPath.indexOf(z)})){for(var L=0;L<h.length;++L)if(h.indexOf(_.keyPath[L])===-1)return!1;return!0}return!1}).sort(function(_,L){return _.keyPath.length-L.keyPath.length})[0];if(p&&this.db._maxKey!==Ds){var F=p.keyPath.slice(0,h.length);return this.where(F).equals(F.map(function(L){return a[L]}))}!p&&Gt&&console.warn("The query ".concat(JSON.stringify(a)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(h.join("+"),"]"));var g=this.schema.idxByName,v=this.db._deps.indexedDB;function I(_,L){return v.cmp(_,L)===0}var O=h.reduce(function(Y,L){var z=Y[0],D=Y[1],Y=g[L],N=a[L];return[z||Y,z||!Y?Ls(D,Y&&Y.multi?function(U){return U=k(U,L),o(U)&&U.some(function(V){return I(N,V)})}:function(U){return I(N,k(U,L))}):D]},[null,null]),F=O[0],O=O[1];return F?this.where(F.name).equals(a[F.keyPath]).filter(O):p?this.filter(O):this.where(h).equals("")},_e.prototype.filter=function(a){return this.toCollection().and(a)},_e.prototype.count=function(a){return this.toCollection().count(a)},_e.prototype.offset=function(a){return this.toCollection().offset(a)},_e.prototype.limit=function(a){return this.toCollection().limit(a)},_e.prototype.each=function(a){return this.toCollection().each(a)},_e.prototype.toArray=function(a){return this.toCollection().toArray(a)},_e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},_e.prototype.orderBy=function(a){return new this.db.Collection(new this.db.WhereClause(this,o(a)?"[".concat(a.join("+"),"]"):a))},_e.prototype.reverse=function(){return this.toCollection().reverse()},_e.prototype.mapToClass=function(a){var h,p=this.db,g=this.name;function v(){return h!==null&&h.apply(this,arguments)||this}(this.schema.mappedClass=a).prototype instanceof ul&&(function(_,L){if(typeof L!="function"&&L!==null)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function z(){this.constructor=_}t(_,L),_.prototype=L===null?Object.create(L):(z.prototype=L.prototype,new z)}(v,h=a),Object.defineProperty(v.prototype,"db",{get:function(){return p},enumerable:!1,configurable:!0}),v.prototype.table=function(){return g},a=v);for(var I=new Set,F=a.prototype;F;F=u(F))Object.getOwnPropertyNames(F).forEach(function(_){return I.add(_)});function O(_){if(!_)return _;var L,z=Object.create(a.prototype);for(L in _)if(!I.has(L))try{z[L]=_[L]}catch{}return z}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=O,this.hook("reading",O),a},_e.prototype.defineClass=function(){return this.mapToClass(function(a){l(this,a)})},_e.prototype.add=function(a,h){var p=this,g=this.schema.primKey,v=g.auto,I=g.keyPath,F=a;return I&&v&&(F=Mi(I)(a)),this._trans("readwrite",function(O){return p.core.mutate({trans:O,type:"add",keys:h!=null?[h]:null,values:[F]})}).then(function(O){return O.numFailures?he.reject(O.failures[0]):O.lastResult}).then(function(O){if(I)try{G(a,I,O)}catch{}return O})},_e.prototype.update=function(a,h){return typeof a!="object"||o(a)?this.where(":id").equals(a).modify(h):(a=k(a,this.schema.primKey.keyPath),a===void 0?We(new de.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(a).modify(h))},_e.prototype.put=function(a,h){var p=this,g=this.schema.primKey,v=g.auto,I=g.keyPath,F=a;return I&&v&&(F=Mi(I)(a)),this._trans("readwrite",function(O){return p.core.mutate({trans:O,type:"put",values:[F],keys:h!=null?[h]:null})}).then(function(O){return O.numFailures?he.reject(O.failures[0]):O.lastResult}).then(function(O){if(I)try{G(a,I,O)}catch{}return O})},_e.prototype.delete=function(a){var h=this;return this._trans("readwrite",function(p){return h.core.mutate({trans:p,type:"delete",keys:[a]})}).then(function(p){return p.numFailures?he.reject(p.failures[0]):void 0})},_e.prototype.clear=function(){var a=this;return this._trans("readwrite",function(h){return a.core.mutate({trans:h,type:"deleteRange",range:cl})}).then(function(h){return h.numFailures?he.reject(h.failures[0]):void 0})},_e.prototype.bulkGet=function(a){var h=this;return this._trans("readonly",function(p){return h.core.getMany({keys:a,trans:p}).then(function(g){return g.map(function(v){return h.hook.reading.fire(v)})})})},_e.prototype.bulkAdd=function(a,h,p){var g=this,v=Array.isArray(h)?h:void 0,I=(p=p||(v?void 0:h))?p.allKeys:void 0;return this._trans("readwrite",function(F){var L=g.schema.primKey,O=L.auto,L=L.keyPath;if(L&&v)throw new de.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==a.length)throw new de.InvalidArgument("Arguments objects and keys must have the same length");var _=a.length,L=L&&O?a.map(Mi(L)):a;return g.core.mutate({trans:F,type:"add",keys:v,values:L,wantResults:I}).then(function(U){var D=U.numFailures,Y=U.results,N=U.lastResult,U=U.failures;if(D===0)return I?Y:N;throw new $t("".concat(g.name,".bulkAdd(): ").concat(D," of ").concat(_," operations failed"),U)})})},_e.prototype.bulkPut=function(a,h,p){var g=this,v=Array.isArray(h)?h:void 0,I=(p=p||(v?void 0:h))?p.allKeys:void 0;return this._trans("readwrite",function(F){var L=g.schema.primKey,O=L.auto,L=L.keyPath;if(L&&v)throw new de.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==a.length)throw new de.InvalidArgument("Arguments objects and keys must have the same length");var _=a.length,L=L&&O?a.map(Mi(L)):a;return g.core.mutate({trans:F,type:"put",keys:v,values:L,wantResults:I}).then(function(U){var D=U.numFailures,Y=U.results,N=U.lastResult,U=U.failures;if(D===0)return I?Y:N;throw new $t("".concat(g.name,".bulkPut(): ").concat(D," of ").concat(_," operations failed"),U)})})},_e.prototype.bulkUpdate=function(a){var h=this,p=this.core,g=a.map(function(F){return F.key}),v=a.map(function(F){return F.changes}),I=[];return this._trans("readwrite",function(F){return p.getMany({trans:F,keys:g,cache:"clone"}).then(function(O){var _=[],L=[];a.forEach(function(D,Y){var N=D.key,U=D.changes,V=O[Y];if(V){for(var B=0,j=Object.keys(U);B<j.length;B++){var K=j[B],X=U[K];if(K===h.schema.primKey.keyPath){if(Pe(X,N)!==0)throw new de.Constraint("Cannot update primary key in bulkUpdate()")}else G(V,K,X)}I.push(Y),_.push(N),L.push(V)}});var z=_.length;return p.mutate({trans:F,type:"put",keys:_,values:L,updates:{keys:g,changeSpecs:v}}).then(function(D){var Y=D.numFailures,N=D.failures;if(Y===0)return z;for(var U=0,V=Object.keys(N);U<V.length;U++){var B,j=V[U],K=I[Number(j)];K!=null&&(B=N[j],delete N[j],N[K]=B)}throw new $t("".concat(h.name,".bulkUpdate(): ").concat(Y," of ").concat(z," operations failed"),N)})})})},_e.prototype.bulkDelete=function(a){var h=this,p=a.length;return this._trans("readwrite",function(g){return h.core.mutate({trans:g,type:"delete",keys:a})}).then(function(F){var v=F.numFailures,I=F.lastResult,F=F.failures;if(v===0)return I;throw new $t("".concat(h.name,".bulkDelete(): ").concat(v," of ").concat(p," operations failed"),F)})},_e);function _e(){}function zn(a){function h(F,O){if(O){for(var _=arguments.length,L=new Array(_-1);--_;)L[_-1]=arguments[_];return p[F].subscribe.apply(null,L),a}if(typeof F=="string")return p[F]}var p={};h.addEventType=I;for(var g=1,v=arguments.length;g<v;++g)I(arguments[g]);return h;function I(F,O,_){if(typeof F!="object"){var L;O=O||iu;var z={subscribers:[],fire:_=_||Oe,subscribe:function(D){z.subscribers.indexOf(D)===-1&&(z.subscribers.push(D),z.fire=O(z.fire,D))},unsubscribe:function(D){z.subscribers=z.subscribers.filter(function(Y){return Y!==D}),z.fire=z.subscribers.reduce(O,_)}};return p[F]=h[F]=z}r(L=F).forEach(function(D){var Y=L[D];if(o(Y))I(D,L[D][0],L[D][1]);else{if(Y!=="asap")throw new de.InvalidArgument("Invalid event config");var N=I(D,Vt,function(){for(var U=arguments.length,V=new Array(U);U--;)V[U]=arguments[U];N.subscribers.forEach(function(B){M(function(){B.apply(null,V)})})})}})}}function Yn(a,h){return y(h).from({prototype:a}),h}function nn(a,h){return!(a.filter||a.algorithm||a.or)&&(h?a.justLimit:!a.replayFilter)}function lo(a,h){a.filter=Ls(a.filter,h)}function ho(a,h,p){var g=a.replayFilter;a.replayFilter=g?function(){return Ls(g(),h())}:h,a.justLimit=p&&!g}function Di(a,h){if(a.isPrimKey)return h.primaryKey;var p=h.getIndexByKeyPath(a.index);if(!p)throw new de.Schema("KeyPath "+a.index+" on object store "+h.name+" is not indexed");return p}function ml(a,h,p){var g=Di(a,h.schema);return h.openCursor({trans:p,values:!a.keysOnly,reverse:a.dir==="prev",unique:!!a.unique,query:{index:g,range:a.range}})}function Li(a,h,p,g){var v=a.replayFilter?Ls(a.filter,a.replayFilter()):a.filter;if(a.or){var I={},F=function(O,_,L){var z,D;v&&!v(_,L,function(Y){return _.stop(Y)},function(Y){return _.fail(Y)})||((D=""+(z=_.primaryKey))=="[object ArrayBuffer]"&&(D=""+new Uint8Array(z)),f(I,D)||(I[D]=!0,h(O,_,L)))};return Promise.all([a.or._iterate(F,p),gl(ml(a,g,p),a.algorithm,F,!a.keysOnly&&a.valueMapper)])}return gl(ml(a,g,p),Ls(a.algorithm,v),h,!a.keysOnly&&a.valueMapper)}function gl(a,h,p,g){var v=ze(g?function(I,F,O){return p(g(I),F,O)}:p);return a.then(function(I){if(I)return I.start(function(){var F=function(){return I.continue()};h&&!h(I,function(O){return F=O},function(O){I.stop(O),F=Oe},function(O){I.fail(O),F=Oe})||v(I.value,I,function(O){return F=O}),F()})})}var ss=Symbol(),co=(El.prototype.execute=function(a){var h=(h=this.replacePrefix)===null||h===void 0?void 0:h[0];return h&&typeof a=="string"&&a.startsWith(h)?this.replacePrefix[1]+a.substring(h.length):a},El);function El(a){Object.assign(this,a)}var cu=(xe.prototype._read=function(a,h){var p=this._ctx;return p.error?p.table._trans(null,We.bind(null,p.error)):p.table._trans("readonly",a).then(h)},xe.prototype._write=function(a){var h=this._ctx;return h.error?h.table._trans(null,We.bind(null,h.error)):h.table._trans("readwrite",a,"locked")},xe.prototype._addAlgorithm=function(a){var h=this._ctx;h.algorithm=Ls(h.algorithm,a)},xe.prototype._iterate=function(a,h){return Li(this._ctx,a,h,this._ctx.table.core)},xe.prototype.clone=function(a){var h=Object.create(this.constructor.prototype),p=Object.create(this._ctx);return a&&l(p,a),h._ctx=p,h},xe.prototype.raw=function(){return this._ctx.valueMapper=null,this},xe.prototype.each=function(a){var h=this._ctx;return this._read(function(p){return Li(h,a,p,h.table.core)})},xe.prototype.count=function(a){var h=this;return this._read(function(p){var g=h._ctx,v=g.table.core;if(nn(g,!0))return v.count({trans:p,query:{index:Di(g,v.schema),range:g.range}}).then(function(F){return Math.min(F,g.limit)});var I=0;return Li(g,function(){return++I,!1},p,v).then(function(){return I})}).then(a)},xe.prototype.sortBy=function(a,h){var p=a.split(".").reverse(),g=p[0],v=p.length-1;function I(_,L){return L?I(_[p[L]],L-1):_[g]}var F=this._ctx.dir==="next"?1:-1;function O(_,L){return _=I(_,v),L=I(L,v),_<L?-F:L<_?F:0}return this.toArray(function(_){return _.sort(O)}).then(h)},xe.prototype.toArray=function(a){var h=this;return this._read(function(p){var g=h._ctx;if(g.dir==="next"&&nn(g,!0)&&0<g.limit){var v=g.valueMapper,I=Di(g,g.table.core.schema);return g.table.core.query({trans:p,limit:g.limit,values:!0,query:{index:I,range:g.range}}).then(function(O){return O=O.result,v?O.map(v):O})}var F=[];return Li(g,function(O){return F.push(O)},p,g.table.core).then(function(){return F})},a)},xe.prototype.offset=function(a){var h=this._ctx;return a<=0||(h.offset+=a,nn(h)?ho(h,function(){var p=a;return function(g,v){return p===0||(p===1?--p:v(function(){g.advance(p),p=0}),!1)}}):ho(h,function(){var p=a;return function(){return--p<0}})),this},xe.prototype.limit=function(a){return this._ctx.limit=Math.min(this._ctx.limit,a),ho(this._ctx,function(){var h=a;return function(p,g,v){return--h<=0&&g(v),0<=h}},!0),this},xe.prototype.until=function(a,h){return lo(this._ctx,function(p,g,v){return!a(p.value)||(g(v),h)}),this},xe.prototype.first=function(a){return this.limit(1).toArray(function(h){return h[0]}).then(a)},xe.prototype.last=function(a){return this.reverse().first(a)},xe.prototype.filter=function(a){var h;return lo(this._ctx,function(p){return a(p.value)}),(h=this._ctx).isMatch=Ls(h.isMatch,a),this},xe.prototype.and=function(a){return this.filter(a)},xe.prototype.or=function(a){return new this.db.WhereClause(this._ctx.table,a,this)},xe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},xe.prototype.desc=function(){return this.reverse()},xe.prototype.eachKey=function(a){var h=this._ctx;return h.keysOnly=!h.isMatch,this.each(function(p,g){a(g.key,g)})},xe.prototype.eachUniqueKey=function(a){return this._ctx.unique="unique",this.eachKey(a)},xe.prototype.eachPrimaryKey=function(a){var h=this._ctx;return h.keysOnly=!h.isMatch,this.each(function(p,g){a(g.primaryKey,g)})},xe.prototype.keys=function(a){var h=this._ctx;h.keysOnly=!h.isMatch;var p=[];return this.each(function(g,v){p.push(v.key)}).then(function(){return p}).then(a)},xe.prototype.primaryKeys=function(a){var h=this._ctx;if(h.dir==="next"&&nn(h,!0)&&0<h.limit)return this._read(function(g){var v=Di(h,h.table.core.schema);return h.table.core.query({trans:g,values:!1,limit:h.limit,query:{index:v,range:h.range}})}).then(function(g){return g.result}).then(a);h.keysOnly=!h.isMatch;var p=[];return this.each(function(g,v){p.push(v.primaryKey)}).then(function(){return p}).then(a)},xe.prototype.uniqueKeys=function(a){return this._ctx.unique="unique",this.keys(a)},xe.prototype.firstKey=function(a){return this.limit(1).keys(function(h){return h[0]}).then(a)},xe.prototype.lastKey=function(a){return this.reverse().firstKey(a)},xe.prototype.distinct=function(){var a=this._ctx,a=a.index&&a.table.schema.idxByName[a.index];if(!a||!a.multi)return this;var h={};return lo(this._ctx,function(v){var g=v.primaryKey.toString(),v=f(h,g);return h[g]=!0,!v}),this},xe.prototype.modify=function(a){var h=this,p=this._ctx;return this._write(function(g){var v,I,F;F=typeof a=="function"?a:(v=r(a),I=v.length,function(B){for(var j=!1,K=0;K<I;++K){var X=v[K],Q=a[X],ee=k(B,X);Q instanceof co?(G(B,X,Q.execute(ee)),j=!0):ee!==Q&&(G(B,X,Q),j=!0)}return j});function O(B,X){var K=X.failures,X=X.numFailures;U+=B-X;for(var Q=0,ee=r(K);Q<ee.length;Q++){var oe=ee[Q];N.push(K[oe])}}var _=p.table.core,L=_.schema.primaryKey,z=L.outbound,D=L.extractKey,Y=h.db._options.modifyChunkSize||200,N=[],U=0,V=[];return h.clone().primaryKeys().then(function(B){function j(K){var X=Math.min(Y,B.length-K);return _.getMany({trans:g,keys:B.slice(K,K+X),cache:"immutable"}).then(function(Q){for(var ee=[],oe=[],ne=z?[]:null,ie=[],ae=0;ae<X;++ae){var le=Q[ae],ve={value:se(le),primKey:B[K+ae]};F.call(ve,ve.value,ve)!==!1&&(ve.value==null?ie.push(B[K+ae]):z||Pe(D(le),D(ve.value))===0?(oe.push(ve.value),z&&ne.push(B[K+ae])):(ie.push(B[K+ae]),ee.push(ve.value)))}var Te=nn(p)&&p.limit===1/0&&(typeof a!="function"||a===uo)&&{index:p.index,range:p.range};return Promise.resolve(0<ee.length&&_.mutate({trans:g,type:"add",values:ee}).then(function(Se){for(var be in Se.failures)ie.splice(parseInt(be),1);O(ee.length,Se)})).then(function(){return(0<oe.length||Te&&typeof a=="object")&&_.mutate({trans:g,type:"put",keys:ne,values:oe,criteria:Te,changeSpec:typeof a!="function"&&a}).then(function(Se){return O(oe.length,Se)})}).then(function(){return(0<ie.length||Te&&a===uo)&&_.mutate({trans:g,type:"delete",keys:ie,criteria:Te}).then(function(Se){return O(ie.length,Se)})}).then(function(){return B.length>K+X&&j(K+Y)})})}return j(0).then(function(){if(0<N.length)throw new Rs("Error modifying one or more objects",N,U,V);return B.length})})})},xe.prototype.delete=function(){var a=this._ctx,h=a.range;return nn(a)&&(a.isPrimKey||h.type===3)?this._write(function(p){var g=a.table.core.schema.primaryKey,v=h;return a.table.core.count({trans:p,query:{index:g,range:v}}).then(function(I){return a.table.core.mutate({trans:p,type:"deleteRange",range:v}).then(function(F){var O=F.failures;if(F.lastResult,F.results,F=F.numFailures,F)throw new Rs("Could not delete some values",Object.keys(O).map(function(_){return O[_]}),I-F);return I-F})})}):this.modify(uo)},xe);function xe(){}var uo=function(a,h){return h.value=null};function uu(a,h){return a<h?-1:a===h?0:1}function du(a,h){return h<a?-1:a===h?0:1}function vt(a,h,p){return a=a instanceof wl?new a.Collection(a):a,a._ctx.error=new(p||TypeError)(h),a}function rn(a){return new a.Collection(a,function(){return vl("")}).limit(0)}function Ni(a,h,p,g){var v,I,F,O,_,L,z,D=p.length;if(!p.every(function(U){return typeof U=="string"}))return vt(a,hl);function Y(U){v=U==="next"?function(B){return B.toUpperCase()}:function(B){return B.toLowerCase()},I=U==="next"?function(B){return B.toLowerCase()}:function(B){return B.toUpperCase()},F=U==="next"?uu:du;var V=p.map(function(B){return{lower:I(B),upper:v(B)}}).sort(function(B,j){return F(B.lower,j.lower)});O=V.map(function(B){return B.upper}),_=V.map(function(B){return B.lower}),z=(L=U)==="next"?"":g}Y("next"),a=new a.Collection(a,function(){return gs(O[0],_[D-1]+g)}),a._ondirectionchange=function(U){Y(U)};var N=0;return a._addAlgorithm(function(U,V,B){var j=U.key;if(typeof j!="string")return!1;var K=I(j);if(h(K,_,N))return!0;for(var X=null,Q=N;Q<D;++Q){var ee=function(oe,ne,ie,ae,le,ve){for(var Te=Math.min(oe.length,ae.length),Se=-1,be=0;be<Te;++be){var Nt=ne[be];if(Nt!==ae[be])return le(oe[be],ie[be])<0?oe.substr(0,be)+ie[be]+ie.substr(be+1):le(oe[be],ae[be])<0?oe.substr(0,be)+ae[be]+ie.substr(be+1):0<=Se?oe.substr(0,Se)+ne[Se]+ie.substr(Se+1):null;le(oe[be],Nt)<0&&(Se=be)}return Te<ae.length&&ve==="next"?oe+ie.substr(oe.length):Te<oe.length&&ve==="prev"?oe.substr(0,ie.length):Se<0?null:oe.substr(0,Se)+ae[Se]+ie.substr(Se+1)}(j,K,O[Q],_[Q],F,L);ee===null&&X===null?N=Q+1:(X===null||0<F(X,ee))&&(X=ee)}return V(X!==null?function(){U.continue(X+z)}:B),!1}),a}function gs(a,h,p,g){return{type:2,lower:a,upper:h,lowerOpen:p,upperOpen:g}}function vl(a){return{type:1,lower:a,upper:a}}var wl=(Object.defineProperty($e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$e.prototype.between=function(a,h,p,g){p=p!==!1,g=g===!0;try{return 0<this._cmp(a,h)||this._cmp(a,h)===0&&(p||g)&&(!p||!g)?rn(this):new this.Collection(this,function(){return gs(a,h,!p,!g)})}catch{return vt(this,ts)}},$e.prototype.equals=function(a){return a==null?vt(this,ts):new this.Collection(this,function(){return vl(a)})},$e.prototype.above=function(a){return a==null?vt(this,ts):new this.Collection(this,function(){return gs(a,void 0,!0)})},$e.prototype.aboveOrEqual=function(a){return a==null?vt(this,ts):new this.Collection(this,function(){return gs(a,void 0,!1)})},$e.prototype.below=function(a){return a==null?vt(this,ts):new this.Collection(this,function(){return gs(void 0,a,!1,!0)})},$e.prototype.belowOrEqual=function(a){return a==null?vt(this,ts):new this.Collection(this,function(){return gs(void 0,a)})},$e.prototype.startsWith=function(a){return typeof a!="string"?vt(this,hl):this.between(a,a+Ds,!0,!0)},$e.prototype.startsWithIgnoreCase=function(a){return a===""?this.startsWith(a):Ni(this,function(h,p){return h.indexOf(p[0])===0},[a],Ds)},$e.prototype.equalsIgnoreCase=function(a){return Ni(this,function(h,p){return h===p[0]},[a],"")},$e.prototype.anyOfIgnoreCase=function(){var a=je.apply(Ie,arguments);return a.length===0?rn(this):Ni(this,function(h,p){return p.indexOf(h)!==-1},a,"")},$e.prototype.startsWithAnyOfIgnoreCase=function(){var a=je.apply(Ie,arguments);return a.length===0?rn(this):Ni(this,function(h,p){return p.some(function(g){return h.indexOf(g)===0})},a,Ds)},$e.prototype.anyOf=function(){var a=this,h=je.apply(Ie,arguments),p=this._cmp;try{h.sort(p)}catch{return vt(this,ts)}if(h.length===0)return rn(this);var g=new this.Collection(this,function(){return gs(h[0],h[h.length-1])});g._ondirectionchange=function(I){p=I==="next"?a._ascending:a._descending,h.sort(p)};var v=0;return g._addAlgorithm(function(I,F,O){for(var _=I.key;0<p(_,h[v]);)if(++v===h.length)return F(O),!1;return p(_,h[v])===0||(F(function(){I.continue(h[v])}),!1)}),g},$e.prototype.notEqual=function(a){return this.inAnyRange([[-1/0,a],[a,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$e.prototype.noneOf=function(){var a=je.apply(Ie,arguments);if(a.length===0)return new this.Collection(this);try{a.sort(this._ascending)}catch{return vt(this,ts)}var h=a.reduce(function(p,g){return p?p.concat([[p[p.length-1][1],g]]):[[-1/0,g]]},null);return h.push([a[a.length-1],this.db._maxKey]),this.inAnyRange(h,{includeLowers:!1,includeUppers:!1})},$e.prototype.inAnyRange=function(j,h){var p=this,g=this._cmp,v=this._ascending,I=this._descending,F=this._min,O=this._max;if(j.length===0)return rn(this);if(!j.every(function(K){return K[0]!==void 0&&K[1]!==void 0&&v(K[0],K[1])<=0}))return vt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",de.InvalidArgument);var _=!h||h.includeLowers!==!1,L=h&&h.includeUppers===!0,z,D=v;function Y(K,X){return D(K[0],X[0])}try{(z=j.reduce(function(K,X){for(var Q=0,ee=K.length;Q<ee;++Q){var oe=K[Q];if(g(X[0],oe[1])<0&&0<g(X[1],oe[0])){oe[0]=F(oe[0],X[0]),oe[1]=O(oe[1],X[1]);break}}return Q===ee&&K.push(X),K},[])).sort(Y)}catch{return vt(this,ts)}var N=0,U=L?function(K){return 0<v(K,z[N][1])}:function(K){return 0<=v(K,z[N][1])},V=_?function(K){return 0<I(K,z[N][0])}:function(K){return 0<=I(K,z[N][0])},B=U,j=new this.Collection(this,function(){return gs(z[0][0],z[z.length-1][1],!_,!L)});return j._ondirectionchange=function(K){D=K==="next"?(B=U,v):(B=V,I),z.sort(Y)},j._addAlgorithm(function(K,X,Q){for(var ee,oe=K.key;B(oe);)if(++N===z.length)return X(Q),!1;return!U(ee=oe)&&!V(ee)||(p._cmp(oe,z[N][1])===0||p._cmp(oe,z[N][0])===0||X(function(){D===v?K.continue(z[N][0]):K.continue(z[N][1])}),!1)}),j},$e.prototype.startsWithAnyOf=function(){var a=je.apply(Ie,arguments);return a.every(function(h){return typeof h=="string"})?a.length===0?rn(this):this.inAnyRange(a.map(function(h){return[h,h+Ds]})):vt(this,"startsWithAnyOf() only works with strings")},$e);function $e(){}function Ht(a){return ze(function(h){return Vn(h),a(h.target.error),!1})}function Vn(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()}var Gn="storagemutated",po="x-storagemutated-1",Es=zn(null,Gn),pu=(jt.prototype._lock=function(){return C(!fe.global),++this._reculock,this._reculock!==1||fe.global||(fe.lockOwnerFor=this),this},jt.prototype._unlock=function(){if(C(!fe.global),--this._reculock==0)for(fe.global||(fe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var a=this._blockedFuncs.shift();try{Ms(a[1],a[0])}catch{}}return this},jt.prototype._locked=function(){return this._reculock&&fe.lockOwnerFor!==this},jt.prototype.create=function(a){var h=this;if(!this.mode)return this;var p=this.db.idbdb,g=this.db._state.dbOpenError;if(C(!this.idbtrans),!a&&!p)switch(g&&g.name){case"DatabaseClosedError":throw new de.DatabaseClosed(g);case"MissingAPIError":throw new de.MissingAPI(g.message,g);default:throw new de.OpenFailed(g)}if(!this.active)throw new de.TransactionInactive;return C(this._completion._state===null),(a=this.idbtrans=a||(this.db.core||p).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ze(function(v){Vn(v),h._reject(a.error)}),a.onabort=ze(function(v){Vn(v),h.active&&h._reject(new de.Abort(a.error)),h.active=!1,h.on("abort").fire(v)}),a.oncomplete=ze(function(){h.active=!1,h._resolve(),"mutatedParts"in a&&Es.storagemutated.fire(a.mutatedParts)}),this},jt.prototype._promise=function(a,h,p){var g=this;if(a==="readwrite"&&this.mode!=="readwrite")return We(new de.ReadOnly("Transaction is readonly"));if(!this.active)return We(new de.TransactionInactive);if(this._locked())return new he(function(I,F){g._blockedFuncs.push([function(){g._promise(a,h,p).then(I,F)},fe])});if(p)return ps(function(){var I=new he(function(F,O){g._lock();var _=h(F,O,g);_&&_.then&&_.then(F,O)});return I.finally(function(){return g._unlock()}),I._lib=!0,I});var v=new he(function(I,F){var O=h(I,F,g);O&&O.then&&O.then(I,F)});return v._lib=!0,v},jt.prototype._root=function(){return this.parent?this.parent._root():this},jt.prototype.waitFor=function(a){var h,p=this._root(),g=he.resolve(a);p._waitingFor?p._waitingFor=p._waitingFor.then(function(){return g}):(p._waitingFor=g,p._waitingQueue=[],h=p.idbtrans.objectStore(p.storeNames[0]),function I(){for(++p._spinCount;p._waitingQueue.length;)p._waitingQueue.shift()();p._waitingFor&&(h.get(-1/0).onsuccess=I)}());var v=p._waitingFor;return new he(function(I,F){g.then(function(O){return p._waitingQueue.push(ze(I.bind(null,O)))},function(O){return p._waitingQueue.push(ze(F.bind(null,O)))}).finally(function(){p._waitingFor===v&&(p._waitingFor=null)})})},jt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new de.Abort))},jt.prototype.table=function(a){var h=this._memoizedTables||(this._memoizedTables={});if(f(h,a))return h[a];var p=this.schema[a];if(!p)throw new de.NotFound("Table "+a+" not part of transaction");return p=new this.db.Table(a,p,this),p.core=this.db.core.table(a),h[a]=p},jt);function jt(){}function fo(a,h,p,g,v,I,F){return{name:a,keyPath:h,unique:p,multi:g,auto:v,compound:I,src:(p&&!F?"&":"")+(g?"*":"")+(v?"++":"")+yl(h)}}function yl(a){return typeof a=="string"?a:a?"["+[].join.call(a,"+")+"]":""}function mo(a,h,p){return{name:a,primKey:h,indexes:p,mappedClass:null,idxByName:(g=function(v){return[v.name,v]},p.reduce(function(v,I,F){return F=g(I,F),F&&(v[F[0]]=F[1]),v},{}))};var g}var Hn=function(a){try{return a.only([[]]),Hn=function(){return[[]]},[[]]}catch{return Hn=function(){return Ds},Ds}};function go(a){return a==null?function(){}:typeof a=="string"?(h=a).split(".").length===1?function(p){return p[h]}:function(p){return k(p,h)}:function(p){return k(p,a)};var h}function Il(a){return[].slice.call(a)}var fu=0;function jn(a){return a==null?":id":typeof a=="string"?a:"[".concat(a.join("+"),"]")}function mu(a,h,_){function g(B){if(B.type===3)return null;if(B.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var N=B.lower,U=B.upper,V=B.lowerOpen,B=B.upperOpen;return N===void 0?U===void 0?null:h.upperBound(U,!!B):U===void 0?h.lowerBound(N,!!V):h.bound(N,U,!!V,!!B)}function v(Y){var N,U=Y.name;return{name:U,schema:Y,mutate:function(V){var B=V.trans,j=V.type,K=V.keys,X=V.values,Q=V.range;return new Promise(function(ee,oe){ee=ze(ee);var ne=B.objectStore(U),ie=ne.keyPath==null,ae=j==="put"||j==="add";if(!ae&&j!=="delete"&&j!=="deleteRange")throw new Error("Invalid operation type: "+j);var le,ve=(K||X||{length:1}).length;if(K&&X&&K.length!==X.length)throw new Error("Given keys array must have same length as given values array.");if(ve===0)return ee({numFailures:0,failures:{},results:[],lastResult:void 0});function Te(ut){++Nt,Vn(ut)}var Se=[],be=[],Nt=0;if(j==="deleteRange"){if(Q.type===4)return ee({numFailures:Nt,failures:be,results:[],lastResult:void 0});Q.type===3?Se.push(le=ne.clear()):Se.push(le=ne.delete(g(Q)))}else{var ie=ae?ie?[X,K]:[X,null]:[K,null],Ae=ie[0],ot=ie[1];if(ae)for(var at=0;at<ve;++at)Se.push(le=ot&&ot[at]!==void 0?ne[j](Ae[at],ot[at]):ne[j](Ae[at])),le.onerror=Te;else for(at=0;at<ve;++at)Se.push(le=ne[j](Ae[at])),le.onerror=Te}function Xi(ut){ut=ut.target.result,Se.forEach(function(Us,No){return Us.error!=null&&(be[No]=Us.error)}),ee({numFailures:Nt,failures:be,results:j==="delete"?K:Se.map(function(Us){return Us.result}),lastResult:ut})}le.onerror=function(ut){Te(ut),Xi(ut)},le.onsuccess=Xi})},getMany:function(V){var B=V.trans,j=V.keys;return new Promise(function(K,X){K=ze(K);for(var Q,ee=B.objectStore(U),oe=j.length,ne=new Array(oe),ie=0,ae=0,le=function(Se){Se=Se.target,ne[Se._pos]=Se.result,++ae===ie&&K(ne)},ve=Ht(X),Te=0;Te<oe;++Te)j[Te]!=null&&((Q=ee.get(j[Te]))._pos=Te,Q.onsuccess=le,Q.onerror=ve,++ie);ie===0&&K(ne)})},get:function(V){var B=V.trans,j=V.key;return new Promise(function(K,X){K=ze(K);var Q=B.objectStore(U).get(j);Q.onsuccess=function(ee){return K(ee.target.result)},Q.onerror=Ht(X)})},query:(N=L,function(V){return new Promise(function(B,j){B=ze(B);var K,X,Q,ie=V.trans,ee=V.values,oe=V.limit,le=V.query,ne=oe===1/0?void 0:oe,ae=le.index,le=le.range,ie=ie.objectStore(U),ae=ae.isPrimaryKey?ie:ie.index(ae.name),le=g(le);if(oe===0)return B({result:[]});N?((ne=ee?ae.getAll(le,ne):ae.getAllKeys(le,ne)).onsuccess=function(ve){return B({result:ve.target.result})},ne.onerror=Ht(j)):(K=0,X=!ee&&"openKeyCursor"in ae?ae.openKeyCursor(le):ae.openCursor(le),Q=[],X.onsuccess=function(ve){var Te=X.result;return Te?(Q.push(ee?Te.value:Te.primaryKey),++K===oe?B({result:Q}):void Te.continue()):B({result:Q})},X.onerror=Ht(j))})}),openCursor:function(V){var B=V.trans,j=V.values,K=V.query,X=V.reverse,Q=V.unique;return new Promise(function(ee,oe){ee=ze(ee);var ae=K.index,ne=K.range,ie=B.objectStore(U),ie=ae.isPrimaryKey?ie:ie.index(ae.name),ae=X?Q?"prevunique":"prev":Q?"nextunique":"next",le=!j&&"openKeyCursor"in ie?ie.openKeyCursor(g(ne),ae):ie.openCursor(g(ne),ae);le.onerror=Ht(oe),le.onsuccess=ze(function(ve){var Te,Se,be,Nt,Ae=le.result;Ae?(Ae.___id=++fu,Ae.done=!1,Te=Ae.continue.bind(Ae),Se=(Se=Ae.continuePrimaryKey)&&Se.bind(Ae),be=Ae.advance.bind(Ae),Nt=function(){throw new Error("Cursor not stopped")},Ae.trans=B,Ae.stop=Ae.continue=Ae.continuePrimaryKey=Ae.advance=function(){throw new Error("Cursor not started")},Ae.fail=ze(oe),Ae.next=function(){var ot=this,at=1;return this.start(function(){return at--?ot.continue():ot.stop()}).then(function(){return ot})},Ae.start=function(ot){function at(){if(le.result)try{ot()}catch(ut){Ae.fail(ut)}else Ae.done=!0,Ae.start=function(){throw new Error("Cursor behind last entry")},Ae.stop()}var Xi=new Promise(function(ut,Us){ut=ze(ut),le.onerror=Ht(Us),Ae.fail=Us,Ae.stop=function(No){Ae.stop=Ae.continue=Ae.continuePrimaryKey=Ae.advance=Nt,ut(No)}});return le.onsuccess=ze(function(ut){le.onsuccess=at,at()}),Ae.continue=Te,Ae.continuePrimaryKey=Se,Ae.advance=be,at(),Xi},ee(Ae)):ee(null)},oe)})},count:function(V){var B=V.query,j=V.trans,K=B.index,X=B.range;return new Promise(function(Q,ee){var oe=j.objectStore(U),ne=K.isPrimaryKey?oe:oe.index(K.name),oe=g(X),ne=oe?ne.count(oe):ne.count();ne.onsuccess=ze(function(ie){return Q(ie.target.result)}),ne.onerror=Ht(ee)})}}}var I,F,O,z=(F=_,O=Il((I=a).objectStoreNames),{schema:{name:I.name,tables:O.map(function(Y){return F.objectStore(Y)}).map(function(Y){var N=Y.keyPath,B=Y.autoIncrement,U=o(N),V={},B={name:Y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:N==null,compound:U,keyPath:N,autoIncrement:B,unique:!0,extractKey:go(N)},indexes:Il(Y.indexNames).map(function(j){return Y.index(j)}).map(function(Q){var K=Q.name,X=Q.unique,ee=Q.multiEntry,Q=Q.keyPath,ee={name:K,compound:o(Q),keyPath:Q,unique:X,multiEntry:ee,extractKey:go(Q)};return V[jn(Q)]=ee}),getIndexByKeyPath:function(j){return V[jn(j)]}};return V[":id"]=B.primaryKey,N!=null&&(V[jn(N)]=B.primaryKey),B})},hasGetAll:0<O.length&&"getAll"in F.objectStore(O[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),_=z.schema,L=z.hasGetAll,z=_.tables.map(v),D={};return z.forEach(function(Y){return D[Y.name]=Y}),{stack:"dbcore",transaction:a.transaction.bind(a),table:function(Y){if(!D[Y])throw new Error("Table '".concat(Y,"' not found"));return D[Y]},MIN_KEY:-1/0,MAX_KEY:Hn(h),schema:_}}function gu(a,h,p,g){var v=p.IDBKeyRange;return p.indexedDB,{dbcore:(g=mu(h,v,g),a.dbcore.reduce(function(I,F){return F=F.create,s(s({},I),F(I))},g))}}function _i(a,g){var p=g.db,g=gu(a._middlewares,p,a._deps,g);a.core=g.dbcore,a.tables.forEach(function(v){var I=v.name;a.core.schema.tables.some(function(F){return F.name===I})&&(v.core=a.core.table(I),a[I]instanceof a.Table&&(a[I].core=v.core))})}function Ui(a,h,p,g){p.forEach(function(v){var I=g[v];h.forEach(function(F){var O=function _(L,z){return A(L,z)||(L=u(L))&&_(L,z)}(F,v);(!O||"value"in O&&O.value===void 0)&&(F===a.Transaction.prototype||F instanceof a.Transaction?w(F,v,{get:function(){return this.table(v)},set:function(_){E(this,v,{value:_,writable:!0,configurable:!0,enumerable:!0})}}):F[v]=new a.Table(v,I))})})}function Eo(a,h){h.forEach(function(p){for(var g in p)p[g]instanceof a.Table&&delete p[g]})}function Eu(a,h){return a._cfg.version-h._cfg.version}function vu(a,h,p,g){var v=a._dbSchema;p.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=mo("$meta",Tl("")[0],[]),a._storeNames.push("$meta"));var I=a._createTransaction("readwrite",a._storeNames,v);I.create(p),I._completion.catch(g);var F=I._reject.bind(I),O=fe.transless||fe;ps(function(){return fe.trans=I,fe.transless=O,h!==0?(_i(a,p),L=h,((_=I).storeNames.includes("$meta")?_.table("$meta").get("version").then(function(z){return z??L}):he.resolve(L)).then(function(z){return Y=z,N=I,U=p,V=[],z=(D=a)._versions,B=D._dbSchema=ki(0,D.idbdb,U),(z=z.filter(function(j){return j._cfg.version>=Y})).length!==0?(z.forEach(function(j){V.push(function(){var K=B,X=j._cfg.dbschema;zi(D,K,U),zi(D,X,U),B=D._dbSchema=X;var Q=vo(K,X);Q.add.forEach(function(ae){wo(U,ae[0],ae[1].primKey,ae[1].indexes)}),Q.change.forEach(function(ae){if(ae.recreate)throw new de.Upgrade("Not yet support for changing primary key");var le=U.objectStore(ae.name);ae.add.forEach(function(ve){return Bi(le,ve)}),ae.change.forEach(function(ve){le.deleteIndex(ve.name),Bi(le,ve)}),ae.del.forEach(function(ve){return le.deleteIndex(ve)})});var ee=j._cfg.contentUpgrade;if(ee&&j._cfg.version>Y){_i(D,U),N._memoizedTables={};var oe=H(X);Q.del.forEach(function(ae){oe[ae]=K[ae]}),Eo(D,[D.Transaction.prototype]),Ui(D,[D.Transaction.prototype],r(oe),oe),N.schema=oe;var ne,ie=Mt(ee);return ie&&tn(),Q=he.follow(function(){var ae;(ne=ee(N))&&ie&&(ae=fs.bind(null,null),ne.then(ae,ae))}),ne&&typeof ne.then=="function"?he.resolve(ne):Q.then(function(){return ne})}}),V.push(function(K){var X,Q,ee=j._cfg.dbschema;X=ee,Q=K,[].slice.call(Q.db.objectStoreNames).forEach(function(oe){return X[oe]==null&&Q.db.deleteObjectStore(oe)}),Eo(D,[D.Transaction.prototype]),Ui(D,[D.Transaction.prototype],D._storeNames,D._dbSchema),N.schema=D._dbSchema}),V.push(function(K){D.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(D.idbdb.version/10)===j._cfg.version?(D.idbdb.deleteObjectStore("$meta"),delete D._dbSchema.$meta,D._storeNames=D._storeNames.filter(function(X){return X!=="$meta"})):K.objectStore("$meta").put(j._cfg.version,"version"))})}),function j(){return V.length?he.resolve(V.shift()(N.idbtrans)).then(j):he.resolve()}().then(function(){Cl(B,U)})):he.resolve();var D,Y,N,U,V,B}).catch(F)):(r(v).forEach(function(z){wo(p,z,v[z].primKey,v[z].indexes)}),_i(a,p),void he.follow(function(){return a.on.populate.fire(I)}).catch(F));var _,L})}function wu(a,h){Cl(a._dbSchema,h),h.db.version%10!=0||h.objectStoreNames.contains("$meta")||h.db.createObjectStore("$meta").add(Math.ceil(h.db.version/10-1),"version");var p=ki(0,a.idbdb,h);zi(a,a._dbSchema,h);for(var g=0,v=vo(p,a._dbSchema).change;g<v.length;g++){var I=function(F){if(F.change.length||F.recreate)return console.warn("Unable to patch indexes of table ".concat(F.name," because it has changes on the type of index or primary key.")),{value:void 0};var O=h.objectStore(F.name);F.add.forEach(function(_){Gt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(F.name,".").concat(_.src)),Bi(O,_)})}(v[g]);if(typeof I=="object")return I.value}}function vo(a,h){var p,g={del:[],add:[],change:[]};for(p in a)h[p]||g.del.push(p);for(p in h){var v=a[p],I=h[p];if(v){var F={name:p,def:I,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(I.primKey.keyPath||"")||v.primKey.auto!==I.primKey.auto)F.recreate=!0,g.change.push(F);else{var O=v.idxByName,_=I.idxByName,L=void 0;for(L in O)_[L]||F.del.push(L);for(L in _){var z=O[L],D=_[L];z?z.src!==D.src&&F.change.push(D):F.add.push(D)}(0<F.del.length||0<F.add.length||0<F.change.length)&&g.change.push(F)}}else g.add.push([p,I])}return g}function wo(a,h,p,g){var v=a.db.createObjectStore(h,p.keyPath?{keyPath:p.keyPath,autoIncrement:p.auto}:{autoIncrement:p.auto});return g.forEach(function(I){return Bi(v,I)}),v}function Cl(a,h){r(a).forEach(function(p){h.db.objectStoreNames.contains(p)||(Gt&&console.debug("Dexie: Creating missing table",p),wo(h,p,a[p].primKey,a[p].indexes))})}function Bi(a,h){a.createIndex(h.name,h.keyPath,{unique:h.unique,multiEntry:h.multi})}function ki(a,h,p){var g={};return x(h.objectStoreNames,0).forEach(function(v){for(var I=p.objectStore(v),F=fo(yl(L=I.keyPath),L||"",!0,!1,!!I.autoIncrement,L&&typeof L!="string",!0),O=[],_=0;_<I.indexNames.length;++_){var z=I.index(I.indexNames[_]),L=z.keyPath,z=fo(z.name,L,!!z.unique,!!z.multiEntry,!1,L&&typeof L!="string",!1);O.push(z)}g[v]=mo(v,F,O)}),g}function zi(a,h,p){for(var g=p.db.objectStoreNames,v=0;v<g.length;++v){var I=g[v],F=p.objectStore(I);a._hasGetAll="getAll"in F;for(var O=0;O<F.indexNames.length;++O){var _=F.indexNames[O],L=F.index(_).keyPath,z=typeof L=="string"?L:"["+x(L).join("+")+"]";!h[I]||(L=h[I].idxByName[z])&&(L.name=_,delete h[I].idxByName[z],h[I].idxByName[_]=L)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(a._hasGetAll=!1)}function Tl(a){return a.split(",").map(function(h,p){var g=(h=h.trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(g)?g.match(/^\[(.*)\]$/)[1].split("+"):g;return fo(g,v||null,/\&/.test(h),/\*/.test(h),/\+\+/.test(h),o(v),p===0)})}var yu=(Yi.prototype._parseStoresSpec=function(a,h){r(a).forEach(function(p){if(a[p]!==null){var g=Tl(a[p]),v=g.shift();if(v.unique=!0,v.multi)throw new de.Schema("Primary key cannot be multi-valued");g.forEach(function(I){if(I.auto)throw new de.Schema("Only primary key can be marked as autoIncrement (++)");if(!I.keyPath)throw new de.Schema("Index must have a name and cannot be an empty string")}),h[p]=mo(p,v,g)}})},Yi.prototype.stores=function(p){var h=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,p):p;var p=h._versions,g={},v={};return p.forEach(function(I){l(g,I._cfg.storesSource),v=I._cfg.dbschema={},I._parseStoresSpec(g,v)}),h._dbSchema=v,Eo(h,[h._allTables,h,h.Transaction.prototype]),Ui(h,[h._allTables,h,h.Transaction.prototype,this._cfg.tables],r(v),v),h._storeNames=r(v),this},Yi.prototype.upgrade=function(a){return this._cfg.contentUpgrade=qr(this._cfg.contentUpgrade||Oe,a),this},Yi);function Yi(){}function yo(a,h){var p=a._dbNamesDB;return p||(p=a._dbNamesDB=new ns(Oi,{addons:[],indexedDB:a,IDBKeyRange:h})).version(1).stores({dbnames:"name"}),p.table("dbnames")}function Io(a){return a&&typeof a.databases=="function"}function Co(a){return ps(function(){return fe.letThrough=!0,a()})}function To(a){return!("from"in a)}var rt=function(a,h){if(!this){var p=new rt;return a&&"d"in a&&l(p,a),p}l(this,arguments.length?{d:1,from:a,to:1<arguments.length?h:a}:{d:0})};function Kn(a,h,p){var g=Pe(h,p);if(!isNaN(g)){if(0<g)throw RangeError();if(To(a))return l(a,{from:h,to:p,d:1});var v=a.l,g=a.r;if(Pe(p,a.from)<0)return v?Kn(v,h,p):a.l={from:h,to:p,d:1,l:null,r:null},bl(a);if(0<Pe(h,a.to))return g?Kn(g,h,p):a.r={from:h,to:p,d:1,l:null,r:null},bl(a);Pe(h,a.from)<0&&(a.from=h,a.l=null,a.d=g?g.d+1:1),0<Pe(p,a.to)&&(a.to=p,a.r=null,a.d=a.l?a.l.d+1:1),p=!a.r,v&&!a.l&&Wn(a,v),g&&p&&Wn(a,g)}}function Wn(a,h){To(h)||function p(g,_){var I=_.from,F=_.to,O=_.l,_=_.r;Kn(g,I,F),O&&p(g,O),_&&p(g,_)}(a,h)}function Vi(a,h){var p=bo(h),g=p.next();if(g.done)return!1;for(var v=g.value,I=bo(a),F=I.next(v.from),O=F.value;!g.done&&!F.done;){if(Pe(O.from,v.to)<=0&&0<=Pe(O.to,v.from))return!0;Pe(v.from,O.from)<0?v=(g=p.next(O.from)).value:O=(F=I.next(v.from)).value}return!1}function bo(a){var h=To(a)?null:{s:0,n:a};return{next:function(p){for(var g=0<arguments.length;h;)switch(h.s){case 0:if(h.s=1,g)for(;h.n.l&&Pe(p,h.n.from)<0;)h={up:h,n:h.n.l,s:1};else for(;h.n.l;)h={up:h,n:h.n.l,s:1};case 1:if(h.s=2,!g||Pe(p,h.n.to)<=0)return{value:h.n,done:!1};case 2:if(h.n.r){h.s=3,h={up:h,n:h.n.r,s:0};continue}case 3:h=h.up}return{done:!0}}}}function bl(a){var h,p,g=(((h=a.r)===null||h===void 0?void 0:h.d)||0)-(((p=a.l)===null||p===void 0?void 0:p.d)||0),v=1<g?"r":g<-1?"l":"";v&&(h=v=="r"?"l":"r",p=s({},a),g=a[v],a.from=g.from,a.to=g.to,a[v]=g[v],p[v]=g[h],(a[h]=p).d=Al(p)),a.d=Al(a)}function Al(p){var h=p.r,p=p.l;return(h?p?Math.max(h.d,p.d):h.d:p?p.d:0)+1}function Gi(a,h){return r(h).forEach(function(p){a[p]?Wn(a[p],h[p]):a[p]=function g(v){var I,F,O={};for(I in v)f(v,I)&&(F=v[I],O[I]=!F||typeof F!="object"||J.has(F.constructor)?F:g(F));return O}(h[p])}),a}function Ao(a,h){return a.all||h.all||Object.keys(a).some(function(p){return h[p]&&Vi(h[p],a[p])})}m(rt.prototype,((Tt={add:function(a){return Wn(this,a),this},addKey:function(a){return Kn(this,a,a),this},addKeys:function(a){var h=this;return a.forEach(function(p){return Kn(h,p,p)}),this}})[ce]=function(){return bo(this)},Tt));var Ns={},So={},Fo=!1;function Hi(a){Gi(So,a),Fo||(Fo=!0,setTimeout(function(){Fo=!1,xo(So,!(So={}))},0))}function xo(a,h){h===void 0&&(h=!1);var p=new Set;if(a.all)for(var g=0,v=Object.values(Ns);g<v.length;g++)Sl(F=v[g],a,p,h);else for(var I in a){var F,O=/^idb\:\/\/(.*)\/(.*)\//.exec(I);O&&(I=O[1],O=O[2],(F=Ns["idb://".concat(I,"/").concat(O)])&&Sl(F,a,p,h))}p.forEach(function(_){return _()})}function Sl(a,h,p,g){for(var v=[],I=0,F=Object.entries(a.queries.query);I<F.length;I++){for(var O=F[I],_=O[0],L=[],z=0,D=O[1];z<D.length;z++){var Y=D[z];Ao(h,Y.obsSet)?Y.subscribers.forEach(function(B){return p.add(B)}):g&&L.push(Y)}g&&v.push([_,L])}if(g)for(var N=0,U=v;N<U.length;N++){var V=U[N],_=V[0],L=V[1];a.queries.query[_]=L}}function Iu(a){var h=a._state,p=a._deps.indexedDB;if(h.isBeingOpened||a.idbdb)return h.dbReadyPromise.then(function(){return h.dbOpenError?We(h.dbOpenError):a});h.isBeingOpened=!0,h.dbOpenError=null,h.openComplete=!1;var g=h.openCanceller,v=Math.round(10*a.verno),I=!1;function F(){if(h.openCanceller!==g)throw new de.DatabaseClosed("db.open() was cancelled")}function O(){return new he(function(Y,N){if(F(),!p)throw new de.MissingAPI;var U=a.name,V=h.autoSchema||!v?p.open(U):p.open(U,v);if(!V)throw new de.MissingAPI;V.onerror=Ht(N),V.onblocked=ze(a._fireOnBlocked),V.onupgradeneeded=ze(function(B){var j;z=V.transaction,h.autoSchema&&!a._options.allowEmptyDB?(V.onerror=Vn,z.abort(),V.result.close(),(j=p.deleteDatabase(U)).onsuccess=j.onerror=ze(function(){N(new de.NoSuchDatabase("Database ".concat(U," doesnt exist")))})):(z.onerror=Ht(N),B=B.oldVersion>Math.pow(2,62)?0:B.oldVersion,D=B<1,a.idbdb=V.result,I&&wu(a,z),vu(a,B/10,z,N))},N),V.onsuccess=ze(function(){z=null;var B,j,K,X,Q,ee=a.idbdb=V.result,oe=x(ee.objectStoreNames);if(0<oe.length)try{var ne=ee.transaction((X=oe).length===1?X[0]:X,"readonly");if(h.autoSchema)j=ee,K=ne,(B=a).verno=j.version/10,K=B._dbSchema=ki(0,j,K),B._storeNames=x(j.objectStoreNames,0),Ui(B,[B._allTables],r(K),K);else if(zi(a,a._dbSchema,ne),((Q=vo(ki(0,(Q=a).idbdb,ne),Q._dbSchema)).add.length||Q.change.some(function(ie){return ie.add.length||ie.change.length}))&&!I)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),ee.close(),v=ee.version+1,I=!0,Y(O());_i(a,ne)}catch{}sn.push(a),ee.onversionchange=ze(function(ie){h.vcFired=!0,a.on("versionchange").fire(ie)}),ee.onclose=ze(function(ie){a.on("close").fire(ie)}),D&&(Q=a._deps,ne=U,ee=Q.indexedDB,Q=Q.IDBKeyRange,Io(ee)||ne===Oi||yo(ee,Q).put({name:ne}).catch(Oe)),Y()},N)}).catch(function(Y){switch(Y==null?void 0:Y.name){case"UnknownError":if(0<h.PR1398_maxLoop)return h.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),O();break;case"VersionError":if(0<v)return v=0,O()}return he.reject(Y)})}var _,L=h.dbReadyResolve,z=null,D=!1;return he.race([g,(typeof navigator>"u"?he.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(Y){function N(){return indexedDB.databases().finally(Y)}_=setInterval(N,100),N()}).finally(function(){return clearInterval(_)}):Promise.resolve()).then(O)]).then(function(){return F(),h.onReadyBeingFired=[],he.resolve(Co(function(){return a.on.ready.fire(a.vip)})).then(function Y(){if(0<h.onReadyBeingFired.length){var N=h.onReadyBeingFired.reduce(qr,Oe);return h.onReadyBeingFired=[],he.resolve(Co(function(){return N(a.vip)})).then(Y)}})}).finally(function(){h.openCanceller===g&&(h.onReadyBeingFired=null,h.isBeingOpened=!1)}).catch(function(Y){h.dbOpenError=Y;try{z&&z.abort()}catch{}return g===h.openCanceller&&a._close(),We(Y)}).finally(function(){h.openComplete=!0,L()}).then(function(){var Y;return D&&(Y={},a.tables.forEach(function(N){N.schema.indexes.forEach(function(U){U.name&&(Y["idb://".concat(a.name,"/").concat(N.name,"/").concat(U.name)]=new rt(-1/0,[[[]]]))}),Y["idb://".concat(a.name,"/").concat(N.name,"/")]=Y["idb://".concat(a.name,"/").concat(N.name,"/:dels")]=new rt(-1/0,[[[]]])}),Es(Gn).fire(Y),xo(Y,!0)),a})}function Ro(a){function h(I){return a.next(I)}var p=v(h),g=v(function(I){return a.throw(I)});function v(I){return function(_){var O=I(_),_=O.value;return O.done?_:_&&typeof _.then=="function"?_.then(p,g):o(_)?Promise.all(_).then(p,g):p(_)}}return v(h)()}function ji(a,h,p){for(var g=o(a)?a.slice():[a],v=0;v<p;++v)g.push(h);return g}var Cu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(a){return s(s({},a),{table:function(h){var p=a.table(h),g=p.schema,v={},I=[];function F(D,Y,N){var U=jn(D),V=v[U]=v[U]||[],B=D==null?0:typeof D=="string"?1:D.length,j=0<Y,j=s(s({},N),{name:j?"".concat(U,"(virtual-from:").concat(N.name,")"):N.name,lowLevelIndex:N,isVirtual:j,keyTail:Y,keyLength:B,extractKey:go(D),unique:!j&&N.unique});return V.push(j),j.isPrimaryKey||I.push(j),1<B&&F(B===2?D[0]:D.slice(0,B-1),Y+1,N),V.sort(function(K,X){return K.keyTail-X.keyTail}),j}h=F(g.primaryKey.keyPath,0,g.primaryKey),v[":id"]=[h];for(var O=0,_=g.indexes;O<_.length;O++){var L=_[O];F(L.keyPath,0,L)}function z(D){var Y,N=D.query.index;return N.isVirtual?s(s({},D),{query:{index:N.lowLevelIndex,range:(Y=D.query.range,N=N.keyTail,{type:Y.type===1?2:Y.type,lower:ji(Y.lower,Y.lowerOpen?a.MAX_KEY:a.MIN_KEY,N),lowerOpen:!0,upper:ji(Y.upper,Y.upperOpen?a.MIN_KEY:a.MAX_KEY,N),upperOpen:!0})}}):D}return s(s({},p),{schema:s(s({},g),{primaryKey:h,indexes:I,getIndexByKeyPath:function(D){return(D=v[jn(D)])&&D[0]}}),count:function(D){return p.count(z(D))},query:function(D){return p.query(z(D))},openCursor:function(D){var Y=D.query.index,N=Y.keyTail,U=Y.isVirtual,V=Y.keyLength;return U?p.openCursor(z(D)).then(function(j){return j&&B(j)}):p.openCursor(D);function B(j){return Object.create(j,{continue:{value:function(K){K!=null?j.continue(ji(K,D.reverse?a.MAX_KEY:a.MIN_KEY,N)):D.unique?j.continue(j.key.slice(0,V).concat(D.reverse?a.MIN_KEY:a.MAX_KEY,N)):j.continue()}},continuePrimaryKey:{value:function(K,X){j.continuePrimaryKey(ji(K,a.MAX_KEY,N),X)}},primaryKey:{get:function(){return j.primaryKey}},key:{get:function(){var K=j.key;return V===1?K[0]:K.slice(0,V)}},value:{get:function(){return j.value}}})}}})}})}};function Po(a,h,p,g){return p=p||{},g=g||"",r(a).forEach(function(v){var I,F,O;f(h,v)?(I=a[v],F=h[v],typeof I=="object"&&typeof F=="object"&&I&&F?(O=we(I))!==we(F)?p[g+v]=h[v]:O==="Object"?Po(I,F,p,g+v+"."):I!==F&&(p[g+v]=h[v]):I!==F&&(p[g+v]=h[v])):p[g+v]=void 0}),r(h).forEach(function(v){f(a,v)||(p[g+v]=h[v])}),p}function Oo(a,h){return h.type==="delete"?h.keys:h.keys||h.values.map(a.extractKey)}var Tu={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(a){return s(s({},a),{table:function(h){var p=a.table(h),g=p.schema.primaryKey;return s(s({},p),{mutate:function(v){var I=fe.trans,F=I.table(h).hook,O=F.deleting,_=F.creating,L=F.updating;switch(v.type){case"add":if(_.fire===Oe)break;return I._promise("readwrite",function(){return z(v)},!0);case"put":if(_.fire===Oe&&L.fire===Oe)break;return I._promise("readwrite",function(){return z(v)},!0);case"delete":if(O.fire===Oe)break;return I._promise("readwrite",function(){return z(v)},!0);case"deleteRange":if(O.fire===Oe)break;return I._promise("readwrite",function(){return function D(Y,N,U){return p.query({trans:Y,values:!1,query:{index:g,range:N},limit:U}).then(function(V){var B=V.result;return z({type:"delete",keys:B,trans:Y}).then(function(j){return 0<j.numFailures?Promise.reject(j.failures[0]):B.length<U?{failures:[],numFailures:0,lastResult:void 0}:D(Y,s(s({},N),{lower:B[B.length-1],lowerOpen:!0}),U)})})}(v.trans,v.range,1e4)},!0)}return p.mutate(v);function z(D){var Y,N,U,V=fe.trans,B=D.keys||Oo(g,D);if(!B)throw new Error("Keys missing");return(D=D.type==="add"||D.type==="put"?s(s({},D),{keys:B}):s({},D)).type!=="delete"&&(D.values=n([],D.values)),D.keys&&(D.keys=n([],D.keys)),Y=p,U=B,((N=D).type==="add"?Promise.resolve([]):Y.getMany({trans:N.trans,keys:U,cache:"immutable"})).then(function(j){var K=B.map(function(X,Q){var ee,oe,ne,ie=j[Q],ae={onerror:null,onsuccess:null};return D.type==="delete"?O.fire.call(ae,X,ie,V):D.type==="add"||ie===void 0?(ee=_.fire.call(ae,X,D.values[Q],V),X==null&&ee!=null&&(D.keys[Q]=X=ee,g.outbound||G(D.values[Q],g.keyPath,X))):(ee=Po(ie,D.values[Q]),(oe=L.fire.call(ae,ee,X,ie,V))&&(ne=D.values[Q],Object.keys(oe).forEach(function(le){f(ne,le)?ne[le]=oe[le]:G(ne,le,oe[le])}))),ae});return p.mutate(D).then(function(X){for(var Q=X.failures,ee=X.results,oe=X.numFailures,X=X.lastResult,ne=0;ne<B.length;++ne){var ie=(ee||B)[ne],ae=K[ne];ie==null?ae.onerror&&ae.onerror(Q[ne]):ae.onsuccess&&ae.onsuccess(D.type==="put"&&j[ne]?D.values[ne]:ie)}return{failures:Q,results:ee,numFailures:oe,lastResult:X}}).catch(function(X){return K.forEach(function(Q){return Q.onerror&&Q.onerror(X)}),Promise.reject(X)})})}}})}})}};function Fl(a,h,p){try{if(!h||h.keys.length<a.length)return null;for(var g=[],v=0,I=0;v<h.keys.length&&I<a.length;++v)Pe(h.keys[v],a[I])===0&&(g.push(p?se(h.values[v]):h.values[v]),++I);return g.length===a.length?g:null}catch{return null}}var bu={stack:"dbcore",level:-1,create:function(a){return{table:function(h){var p=a.table(h);return s(s({},p),{getMany:function(g){if(!g.cache)return p.getMany(g);var v=Fl(g.keys,g.trans._cache,g.cache==="clone");return v?he.resolve(v):p.getMany(g).then(function(I){return g.trans._cache={keys:g.keys,values:g.cache==="clone"?se(I):I},I})},mutate:function(g){return g.type!=="add"&&(g.trans._cache=null),p.mutate(g)}})}}}};function xl(a,h){return a.trans.mode==="readonly"&&!!a.subscr&&!a.trans.explicit&&a.trans.db._options.cache!=="disabled"&&!h.schema.primaryKey.outbound}function Rl(a,h){switch(a){case"query":return h.values&&!h.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Au={stack:"dbcore",level:0,name:"Observability",create:function(a){var h=a.schema.name,p=new rt(a.MIN_KEY,a.MAX_KEY);return s(s({},a),{transaction:function(g,v,I){if(fe.subscr&&v!=="readonly")throw new de.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(fe.querier));return a.transaction(g,v,I)},table:function(g){var v=a.table(g),I=v.schema,F=I.primaryKey,D=I.indexes,O=F.extractKey,_=F.outbound,L=F.autoIncrement&&D.filter(function(N){return N.compound&&N.keyPath.includes(F.keyPath)}),z=s(s({},v),{mutate:function(N){function U(le){return le="idb://".concat(h,"/").concat(g,"/").concat(le),X[le]||(X[le]=new rt)}var V,B,j,K=N.trans,X=N.mutatedParts||(N.mutatedParts={}),Q=U(""),ee=U(":dels"),oe=N.type,ae=N.type==="deleteRange"?[N.range]:N.type==="delete"?[N.keys]:N.values.length<50?[Oo(F,N).filter(function(le){return le}),N.values]:[],ne=ae[0],ie=ae[1],ae=N.trans._cache;return o(ne)?(Q.addKeys(ne),(ae=oe==="delete"||ne.length===ie.length?Fl(ne,ae):null)||ee.addKeys(ne),(ae||ie)&&(V=U,B=ae,j=ie,I.indexes.forEach(function(le){var ve=V(le.name||"");function Te(be){return be!=null?le.extractKey(be):null}function Se(be){return le.multiEntry&&o(be)?be.forEach(function(Nt){return ve.addKey(Nt)}):ve.addKey(be)}(B||j).forEach(function(be,ot){var Ae=B&&Te(B[ot]),ot=j&&Te(j[ot]);Pe(Ae,ot)!==0&&(Ae!=null&&Se(Ae),ot!=null&&Se(ot))})}))):ne?(ie={from:ne.lower,to:ne.upper},ee.add(ie),Q.add(ie)):(Q.add(p),ee.add(p),I.indexes.forEach(function(le){return U(le.name).add(p)})),v.mutate(N).then(function(le){return!ne||N.type!=="add"&&N.type!=="put"||(Q.addKeys(le.results),L&&L.forEach(function(ve){var Te=N.values.map(function(be){return ve.extractKey(be)}),Se=ve.keyPath.findIndex(function(be){return be===F.keyPath});le.results.forEach(function(be){return Te[Se]=be}),U(ve.name).addKeys(Te)})),K.mutatedParts=Gi(K.mutatedParts||{},X),le})}}),D=function(U){var V=U.query,U=V.index,V=V.range;return[U,new rt((U=V.lower)!==null&&U!==void 0?U:a.MIN_KEY,(V=V.upper)!==null&&V!==void 0?V:a.MAX_KEY)]},Y={get:function(N){return[F,new rt(N.key)]},getMany:function(N){return[F,new rt().addKeys(N.keys)]},count:D,query:D,openCursor:D};return r(Y).forEach(function(N){z[N]=function(U){var V=fe.subscr,B=!!V,j=xl(fe,v)&&Rl(N,U)?U.obsSet={}:V;if(B){var K=function(ie){return ie="idb://".concat(h,"/").concat(g,"/").concat(ie),j[ie]||(j[ie]=new rt)},X=K(""),Q=K(":dels"),V=Y[N](U),B=V[0],V=V[1];if((N==="query"&&B.isPrimaryKey&&!U.values?Q:K(B.name||"")).add(V),!B.isPrimaryKey){if(N!=="count"){var ee=N==="query"&&_&&U.values&&v.query(s(s({},U),{values:!1}));return v[N].apply(this,arguments).then(function(ie){if(N==="query"){if(_&&U.values)return ee.then(function(Te){return Te=Te.result,X.addKeys(Te),ie});var ae=U.values?ie.result.map(O):ie.result;(U.values?X:Q).addKeys(ae)}else if(N==="openCursor"){var le=ie,ve=U.values;return le&&Object.create(le,{key:{get:function(){return Q.addKey(le.primaryKey),le.key}},primaryKey:{get:function(){var Te=le.primaryKey;return Q.addKey(Te),Te}},value:{get:function(){return ve&&X.addKey(le.primaryKey),le.value}}})}return ie})}Q.add(p)}}return v[N].apply(this,arguments)}}),z}})}};function Pl(a,h,p){if(p.numFailures===0)return h;if(h.type==="deleteRange")return null;var g=h.keys?h.keys.length:"values"in h&&h.values?h.values.length:1;return p.numFailures===g?null:(h=s({},h),o(h.keys)&&(h.keys=h.keys.filter(function(v,I){return!(I in p.failures)})),"values"in h&&o(h.values)&&(h.values=h.values.filter(function(v,I){return!(I in p.failures)})),h)}function Mo(a,h){return p=a,((g=h).lower===void 0||(g.lowerOpen?0<Pe(p,g.lower):0<=Pe(p,g.lower)))&&(a=a,(h=h).upper===void 0||(h.upperOpen?Pe(a,h.upper)<0:Pe(a,h.upper)<=0));var p,g}function Ol(a,h,Y,g,v,I){if(!Y||Y.length===0)return a;var F=h.query.index,O=F.multiEntry,_=h.query.range,L=g.schema.primaryKey.extractKey,z=F.extractKey,D=(F.lowLevelIndex||F).extractKey,Y=Y.reduce(function(N,U){var V=N,B=U.type==="add"||U.type==="put"?U.values.filter(function(Q){return Q=z(Q),O&&o(Q)?Q.some(function(ee){return Mo(ee,_)}):Mo(Q,_)}).map(function(Q){return Q=se(Q),I&&Object.freeze(Q),Q}):[];switch(U.type){case"add":V=N.concat(h.values?B:B.map(function(ee){return L(ee)}));break;case"put":var j=new rt().addKeys(U.values.map(function(ee){return L(ee)})),V=N.filter(function(ee){return ee=h.values?L(ee):ee,!Vi(new rt(ee),j)}).concat(h.values?B:B.map(function(ee){return L(ee)}));break;case"delete":var K=new rt().addKeys(U.keys);V=N.filter(function(ee){return ee=h.values?L(ee):ee,!Vi(new rt(ee),K)});break;case"deleteRange":var X=U.range;V=N.filter(function(ee){return!Mo(L(ee),X)})}return V},a);return Y===a?a:(Y.sort(function(N,U){return Pe(D(N),D(U))||Pe(L(N),L(U))}),h.limit&&h.limit<1/0&&(Y.length>h.limit?Y.length=h.limit:a.length===h.limit&&Y.length<h.limit&&(v.dirty=!0)),I?Object.freeze(Y):Y)}function Ml(a,h){return Pe(a.lower,h.lower)===0&&Pe(a.upper,h.upper)===0&&!!a.lowerOpen==!!h.lowerOpen&&!!a.upperOpen==!!h.upperOpen}function Su(a,h){return function(p,g,v,I){if(p===void 0)return g!==void 0?-1:0;if(g===void 0)return 1;if((g=Pe(p,g))===0){if(v&&I)return 0;if(v)return 1;if(I)return-1}return g}(a.lower,h.lower,a.lowerOpen,h.lowerOpen)<=0&&0<=function(p,g,v,I){if(p===void 0)return g!==void 0?1:0;if(g===void 0)return-1;if((g=Pe(p,g))===0){if(v&&I)return 0;if(v)return-1;if(I)return 1}return g}(a.upper,h.upper,a.upperOpen,h.upperOpen)}function Fu(a,h,p,g){a.subscribers.add(p),g.addEventListener("abort",function(){var v,I;a.subscribers.delete(p),a.subscribers.size===0&&(v=a,I=h,setTimeout(function(){v.subscribers.size===0&&pe(I,v)},3e3))})}var xu={stack:"dbcore",level:0,name:"Cache",create:function(a){var h=a.schema.name;return s(s({},a),{transaction:function(p,g,v){var I,F,O=a.transaction(p,g,v);return g==="readwrite"&&(F=(I=new AbortController).signal,v=function(_){return function(){if(I.abort(),g==="readwrite"){for(var L=new Set,z=0,D=p;z<D.length;z++){var Y=D[z],N=Ns["idb://".concat(h,"/").concat(Y)];if(N){var U=a.table(Y),V=N.optimisticOps.filter(function(ve){return ve.trans===O});if(O._explicit&&_&&O.mutatedParts)for(var B=0,j=Object.values(N.queries.query);B<j.length;B++)for(var K=0,X=(oe=j[B]).slice();K<X.length;K++)Ao((ne=X[K]).obsSet,O.mutatedParts)&&(pe(oe,ne),ne.subscribers.forEach(function(ve){return L.add(ve)}));else if(0<V.length){N.optimisticOps=N.optimisticOps.filter(function(ve){return ve.trans!==O});for(var Q=0,ee=Object.values(N.queries.query);Q<ee.length;Q++)for(var oe,ne,ie,ae=0,le=(oe=ee[Q]).slice();ae<le.length;ae++)(ne=le[ae]).res!=null&&O.mutatedParts&&(_&&!ne.dirty?(ie=Object.isFrozen(ne.res),ie=Ol(ne.res,ne.req,V,U,ne,ie),ne.dirty?(pe(oe,ne),ne.subscribers.forEach(function(ve){return L.add(ve)})):ie!==ne.res&&(ne.res=ie,ne.promise=he.resolve({result:ie}))):(ne.dirty&&pe(oe,ne),ne.subscribers.forEach(function(ve){return L.add(ve)})))}}}L.forEach(function(ve){return ve()})}}},O.addEventListener("abort",v(!1),{signal:F}),O.addEventListener("error",v(!1),{signal:F}),O.addEventListener("complete",v(!0),{signal:F})),O},table:function(p){var g=a.table(p),v=g.schema.primaryKey;return s(s({},g),{mutate:function(I){var F=fe.trans;if(v.outbound||F.db._options.cache==="disabled"||F.explicit)return g.mutate(I);var O=Ns["idb://".concat(h,"/").concat(p)];return O?(F=g.mutate(I),I.type!=="add"&&I.type!=="put"||!(50<=I.values.length||Oo(v,I).some(function(_){return _==null}))?(O.optimisticOps.push(I),I.mutatedParts&&Hi(I.mutatedParts),F.then(function(_){0<_.numFailures&&(pe(O.optimisticOps,I),(_=Pl(0,I,_))&&O.optimisticOps.push(_),I.mutatedParts&&Hi(I.mutatedParts))}),F.catch(function(){pe(O.optimisticOps,I),I.mutatedParts&&Hi(I.mutatedParts)})):F.then(function(_){var L=Pl(0,s(s({},I),{values:I.values.map(function(N,D){var Y,N=(Y=v.keyPath)!==null&&Y!==void 0&&Y.includes(".")?se(N):s({},N);return G(N,v.keyPath,_.results[D]),N})}),_);O.optimisticOps.push(L),queueMicrotask(function(){return I.mutatedParts&&Hi(I.mutatedParts)})}),F):g.mutate(I)},query:function(I){if(!xl(fe,g)||!Rl("query",I))return g.query(I);var F=((L=fe.trans)===null||L===void 0?void 0:L.db._options.cache)==="immutable",D=fe,O=D.requery,_=D.signal,L=function(U,V,B,j){var K=Ns["idb://".concat(U,"/").concat(V)];if(!K)return[];if(!(V=K.queries[B]))return[null,!1,K,null];var X=V[(j.query?j.query.index.name:null)||""];if(!X)return[null,!1,K,null];switch(B){case"query":var Q=X.find(function(ee){return ee.req.limit===j.limit&&ee.req.values===j.values&&Ml(ee.req.query.range,j.query.range)});return Q?[Q,!0,K,X]:[X.find(function(ee){return("limit"in ee.req?ee.req.limit:1/0)>=j.limit&&(!j.values||ee.req.values)&&Su(ee.req.query.range,j.query.range)}),!1,K,X];case"count":return Q=X.find(function(ee){return Ml(ee.req.query.range,j.query.range)}),[Q,!!Q,K,X]}}(h,p,"query",I),z=L[0],D=L[1],Y=L[2],N=L[3];return z&&D?z.obsSet=I.obsSet:(D=g.query(I).then(function(U){var V=U.result;if(z&&(z.res=V),F){for(var B=0,j=V.length;B<j;++B)Object.freeze(V[B]);Object.freeze(V)}else U.result=se(V);return U}).catch(function(U){return N&&z&&pe(N,z),Promise.reject(U)}),z={obsSet:I.obsSet,promise:D,subscribers:new Set,type:"query",req:I,dirty:!1},N?N.push(z):(N=[z],(Y=Y||(Ns["idb://".concat(h,"/").concat(p)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[I.query.index.name||""]=N)),Fu(z,N,O,_),z.promise.then(function(U){return{result:Ol(U.result,I,Y==null?void 0:Y.optimisticOps,g,z,F)}})}})}})}};function Ki(a,h){return new Proxy(a,{get:function(p,g,v){return g==="db"?h:Reflect.get(p,g,v)}})}var ns=(Xe.prototype.version=function(a){if(isNaN(a)||a<.1)throw new de.Type("Given version is not a positive number");if(a=Math.round(10*a)/10,this.idbdb||this._state.isBeingOpened)throw new de.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var h=this._versions,p=h.filter(function(g){return g._cfg.version===a})[0];return p||(p=new this.Version(a),h.push(p),h.sort(Eu),p.stores({}),this._state.autoSchema=!1,p)},Xe.prototype._whenReady=function(a){var h=this;return this.idbdb&&(this._state.openComplete||fe.letThrough||this._vip)?a():new he(function(p,g){if(h._state.openComplete)return g(new de.DatabaseClosed(h._state.dbOpenError));if(!h._state.isBeingOpened){if(!h._state.autoOpen)return void g(new de.DatabaseClosed);h.open().catch(Oe)}h._state.dbReadyPromise.then(p,g)}).then(a)},Xe.prototype.use=function(a){var h=a.stack,p=a.create,g=a.level,v=a.name;return v&&this.unuse({stack:h,name:v}),a=this._middlewares[h]||(this._middlewares[h]=[]),a.push({stack:h,create:p,level:g??10,name:v}),a.sort(function(I,F){return I.level-F.level}),this},Xe.prototype.unuse=function(a){var h=a.stack,p=a.name,g=a.create;return h&&this._middlewares[h]&&(this._middlewares[h]=this._middlewares[h].filter(function(v){return g?v.create!==g:!!p&&v.name!==p})),this},Xe.prototype.open=function(){var a=this;return Ms(ds,function(){return Iu(a)})},Xe.prototype._close=function(){var a=this._state,h=sn.indexOf(this);if(0<=h&&sn.splice(h,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}a.isBeingOpened||(a.dbReadyPromise=new he(function(p){a.dbReadyResolve=p}),a.openCanceller=new he(function(p,g){a.cancelOpen=g}))},Xe.prototype.close=function(p){var h=(p===void 0?{disableAutoOpen:!0}:p).disableAutoOpen,p=this._state;h?(p.isBeingOpened&&p.cancelOpen(new de.DatabaseClosed),this._close(),p.autoOpen=!1,p.dbOpenError=new de.DatabaseClosed):(this._close(),p.autoOpen=this._options.autoOpen||p.isBeingOpened,p.openComplete=!1,p.dbOpenError=null)},Xe.prototype.delete=function(a){var h=this;a===void 0&&(a={disableAutoOpen:!0});var p=0<arguments.length&&typeof arguments[0]!="object",g=this._state;return new he(function(v,I){function F(){h.close(a);var O=h._deps.indexedDB.deleteDatabase(h.name);O.onsuccess=ze(function(){var _,L,z;_=h._deps,L=h.name,z=_.indexedDB,_=_.IDBKeyRange,Io(z)||L===Oi||yo(z,_).delete(L).catch(Oe),v()}),O.onerror=Ht(I),O.onblocked=h._fireOnBlocked}if(p)throw new de.InvalidArgument("Invalid closeOptions argument to db.delete()");g.isBeingOpened?g.dbReadyPromise.then(F):F()})},Xe.prototype.backendDB=function(){return this.idbdb},Xe.prototype.isOpen=function(){return this.idbdb!==null},Xe.prototype.hasBeenClosed=function(){var a=this._state.dbOpenError;return a&&a.name==="DatabaseClosed"},Xe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Xe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Xe.prototype,"tables",{get:function(){var a=this;return r(this._allTables).map(function(h){return a._allTables[h]})},enumerable:!1,configurable:!0}),Xe.prototype.transaction=function(){var a=(function(h,p,g){var v=arguments.length;if(v<2)throw new de.InvalidArgument("Too few arguments");for(var I=new Array(v-1);--v;)I[v-1]=arguments[v];return g=I.pop(),[h,Z(I),g]}).apply(this,arguments);return this._transaction.apply(this,a)},Xe.prototype._transaction=function(a,h,p){var g=this,v=fe.trans;v&&v.db===this&&a.indexOf("!")===-1||(v=null);var I,F,O=a.indexOf("?")!==-1;a=a.replace("!","").replace("?","");try{if(F=h.map(function(L){if(L=L instanceof g.Table?L.name:L,typeof L!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return L}),a=="r"||a===oo)I=oo;else{if(a!="rw"&&a!=ao)throw new de.InvalidArgument("Invalid transaction mode: "+a);I=ao}if(v){if(v.mode===oo&&I===ao){if(!O)throw new de.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");v=null}v&&F.forEach(function(L){if(v&&v.storeNames.indexOf(L)===-1){if(!O)throw new de.SubTransaction("Table "+L+" not included in parent transaction.");v=null}}),O&&v&&!v.active&&(v=null)}}catch(L){return v?v._promise(null,function(z,D){D(L)}):We(L)}var _=(function L(z,D,Y,N,U){return he.resolve().then(function(){var V=fe.transless||fe,B=z._createTransaction(D,Y,z._dbSchema,N);if(B.explicit=!0,V={trans:B,transless:V},N)B.idbtrans=N.idbtrans;else try{B.create(),B.idbtrans._explicit=!0,z._state.PR1398_maxLoop=3}catch(X){return X.name===es.InvalidState&&z.isOpen()&&0<--z._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),z.close({disableAutoOpen:!1}),z.open().then(function(){return L(z,D,Y,null,U)})):We(X)}var j,K=Mt(U);return K&&tn(),V=he.follow(function(){var X;(j=U.call(B,B))&&(K?(X=fs.bind(null,null),j.then(X,X)):typeof j.next=="function"&&typeof j.throw=="function"&&(j=Ro(j)))},V),(j&&typeof j.then=="function"?he.resolve(j).then(function(X){return B.active?X:We(new de.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):V.then(function(){return j})).then(function(X){return N&&B._resolve(),B._completion.then(function(){return X})}).catch(function(X){return B._reject(X),We(X)})})}).bind(null,this,I,F,v,p);return v?v._promise(I,_,"lock"):fe.trans?Ms(fe.transless,function(){return g._whenReady(_)}):this._whenReady(_)},Xe.prototype.table=function(a){if(!f(this._allTables,a))throw new de.InvalidTable("Table ".concat(a," does not exist"));return this._allTables[a]},Xe);function Xe(a,h){var p=this;this._middlewares={},this.verno=0;var g=Xe.dependencies;this._options=h=s({addons:Xe.addons,autoOpen:!0,indexedDB:g.indexedDB,IDBKeyRange:g.IDBKeyRange,cache:"cloned"},h),this._deps={indexedDB:h.indexedDB,IDBKeyRange:h.IDBKeyRange},g=h.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var v,I,F,O,_,L={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Oe,dbReadyPromise:null,cancelOpen:Oe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:h.autoOpen};L.dbReadyPromise=new he(function(D){L.dbReadyResolve=D}),L.openCanceller=new he(function(D,Y){L.cancelOpen=Y}),this._state=L,this.name=a,this.on=zn(this,"populate","blocked","versionchange","close",{ready:[qr,Oe]}),this.on.ready.subscribe=R(this.on.ready.subscribe,function(D){return function(Y,N){Xe.vip(function(){var U,V=p._state;V.openComplete?(V.dbOpenError||he.resolve().then(Y),N&&D(Y)):V.onReadyBeingFired?(V.onReadyBeingFired.push(Y),N&&D(Y)):(D(Y),U=p,N||D(function B(){U.on.ready.unsubscribe(Y),U.on.ready.unsubscribe(B)}))})}}),this.Collection=(v=this,Yn(cu.prototype,function(j,B){this.db=v;var N=cl,U=null;if(B)try{N=B()}catch(K){U=K}var V=j._ctx,B=V.table,j=B.hook.reading.fire;this._ctx={table:B,index:V.index,isPrimKey:!V.index||B.schema.primKey.keyPath&&V.index===B.schema.primKey.name,range:N,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:U,or:V.or,valueMapper:j!==Vt?j:null}})),this.Table=(I=this,Yn(fl.prototype,function(D,Y,N){this.db=I,this._tx=N,this.name=D,this.schema=Y,this.hook=I._allTables[D]?I._allTables[D].hook:zn(null,{creating:[Dn,Oe],reading:[Qr,Vt],updating:[nu,Oe],deleting:[Ln,Oe]})})),this.Transaction=(F=this,Yn(pu.prototype,function(D,Y,N,U,V){var B=this;this.db=F,this.mode=D,this.storeNames=Y,this.schema=N,this.chromeTransactionDurability=U,this.idbtrans=null,this.on=zn(this,"complete","error","abort"),this.parent=V||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new he(function(j,K){B._resolve=j,B._reject=K}),this._completion.then(function(){B.active=!1,B.on.complete.fire()},function(j){var K=B.active;return B.active=!1,B.on.error.fire(j),B.parent?B.parent._reject(j):K&&B.idbtrans&&B.idbtrans.abort(),We(j)})})),this.Version=(O=this,Yn(yu.prototype,function(D){this.db=O,this._cfg={version:D,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(_=this,Yn(wl.prototype,function(D,Y,N){if(this.db=_,this._ctx={table:D,index:Y===":id"?null:Y,or:N},this._cmp=this._ascending=Pe,this._descending=function(U,V){return Pe(V,U)},this._max=function(U,V){return 0<Pe(U,V)?U:V},this._min=function(U,V){return Pe(U,V)<0?U:V},this._IDBKeyRange=_._deps.IDBKeyRange,!this._IDBKeyRange)throw new de.MissingAPI})),this.on("versionchange",function(D){0<D.newVersion?console.warn("Another connection wants to upgrade database '".concat(p.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(p.name,"'. Closing db now to resume the delete request.")),p.close({disableAutoOpen:!1})}),this.on("blocked",function(D){!D.newVersion||D.newVersion<D.oldVersion?console.warn("Dexie.delete('".concat(p.name,"') was blocked")):console.warn("Upgrade '".concat(p.name,"' blocked by other connection holding version ").concat(D.oldVersion/10))}),this._maxKey=Hn(h.IDBKeyRange),this._createTransaction=function(D,Y,N,U){return new p.Transaction(D,Y,N,p._options.chromeTransactionDurability,U)},this._fireOnBlocked=function(D){p.on("blocked").fire(D),sn.filter(function(Y){return Y.name===p.name&&Y!==p&&!Y._state.vcFired}).map(function(Y){return Y.on("versionchange").fire(D)})},this.use(bu),this.use(xu),this.use(Au),this.use(Cu),this.use(Tu);var z=new Proxy(this,{get:function(D,Y,N){if(Y==="_vip")return!0;if(Y==="table")return function(V){return Ki(p.table(V),z)};var U=Reflect.get(D,Y,N);return U instanceof fl?Ki(U,z):Y==="tables"?U.map(function(V){return Ki(V,z)}):Y==="_createTransaction"?function(){return Ki(U.apply(this,arguments),z)}:U}});this.vip=z,g.forEach(function(D){return D(p)})}var Wi,Tt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ru=(Do.prototype.subscribe=function(a,h,p){return this._subscribe(a&&typeof a!="function"?a:{next:a,error:h,complete:p})},Do.prototype[Tt]=function(){return this},Do);function Do(a){this._subscribe=a}try{Wi={indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch{Wi={indexedDB:null,IDBKeyRange:null}}function Dl(a){var h,p=!1,g=new Ru(function(v){var I=Mt(a),F,O=!1,_={},L={},z={get closed(){return O},unsubscribe:function(){O||(O=!0,F&&F.abort(),D&&Es.storagemutated.unsubscribe(N))}};v.start&&v.start(z);var D=!1,Y=function(){return ro(U)},N=function(V){Gi(_,V),Ao(L,_)&&Y()},U=function(){var V,B,j;!O&&Wi.indexedDB&&(_={},V={},F&&F.abort(),F=new AbortController,j=function(K){var X=$s();try{I&&tn();var Q=ps(a,K);return Q=I?Q.finally(fs):Q}finally{X&&en()}}(B={subscr:V,signal:F.signal,requery:Y,querier:a,trans:null}),Promise.resolve(j).then(function(K){p=!0,h=K,O||B.signal.aborted||(_={},function(X){for(var Q in X)if(f(X,Q))return;return 1}(L=V)||D||(Es(Gn,N),D=!0),ro(function(){return!O&&v.next&&v.next(K)}))},function(K){p=!1,["DatabaseClosedError","AbortError"].includes(K==null?void 0:K.name)||O||ro(function(){O||v.error&&v.error(K)})}))};return setTimeout(Y,0),z});return g.hasValue=function(){return p},g.getValue=function(){return h},g}var _s=ns;function Lo(a){var h=vs;try{vs=!0,Es.storagemutated.fire(a),xo(a,!0)}finally{vs=h}}m(_s,s(s({},Dt),{delete:function(a){return new _s(a,{addons:[]}).delete()},exists:function(a){return new _s(a,{addons:[]}).open().then(function(h){return h.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(a){try{return h=_s.dependencies,p=h.indexedDB,h=h.IDBKeyRange,(Io(p)?Promise.resolve(p.databases()).then(function(g){return g.map(function(v){return v.name}).filter(function(v){return v!==Oi})}):yo(p,h).toCollection().primaryKeys()).then(a)}catch{return We(new de.MissingAPI)}var h,p},defineClass:function(){return function(a){l(this,a)}},ignoreTransaction:function(a){return fe.trans?Ms(fe.transless,a):a()},vip:Co,async:function(a){return function(){try{var h=Ro(a.apply(this,arguments));return h&&typeof h.then=="function"?h:he.resolve(h)}catch(p){return We(p)}}},spawn:function(a,h,p){try{var g=Ro(a.apply(p,h||[]));return g&&typeof g.then=="function"?g:he.resolve(g)}catch(v){return We(v)}},currentTransaction:{get:function(){return fe.trans||null}},waitFor:function(a,h){return h=he.resolve(typeof a=="function"?_s.ignoreTransaction(a):a).timeout(h||6e4),fe.trans?fe.trans.waitFor(h):h},Promise:he,debug:{get:function(){return Gt},set:function(a){nl(a)}},derive:y,extend:l,props:m,override:R,Events:zn,on:Es,liveQuery:Dl,extendObservabilitySet:Gi,getByKeyPath:k,setByKeyPath:G,delByKeyPath:function(a,h){typeof h=="string"?G(a,h,void 0):"length"in h&&[].map.call(h,function(p){G(a,p,void 0)})},shallowClone:H,deepClone:se,getObjectDiff:Po,cmp:Pe,asap:M,minKey:-1/0,addons:[],connections:sn,errnames:es,dependencies:Wi,cache:Ns,semVer:"4.0.4",version:"4.0.4".split(".").map(function(a){return parseInt(a)}).reduce(function(a,h,p){return a+h/Math.pow(10,2*p)})})),_s.maxKey=Hn(_s.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Es(Gn,function(a){vs||(a=new CustomEvent(po,{detail:a}),vs=!0,dispatchEvent(a),vs=!1)}),addEventListener(po,function(a){a=a.detail,vs||Lo(a)}));var on,vs=!1,Ll=function(){};return typeof BroadcastChannel<"u"&&((Ll=function(){(on=new BroadcastChannel(po)).onmessage=function(a){return a.data&&Lo(a.data)}})(),typeof on.unref=="function"&&on.unref(),Es(Gn,function(a){vs||on.postMessage(a)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(a){if(!ns.disableBfCache&&a.persisted){Gt&&console.debug("Dexie: handling persisted pagehide"),on!=null&&on.close();for(var h=0,p=sn;h<p.length;h++)p[h].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(a){!ns.disableBfCache&&a.persisted&&(Gt&&console.debug("Dexie: handling persisted pageshow"),Ll(),Lo({all:new rt(-1/0,[[]])}))})),he.rejectionMapper=function(a,h){return!a||a instanceof Ct||a instanceof TypeError||a instanceof SyntaxError||!a.name||!Ve[a.name]?a:(h=new Ve[a.name](h||a.message,a),"stack"in a&&w(h,"stack",{get:function(){return this.inner.stack}}),h)},nl(Gt),s(ns,Object.freeze({__proto__:null,Dexie:ns,liveQuery:Dl,Entity:ul,cmp:Pe,PropModSymbol:ss,PropModification:co,replacePrefix:function(a,h){return new co({replacePrefix:[a,h]})},default:ns,RangeSet:rt,mergeRanges:Wn,rangesOverlap:Vi}),{default:ns}),ns})})(eu);var Fm=eu.exports;const Oa=Dc(Fm),Mh=Symbol.for("Dexie"),Ma=globalThis[Mh]||(globalThis[Mh]=Oa);if(Oa.semVer!==Ma.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Oa.semVer} and ${Ma.semVer}`);class xm extends Ma{constructor(){super("MyAppDatabase"),T(this,"files"),this.version(1).stores({files:"id, file"})}}const Rm=class Da extends Fe{constructor(e){super(e),T(this,"enabled",!0),T(this,"onFragmentsDeleted",new $),T(this,"onFragmentsLoaded",new $),T(this,"onDisposed",new $),T(this,"models",{}),T(this,"serializer",new zh),T(this,"maxRamTime",5e3),T(this,"useCache",!0),T(this,"_culler",null),T(this,"_world",null),T(this,"_ramCache",new Map),T(this,"_fileCache",new xm),T(this,"_url",null),T(this,"_isDisposing",!1),T(this,"_geometryInstances",{}),T(this,"_loadedFragments",{}),T(this,"fragIDData",new Map),T(this,"_baseMaterial",new Dr),T(this,"_baseMaterialT",new Dr({transparent:!0,opacity:.5})),this.components.add(Da.uuid,this)}get url(){if(!this._url)throw new Error("url must be set before using the streaming service!");return this._url}set url(e){this._url=e}get world(){if(!this._world)throw new Error("You must set a world before using the streamer!");return this._world}set world(e){var t;this._world=e,(t=this._culler)==null||t.dispose(),this._culler=new Sm(this.components,e),this._culler.onViewUpdated.add(async({toLoad:s,toRemove:n,toShow:i,toHide:r})=>{await this.loadFoundGeometries(s),await this.unloadLostGeometries(n),this.setMeshVisibility(i,!0),this.setMeshVisibility(r,!1)})}get culler(){if(!this._culler)throw new Error("You must set a world before using the streamer!");return this._culler}dispose(){var e;this._isDisposing=!0,this.onFragmentsLoaded.reset(),this.onFragmentsDeleted.reset(),this._ramCache.clear(),this.models={},this._geometryInstances={},this._loadedFragments={},this.fragIDData.clear(),this._baseMaterial.dispose(),this._baseMaterialT.dispose(),(e=this._culler)==null||e.dispose(),this.onDisposed.trigger(Da.uuid),this.onDisposed.reset(),this._isDisposing=!1}async load(e,t,s){const{assets:n,geometries:i,globalDataFileId:r}=e,o=this.url+r,l=await(await fetch(o)).arrayBuffer(),u=new Uint8Array(l),d=this.components.get(Qe).load(u,{coordinate:t});this.world.scene.three.add(d);const{opaque:f,transparent:m}=d.geometryIDs;for(const[w,y]of f){const A=d.keyFragments.get(y);if(A===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(A,[d,w,new Set])}for(const[w,y]of m){const A=d.keyFragments.get(y);if(A===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(A,[d,Math.abs(w),new Set])}this.culler.add(d.uuid,n,i),this.models[d.uuid]={assets:n,geometries:i};const E=new Map;for(const w of n){const y=w.id;for(const{transformation:A,geometryID:S,color:x}of w.geometries){E.has(S)||E.set(S,[]);const R=E.get(S);if(!R)throw new Error("Malformed instances");R.push({id:y,transformation:A,color:x})}}if(this._geometryInstances[d.uuid]=E,s){const w=new Map,y=new Map;for(const C in s.ids){const M=s.ids[C],k=parseInt(C,10);w.set(k,M)}for(const C in s.types){const M=s.types[C],k=parseInt(C,10);y.set(k,M)}const A=r.replace("-global","-properties");d.streamSettings={baseUrl:this.url,baseFileName:A,ids:w,types:y};const{indexesFile:S}=s,x=await(await fetch(this.url+S)).text(),R=this.components.get(Ja);R.setRelationMap(d,R.getRelationsMapFromJSON(x))}return this.culler.needsUpdate=!0,d}remove(e){this._isDisposing=!0;const t=this.components.get(Qe).groups.get(e);if(t===void 0){console.log("Group to delete not found.");return}delete this.models[e],delete this._geometryInstances[e],delete this._loadedFragments[e];const s=t.keyFragments.values();for(const n of s)this.fragIDData.delete(n);this.culler.remove(e),this._isDisposing=!1}setVisibility(e,t){const s=new Map;for(const n in t){const i=this.fragIDData.get(n);if(i===void 0)throw new Error("Geometry not found!");const[r,o,l]=i,u=r.uuid;s.has(u)||s.set(u,new Map);const d=s.get(u),f=t[n];for(const E of f)e?l.delete(E):l.add(E);d.get(o)||d.set(o,new Set);const m=d.get(o);for(const E of f)m.add(E)}for(const[n,i]of s){this.culler.setVisibility(e,n,i);for(const[r]of i){const o=this._loadedFragments[n];if(!o)continue;const l=o[r];if(l)for(const u of l){const d=t[u.id];d&&u.setVisibility(e,d)}}}this.culler.needsUpdate=!0}async clearCache(){await this._fileCache.delete()}get(){}update(){}async loadFoundGeometries(e){for(const t in e){if(this._isDisposing)return;const s=this.components.get(Qe).groups.get(t);if(!s)return;const{geometries:n}=this.models[t],i=new Map,r=new Set;for(const[d,f]of e[t])for(const m of f){r.add(m);const E=n[m];if(!E)throw new Error("Geometry not found");if(E.geometryFile){const w=E.geometryFile,y=i.get(w)||0;i.set(w,y+d)}}const o=Array.from(i).sort((d,f)=>f[1]-d[1]);for(const[d]of o){const f=this.url+d;if(!this._ramCache.has(f)){let w=new Uint8Array;if(this.useCache){const A=await this._fileCache.files.get(f);if(A)w=A.file;else{const S=await(await fetch(f)).arrayBuffer();w=new Uint8Array(S),this._fileCache.files.add({file:w,id:f})}}else{const A=await(await fetch(f)).arrayBuffer();w=new Uint8Array(A)}const y=this.serializer.import(w);this._ramCache.set(f,{data:y,time:performance.now()})}const m=this._ramCache.get(f);if(!m)continue;m.time=performance.now();const E=[];if(m)for(const[w,{position:y,index:A,normal:S}]of m.data){if(this._isDisposing)return;if(!r.has(w)||!this._geometryInstances[t]||!this._geometryInstances[t].has(w))continue;const x=this._geometryInstances[t].get(w);if(!x)throw new Error("Instances not found!");const R=new De,C=new gt(y,3),M=new gt(S,3);R.setAttribute("position",C),R.setAttribute("normal",M),R.setIndex(Array.from(A));const k=[],G=[];for(const H of x)H.color[3]===1?G.push(H):k.push(H);this.newFragment(s,w,R,k,!0,E),this.newFragment(s,w,R,G,!1,E)}E.length&&!this._isDisposing&&this.onFragmentsLoaded.trigger(E)}const l=new Set,u=performance.now();for(const[d,{time:f}]of this._ramCache)u-f>this.maxRamTime&&l.add(d);for(const d of l)this._ramCache.delete(d)}}async unloadLostGeometries(e){if(this._isDisposing)return;const t=[],s=this.components.get(Qe);for(const n in e){const i=s.groups.get(n);if(!i)throw new Error("Fragment group not found!");if(!this._loadedFragments[n])continue;const r=this._loadedFragments[n],o=e[n];for(const l of o){if(this.culler.removeFragment(i.uuid,l),!r[l])continue;const u=r[l];for(const d of u)i.items.splice(i.items.indexOf(d),1),t.push(d);delete r[l]}}t.length&&this.onFragmentsDeleted.trigger(t);for(const n of t)s.list.delete(n.id),this.world.meshes.delete(n.mesh),n.mesh.material=[],n.dispose(!0)}setMeshVisibility(e,t){for(const s in e)for(const n of e[s]){const i=this._loadedFragments[s];if(!i)continue;const r=i[n];if(r)for(const o of r)o.mesh.visible=t}}newFragment(e,t,s,n,i,r){if(n.length===0||this._isDisposing)return;const o=e.geometryIDs,l=i?o.transparent:o.opaque,u=t*(i?-1:1),d=l.get(u);if(d===void 0)return;const f=e.keyFragments.get(d);if(f===void 0)return;const m=this.components.get(Qe);if(m.list.has(f))return;const E=i?this._baseMaterialT:this._baseMaterial,w=new Lr(s,E,n.length);w.id=f,w.mesh.uuid=f,w.group=e,e.add(w.mesh),e.items.push(w),m.list.set(w.id,w),this.world.meshes.add(w.mesh),this._loadedFragments[e.uuid]||(this._loadedFragments[e.uuid]={});const y=this._loadedFragments[e.uuid];y[t]||(y[t]=[]),y[t].push(w);const A=new Map;for(let C=0;C<n.length;C++){const M=new me,k=new Et,{id:G,transformation:H,color:W}=n[C];M.fromArray(H);const[Z,J,te]=W;if(k.setRGB(Z,J,te,"srgb"),A.has(G)){const se=A.get(G);if(!se)continue;se.transforms.push(M),se.colors&&se.colors.push(k)}else A.set(G,{id:G,colors:[k],transforms:[M]})}const S=Array.from(A.values());w.add(S);const x=this.fragIDData.get(w.id);if(!x)throw new Error("Fragment data not found!");const R=x[2];R.size&&w.setVisibility(!1,R),this.culler.addFragment(e.uuid,t,w),r.push(w)}};T(Rm,"uuid","22437e8d-9dbc-4b99-a04f-d2da280d50c8");const tu=class La extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"onBeforeUpdate",new $),T(this,"onAfterUpdate",new $),T(this,"onSetup",new $),T(this,"isSetup",!1),T(this,"enabled",!0),T(this,"events",{}),T(this,"multiple","ctrlKey"),T(this,"zoomFactor",1.5),T(this,"zoomToSelection",!1),T(this,"backupColor",null),T(this,"selection",{}),T(this,"config",{selectName:"select",hoverName:"hover",selectionColor:new Et("#BCF124"),hoverColor:new Et("#6528D7"),autoHighlightOnClick:!0,world:null}),T(this,"colors",new Map),T(this,"_mouseState",{down:!1,moved:!1}),T(this,"clearHover",()=>{this.selection[this.config.hoverName]={}}),T(this,"onMouseDown",()=>{this.enabled&&(this._mouseState.down=!0)}),T(this,"onMouseUp",async t=>{const s=this.config.world;if(!s)throw new Error("No world found!");if(!s.renderer)throw new Error("This world doesn't have a renderer!");if(this.enabled&&t.target===s.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,this.config.autoHighlightOnClick){const n=this.multiple==="none"?!0:!t[this.multiple];await this.highlight(this.config.selectName,n,this.zoomToSelection)}}}),T(this,"onMouseMove",async()=>{if(!this.enabled)return;if(this._mouseState.moved){this.clear(this.config.hoverName);return}this._mouseState.moved=this._mouseState.down;const t=this.selection[this.config.selectName];await this.highlight(this.config.hoverName,!0,!1,t)}),this.components.add(La.uuid,this)}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={};for(const e in this.events)this.events[e].onClear.reset(),this.events[e].onHighlight.reset();this.onSetup.reset(),this.events={},this.onDisposed.trigger(La.uuid),this.onDisposed.reset()}add(e,t){if(this.selection[e]||this.colors.has(e))throw new Error("A selection with that name already exists!");this.colors.set(e,t),this.selection[e]={},this.events[e]={onHighlight:new $,onClear:new $}}async highlight(e,t=!0,s=this.zoomToSelection,n={}){if(!this.enabled)return null;if(!this.config.world)throw new Error("No world found in config!");const i=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);const r=this.components.get(Qe).meshes,o=this.components.get(zt).get(i).castRay(r);if(!o||!o.face)return this.clear(e),null;const l=o.object,u=l.geometry,d=o.instanceId;if(!u||d===void 0)return null;const f=l.fragment.getItemID(d);if(f===null)throw new Error("Item ID not found!");const m=l.fragment.group;if(!m)throw new Error("Fragment must belong to a FragmentsGroup!");const E=m.getFragmentMap([f]),w={};for(const y in E){const A=E[y],S=n[y];for(const x of A)(!S||!S.has(x))&&(w[y]||(w[y]=new Set),w[y].add(x))}return await this.highlightByID(e,w,t,s),{id:f,fragments:E}}async highlightByID(e,t,s=!0,n=this.zoomToSelection){if(!this.enabled)return;s&&this.clear(e);const i=this.components.get(Qe),r=this.colors.get(e);if(!r)throw new Error("Color for selection not found!");for(const o in t){const l=i.list.get(o);if(!l)continue;this.selection[e][o]||(this.selection[e][o]=new Set);const u=t[o];for(const d of u)this.selection[e][o].add(d),l.setColor(r,[d])}this.events[e].onHighlight.trigger(this.selection[e]),n&&await this.zoomSelection(e)}clear(e){const t=e?[e]:Object.keys(this.selection);for(const s of t){const n=this.components.get(Qe),i=this.selection[s];for(const r in this.selection[s]){const o=n.list.get(r);if(!o)continue;const l=i[r];l&&(this.backupColor?o.setColor(this.backupColor):o.resetColor(l))}this.events[s].onClear.trigger(null),this.selection[s]={}}}setup(e){this.config={...this.config,...e},this.add(this.config.selectName,this.config.selectionColor),this.add(this.config.hoverName,this.config.hoverColor),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(e){if(!this.config.world)throw new Error("No world found in config!");const t=this.config.world;if(!t.camera.hasCameraControls())return;const s=this.components.get(Qa),n=this.components.get(Qe);s.reset();const i=this.selection[e];if(!Object.keys(i).length)return;for(const y in i){const A=n.list.get(y);if(!A)continue;const S=i[y];s.addMesh(A.mesh,S)}const r=s.getSphere(),o=1/0,l=-1/0,{x:u,y:d,z:f}=r.center,m=r.radius===o||u===o||d===o||f===o,E=r.radius===l||u===l||d===l||f===l,w=r.radius===0;m||E||w||(r.radius*=this.zoomFactor,await t.camera.controls.fitToSphere(r,!0))}setupEvents(e){if(!this.config.world)throw new Error("No world found while setting up events!");if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.config.world.renderer.three.domElement,s=this.events[this.config.selectName].onHighlight;s.remove(this.clearHover),t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("mousemove",this.onMouseMove),e&&(s.add(this.clearHover),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("mousemove",this.onMouseMove))}};T(tu,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let Mm=tu;const Pm=class su extends Fe{constructor(e){super(e),T(this,"onDisposed",new $),T(this,"onNavigated",new $),T(this,"onExited",new $),T(this,"enabled",!1),T(this,"currentPlan",null),T(this,"defaultSectionOffset",1.5),T(this,"defaultCameraOffset",30),T(this,"list",[]),T(this,"world"),T(this,"_floorPlanViewCached",!1),T(this,"_previousCamera",new P),T(this,"_previousTarget",new P),T(this,"_previousProjection","Perspective"),this.components.add(su.uuid,this)}dispose(){this.onExited.reset(),this.onNavigated.reset(),this.list=[],this.onDisposed.trigger(),this.onDisposed.reset()}async generate(e){if(!e.hasProperties)throw new Error("Properties are needed to compute plan views!");const t=await e.getAllPropertiesOfType(Hr);if(!t)throw new Error("Floorplans not found!");const s=e.coordinationMatrix.elements[13],n=await hs.getUnits(e);for(const i of Object.values(t)){const r={value:0};this.getAbsoluteFloorHeight(i.ObjectPlacement,r);const o=r.value*n+s;this.create({name:i.Name.value,id:i.GlobalId.value,normal:new P(0,-1,0),point:new P(0,o,0),ortho:!0,offset:this.defaultSectionOffset})}}create(e){if(!this.world)throw new Error("You must set a world before creating the clipping planes!");if(this.list.find(n=>n.id===e.id)){console.warn(`There's already a plan with the id: ${e.id}`);return}const t=this.createClippingPlane(e),s={...e,plane:t};this.list.push(s)}async goTo(e,t=!1){var s;((s=this.currentPlan)==null?void 0:s.id)!==e&&(this.onNavigated.trigger({id:e}),this.storeCameraPosition(),await this.hidePreviousClippingPlane(),this.updateCurrentPlan(e),await this.activateCurrentPlan(),this.enabled||(await this.moveCameraTo2DPlanPosition(t),this.enabled=!0))}async exitPlanView(e=!1){if(!this.enabled||!this.world)return;this.enabled=!1,this.onExited.trigger(),this.cacheFloorplanView();const t=this.world.camera;t.set("Orbit"),await t.projection.set(this._previousProjection),this.currentPlan&&this.currentPlan.plane&&(this.currentPlan.plane.enabled=!1,this.currentPlan.plane.edges.enabled=!1,this.currentPlan.plane.edges.visible=!1),this.currentPlan=null,await t.controls.setLookAt(this._previousCamera.x,this._previousCamera.y,this._previousCamera.z,this._previousTarget.x,this._previousTarget.y,this._previousTarget.z,e)}storeCameraPosition(){this.enabled?this.cacheFloorplanView():this.store3dCameraPosition()}createClippingPlane(e){if(!this.world)throw new Error("World is needed to create clipping planes!");const{normal:t,point:s}=e,n=s.clone();e.offset&&(n.y+=e.offset);const i=this.components.get(Ur),r=i.Type;i.Type=vi;const o=i.createFromNormalAndCoplanarPoint(this.world,t,n);return o.edges.update(),o.visible=!1,o.enabled=!1,o.edges.enabled=!1,o.edges.visible=!1,i.Type=r,o}cacheFloorplanView(){if(!this.world)throw new Error("World is needed to create clipping planes!");this._floorPlanViewCached=!0,this.world.camera.controls.saveState()}async moveCameraTo2DPlanPosition(e){if(!this.world)throw new Error("World is needed to create clipping planes!");const t=this.world.camera;this._floorPlanViewCached?await t.controls.reset(e):await t.controls.setLookAt(0,100,0,0,0,0,e)}async activateCurrentPlan(){if(!this.world)throw new Error("World is needed to create clipping planes!");if(!this.currentPlan)throw new Error("Current plan is not defined.");const e=this.world.camera;this.currentPlan.plane&&(this.currentPlan.plane.enabled=!0,this.currentPlan.plane.edges.fillNeedsUpdate=!0,this.currentPlan.plane.edges.visible=!0),e.set("Plan");const t=this.currentPlan.ortho?"Orthographic":"Perspective";await e.projection.set(t)}store3dCameraPosition(){if(!this.world)throw new Error("World is needed to create clipping planes!");const e=this.world.camera;e.three.getWorldPosition(this._previousCamera),e.controls.getTarget(this._previousTarget),this._previousProjection=e.projection.current}updateCurrentPlan(e){const t=this.list.find(s=>s.id===e);if(!t)throw new Error("The specified plan is undefined!");this.currentPlan=t}async hidePreviousClippingPlane(){if(this.currentPlan){const e=this.currentPlan.plane;e&&(e.enabled=!1),this.currentPlan.plane instanceof vi&&(this.currentPlan.plane.edges.visible=!1)}}getAbsoluteFloorHeight(e,t){const s=e.RelativePlacement.Location.Coordinates;t.value+=s[2].value,e.PlacementRelTo&&this.getAbsoluteFloorHeight(e.PlacementRelTo,t)}};T(Pm,"uuid","a80874aa-1c93-43a4-80f2-df346da086b1");export{Mm as A,bf as G};
